<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[é˜¿è´µ]]></title>
  <link href="http://andyfightting.github.io/atom.xml" rel="self"/>
  <link href="http://andyfightting.github.io/"/>
  <updated>2016-12-02T20:12:27+08:00</updated>
  <id>http://andyfightting.github.io/</id>
  <author>
    <name><![CDATA[guimingsu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[React Native åŸºç¡€ç»„ä»¶]]></title>
    <link href="http://andyfightting.github.io/blog/2016/12/02/react-base-view/"/>
    <updated>2016-12-02T09:12:24+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/12/02/react-base-view</id>
    <content type="html"><![CDATA[<p>è¿™é‡Œä¸»è¦è®°å½•çœ‹ <a href="https://github.com/facebook/react-native">React Native å®˜æ–¹ä¾‹å­</a> çš„åŸºç¡€ç»„ä»¶è¿‡ç¨‹ä¸­ï¼Œè®°å½•ä¸€äº›æ¯”è¾ƒç‰¹æ®Šæˆ–éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚
<img src="http://andyfightting.github.io/myimg/react/view0.png" width="800" alt="" /></p>

<h4>View</h4>

<pre><code>//å®½åº¦è‡ªé€‚åº”,éœ€è¦åœ¨Textçš„çˆ¶æ§ä»¶ä¸Šè®¾ç½®alignSelfå±æ€§ï¼
å¿…é¡»æŠŠæ–‡å­—æ”¾åœ¨&lt;Text&gt;ç»„ä»¶å†…ã€‚ä¸èƒ½ç›´æ¥åœ¨&lt;View&gt;ä¸‹æ”¾ç½®ä¸€æ®µæ–‡å­—ã€‚
å€¼ä¸ºflex-start,center,flex-endéƒ½ä¼šè‡ªé€‚åº”ï¼è€Œauto,stretchåˆ™ä¸ä¼šï¼
&lt;View style=&gt;
    &lt;Text&gt;è¿™é‡Œçš„æ–‡å­—ä¼šè‡ªé€‚åº”å®½åº¦ï¼&lt;/Text&gt;
&lt;/View&gt;

//èƒŒæ™¯è‰²å’Œåœ†è§’é—®é¢˜
å½“è®¾ç½®äº†èƒŒæ™¯è‰²åˆè®¾ç½®äº†åœ†è§’æ—¶ï¼Œéœ€è¦è®¾ç½® overflow: 'hidden' ï¼Œå¦åˆ™å››ä¸ªè§’ä¼šæœ‰èƒŒæ™¯è‰²ï¼å‰ææ˜¯è¿™ä¸ªViewé‡Œæœ‰å­ç»„ä»¶ï¼Œ
å› ä¸ºåƒcssä¼¼çš„èƒŒæ™¯è‰²ä¼šç»§æ‰¿åˆ°å­ç»„ä»¶ä¸­ï¼å››ä¸ªè§’æ˜¾ç¤ºçš„æ˜¯å­ç»„ä»¶çš„èƒŒæ™¯è‰²ã€‚
æ‰€ä»¥ä¸ç”¨overflow,æŠŠå­ç»„ä»¶èƒŒæ™¯è‰²è®¾ç½®é€æ˜transparentä¹Ÿå¯ä»¥ã€‚ 

//overflow:(visible,hidden,scroll),è®¾ç½®å­ç»„ä»¶è¶…å‡ºçˆ¶ç»„ä»¶çš„è¯è¯¥å¦‚ä½•æ˜¾ç¤ºã€‚
visible:é»˜è®¤å€¼ã€‚å†…å®¹ä¸ä¼šè¢«ä¿®å‰ªï¼Œä¼šå‘ˆç°åœ¨å…ƒç´ æ¡†ä¹‹å¤–ã€‚
hidden:å†…å®¹ä¼šè¢«ä¿®å‰ªï¼Œå¹¶ä¸”å…¶ä½™å†…å®¹æ˜¯ä¸å¯è§çš„ã€‚
scroll:å†…å®¹ä¼šè¢«ä¿®å‰ªï¼Œä½†æ˜¯æµè§ˆå™¨ä¼šæ˜¾ç¤ºæ»šåŠ¨æ¡ä»¥ä¾¿æŸ¥çœ‹å…¶ä½™çš„å†…å®¹ã€‚

//ä¸é€æ˜opacity:(0~1),1ä¸é€æ˜ï¼Œ0é€æ˜ã€‚

//zIndexæ˜¯ä»å±å¹•æŒ‡å‘å¤–çš„zè½´ã€‚

//ä¸€èˆ¬ç”¨TouchableWithoutFeedback onPress æ¥æ¥æ”¶ç‚¹å‡»äº‹ä»¶ã€‚        
</code></pre>

<h4>Text</h4>

<pre><code>//Texté‡Œä¹Ÿå¯ä»¥åµŒå¥—å…¶ä»–ç»„ä»¶ã€‚åµŒå¥—çš„ç©ºé—´æ˜¯spanæ ·å¼è€Œä¸æ˜¯divå—ã€‚

//æ–‡å­—å±…ä¸­é™¤äº†è¦è®¾ç½®textAlign='center'ï¼Œå¤–è¿˜éœ€è®¾ç½®lineHeight = height,å› ä¸ºtextAlignåªæ˜¯æ°´å¹³å¯¹é½æ–¹å¼ã€‚

//Textæœ¬èº«è®¾ç½®alignSelfä¸ºflex-start,center,flex-endä¹Ÿä¼šå®½åº¦è‡ªé€‚åº”ã€‚

//fontStyle: (italic,normal,oblique).

//textDecorationLine:(none,underline,line-through,underline line-through)

//textDecorationStyle: (dashed,dotted,double,solid)

//letterSpacing: å­—ç¬¦é—´è·

//Textæœ‰onPressï¼ŒonLongPress.æ ·å¼å±æ€§å€¼å¯ä»¥é€šè¿‡stateåŠ¨æ€æ”¹å˜ã€‚

//ellipsizeMode: (clip,head,middle,tail,wordWrapping) wordWrapping:ä¸‰ä¸ªç‚¹éƒ½ä¸æ˜¾ç¤º

//adjustsFontSizeToFit: iOSçš„è‡ªåŠ¨è°ƒæ•´å­—ä½“å¤§å°
</code></pre>

<h4>Image</h4>

<pre><code>//Imageé‡Œä¹Ÿå¯ä»¥åµŒå¥—ã€‚ä¹Ÿå¯ä»¥æ˜¾ç¤ºgif

//capInsets {top, left, bottom, right} ,9-patchå›¾ç‰‡æ•ˆæœã€‚

//tintColor: ä¸ºæ‰€æœ‰éé€æ˜çš„åƒç´ æŒ‡å®šä¸€ä¸ªé¢œè‰².(tint:æŸ“ï¼Œç»™...ç€è‰²)

//resizeMode: å›¾ç‰‡å¦‚ä½•æ˜¾ç¤º
Image.resizeMode.cover(æŒ‰æ¯”ä¾‹å……æ»¡),(é»˜è®¤å€¼)
Image.resizeMode.contain(æŒ‰æ¯”ä¾‹åŒ…å«),
Image.resizeMode.stretch(æ‹‰ä¼¸å……æ»¡),
Image.resizeMode.center(æŒ‰æ¯”ä¾‹å±…ä¸­),
Image.resizeMode.repeat(åŸæ¯”ä¾‹é‡å¤æ˜¾ç¤º)

 //å¦‚æœ source æˆ–è€… uri å±æ€§å€¼æœ‰httpå‰ç¼€çš„è¯ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å›¾ç‰‡ã€‚

  //åŠ è½½ç½‘ç»œå›¾ç‰‡çš„ä¸€äº›å›è°ƒæ–¹æ³•ï¼Œä¸è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šè°ƒç”¨onLoadEnd
  &lt;Image
     style=/{/{width:300,height:100/}/} //æŠŠ/å»æ‰
     defaultSource={require('./images/msg.png')}
     onLoadStart={() =&gt; { console.log('Image:-----onLoadStart') }}
     onProgress={() =&gt; { console.log('Image:-----onProgress')  }}
     onLoad={() =&gt; { console.log('Image:-----onLoad')  }}//æˆåŠŸ
     onError={() =&gt; { console.log('Image:-----onError')  }}//å¤±è´¥
     onLoadEnd={() =&gt; { console.log('Image:-----onLoadEnd')  }}//ä¸è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šè¢«è°ƒç”¨
     source=/{/{uri:'https:xxx.png'/}/} //æŠŠ/éƒ½å»æ‰
    /&gt;
</code></pre>

<h4>å›¾ç‰‡åŠ è½½æˆåŠŸ</h4>

<p><img src="http://andyfightting.github.io/myimg/react/images.png" width="400" alt="" /></p>

<h4>å›¾ç‰‡åŠ è½½å¤±è´¥</h4>

<p><img src="http://andyfightting.github.io/myimg/react/imagee.png" width="400" alt="" /></p>

<h4>Button</h4>

<pre><code>//color: iOSæ˜¯è®¾ç½®æ–‡å­—é¢œè‰²ï¼Œè€ŒAndroidæ˜¯è®¾ç½®èƒŒæ™¯è‰².title å’Œ onPressä¸¤ä¸ªå±æ€§æ˜¯å¿…é¡»çš„ã€‚
Buttonå¯ä»¥å±æ€§å¾ˆå°‘å•Šï¼Œstyleæ ·å¼éƒ½æ²¡ç”¨...ä¸€èˆ¬ç”¨TouchableOpacityæˆ–TouchableNativeFeedbackåµŒå¥—Textæ¥è‡ªå®šä¹‰æŒ‰é’®ã€‚
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Native Navigator]]></title>
    <link href="http://andyfightting.github.io/blog/2016/12/01/react-navigator/"/>
    <updated>2016-12-01T09:27:30+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/12/01/react-navigator</id>
    <content type="html"><![CDATA[<p>è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹Navigatorçš„åŸºæœ¬ä½¿ç”¨ï¼Œé¡µé¢é—´çš„ä¼ å‚ï¼Œå›è°ƒï¼Œä»¥åŠåœ¨push,popè¿‡ç¨‹ä¸­ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è°ƒç”¨é¡ºåºã€‚</p>

<p>React çš„â€œé¡µé¢â€çš„æ¦‚å¿µå’ŒAndroidæˆ–iOSæœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä¸åƒAndroidæœ‰ä¸ªActivityä½œä¸ºé¡µé¢å®¹å™¨ï¼ŒiOSæœ‰Controllerä½œä¸ºé¡µé¢å®¹å™¨ã€‚React çš„â€œé¡µé¢â€æœ¬èº«å°±æ˜¯ä¸€ä¸ªç»„ä»¶é›†åˆï¼Œå’ŒText,Imageç­‰åŸºç¡€ç»„ä»¶æ˜¯ä¸€ä¸ªçº§åˆ«çš„ä¸œè¥¿ã€‚åªä¸è¿‡æ˜¯æŠŠå¤šä¸ªç»„ä»¶æ‹¼èµ·æ¥å……æ»¡å±å¹•ï¼Œå°±ç»„æˆä¸€ä¸ªâ€œé¡µé¢â€äº†ã€‚</p>

<p>é€šè¿‡åœ¨Navigatorçš„routeé‡Œæ”¾ç½®ä¸€ä¸ªparamså‚æ•°ï¼Œparamsé‡Œé¢æ”¾key-valueä¼ å‚ã€‚æ³¨æ„ï¼Œæ–¹æ³•ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å½“åšvalueä¼ é€’ï¼Œè¿™æ ·å°±å¯å›è°ƒäº†ã€‚å°±åƒAndroidçš„æ¥å£å›è°ƒæˆ–iOSçš„blockä¼¼çš„ï¼Œåœ¨Aé¡µé¢å®ç°æ–¹æ³•ï¼Œç„¶åä¼ é€’ç»™Bé¡µé¢ï¼Œåœ¨Bé¡µé¢ä½¿ç”¨æ–¹æ³•ï¼Œè¿™æ ·æ•°æ®å°±ä»Bå›ä¼ ç»™Aäº†ã€‚æ•°æ®ä»æ–¹æ³•ä½¿ç”¨çš„åœ°æ–¹ä¼ åˆ°æ–¹æ³•å®ç°çš„åœ°æ–¹ã€‚</p>

<h4>åœ¨Index.jsé‡Œåˆå§‹åŒ–Navigatorå¹¶ä¸”æ˜¾ç¤ºç¬¬ä¸€ä¸ªé¡µé¢FirstView:</h4>

<p><img src="http://andyfightting.github.io/myimg/java/lift0.png" width="500" alt="" /></p>

<h4>ä»FirstView push åˆ°SecondView</h4>

<p><img src="http://andyfightting.github.io/myimg/java/lift1.png" width="500" alt="" /></p>

<h4>ä¸è°ƒç”¨FirstViewçš„å›è°ƒæ–¹æ³•ç›´æ¥popã€‚</h4>

<p><img src="http://andyfightting.github.io/myimg/java/life3.png" width="500" alt="" /></p>

<h4>å¦‚æœåœ¨SecondViewé‡Œç‚¹å‡»è¿”å›çš„æ—¶å€™ï¼Œå…ˆæ‰ç”¨FirstViewçš„å›è°ƒæ–¹æ³•, åœ¨å›è°ƒæ–¹æ³•é‡Œè°ƒç”¨ setState() åˆ·æ–°FirstViewï¼Œç„¶å pop ã€‚</h4>

<p><img src="http://andyfightting.github.io/myimg/java/lift2.png" width="500" alt="" /></p>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºä¸ç®¡æ˜¯ä»Aåˆ°Bè¿˜æ˜¯ä»Bè¿”å›A,Açš„componentWillReceivePropséƒ½ä¼šè¢«è°ƒç”¨! Açš„æ›´æ–°æµç¨‹éƒ½ä¼šå…ˆèµ°ä¸€éï¼</p>

<p><img src="http://andyfightting.github.io/myimg/java/life4.png" width="600" alt="" /></p>

<pre><code>configureScene å±æ€§ç”¨æ¥é…ç½®åœºæ™¯åŠ¨ç”»ã€‚
configureScene={(route, routeStack) =&gt; {
                return Navigator.SceneConfigs.PushFromRight;
              }}
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>åœ¨/node_modules/react-native/Libraries/CustomComponents/Navigator/NavigatorSceneConfigs ä¸­é¢„è®¾äº†å¾ˆå¤šè½¬åœºåŠ¨ç”»ã€‚
</span><span class='line'>PushFromRight
</span><span class='line'>PushFromLeft
</span><span class='line'>FloatFromRight // We will want to customize this soon
</span><span class='line'>FloatFromLeft
</span><span class='line'>FloatFromBottom
</span><span class='line'>FloatFromBottomAndroid
</span><span class='line'>FadeAndroid
</span><span class='line'>HorizontalSwipeJump
</span><span class='line'>HorizontalSwipeJumpFromRight
</span><span class='line'>HorizontalSwipeJumpFromLeft
</span><span class='line'>VerticalUpSwipeJump
</span><span class='line'>VerticalDownSwipeJump</span></code></pre></td></tr></table></div></figure>


<h4>å…¶ä»–æ–¹æ³•</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getCurrentRoutes() - è·å–å½“å‰æ ˆé‡Œçš„æ‰€æœ‰è·¯ç”±
</span><span class='line'>jumpBack() - è·³å›ä¹‹å‰çš„è·¯ç”±ï¼Œè¿˜ä¿ç•™ç°åœ¨çš„ï¼Œè¿˜å¯ä»¥å†è·³å›æ¥ï¼Œä¼šä¿ç•™åŸæ ·
</span><span class='line'>jumpForward() - ä¸ä¸Šä¸€ä¸ªæ–¹æ³•å¯¹åº”
</span><span class='line'>jumpTo(route) - è·³è½¬åˆ°å·²æœ‰çš„åœºæ™¯å¹¶ä¸”ä¸å¸è½½
</span><span class='line'>push(route) - è·³è½¬åˆ°æ–°çš„åœºæ™¯ï¼Œå¹¶ä¸”å°†åœºæ™¯å…¥æ ˆ
</span><span class='line'>pop() - è·³è½¬å›å»å¹¶ä¸”å¸è½½æ‰å½“å‰åœºæ™¯
</span><span class='line'>replace(route) - ç”¨ä¸€ä¸ªæ–°çš„è·¯ç”±æ›¿æ¢æ‰å½“å‰åœºæ™¯
</span><span class='line'>replaceAtIndex(route, index) - æ›¿æ¢æ‰æŒ‡å®šåºåˆ—çš„è·¯ç”±åœºæ™¯
</span><span class='line'>replacePrevious(route) - æ›¿æ¢æ‰ä¹‹å‰çš„åœºæ™¯
</span><span class='line'>resetTo(route) - è·³è½¬åˆ°æ–°çš„åœºæ™¯ï¼Œå¹¶ä¸”é‡ç½®æ•´ä¸ªè·¯ç”±æ ˆ
</span><span class='line'>immediatelyResetRouteStack(routeStack) - ç”¨æ–°çš„è·¯ç”±æ•°ç»„æ¥é‡ç½®è·¯ç”±æ ˆ
</span><span class='line'>popToRoute(route) - popåˆ°è·¯ç”±æŒ‡å®šçš„åœºæ™¯ï¼Œåœ¨æ•´ä¸ªè·¯ç”±æ ˆä¸­ï¼Œå¤„äºæŒ‡å®šåœºæ™¯ä¹‹åçš„åœºæ™¯å°†ä¼šè¢«å¸è½½
</span><span class='line'>popToTop() - popåˆ°æ ˆä¸­çš„ç¬¬ä¸€ä¸ªåœºæ™¯ï¼Œå¸è½½æ‰æ‰€æœ‰çš„å…¶ä»–åœºæ™¯</span></code></pre></td></tr></table></div></figure>


<h4>index.ios.js</h4>

<pre><code>import React, {Component} from 'react';
import {View,Navigator,AppRegistry} from 'react-native';
import FirstView from './FirstView';

   var logName = 'Index:--------';

   export default class BaseNavigator extends Component {
     constructor(props){
          console.log(logName + 'constructor');
          super(props);
      }
      componentWillMount(){
          console.log(logName + 'componentWillMount');
      }
       render() {
         console.log(logName+'render')
        return (
        &lt;Navigator
          //æŠŠä¸‹é¢ä¸€è¡Œçš„/éƒ½å»æ‰ï¼Œå› ä¸ºMarkdownè½¬åŒ–ä¸äº†æ‰€ä»¥åŠ çš„
          initialRoute=/{/{params: /{/},view: FirstView /}/}
          renderScene={(route, navigator) =&gt; {
            let ShowedView = route.view;
            return &lt;ShowedView {...route.params} nav={navigator} /&gt;
          }} /&gt;
        );
       }

       componentDidMount() {
           console.log(logName + 'componentDidMount');
       }

       componentWillReceiveProps(nextprops){
              console.log(logName + 'componentWillReceiveProps');
        }
        shouldComponentUpdate(nextProps,nextState){
              console.log(logName + 'shouldComponentUpdate');
            return true;
        }
        componentWillUpdate(nextProps,nextState){
              console.log(logName + 'componentWillUpdate');
        }
        componentDidUpdate(prevProps,prevState){
            console.log(logName + 'componentDidUpdate');
        }
        componentWillUnmount(){
            console.log(logName + 'componentWillUnmount');
        }
   }
AppRegistry.registerComponent('MyReact', () =&gt; BaseNavigator);
</code></pre>

<h4>FirstView.js</h4>

<pre><code>import React,{Component} from 'react';
import {View,StyleSheet,Text} from 'react-native';
import SecondView from './SecondView';

var logName = 'FirstView:--------';
export default class FirstView extends Component { 
  constructor(props) {
    console.log(logName + 'constructor');
        super(props);
        this.state = {
            callBackMsg: '',
        };
    }
   componentWillMount(){
       console.log(logName + 'componentWillMount');
   }

    render() {
      console.log(logName+'render')
        return (
            &lt;View style={styles.backView}&gt;
                  &lt;Text style={styles.tapView}  onPress={this.pressedFun.bind(this)}&gt;ç‚¹å‡»è·³è½¬&lt;/Text&gt;
                  &lt;Text style={styles.msgView}&gt;
                    {this.state.callBackMsg}
                  &lt;/Text&gt;
            &lt;/View&gt;
        );
    }
    componentDidMount() {
        console.log(logName + 'componentDidMount');
    }

    componentWillReceiveProps(nextprops){
           console.log(logName + 'componentWillReceiveProps');
     }
     shouldComponentUpdate(nextProps,nextState){
           console.log(logName + 'shouldComponentUpdate');
         return true;
     }
     componentWillUpdate(nextProps,nextState){
           console.log(logName + 'componentWillUpdate');
     }
     componentDidUpdate(prevProps,prevState){
         console.log(logName + 'componentDidUpdate');
     }
     componentWillUnmount(){
         console.log(logName + 'componentWillUnmount');
     }
//-------ä¸ªäººæ–¹æ³•--------
    pressedFun() {
        let nav = this.props.nav;
        let tmpThis = this;
            nav.push({
                view: SecondView,
                params:{
                  userId: 123,
                  userName: 'andy',
                  callBackFun: function(newMsg){
                      tmpThis.setState({
                        callBackMsg: newMsg,
                      })
                  },
                },
            });
          }
}

const styles = StyleSheet.create({
  backView:{
    flex: 1,
    justifyContent: 'center',
    backgroundColor: 'azure',
  },
  tapView:{
    fontSize: 20,
    alignSelf: 'center',
    textAlign: 'center',
    width: 130,
    height: 50,
    lineHeight: 50,
    color: 'yellow',
    borderColor: 'yellow',
    borderWidth: 2,
    borderRadius: 25,
    backgroundColor: 'blue',
    overflow: 'hidden',//ä¸ç„¶è¾¹è§’ä¼šæœ‰èƒŒæ™¯è‰²
  },
  msgView:{
    fontSize: 16,
    marginTop: 30,
    textAlign: 'center',
  },
});
</code></pre>

<h4>SecondView.js</h4>

<pre><code>import React,{Component} from 'react';
import {View,Navigator,StyleSheet,TouchableWithoutFeedback,Image,Text,} from 'react-native';

var logName = 'SecondView:--------';
export default class SecondView extends Component {
  static defaultProps = {
      // testProp: 'testPropé»˜è®¤å€¼',
  }
  static propTypes = {
      // testProp: React.PropTypes.string.isRequired,
  }
  constructor(props) {
        console.log(logName + 'constructor');
        super(props);
        this.state = {};
    }
    componentWillMount(){
        console.log(logName + 'componentWillMount');
    }
    render() {
      console.log(logName+'render')
       return (
            &lt;View style={styles.backView}&gt;
              &lt;View style={styles.titleBackView}&gt;
              &lt;TouchableWithoutFeedback onPress={this.backPressed.bind(this)}&gt;
                 &lt;Image style={styles.backImage} source= {require('./images/backImage.png')}/&gt;
              &lt;/TouchableWithoutFeedback&gt;
                &lt;Text style={styles.titleView}&gt;æ ‡é¢˜&lt;/Text&gt;
              &lt;/View&gt;
                &lt;Text&gt;ä¸Šä¸ªé¡µé¢ä¼ æ¥çš„å‚æ•°userId: {this.props.userId}&lt;/Text&gt;
                &lt;Text&gt;ä¸Šä¸ªé¡µé¢ä¼ æ¥çš„å‚æ•°userName: {this.props.userName}&lt;/Text&gt;
            &lt;/View&gt;
        );
    }
    componentDidMount() {
        console.log(logName + 'componentDidMount');
    }

    componentWillReceiveProps(nextprops){
           console.log(logName + 'componentWillReceiveProps');
     }
     shouldComponentUpdate(nextProps,nextState){
           console.log(logName + 'shouldComponentUpdate');
         return true;
     }
     componentWillUpdate(nextProps,nextState){
           console.log(logName + 'componentWillUpdate');
     }
     componentDidUpdate(prevProps,prevState){
         console.log(logName + 'componentDidUpdate');
     }
     componentWillUnmount(){
         console.log(logName + 'componentWillUnmount');
     }

//------ä¸ªäººæ–¹æ³•--------
     backPressed() {
         let nav = this.props.nav;
             this.props.callBackFun('è¿™æ˜¯æ¶ˆå¤±çš„é¡µé¢é€šè¿‡å›è°ƒæ–¹æ³•ä¼ æ¥çš„æ•°æ®ï¼');
             nav.pop();
     }
}
const styles = StyleSheet.create({
  backView:{
    flex: 1,
    backgroundColor: 'bisque',
  },
  titleBackView:{
    height: 65,
    backgroundColor: 'darkkhaki',
    flexDirection: 'row'
  },
  titleView:{
    height:45,
    lineHeight:45,
    marginTop:20,
    color: 'white',
    fontSize: 18,
    textAlign: 'center',
    alignSelf: 'center',
    flex: 1,
    marginRight:20,
  },
  backImage:{
    marginTop:35,
    marginLeft:10,
    width: 10,
    height: 20,
  },
});
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Native ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/30/react-native-life/"/>
    <updated>2016-11-30T11:08:59+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/30/react-native-life</id>
    <content type="html"><![CDATA[<p>ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ä»å¼€å§‹ç”Ÿæˆåˆ°æœ€åæ¶ˆäº¡æ‰€ç»å†çš„çŠ¶æ€ï¼Œç†è§£ç”Ÿå‘½å‘¨æœŸæ˜¯å¼€å‘çš„åŸºç¡€ã€‚ES5è¯­æ³•å’ŒES6è¯­æ³•æœ‰æ‰€å˜åŒ–ï¼Œåœ¨ES5è¯­æ³•ä¸­ï¼Œæœ‰getDefaultPropTypesæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç»„ä»¶è¢«åˆ›å»ºæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œå®ƒçš„è¿”å›å€¼æˆä¸ºäº†this.propsçš„åˆå§‹å€¼ã€‚è€ŒES6è¯­æ³•ä¸­ï¼Œå±æ€§çš„ç±»å‹å’Œé»˜è®¤å€¼å£°æ˜ä¸åƒES5è¯­æ³•é‚£æ ·åœ¨ç»„ä»¶å®šä¹‰å†…éƒ¨å£°æ˜,è€Œæ˜¯åœ¨ç»„ä»¶å®šä¹‰çš„å¤–éƒ¨å£°æ˜ï¼Œæ‰€ä»¥æ²¡æœ‰äº†getDefaultPropTypesæ–¹æ³•.</p>

<p><img src="http://andyfightting.github.io/myimg/java/life2.png" alt="" /></p>

<h4>å¯ä»¥æŠŠç»„ä»¶ç”Ÿå‘½å‘¨æœŸå¤§è‡´åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ç¬¬ä¸€é˜¶æ®µï¼šæ˜¯ç»„ä»¶ç¬¬ä¸€æ¬¡ç»˜åˆ¶é˜¶æ®µï¼Œå¦‚å›¾ä¸­çš„ä¸Šé¢è™šçº¿æ¡†å†…ï¼Œåœ¨è¿™é‡Œå®Œæˆäº†ç»„ä»¶çš„åŠ è½½å’Œåˆå§‹åŒ–ï¼›
</span><span class='line'>ç¬¬äºŒé˜¶æ®µï¼šæ˜¯ç»„ä»¶åœ¨è¿è¡Œå’Œäº¤äº’é˜¶æ®µï¼Œå¦‚å›¾ä¸­å·¦ä¸‹è§’è™šçº¿æ¡†ï¼Œè¿™ä¸ªé˜¶æ®µç»„ä»¶å¯ä»¥å¤„ç†ç”¨æˆ·äº¤äº’æ¥æ”¶äº‹ä»¶æ›´æ–°ç•Œé¢ï¼›
</span><span class='line'>ç¬¬ä¸‰é˜¶æ®µï¼šæ˜¯ç»„ä»¶å¸è½½æ¶ˆäº¡çš„é˜¶æ®µï¼Œå¦‚å›¾ä¸­å³ä¸‹è§’çš„è™šçº¿æ¡†ä¸­ï¼Œè¿™é‡Œåšä¸€äº›ç»„ä»¶çš„æ¸…ç†å·¥ä½œã€‚</span></code></pre></td></tr></table></div></figure>


<p><strong>constructor(props) :</strong>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ã€‚ è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥é€šè¿‡this.stateåˆå§‹åŒ–çŠ¶æ€å‚æ•°ï¼ŒES5æ˜¯é€šè¿‡getInitialState()æ–¹æ³•åˆå§‹åŒ–çš„ã€‚</p>

<p><strong>getDefaultProps() :</strong>åœ¨ç»„ä»¶ç±»åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œç„¶åè¿”å›å€¼è¢«ç¼“å­˜ä¸‹æ¥ã€‚å…¨å±€è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«ã€‚</p>

<p><strong>getInitialState() :</strong>åœ¨ç»„ä»¶æŒ‚è½½ä¹‹å‰è°ƒç”¨ä¸€æ¬¡ã€‚è¿”å›å€¼å°†ä¼šä½œä¸º this.state çš„åˆå§‹å€¼ã€‚</p>

<p><strong>componentWillMount() :</strong>åœ¨ç»„ä»¶åˆ›å»ºå¹¶åˆå§‹åŒ–äº†çŠ¶æ€ä¹‹åï¼Œåœ¨ç¬¬ä¸€æ¬¡ render() ä¹‹å‰ã€‚å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚è¿™ä¸ªå‡½æ•°åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p>

<p><strong>render() :</strong>è¿™ä¸ªæ–¹æ³•æ˜¯å¿…é¡»çš„ï¼Œå¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥è¿”å› null æˆ–è€… false æ¥è¡¨æ˜ä¸éœ€è¦æ¸²æŸ“ä»»ä½•ä¸œè¥¿.</p>

<p><strong>componentDidMount() :</strong>åœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡ç»˜åˆ¶ä¹‹åï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•é€šçŸ¥ç»„ä»¶å·²ç»åŠ è½½å®Œæˆã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œå…¶è™šæ‹Ÿ DOM å·²ç»æ„å»ºå®Œæˆï¼Œå¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œè·å–å…¶ä¸­çš„å…ƒç´ æˆ–è€…å­ç»„ä»¶ã€‚æ¡†æ¶æ˜¯å…ˆè°ƒç”¨å­ç»„ä»¶çš„è¯¥æ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨çˆ¶ç»„ä»¶çš„ã€‚å¯ä»¥åœ¨è¿™é‡Œå‘èµ·ç½‘ç»œè¯·æ±‚ç­‰ã€‚</p>

<p><strong>componentWillReceiveProps(nextProps) :</strong> çˆ¶ç»„ä»¶æ”¹å˜å­ç»„ä»¶çš„å±æ€§çš„æ—¶å€™ä¼šè°ƒç”¨è¯¥æ–¹æ³•,åˆæ¬¡æ¸²æŸ“æ—¶ä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚å‚æ•°nextPropsæ˜¯å³å°†è¢«è®¾ç½®çš„å±æ€§ï¼Œæ—§çš„å±æ€§è¿˜æ˜¯å¯ä»¥é€šè¿‡ this.props æ¥è·å–ã€‚</p>

<p><strong>shouldComponentUpdate(nextProps,nextState) :</strong>å½“ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„å±æ€§æˆ–çŠ¶æ€æ”¹å˜çš„è¯ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚å‚æ•° nextProps å’Œä¸Šé¢çš„æ–¹æ³•ä¸€æ ·ã€‚nextState è¡¨ç¤ºç»„ä»¶å³å°†æ›´æ–°çš„çŠ¶æ€å€¼ã€‚è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å†³å®šæ˜¯å¦éœ€è¦æ›´æ–°ç»„ä»¶ï¼Œé»˜è®¤è¿”å›trueã€‚å¯ä»¥é‡è½½è¿™ä¸ªå‡½æ•°æ¥å†³å®šç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°ã€‚</p>

<p><strong>componentWillUpdate(nextProps,nextState) :</strong>å¦‚æœç»„ä»¶çŠ¶æ€æ”¹å˜ï¼Œå¹¶ä¸”ä¸Šé¢çš„æ–¹æ³•è¿”å›ä¸ºtrueï¼Œå°±ä¼šå¼€å§‹å‡†æ›´æ–°ç»„ä»¶ã€‚è¿™é‡Œå¯ä»¥åšä¸€äº›åœ¨æ›´æ–°ç»„ä»¶ä¹‹å‰è¦åšçš„äº‹æƒ…ã€‚<strong>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¸èƒ½å†è°ƒç”¨ this.setState æ¥ä¿®æ”¹çŠ¶æ€</strong>ã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨ä¹‹åï¼Œå°±ä¼šæŠŠ nextProps å’Œ nextState åˆ†åˆ«è®¾ç½®åˆ° this.props å’Œ this.state ä¸­ã€‚ç´§æ¥ç€å°±ä¼šè°ƒç”¨ render() æ¥æ›´æ–°ç»„ä»¶äº†ã€‚</p>

<p><strong>componentDidUpdate(prevProps,prevState) :</strong>åœ¨è°ƒç”¨äº† render() æ›´æ–°ç»„ä»¶åŒæ­¥åˆ° DOM ä¸­ä¹‹åç«‹åˆ»è°ƒç”¨è¯¥æ–¹æ³•ã€‚å› ä¸ºåˆ°è¿™é‡Œå·²ç»å®Œæˆäº†å±æ€§å’ŒçŠ¶æ€çš„æ›´æ–°äº†ï¼Œæ­¤æ–¹æ³•çš„å‚æ•°å˜æˆäº† prevProps å’Œ prevStateã€‚</p>

<p><strong>componentWillUnmount() :</strong>å½“ç»„ä»¶ä» DOM ä¸­ç§»é™¤çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚å¯ä»¥è¿™ä¸ªæ–¹æ³•ä¸­åšä¸€äº›èµ„æºæ¸…ç†å·¥ä½œã€‚</p>

<p><a href="http://bbs.reactnative.cn/topic/15/react-react-native-%E7%9A%84es5-es6%E5%86%99%E6%B3%95%E5%AF%B9%E7%85%A7%E8%A1%A8">ES5 ES6å†™æ³•å¯¹ç…§è¡¨</a></p>

<p><a href="http://blog.kdchang.cc/2016/04/04/react-react-native-es5-es6-cheat-sheet/">ES5 ES6åŒºåˆ«</a></p>

<p><a href="https://babeljs.io/blog/2015/06/07/react-on-es6-plus">React on ES6</a></p>

<p><a href="http://egorsmirnov.me/2015/06/14/react-and-es6-part2.html">React and ES6</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Flexbox å¸ƒå±€]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/30/css-flex-box/"/>
    <updated>2016-11-30T08:56:06+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/30/css-flex-box</id>
    <content type="html"><![CDATA[<p>å¼¹æ€§ç›’å­å¸ƒå±€ç”±å¼¹æ€§å®¹å™¨å’Œå¼¹æ€§å­itemç»„æˆã€‚å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šæ°´å¹³çš„ä¸»è½´å’Œå‚ç›´çš„äº¤å‰è½´ã€‚ä¸»è½´çš„å¼€å§‹ä½ç½®å«åšmain startï¼Œç»“æŸä½ç½®å«åšmain endï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åšcross startï¼Œç»“æŸä½ç½®å«åšcross endã€‚itemé»˜è®¤æ²¿ä¸»è½´æ’åˆ—ã€‚itemå æ®çš„ä¸»è½´ç©ºé—´å«åšmain sizeï¼Œå æ®çš„äº¤å‰è½´ç©ºé—´å«åšcross size
<img src="http://andyfightting.github.io/myimg/java/flexbox.png" width="600" alt="" /></p>

<p><strong>ç”¨åœ¨å®¹å™¨ä¸Šçš„å±æ€§ï¼š</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flex-direction :å†³å®šitemçš„æ’åˆ—æ–¹å‘ã€‚(row,row-reverse,column,column-reverse)
</span><span class='line'>flex-wrap :å†³å®šitemå¦‚ä½•æ¢è¡Œã€‚(nowrap,wrap,wrap-reverse)
</span><span class='line'>justify-content :å†³å®šitmeåœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚(flex-start,flex-end,center,space-between,space-around)
</span><span class='line'>align-items :å†³å®šitemåœ¨äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚(stretch,flex-start,flex-end,center,baseline:itemç¬¬ä¸€è¡Œæ–‡å­—åŸºçº¿å¯¹é½)
</span><span class='line'>align-content :å†³å®šå¤šæ¡äº¤å‰è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚(flex-start,flex-end,center,space-between,space-around,stretch)</span></code></pre></td></tr></table></div></figure>


<p>align-content:</p>

<p><img src="http://andyfightting.github.io/myimg/java/flex1.png" width="400" alt="" /></p>

<p><strong>ç”¨åœ¨Itemä¸Šçš„å±æ€§</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>order :å®šä¹‰itemçš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º0ã€‚
</span><span class='line'>flex-grow :å®šä¹‰itemçš„æ”¾å¤§æ¯”ä¾‹ã€‚é»˜è®¤ä¸º0ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ä¹Ÿä¸æ”¾å¤§ã€‚æœ‰å¤šä¸ªçš„è¯æŒ‰æ¯”ä¾‹å‡åˆ†ã€‚
</span><span class='line'>flex-shrink :å®šä¹‰itemçš„ç¼©å°æ¯”ä¾‹ã€‚é»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚0åˆ™ä¸ç¼©å°ã€‚
</span><span class='line'>flex-basis :å®šä¹‰äº†åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œitemå æ®çš„ä¸»è½´ç©ºé—´,é»˜è®¤auto,å³æœ¬æ¥å¤§å°ã€‚
</span><span class='line'>flex : flex-grow, flex-shrink å’Œ flex-basisçš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º0 1 autoã€‚
</span><span class='line'>align-self :è®¾ç½®itemè‡ªèº«åœ¨äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚å¯è¦†ç›–align-itemså±æ€§ã€‚
</span><span class='line'>é»˜è®¤å€¼ä¸ºautoï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„align-itemså±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäºstretchã€‚
</span><span class='line'>(auto,flex-start,flex-end,center,baseline,stretch)</span></code></pre></td></tr></table></div></figure>


<p>React Nativeä¸­çš„Flexboxçš„å·¥ä½œåŸç†å’Œwebä¸Šçš„CSSåŸºæœ¬ä¸€è‡´ï¼Œä¹Ÿæœ‰äº›å·®å¼‚:flexDirectionçš„é»˜è®¤å€¼æ˜¯columnè€Œä¸æ˜¯rowï¼ŒalignItemsçš„é»˜è®¤å€¼æ˜¯stretchè€Œä¸æ˜¯flex-startã€‚ä½¿ç”¨flexDirectionã€alignItemså’Œ justifyContentä¸‰ä¸ªæ ·å¼å±æ€§å°±å·²ç»èƒ½æ»¡è¶³å¤§å¤šæ•°å¸ƒå±€éœ€æ±‚ã€‚</p>

<p><code>flexDirection</code>: å†³å®šå¸ƒå±€çš„ä¸»è½´ã€‚å­å…ƒç´ æ˜¯æ²¿ç€æ°´å¹³è½´æ–¹å‘æ’åˆ—ï¼Œè¿˜æ˜¯æ²¿ç€ç«–ç›´è½´æ–¹å‘æ’åˆ—ã€‚</p>

<p><code>justifyContent</code>: å†³å®šå­å…ƒç´ æ²¿ç€ä¸»è½´çš„æ’åˆ—æ–¹å¼ã€‚æœ‰flex-startã€centerã€flex-endã€space-around å’Œ space-betweenã€‚</p>

<p><code>alignItems</code>: å†³å®šå…¶å­å…ƒç´ æ²¿ç€äº¤å‰è½´çš„æ’åˆ—æ–¹å¼ã€‚æœ‰flex-startã€centerã€flex-endä»¥åŠstretchã€‚<strong>æ³¨æ„ï¼šè¦ä½¿stretché€‰é¡¹ç”Ÿæ•ˆçš„è¯ï¼Œå­å…ƒç´ åœ¨æ¬¡è½´æ–¹å‘ä¸Šä¸èƒ½å›ºå®šå°ºå¯¸ã€‚</strong></p>

<p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-examples.html">Fexboxå¸ƒå±€å®ä¾‹</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Native æ ·å¼å±æ€§]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/29/rn-style/"/>
    <updated>2016-11-29T22:27:51+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/29/rn-style</id>
    <content type="html"><![CDATA[<p>React Native é‡‡ç”¨CSSæ ·å¼æ¥å¸ƒå±€ï¼Œä¹Ÿä¼šæœ‰ç»§æ‰¿å’Œè¦†ç›–ä½œç”¨ã€‚åªè¦åœ¨æ ·å¼è¡¨ä¸­ä¹¦å†™ä¸€ä¸ªä¸å­˜åœ¨çš„æ ·å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œæç¤ºè¯¥æ ·å¼ä¸å­˜åœ¨ï¼Œç„¶åæä¾›æ‰€æœ‰å¯ç”¨çš„æ ·å¼ï¼š
<img src="http://andyfightting.github.io/myimg/java/style.png" alt="" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//è¾¹æ¡†
</span><span class='line'>borderBottomWidth 
</span><span class='line'>borderLeftWidth 
</span><span class='line'>borderRightWidth 
</span><span class='line'>borderTopWidth 
</span><span class='line'>borderWidth </span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//è¾¹æ¡†é¢œè‰²
</span><span class='line'>borderBottomColor
</span><span class='line'>borderLeftColor
</span><span class='line'>borderRightColor
</span><span class='line'>borderTopColor
</span><span class='line'>borderColor</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//å¤–è¾¹è·
</span><span class='line'>marginTop
</span><span class='line'>marginBottom
</span><span class='line'>marginLeft
</span><span class='line'>marginRight
</span><span class='line'>marginVertical //ç›¸å½“äºmarginTop å’Œ marginBottom
</span><span class='line'>marginHorizontal //ç›¸å½“äº marginLeft å’Œ marginRight
</span><span class='line'>margin</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//å†…è¾¹è·  
</span><span class='line'>paddingTop  
</span><span class='line'>paddingBottom
</span><span class='line'>paddingLeft  
</span><span class='line'>paddingRight  
</span><span class='line'>paddingVertical //ç›¸å½“äº paddingTop å’Œ paddingBottom
</span><span class='line'>paddingHorizontal  //ç›¸å½“äº paddingLeft å’Œ paddingRight
</span><span class='line'>padding </span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//è¾¹æ¡†åœ†è§’
</span><span class='line'>borderTopLeftRadius
</span><span class='line'>borderTopRightRadius
</span><span class='line'>borderBottomLeftRadius
</span><span class='line'>borderBottomRightRadius
</span><span class='line'>borderRadius</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//flex å¸ƒå±€
</span><span class='line'>flex number 
</span><span class='line'>flexDirection enum('row', 'column') 
</span><span class='line'>flexWrap enum('wrap', 'nowrap') 
</span><span class='line'>alignItems enum('flex-start', 'flex-end', 'center', 'stretch') 
</span><span class='line'>alignSelf enum('auto', 'flex-start', 'flex-end', 'center', 'stretch') 
</span><span class='line'>justifyContent enum('flex-start', 'flex-end', 'center', 'space-between', 'space-around') 
</span><span class='line'>positionå±æ€§å€¼ä¸ºabsoluteå’Œrelativeï¼Œå½“ä½¿ç”¨ç»å¯¹å¸ƒå±€æ—¶ï¼Œå®šä½æ ¹æ®å±å¹•æ¥è¿›è¡Œã€‚</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//å­—ä½“ç›¸å…³å±æ€§
</span><span class='line'>color å­—ä½“é¢œè‰²
</span><span class='line'>fontFamily å­—ä½“æ—
</span><span class='line'>fontSize å­—ä½“å¤§å°
</span><span class='line'>fontStyle å­—ä½“æ ·å¼ï¼Œæ­£å¸¸ï¼Œå€¾æ–œç­‰ï¼Œå€¼ä¸ºenum('normal', 'italic')
</span><span class='line'>fontWeight å­—ä½“ç²—ç»†ï¼Œå€¼ä¸ºenum("normal", 'bold', '100', '200', '300', '400', '500', '600', '700', '800', '900')
</span><span class='line'>letterSpacing å­—ç¬¦é—´éš”
</span><span class='line'>lineHeight è¡Œé«˜
</span><span class='line'>textAlign å­—ä½“å¯¹é½æ–¹å¼ï¼Œå€¼ä¸ºenum("auto", 'left', 'right', 'center', 'justify')
</span><span class='line'>textDecorationLine ä¸Šåˆ’çº¿ï¼Œä¸‹åˆ’çº¿ï¼Œåˆ é™¤çº¿ï¼Œæ— ä¿®é¥°ï¼Œå€¼ä¸ºenum("none", 'underline', 'line-through', 'underline line-through')
</span><span class='line'>textDecorationStyle ä¿®é¥°çš„çº¿çš„ç±»å‹ enum("solid", 'double', 'dotted', 'dashed')
</span><span class='line'>textDecorationColor ä¿®é¥°çš„çº¿çš„é¢œè‰²
</span><span class='line'>writingDirection enum("auto", 'ltr', 'rtl') ä¹¦å†™æ–¹å‘ï¼Œä»å·¦å¾€å³å†™è¿˜æ˜¯ä»å³å¾€å·¦å†™</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//å›¾ç‰‡ç›¸å…³å±æ€§
</span><span class='line'>resizeMode enum('cover', 'contain', 'stretch')
</span><span class='line'>overflow enum('visible', 'hidden') è¶…å‡ºéƒ¨åˆ†æ˜¯å¦æ˜¾ç¤ºï¼Œhiddenä¸ºéšè—
</span><span class='line'>tintColor ç€è‰²ï¼Œrgbå­—ç¬¦ä¸²ç±»å‹
</span><span class='line'>opacity é€æ˜åº¦
</span><span class='line'>scaleX:æ°´å¹³æ–¹å‘ç¼©æ”¾
</span><span class='line'>scaleY:å‚ç›´æ–¹å‘ç¼©æ”¾
</span><span class='line'>rotation:æ—‹è½¬
</span><span class='line'>translateX:æ°´å¹³æ–¹å‘å¹³ç§»
</span><span class='line'>translateY:æ°´å¹³æ–¹å‘å¹³ç§»
</span><span class='line'>//é˜´å½±,é»˜è®¤é€æ˜çš„ï¼Œè¦è®¾ç½®shadowOpacityå¤§äº0æ‰æœ‰æ•ˆæœ
</span><span class='line'>shadowColor
</span><span class='line'>shadowOffset
</span><span class='line'>shadowOpacity
</span><span class='line'>shadowRadius</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Native é—®é¢˜æ±‡æ€»]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/28/react-native-run-bug/"/>
    <updated>2016-11-28T18:46:09+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/28/react-native-run-bug</id>
    <content type="html"><![CDATA[<p>Android è®¾å¤‡:å°ç±³ red note MUI 8.0, iOS è®¾å¤‡:iPhone 6Plus 8.3</p>

<h5>1.è¿è¡Œä¸èµ·æ¥</h5>

<p>æŒ‰ç…§<a href="https://facebook.github.io/react-native/docs/getting-started.html#content">å®˜ç½‘</a>çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥ä¸‹æ¥è¿è¡ŒæŠ¥ï¼š</p>

<pre><code>com.android.builder.testing.api.DeviceException: com.android.ddmlib.InstallException: Failed to establish session
</code></pre>

<p><a href="https://github.com/facebook/react-native/issues/6499">è¿™é‡Œ</a>è¯´å°ç±³ç³»åˆ—çš„æ‰‹æœºéƒ½è¿™æ ·ï¼Œæˆ‘ä»¬å¹³æ—¶ç”¨Android Studioè°ƒè¯•è¿è¡Œä¸æ˜¯ä¼šå¼¹å‡ºä¸ªå¼¹å‡ºæ¡†é—®æ˜¯å¦å®‰è£…å—ï¼Ÿè¿™æ˜¯ç”¨USBé“¾æ¥çš„ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ï¼Œä½†æ˜¯ç”¨å‘½ä»¤å°±æ‰åŠ¨ä¸èµ·æ¥é‚£å¼¹å‡ºæ¡†&hellip;
<img src="http://andyfightting.github.io/myimg/java/react_error_xm0.png" alt="" /></p>

<p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼Œå…³é”®æ˜¯ç¬¬4æ­¥ï¼Œå…³é—­å°ç±³çš„ä¼˜åŒ–
<img src="http://andyfightting.github.io/myimg/java/react_error_xm1.png" alt="" /></p>

<h5>2.è¿è¡Œä¸èµ·æ¥</h5>

<p>æŠ¥é”™ï¼š</p>

<pre><code>com.android.builder.testing.api.DeviceException: com.android.ddmlib.InstallException: Unable to upload some APKs
</code></pre>

<p>è§£å†³ï¼šæŠŠ /é¡¹ç›®/android/build.gradle æ–‡ä»¶é‡Œçš„ <code>classpath 'com.android.tools.build:gradle:1.3.1'</code> æ”¹æˆ <code>classpath 'com.android.tools.build:gradle:1.2.3'</code>å°±å¯ä»¥äº†&hellip;.why? yeah,why?</p>

<h5>3.ç™½å±</h5>

<p>è¿è¡Œèµ·æ¥äº†ï¼Œç­‰å•Šç­‰ï¼Œæ€ä¹ˆè¿˜æ˜¯ç™½å±ï¼Ÿä¸æ˜¯æœ‰ä¸œè¥¿çš„å—ï¼Ÿæ‘‡å•Šæ‘‡ä¸æ˜¯æœ‰å¼¹å‡ºæ¡†çš„å—ï¼Ÿå¼¹å‡ºæ¡†å‘¢ï¼Ÿï¼Ÿ</p>

<p>è§£å†³ï¼šè¿›ç³»ç»Ÿè®¾ç½®ï¼Œåº”ç”¨ç®¡ç†ï¼Œæ‰¾åˆ°è¿™ä¸ªåº”ç”¨ï¼Œç‚¹å‡»åº”ç”¨è¯¦æƒ…é‡Œçš„æƒé™ç®¡ç†ï¼Œå¼€å¯æ˜¾ç¤ºæ‚¬æµ®æ¡†ã€‚åˆ·æ–°ä¸€ä¸‹å†æ‘‡ä¸€æ‘‡å°±æœ‰å¼¹å‡ºæ¡†äº†ã€‚</p>

<h5>4.Could not connect to development server</h5>

<p>æ‘‡å•Šæ‘‡å¼¹å‡ºæ¡†åï¼Œç‚¹å‡»æœ€åçš„ <code>Dev Settings</code> ï¼Œç„¶åè®¾ç½® <code>Debug server host &amp; port for device</code> ä¸º<code>æœ¬æœºIP:8081</code>åè¿”å›åˆ·æ–°å‡ºç°å¦‚ä¸‹é”™è¯¯:</p>

<p><img src="http://andyfightting.github.io/myimg/java/react_error2.png" alt="" /></p>

<p>è§£å†³ï¼šå‘½ä»¤è¡Œè¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>

<pre><code>react-native start &gt; /dev/null 2&gt;&amp;1 &amp; curl "http://localhost:8081/index.android.bundle?platform=android" -o "android/app/src/main/assets/index.android.bundle"
</code></pre>

<p>å¦‚æœæç¤ºæ²¡æœ‰ assets æ–‡ä»¶å¤¹ï¼Œåˆ™å…ˆæ‰‹åŠ¨å»ºä¸€ä¸ªå†è¿è¡Œã€‚ä¹‹åå°±èƒ½çœŸæœºè¿è¡Œèµ·æ¥äº†ï¼š</p>

<p><img src="http://andyfightting.github.io/myimg/java/react_android.png" alt="" /></p>

<h5>iOSæ¨¡æ‹Ÿå™¨Cmd+Rä¸åˆ·æ–°ï¼ŒCmd+Dä¹Ÿæ²¡å¼¹å‡ºæ¡†</h5>

<p>è§£å†³ï¼šè¦å¼€å¯æ¨¡æ‹Ÿå™¨çš„é”®ç›˜é“¾æ¥ã€‚æ¨¡æ‹Ÿå™¨èœå•<code>Hardware</code>-><code>Keyboard</code> é€‰ä¸­ <code>Connect Hardware Keyboard</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Native åŸºç¡€çŸ¥è¯†]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/26/react-native-basic/"/>
    <updated>2016-11-26T11:16:25+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/26/react-native-basic</id>
    <content type="html"><![CDATA[<h4>React çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°è£…ç»„ä»¶! React åº”ç”¨éƒ½æ˜¯æ„å»ºåœ¨ç»„ä»¶ä¹‹ä¸Šï¼Œå„ä¸ªç»„ä»¶ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€å’Œ UIï¼Œå½“çŠ¶æ€å˜æ›´ï¼Œè‡ªåŠ¨é‡æ–°æ¸²æŸ“è‡ªèº«ç»„ä»¶ã€‚ç»„ä»¶çš„ç¬¬ä¸€ä¸ªå­—æ¯å¿…é¡»å¤§å†™,ç»„ä»¶åªèƒ½åŒ…å«ä¸€ä¸ªé¡¶å±‚æ ‡ç­¾ã€‚</h4>

<h4>Declarative</h4>

<p><a href="https://facebook.github.io/react/">React</a> å¯ä»¥å¾ˆå¥½çš„åˆ›å»ºäº¤äº’å¼ç»„ä»¶ï¼Œè®¾è®¡ä¸åŒçŠ¶æ€ä¸‹çš„ç»„ä»¶ï¼Œå¹¶ä¸”Reactå¯ä»¥æ ¹æ®ç»„ä»¶çš„ä¸åŒå‚æ•°é«˜æ•ˆçš„åˆ·æ–°æ¸²æŸ“ã€‚è¿™æ ·çš„ç»„ä»¶å¯ä»¥è®©ä½ çš„ä»£ç æ›´åŠ çš„å¯é¢„æµ‹å¹¶ä¸”æ›´æ–¹ä¾¿è°ƒè¯•ã€‚</p>

<h4>Component-Based</h4>

<p>åŸºäºç»„ä»¶ï¼Œå°è£…ä¸€ä¸ªç»„ä»¶ï¼Œè®©å®ƒä»¬ç®¡ç†è‡ªå·±çš„çŠ¶æ€ï¼Œç„¶åç”¨å®ƒä»¬å»ç»„æˆæ›´åŠ å¤æ‚çš„UIã€‚ç”±äºç»„ä»¶çš„é€»è¾‘æ˜¯å†™åœ¨JavaScripté‡Œçš„è€Œä¸æ˜¯æ¨¡æ¿é‡Œï¼Œè¿™æ ·ä½ å¯ä»¥å¾ˆè½»æ¾çš„è®©å®ƒç©¿æ¢­äºå¤æ‚çš„æ•°æ®ä¹‹é—´ï¼Œå¹¶ä¸”åœ¨DOMå¤–ä¿æŒè‡ªå·±çš„çŠ¶æ€ã€‚</p>

<h4>Learn Once, Write Anywhere</h4>

<p>æˆ‘ä»¬ä¸å‡å®šä½ ç°åœ¨çš„æŠ€æœ¯æ ˆæ˜¯æ€æ ·çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸ç”¨é‡å†™å·²å­˜åœ¨çš„ä»£ç æ¥ç”¨Reactå¼€æ”¾æ–°çš„åŠŸèƒ½ã€‚Reactä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥ç”¨React Nativeåˆ›å»ºå¼ºå¤§çš„ç§»åŠ¨åº”ç”¨ã€‚</p>

<h4>A Simple Component</h4>

<p>React ç»„ä»¶è°ƒç”¨ <code>render()</code> æ–¹æ³•æ¥è¾“å…¥å‚æ•°ç„¶åè¿”å›è¦æ˜¾ç¤ºçš„æ ·å­ã€‚è¿™ä¸ªä¾‹å­ç”¨ä¸€ä¸ªç±»ä¼¼XMLè¯­è¨€çš„æˆ‘ä»¬ç§°ä¹‹ä¸ºJSXï¼Œé€šè¿‡<code>this.props</code>è¾“å…¥æ•°æ®ä¼ åˆ°ç»„ä»¶å†…éƒ¨å¯ä»¥è¢«<code>render()</code>æ–¹æ³•è·å–ã€‚ä½¿ç”¨Reactçš„è¯ï¼ŒJSXæ˜¯å¯é€‰çš„ï¼Œä¸æ˜¯å¿…é¡»è¦ä½¿ç”¨çš„ã€‚è¯•ç€ç‚¹å‡»<code>Complied JS</code>å»çœ‹çœ‹é€šè¿‡JSXç¼–è¯‘å™¨äº§ç”Ÿçš„åŸç”Ÿçš„JavaScript ä»£ç ã€‚</p>

<h4>A Stateful Component</h4>

<p>é™¤äº†é€šè¿‡<code>this.props</code>æ¥ä¼ å…¥å‚æ•°ï¼Œç»„ä»¶å¯ä»¥é€šè¿‡<code>this.state</code>æ¥ç»´æŠ¤è‡ªå·±å†…éƒ¨çŠ¶æ€çš„æ•°æ®ã€‚å½“ç»„ä»¶çš„çŠ¶æ€æ•°æ®æ”¹å˜æ—¶ï¼Œæ¸²æŸ“å™¨å°±ä¼šé‡æ–°è°ƒç”¨<code>render()</code>æ–¹æ³•æ¥åˆ·æ–°ã€‚</p>

<h4>An Application</h4>

<p>ä½¿ç”¨<code>props</code>å’Œ<code>state</code>æˆ‘ä»¬å¯ä»¥æ”¶é›†ä¸€ä¸ªå°å‹çš„ä»£åŠäº‹é¡¹ç”³è¯·ã€‚è¿™ä¸ªä¾‹å­ç”¨<code>state</code>æ¥è·Ÿè¸ªå½“å‰åˆ—è¡¨å’Œç”¨æˆ·è¾“å…¥çš„æ•°æ®ã€‚è™½ç„¶äº‹ä»¶å¤„ç†ç¨‹åºä¼¼ä¹æ˜¯å‘ˆç°å†…è”,ä»–ä»¬ä¼šé€šè¿‡äº‹ä»¶ä»£ç†è¢«æ”¶é›†å’Œä½¿ç”¨ã€‚</p>

<h4>A Component Using External Plugins</h4>

<p>React æ˜¯çµæ´»çš„ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªé’©å­æ¥å’Œåº“æˆ–æ¡†æ¶è¿›è¡Œé“¾æ¥ã€‚è¿™ä¸ªä¾‹å­ä½¿ç”¨<code>remarkable</code>,ä¸€ä¸ªå¤–éƒ¨çš„ Markdown åº“ï¼Œæ¥å®æ—¶è½¬åŒ–æ–‡æœ¬å†…å®¹ã€‚</p>

<p>å“å‘€~ è‡ªå·±ç¿»è¯‘æœç„¶åˆ«æ‰­&hellip;ğŸ˜  React æ˜¯ä»€ä¹ˆå‘¢ï¼ŸReact æ˜¯Facebook å°è£…çš„ä¸€ç»„JSä»£ç åº“ï¼š</p>

<p><img src="http://andyfightting.github.io/myimg/java/react.png" alt="" /></p>

<p>æŒ‰å®ƒè§„åˆ™å¯å°è£…ä¸€ä¸ªä¸€ä¸ªæ¨¡å—ç»„ä»¶ï¼Œè¿™ä¸ªæ¨¡å—ç»„ä»¶æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œè‡ªå·±çš„é€»è¾‘ç­‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸œè¥¿ï¼Œç„¶åæŠŠè¿™æ ·çš„ç»„ä»¶ä¸€ä¸ªä¸€ä¸ªç»„åˆèµ·æ¥ã€‚æŒ‰ç…§React çš„è§„åˆ™å¯ä»¥æ··åˆç€å†™JavaScriptå’ŒHTML,è¿™æ ·çš„ä¸€ä¸ªç»„ä»¶å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—åŒ–çš„Viewã€‚æ·»åŠ ç»„ä»¶å±æ€§ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ class å±æ€§éœ€è¦å†™æˆ className ï¼Œfor å±æ€§éœ€è¦å†™æˆ htmlFor ï¼Œè¿™æ˜¯å› ä¸º class å’Œ for æ˜¯ JavaScript çš„ä¿ç•™å­—ã€‚</p>

<p>React è¿˜å°è£…äº†ä¸€ä¸ªè‡ªå·±çš„è™šæ‹Ÿçš„DOMï¼Œé€šè¿‡è¿™ä¸ªVirtual DOMå»æ›´æ–°çœŸå®çš„DOMï¼Œç”±è¿™ä¸ªVirtual DOMç®¡ç†çœŸå®DOMçš„æ›´æ–°ã€‚å› ä¸ºå¦‚æœå¤§é¢ç§¯çš„æ“ä½œ DOMï¼Œæ€§èƒ½ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œæ‰€ä»¥ React å®ç°äº†ä¸€ä¸ªè™šæ‹Ÿ DOMï¼Œç»„ä»¶ DOM ç»“æ„å°±æ˜¯æ˜ å°„åˆ°è¿™ä¸ªè™šæ‹Ÿ DOM ä¸Šï¼ŒReact åœ¨è¿™ä¸ªè™šæ‹Ÿ DOM ä¸Šå®ç°äº†ä¸€ä¸ª <a href="http://www.ruanyifeng.com/blog/2012/08/how_to_read_diff.html">diff</a> ç®—æ³•ï¼Œå½“è¦æ›´æ–°ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ diff å¯»æ‰¾åˆ°è¦å˜æ›´çš„ DOM èŠ‚ç‚¹ï¼Œå†æŠŠè¿™ä¸ªä¿®æ”¹æ›´æ–°åˆ°æµè§ˆå™¨å®é™…çš„ DOM èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥å®é™…ä¸Šä¸æ˜¯çœŸçš„æ¸²æŸ“æ•´ä¸ª DOM æ ‘ã€‚è¿™ä¸ªè™šæ‹Ÿ DOM æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ JS æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šæ¯”åŸç”Ÿ DOM å¿«å¾ˆå¤šã€‚è¦ä»ç»„ä»¶è·å–çœŸå® DOM çš„èŠ‚ç‚¹ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ° <code>ref</code> å±æ€§ã€‚ç»™ç»„ä»¶è®¾ç½®ä¸€ä¸ª <code>ref</code> å±æ€§ï¼Œç„¶åç”¨ <code>this.refs.[refName]</code> å°±ä¼šè¿”å›è¿™ä¸ªçœŸå®çš„ DOM èŠ‚ç‚¹å¯¹è±¡ã€‚</p>

<h4>Hello World</h4>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;script src="../build/react.js"&gt;&lt;/script&gt;
    &lt;script src="../build/react-dom.js"&gt;&lt;/script&gt;
    &lt;script src="../build/browser.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="example"&gt;&lt;/div&gt;

    &lt;script type="text/babel"&gt;
    var MyComponent = React.createClass({
      render: function() {
        return &lt;div&gt;Hello {this.props.name}&lt;/div&gt;;
      }
    });

    ReactDOM.render(&lt;MyComponent name="World !" /&gt;,
                    document.getElementById('example') );
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>ä¸Šé¢çš„ä»£ç ä¸­ç”¨Reactçš„è¯­æ³•è‡ªå®šä¹‰äº†ä¸€ä¸ªç»„ä»¶å«<code>MyComponent</code>,è¿™ä¸ªç»„ä»¶è¿”å›ä¸€ä¸ªå—åŒºé—´ï¼Œé‡Œé¢æ˜¾ç¤º Hello + è¿™ä¸ªç»„ä»¶çš„<code>name</code>å±æ€§å€¼ã€‚æ³¨æ„script çš„type è¦å£°æ˜ä¸º<code>text/babel</code>ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶äº†ã€‚å¯ä»¥æŠŠ <code>props</code> çœ‹ä½œæ˜¯ç»„ä»¶çš„é…ç½®å±æ€§ï¼Œåœ¨ç»„ä»¶å†…éƒ¨æ˜¯ä¸å˜çš„ï¼Œåªæ˜¯åœ¨è°ƒç”¨è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ä¼ å…¥ä¸åŒçš„å±æ€§å€¼æ¥å®šåˆ¶æ˜¾ç¤ºè¿™ä¸ªç»„ä»¶ã€‚å½“ç»„ä»¶çŠ¶æ€ <code>state</code> æœ‰æ›´æ”¹çš„æ—¶å€™ï¼ŒReact ä¼šè‡ªåŠ¨è°ƒç”¨ç»„ä»¶çš„ <code>render()</code> æ–¹æ³•é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶çš„ UIã€‚<code>this.props</code> å¯¹è±¡çš„å±æ€§ä¸ç»„ä»¶çš„å±æ€§ä¸€ä¸€å¯¹åº”ï¼Œ<code>this.props.children</code> è¡¨ç¤ºç»„ä»¶çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚éœ€è¦æ³¨æ„ï¼Œ <code>this.props.children</code> çš„å€¼æœ‰ä¸‰ç§å¯èƒ½ï¼šå¦‚æœå½“å‰ç»„ä»¶æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå®ƒå°±æ˜¯ <code>undefined</code> ;å¦‚æœæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œæ•°æ®ç±»å‹æ˜¯ <code>object</code> ï¼›å¦‚æœæœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ•°æ®ç±»å‹å°±æ˜¯ <code>array</code> ã€‚æ‰€ä»¥ï¼Œå¤„ç† <code>this.props.children</code> çš„æ—¶å€™è¦å°å¿ƒã€‚ä¸Šé¢çš„ä»£ç æŠŠ HTML ç›´æ¥åµŒå…¥äº† JS ä»£ç é‡Œé¢äº†ï¼Œè¿™å°±æ˜¯ React æå‡ºçš„ä¸€ç§å« JSX çš„è¯­æ³•ã€‚æŠŠåŸæ¥ç½‘é¡µè®¾è®¡çš„ä»£ç åˆ†ç¦»ï¼Œç°åœ¨åˆèåˆäº†ï¼</p>

<p><img src="http://andyfightting.github.io/myimg/java/react_hello.png" alt="" /></p>

<p>Hello World è¿è¡Œèµ·æ¥äº†ï¼å—¯~ æˆ‘å·²ç»æˆåŠŸäº†ä¸€åŠï¼ğŸ˜†</p>

<h4>ç»„ä»¶ç»„åˆ</h4>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;script src="../build/react.js"&gt;&lt;/script&gt;
    &lt;script src="../build/react-dom.js"&gt;&lt;/script&gt;
    &lt;script src="../build/browser.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="example"&gt;&lt;/div&gt;

    &lt;script type="text/babel"&gt;

    var Avatar = React.createClass({
        render: function() {
            return (
                &lt;div&gt;
                    &lt;ProfilePic username={this.props.username} /&gt;
                    &lt;ProfileName username={this.props.username} /&gt;
                &lt;/div&gt;
            );
        }
       });

    var ProfilePic = React.createClass({
        render: function() {
            return (
                &lt;img src={'https://gss0.bdstatic.com/70cFsj3f_gcX8t7mm9GUKT-xh_/avatar/100/r6s1g6.gif'} /&gt;
            );
        }
    });

    var ProfileName = React.createClass({
        render: function() {
            return (
              &lt;div&gt;
                &lt;a href={'http://guimingsu.com'}&gt;
                    {this.props.username}
                &lt;/a&gt;
              &lt;/div&gt;
            );
        }
    });

    ReactDOM.render(
        &lt;Avatar username="hello world " /&gt;,
        document.getElementById('example')
      );

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>è¿™é‡Œæ˜¾ç¤ºäº†ä¸€ä¸ªAvatar ç»„ä»¶ï¼Œè¿™ä¸ªAvatar ç»„ä»¶æ˜¯ç”±ä¸¤ä¸ªæ›´å°çš„ç»„ä»¶ProfilePicå’ŒProfileNameç»„åˆè€Œæˆçš„ã€‚çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶é—´å¯ä»¥é€šè¿‡<code>props</code>ä¸€å±‚ä¸€å±‚çš„ä¼ å€¼ã€‚Remember: React is all about one-way data flow down the component hierarchy.</p>

<p><img src="http://andyfightting.github.io/myimg/java/react_hello0.png" alt="" /></p>

<h4>çŠ¶æ€å˜åŒ–</h4>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;script src="../build/react.js"&gt;&lt;/script&gt;
    &lt;script src="../build/react-dom.js"&gt;&lt;/script&gt;
    &lt;script src="../build/browser.min.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="example"&gt;&lt;/div&gt;
    &lt;script type="text/babel"&gt;

     var LikeButton = React.createClass({
      getInitialState: function() {
        return {liked: false};
      },

      handleClick: function(event) {
        this.setState({liked: !this.state.liked});
      },

      render: function() {
        var text = this.state.liked ? 'like' : 'haven\'t liked';
        return (
          &lt;p onClick={this.handleClick}&gt;
            You {text} this. Click to toggle.
          &lt;/p&gt;
        );
      }
    });

    ReactDOM.render(
      &lt;LikeButton /&gt;,
      document.getElementById('example')
    );

    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ª <code>LikeButton</code> ç»„ä»¶ï¼Œå®ƒçš„ <code>getInitialState</code> æ–¹æ³•ç”¨äºå®šä¹‰åˆå§‹çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡ <code>this.state</code> å±æ€§è¯»å–ã€‚å½“ç”¨æˆ·ç‚¹å‡»ç»„ä»¶ï¼Œå¯¼è‡´çŠ¶æ€å˜åŒ–ï¼Œ<code>this.setState</code> æ–¹æ³•å°±ä¿®æ”¹çŠ¶æ€å€¼ï¼Œæ¯æ¬¡ä¿®æ”¹ä»¥åï¼Œè‡ªåŠ¨è°ƒç”¨ <code>this.render</code> æ–¹æ³•ï¼Œå†æ¬¡æ¸²æŸ“ç»„ä»¶ã€‚
ç”±äº <code>this.props</code> å’Œ <code>this.state</code> éƒ½ç”¨äºæè¿°ç»„ä»¶çš„ç‰¹æ€§ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ··æ·†ã€‚ä¸€ä¸ªç®€å•çš„åŒºåˆ†æ–¹æ³•æ˜¯ï¼Œ<code>this.props</code> è¡¨ç¤ºé‚£äº›ä¸€æ—¦å®šä¹‰ï¼Œå°±ä¸å†æ”¹å˜çš„ç‰¹æ€§ï¼Œè€Œ <code>this.state</code> æ˜¯ä¼šéšç€ç”¨æˆ·äº’åŠ¨è€Œäº§ç”Ÿå˜åŒ–çš„ç‰¹æ€§ã€‚å³æŠŠè¦è·ŸéšæŸä¸ªå‚æ•°å®æ—¶å˜åŒ–çš„ä»£ç å†™åœ¨ <code>render: function() {};</code>é‡Œï¼Œç„¶ååœ¨ç”¨æˆ·è°ƒç”¨çš„æ–¹æ³•é‡Œè°ƒç”¨<code>this.setState({ });</code>æ–¹æ³•æ¥æ”¹å˜å‚æ•°å°±å¯ä»¥äº†ï¼Œå› ä¸ºä»–ä»¬è§¦å‘<code>render</code>æ–¹æ³•ã€‚è¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸åŒå‚æ•°å€¼è‡ªåŠ¨æ˜¾ç¤ºä¸åŒå†…å®¹ã€‚</p>

<h4>ç”Ÿå‘½å‘¨æœŸ</h4>

<p>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåˆ†æˆä¸‰ä¸ªçŠ¶æ€ï¼š</p>

<ol>
<li>Mountingï¼šå·²æ’å…¥çœŸå® DOM</li>
<li>Updatingï¼šæ­£åœ¨è¢«é‡æ–°æ¸²æŸ“</li>
<li>Unmountingï¼šå·²ç§»å‡ºçœŸå® DOM</li>
</ol>


<p>React ä¸ºæ¯ä¸ªçŠ¶æ€éƒ½æä¾›äº†ä¸¤ç§å¤„ç†å‡½æ•°ï¼Œ<code>will</code> å‡½æ•°åœ¨è¿›å…¥çŠ¶æ€ä¹‹å‰è°ƒç”¨ï¼Œ<code>did</code> å‡½æ•°åœ¨è¿›å…¥çŠ¶æ€ä¹‹åè°ƒç”¨ï¼Œä¸‰ç§çŠ¶æ€å…±è®¡äº”ç§å¤„ç†å‡½æ•°ã€‚</p>

<ol>
<li>componentWillMount()</li>
<li>componentDidMount()</li>
<li>componentWillUpdate(object nextProps, object nextState)</li>
<li>componentDidUpdate(object prevProps, object prevState)</li>
<li>componentWillUnmount()</li>
</ol>


<p>æ­¤å¤–ï¼ŒReact è¿˜æä¾›ä¸¤ç§ç‰¹æ®ŠçŠ¶æ€çš„å¤„ç†å‡½æ•°:</p>

<ol>
<li>componentWillReceiveProps(object nextProps)ï¼šå·²åŠ è½½ç»„ä»¶æ”¶åˆ°æ–°çš„å‚æ•°æ—¶è°ƒç”¨</li>
<li>shouldComponentUpdate(object nextProps, object nextState)ï¼šç»„ä»¶åˆ¤æ–­æ˜¯å¦é‡æ–°æ¸²æŸ“æ—¶è°ƒç”¨</li>
</ol>


<p><img src="http://andyfightting.github.io/myimg/java/react_life.png" alt="" /></p>

<p>æŠŠè¿™ä¸ª<a href="https://facebook.github.io/react/docs/thinking-in-react.html">å®˜æ–¹ä¾‹å­</a>çœ‹å®Œå°±èƒ½æ”¶è·ä¸å°‘äº†ã€‚ä¸»è¦åœ¨äºæ€è€ƒï¼Œæ‹¿åˆ°è®¾è®¡å›¾å¦‚ä½•æ‹†åˆ†æ¨¡å—ï¼Œå¦‚ä½•ç»„å»ºï¼Œå¦‚ä½•é€‰å–æ”¾ç½®çŠ¶æ€å‚æ•°ï¼Œå¦‚ä½•çœ‹æ‡‚åˆ«äººå†™å¥½çš„ä»£ç ç­‰ã€‚<a href="http://andyfightting.github.io/mysrc/java/reactPriceDemo.zip">ä¸‹è½½</a></p>

<h5>é“¾æ¥</h5>

<ol>
<li><a href="http://www.cnblogs.com/sakurayeah/category/868210.html">Reactå…¥é—¨</a></li>
<li><a href="https://babeljs.io/docs/learn-es2015/">ECMAScript 2015</a></li>
<li><a href="http://es6.ruanyifeng.com/">ECMAScript 6å…¥é—¨</a></li>
<li><a href="http://bbs.reactnative.cn/topic/15/react-react-native-%E7%9A%84es5-es6%E5%86%99%E6%B3%95%E5%AF%B9%E7%85%A7%E8%A1%A8">ES5å’ŒES6çš„å†™æ³•å¯¹ç…§è¡¨</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Atom]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/24/atom-edit/"/>
    <updated>2016-11-24T14:31:17+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/24/atom-edit</id>
    <content type="html"><![CDATA[<p><a href="https://atom.io/">Atom</a>æ˜¯ç”±GitHubå¼€å‘çš„ä¸€æ¬¾å…è´¹å¼€æºçš„ç¼–è¾‘å™¨ï¼Œé€šè¿‡ç»™å®ƒå®‰è£…ä¸åŒçš„æ’ä»¶åŒ…ï¼Œå°±å¯ä»¥å˜æˆä¸€æ¬¾æ™ºèƒ½çš„IDEäº†ã€‚è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹ä¸ºäº†å¼€å‘<a href="https://facebook.github.io/react-native/">React Native</a>æ‰€å®‰è£…çš„æ’ä»¶åŒ…åŠåŸºæœ¬ä½¿ç”¨ã€‚</p>

<p><a href="https://nuclide.io/">Nuclide</a>æ˜¯å®˜æ–¹æ¨èçš„å¼€å‘React Nativeçš„åŸºäºAtomçš„å·¥å…·ã€‚Nuclide å®‰è£…å¥½åè¿›å…¥è®¾ç½®ï¼Œé€‰ä¸­<code>Install Recommented Packages on Startup</code>é€‰é¡¹ï¼Œä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™å°±ä¼šå®‰è£…Nuclideæ‰€å»ºè®®å®‰è£…çš„æ’ä»¶äº†ã€‚</p>

<h4>æ’ä»¶</h4>

<p><strong>atom-react-native-autocomplete :</strong>React Nativeè‡ªåŠ¨æç¤ºã€‚</p>

<p><strong>atom-beautify :</strong> æ–‡ä»¶æ’ç‰ˆæ ¼å¼åŒ–ã€‚ctrl-alt-bï¼Œå¯ä»¥è¿›å®ƒçš„è®¾ç½®é‡Œé€‰ä¸­ Beauty on Save è‡ªåŠ¨æ ¼å¼åŒ–ã€‚</p>

<p><strong>atom-html-preview :</strong> htmlé¢„è§ˆã€‚ ctrl-shift-h
<img src="http://andyfightting.github.io/myimg/java/atom-html-preview.png" width="700" alt="" /></p>

<p><strong>autocomplete-paths :</strong> æ–‡ä»¶è·¯å¾„æç¤º</p>

<p><img src="http://andyfightting.github.io/myimg/java/autocomplete-paths.png" width="500" alt="" /></p>

<p><strong>color-picker :</strong>é¢œè‰²é€‰å–å™¨ï¼Œç‚¹å‡»è‰²å—å³å¯å¼¹å‡ºï¼Œæˆ–è€…å³é”®é€‰æ‹© Color Picker.</p>

<p><img src="http://andyfightting.github.io/myimg/java/color-picker.png" width="500" alt="" /></p>

<p><strong>docblockr :</strong> å¿«æ·æ–‡æ¡£æ³¨é‡Š</p>

<p><strong>emmet :</strong>webå¼€å‘ç¥å™¨</p>

<p><strong>file-icons :</strong>ç»™æ–‡ä»¶åŠ icon</p>

<p><img src="http://andyfightting.github.io/myimg/java/file-icons.png" width="200" alt="" /></p>

<p><strong>highlight-selected :</strong>é€‰ä¸­ç›¸åŒçš„å­—ç¬¦ä¸²é«˜äº®
<img src="http://andyfightting.github.io/myimg/java/highlight-selected.png" width="500" alt="" /></p>

<p><strong>js-hyperclick :</strong> jså¯¹è±¡ cmd-ç‚¹å‡» è·³è½¬</p>

<p><strong>merge-conflicts :</strong>è§£å†³ç‰ˆæœ¬å†²çª</p>

<p><strong>minimap :</strong>å³è¾¹ä½ç½®å°åœ°å›¾
<img src="http://andyfightting.github.io/myimg/java/minimap.png" width="700" alt="" /></p>

<p><strong>pigments :</strong> æ˜¾ç¤ºé¢œè‰²ã€‚ å¿«æ·é¢æ¿é‡Œæœ Pigments: Show Palette å¯ä»¥æ‰“å¼€è°ƒè‰²æ¿ğŸ¨ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/java/pigment.png" width="400" alt="" /></p>

<p><strong>pretty-json :</strong> Json æ ¼å¼åŒ–ã€‚Packages->PrettyJson->Prettify</p>

<p><strong>react-snippets :</strong> Reactä»£ç å—å¿«æ·è¾“å…¥
<img src="http://andyfightting.github.io/myimg/java/react-snippets.png" width="700" alt="" /></p>

<p><strong>sort-lines :</strong>æŠŠåˆ—æŒ‰å­—æ¯æ’åºã€‚åŠŸèƒ½é”® f5(ç”µè„‘ï¼Œè®¾ç½®ï¼Œé”®ç›˜é‡Œè¦å¼€å¯åŠŸèƒ½é€‰é¡¹) æˆ–è€… Edit->Lines->Sort</p>

<p><strong>tool-bar :</strong>ä¸Šé¢æ˜¾ç¤ºå·¥å…·æ ï¼Œctrl-alt-t å¼€/å…³
<img src="http://andyfightting.github.io/myimg/java/tool-bar.png" width="500" alt="" /></p>

<p>å®‰è£…åçš„æ’ä»¶åŒ…ä¸åœ¨Atomåº”ç”¨æ–‡ä»¶å¤¹é‡Œï¼Œåœ¨ <code>/Users/ç”¨æˆ·å/.atom/packages/</code> æ–‡ä»¶å¤¹é‡Œã€‚ä¸” <code>.atom</code> æ–‡ä»¶å¤¹é»˜è®¤æ˜¯éšè—çš„ã€‚åœ¨å‘½ä»¤çª—å£è¾“å…¥æ˜¾ç¤ºæ–‡ä»¶å¤¹å‘½ä»¤ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//æ˜¾ç¤ºéšè—æ–‡ä»¶
</span><span class='line'>defaults write com.apple.finder AppleShowAllFiles -boolean true ; killall Finder
</span><span class='line'>//éšè—æ–‡ä»¶
</span><span class='line'>defaults write com.apple.finder AppleShowAllFiles -boolean false ; killall Finder</span></code></pre></td></tr></table></div></figure>


<p><img src="http://andyfightting.github.io/myimg/java/packages.png" width="300" alt="" /></p>

<h4>åŒ…çš„é»˜è®¤å€¼ä¿®æ”¹</h4>

<p>å¯ä»¥ç›´æ¥ç‚¹å‡»<code>View Code</code>æ‰“å¼€åŒ…çš„ä»£ç ä¿®æ”¹ã€‚ä¹Ÿå¯ä»¥åƒä¸Šé¢å…ˆæ˜¾ç¤ºæ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°å¯¹åº”çš„åŒ…ï¼Œç„¶åä¿®æ”¹é‡Œé¢çš„é»˜è®¤é…ç½®ã€‚åœ¨Settings -> Open Config Folder ä¹Ÿå¯ä»¥æ‰“å¼€æ‰€æœ‰æ’ä»¶åŒ…çš„é…ç½®ã€‚
<img src="http://andyfightting.github.io/myimg/java/package_change.png" width="700" alt="" /></p>

<h4>å¿«æ·é”®</h4>

<p>ctrl-space : è¡¥å…¨æç¤º (Macè¦æŠŠè®¾ç½®->é”®ç›˜->å¿«æ·é”®->Spotlight é‡Œå¯¹åº”çš„å¿«æ·é”®å–æ¶ˆæ‰! ä¸ç„¶ç”µè„‘çš„ä¼˜å…ˆçº§æ›´é«˜)</p>

<p>ctrl-alt-b : atom-beautifyæ’ä»¶ ä»£ç æ ¼å¼åŒ–ï¼Œä¸ºä»€ä¹ˆJSXæ ¼å¼åŒ–åæœ‰ç‚¹ä¹±&hellip;</p>

<p>cmd-shift-p : æ‰“å¼€å¿«æ·é¢æ¿</p>

<p>cmd-f : æ–‡ä»¶é‡Œæœç´¢</p>

<p>cmd-shift-f : é¡¹ç›®é‡Œæœç´¢</p>

<p>cmd-alt-[ : æŠ˜å ä»£ç </p>

<p>cmd-alt-] : å±•å¼€ä»£ç </p>

<p>cmd-alt-shift-{ : æŠ˜å æ‰€æœ‰ä»£ç </p>

<p>cmd-alt-shift-} : å±•å¼€æ‰€æœ‰ä»£ç </p>

<p>ctrl-[ : å·¦ç§»åŠ¨</p>

<p>ctrl-] : å³ç§»åŠ¨</p>

<p>ctrl-g : è·³è½¬åˆ°æŸè¡Œ</p>

<p>cmd-\ : å·¦è¾¹ç›®å½•æ˜¾ç¤ºæˆ–éšè—</p>

<p>cmd-shift-o : æ‰“å¼€æ–‡ä»¶å¤¹</p>

<p>cmd-b : åœ¨æ‰“å¼€çš„æ–‡ä»¶é—´åˆ‡æ¢</p>

<p>cmd-delete : åˆ é™¤å…‰æ ‡å·¦è¾¹çš„</p>

<p>ctrl-shift-l : åˆ é™¤ä¸€æ•´è¡Œ</p>

<p>ctrl-shift-&ldquo;+&rdquo; : å¢å¤§å­—ä½“</p>

<p>ctrl-shift-&ldquo;-&rdquo; : ç¼©å°å­—ä½“</p>

<p><a href="https://github.com/kompasim/atom-plugins">[92æ¬¾æ’ä»¶æ¨è]</a></p>

<p><a href="http://andyfightting.github.io/myimg/channel_v3.json">channel_v3.json</a></p>

<p><strong>å—¯ï¼Œè¿˜æ˜¯WebStormå¥½ç”¨ï¼ï¼æç¤ºæ›´æ™ºèƒ½ä¹Ÿæ›´å¤šä¸œè¥¿å¯ä»¥è·³è½¬æŸ¥çœ‹ï¼ŒAtomæ²¡è·³ä¸¤ä¸‹å°±è·³ä¸äº†äº†&hellip;</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Struts + Spring + MyBatis]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/18/struts-spring-mybatis/"/>
    <updated>2016-11-18T09:22:51+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/18/struts-spring-mybatis</id>
    <content type="html"><![CDATA[<h4>åŸºæœ¬ä¿¡æ¯ï¼š</h4>

<p><code>Mac OS 10.11</code>, <code>eclipse neon</code>, <code>jdk1.8</code>, <code>tomcat7</code>, <code>struts2.5.5</code>, <code>spring4.3.4</code>, <code>mybatis3.4.1</code>,<code>mybatis-spring1.3</code>,<code>mysqlæ•°æ®åº“</code></p>

<h4>ç»“æ„ç®€ä»‹ï¼š</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ç”¨struts2çš„é…ç½®æ–‡ä»¶æ¥æ§åˆ¶æ–¹æ³•çš„è°ƒç”¨å’Œé¡µé¢çš„è·³è½¬ï¼Œ
</span><span class='line'>jpså’ŒActioné€šè¿‡strtus2æ ‡ç­¾æ–¹å¼æˆ–è€…ELè¡¨è¾¾å¼ä¼ å€¼å–å€¼ã€‚
</span><span class='line'>Actionè´Ÿè´£ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ŒActionè°ƒç”¨Serviceæ¥å£ï¼ŒServiceæ¥å£æ³¨å…¥æŸä¸ªServiceçš„å®ç°ï¼Œ
</span><span class='line'>åœ¨Serviceçš„å®ç°é‡Œè°ƒç”¨Daoæ¥å¤„ç†æ•°æ®åº“ã€‚
</span><span class='line'>è€ŒDaoæ˜¯ç”¨Mybatisé€šè¿‡å¯¹åº”çš„xmlæ˜ å°„æ–‡ä»¶æ¥å…³è”çš„,
</span><span class='line'>ä¸”Actioné‡Œçš„Serviceå®ç°æ³¨å…¥,Serviceå®ç°ç±»é‡Œçš„Daoæ³¨å…¥,Daoçš„Sectionæ³¨å…¥ï¼Œ
</span><span class='line'>éƒ½æ˜¯é€šè¿‡Springé…ç½®æ–‡ä»¶å®ç°çš„ã€‚</span></code></pre></td></tr></table></div></figure>


<h4>æˆªå›¾:</h4>

<p><img src="http://andyfightting.github.io/myimg/java/ssm_index.png" alt="" />
<img src="http://andyfightting.github.io/myimg/java/ssm_list.png" alt="" />
<img src="http://andyfightting.github.io/myimg/java/ssm_json.png" alt="" />
<img src="http://andyfightting.github.io/myimg/java/ssm.png" alt="" /></p>

<p><a href="http://andyfightting.github.io/mysrc/java/SSM.zip">ä¸‹è½½</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SpringMVC + Spring + Hibernate]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/17/springmvc-hibernate-jian/"/>
    <updated>2016-11-17T19:34:43+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/17/springmvc-hibernate-jian</id>
    <content type="html"><![CDATA[<h4>åŸºæœ¬ä¿¡æ¯ï¼š</h4>

<p><code>Mac OS 10.11</code>, <code>eclipse neon</code>, <code>jdk1.8</code>, <code>tomcat7</code>, <code>spring4.3.4</code>, <code>Hibernate5.2.4</code>,<code>jackson2.5</code>,<code>mysqlæ•°æ®åº“</code></p>

<h4>æˆªå›¾:</h4>

<p><img src="http://andyfightting.github.io/myimg/java/ssh_frame.png" alt="" />
<img src="http://andyfightting.github.io/myimg/java/ssh_pack.png" alt="" /></p>

<h4>Controllerä»JSPå–å€¼</h4>

<pre><code>//1.ä½¿ç”¨HttpServletRequestè·å–
public String addUser(HttpServletRequest request) {
    String name = request.getParameter("name");
    String pass = request.getParameter("password");
    return "/addUser";
}
//2.ä½¿ç”¨æ³¨è§£
public String addUser(@RequestParam("name") String name,@RequestParam("password") String password) {
    System.out.println(name+password);
    return "/addUser";
}
//3.è‡ªåŠ¨æ³¨å…¥Entityå±æ€§
public String addUser(User user) {
    System.out.println(user.getName() + user.getPassword());
    return "/addUser";
}
</code></pre>

<h4>Controllerä¼ å€¼ç»™JSP</h4>

<pre><code>//1.ä½¿ç”¨HttpServletRequest ç„¶åsetAttribute()ï¼Œå°±å’ŒServletä¸­ä¸€æ ·
public String getAllUser(HttpServletRequest request) {
    request.setAttribute("userList", userService.getAllUser());
    return "/index";
}
//2.ä½¿ç”¨Springçš„ModelMap `public class ModelMap extends LinkedHashMap&lt;String, Object&gt;`ï¼ŒModelMapæ•°æ®ä¼šåˆ©ç”¨HttpServletRequestçš„Attributeä¼ å€¼
public String getAllUser(ModelMap modelMap) {
    modelMap.put("userList", userService.getAllUser());
    return "/index";
}
//3.HttpServletReequestçš„getSession()  
public String getAllUser(HttpServletRequest request) {
    HttpSession session = request.getSession();
    session.setAttribute("userList", userService.getAllUser());
    return "/index";
}
</code></pre>

<p><a href="http://andyfightting.github.io/mysrc/java/SSH.zip">ä¸‹è½½</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hibernate çš„ä½¿ç”¨]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/16/hibernate/"/>
    <updated>2016-11-16T09:20:12+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/16/hibernate</id>
    <content type="html"><![CDATA[<p>å¯ä»¥è®¤ä¸ºMyBatisæ˜¯åŠè‡ªåŠ¨åŒ–ï¼Œè€ŒHibernateæ˜¯å…¨è‡ªåŠ¨åŒ–(ä¹Ÿå¯åŠè‡ªåŠ¨)ã€‚MyBatisæ˜¯é¢å‘è¡¨å’Œåˆ—çš„SQLæŸ¥è¯¢ï¼Œè€ŒHibernateæ˜¯ç”¨é¢å‘å¯¹è±¡å’Œå¯¹è±¡å±æ€§çš„ HQLæŸ¥è¯¢ã€‚ HQL æŸ¥è¯¢è¢« Hibernate ç¿»è¯‘ä¸ºä¼ ç»Ÿçš„ SQL æŸ¥è¯¢ä»è€Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚å°½ç®¡Hibernateå¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ° SQL è¯­å¥ï¼Œä½†è¿˜æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨ HQL è¯­å¥ï¼Œä»¥é¿å…æ•°æ®åº“ç§»æ¤äº§ç”Ÿçš„éº»çƒ¦ã€‚åœ¨ HQL ä¸­ä¸€äº›å…³é”®å­—æ¯”å¦‚ SELECT ï¼ŒFROM å’Œ WHERE ç­‰ï¼Œæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†å¯¹è±¡åå’Œå±æ€§åæ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚Hibernateä¹Ÿå¯ä»¥ç”¨æ³¨è§£æ–¹å¼æ¥è¿›è¡Œå¯¹è±¡å’Œè¡¨çš„å…³ç³»æ˜ å°„ï¼Œç±»ä¼¼äº<a href="http://ormlite.com/">OrmLit</a>è¿™æ ·ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/java/hibernate_frame.png" alt="" /></p>

<p>å’ŒMybatis å¾ˆåƒï¼Œéƒ½æ˜¯åŠ è½½é…ç½®æ–‡ä»¶å¾—åˆ°SessionFactory, ç„¶åé€šè¿‡SessionFactoryè·å– Session,ç„¶åç”¨Sessionè¿›è¡ŒHQLæ“ä½œã€‚</p>

<p>Hibernate(5.2.4)é…ç½®æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="GBK"?&gt;  
&lt;!DOCTYPE hibernate-configuration PUBLIC  
    "-//Hibernate/Hibernate Configuration DTD 3.0//EN"  
    "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;
&lt;hibernate-configuration&gt;
    &lt;session-factory&gt;
        &lt;property name="connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
        &lt;property name="connection.url"&gt;jdbc:mysql://localhost:8889/java_db&lt;/property&gt;
        &lt;property name="connection.username"&gt;root&lt;/property&gt;
        &lt;property name="connection.password"&gt;root&lt;/property&gt;
        &lt;!-- æŒ‡å®šè¿æ¥æ± é‡Œæœ€å¤§è¿æ¥æ•° --&gt;
        &lt;property name="hibernate.c3p0.max_size"&gt;50&lt;/property&gt;
        &lt;!-- æŒ‡å®šè¿æ¥æ± é‡Œæœ€å°è¿æ¥æ•° --&gt;
        &lt;property name="hibernate.c3p0.min_size"&gt;5&lt;/property&gt;
        &lt;!-- æŒ‡å®šè¿æ¥æ± é‡Œè¿æ¥çš„è¶…æ—¶æ—¶é•¿ --&gt;
        &lt;property name="hibernate.c3p0.timeout"&gt;3000&lt;/property&gt;
        &lt;!-- æŒ‡å®šè¿æ¥æ± é‡Œæœ€å¤§ç¼“å­˜å¤šå°‘ä¸ªStatementå¯¹è±¡ --&gt;
        &lt;property name="hibernate.c3p0.max_statements"&gt;100&lt;/property&gt;
        &lt;property name="hibernate.c3p0.idle_test_perxiod"&gt;3000&lt;/property&gt;
        &lt;property name="hibernate.c3p0.acquire_increment"&gt;2&lt;/property&gt;
        &lt;property name="hibernate.c3p0.validate"&gt;true&lt;/property&gt;
        &lt;!-- æŒ‡å®šæ•°æ®åº“æ–¹è¨€ --&gt;
        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLInnoDBDialect&lt;/property&gt;
        &lt;!-- æ ¹æ®éœ€è¦è‡ªåŠ¨åˆ›å»ºæ•°æ®è¡¨ --&gt;
        &lt;property name="hbm2ddl.auto"&gt;update&lt;/property&gt;
        &lt;!-- æ˜¾ç¤ºHibernateæŒä¹…åŒ–æ“ä½œæ‰€ç”Ÿæˆçš„SQL --&gt;
        &lt;property name="show_sql"&gt;true&lt;/property&gt;
        &lt;!-- å°†SQLè„šæœ¬è¿›è¡Œæ ¼å¼åŒ–åå†è¾“å‡º --&gt;
        &lt;property name="hibernate.format_sql"&gt;true&lt;/property&gt;

        &lt;!-- ä¸‹é¢ç½—åˆ—æ‰€æœ‰çš„æ˜ å°„æ–‡ä»¶ --&gt;
        &lt;mapping resource="com/sgm/config/user.xml" /&gt;

    &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;
</code></pre>

<p>å¯¹è±¡åˆ°è¡¨çš„æ˜ å°„æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC 
 "-//Hibernate/Hibernate Mapping DTD//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt; 
&lt;hibernate-mapping package="com.sgm.bean"&gt;
   &lt;class name="User" table="user"&gt;
      &lt;id name="id" type="int" column="id"&gt;
         &lt;generator class="native"/&gt;
      &lt;/id&gt;
      &lt;property name="name" column="name" type="string"/&gt;
      &lt;property name="password" column="password" type="string"/&gt;
   &lt;/class&gt;
&lt;/hibernate-mapping&gt;
</code></pre>

<p>åŸºæœ¬ä½¿ç”¨</p>

<pre><code>public class Main {
    private static SessionFactory factory;
    static{
        try {
            Configuration config = new Configuration().configure("com/sgm/config/hibernate.xml");
            factory = config.buildSessionFactory();
        } catch (Throwable ex) {
            throw new ExceptionInInitializerError(ex);
        }
    }

@SuppressWarnings("unchecked")
public static void main(String[] args) {
    Session session = factory.openSession();
    Transaction transaction = null;
    try {
        transaction = session.beginTransaction();
        //æ•°æ®åº“å¤„ç†

        transaction.commit();
    } catch (Exception e) {
        if (transaction != null)
            transaction.rollback();
        e.printStackTrace();
    } finally {
        session.close();
    }
  }
}
</code></pre>

<p><img src="http://andyfightting.github.io/myimg/java/hibernate_zsg.png" alt="" /></p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨ä¸å¸¦entityNameå‚æ•°çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚å¸¦entityNameçš„æ˜¯hibernateåœ¨æ¢ç´¢ä¸ä½¿ç”¨pojoç±»è¿›è¡ŒO/Rï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>

<h4>æŸ¥è¯¢</h4>

<pre><code>//fromåé¢æ˜¯å¯¹è±¡ï¼ä¸æ˜¯è¡¨åï¼å¯¹è±¡å’Œè¡¨åœ¨mapperæ–‡ä»¶é‡Œå…³è”å¥½äº†ã€‚hqlé¢å‘çš„æ˜¯å¯¹è±¡ï¼Œä¸æ˜¯è¡¨ï¼
String hql = "FROM User as u where u.id &gt;= 17 ";
Query&lt;User&gt; query = session.createQuery(hql);
List&lt;User&gt; list = query.getResultList();

//ç”¨setParameterè®¾ç½®æŸ¥è¯¢å‚æ•°ï¼ŒsetFirstResultå’ŒsetMaxResultså¯ç”¨äºåˆ†é¡µ
String hql="from User as u where u.name=? and u.password = :password ORDER BY u.id DESC";
Query&lt;User&gt; query=session.createQuery(hql);
query.setParameter(0, "andy");
query.setParameter("password", "123");
query.setFirstResult(1);//ä»ç»“æœé›†çš„é‚£ä¸€æ¡å¼€å§‹(åŒ…æ‹¬è¿™ä¸€æ¡)
query.setMaxResults(2);//æœ€å¤šå‡ æ¡
List&lt;User&gt; list=query.getResultList();

//queryä¹Ÿå¯ä»¥ç”¨äºæ‰¹é‡ä¿®æ”¹å’Œåˆ é™¤ 
String hql = "UPDATE User set name = :name WHERE id &gt;= :id";
//String hql = "DELETE from User WHERE name = :name and id &gt;= :id";
Query&lt;User&gt; query = session.createQuery(hql);
query.setParameter("name", "andy hello");
query.setParameter("id", 19);
int result = query.executeUpdate();
System.out.println("å¤„ç†äº†å‡ æ¡æ•°æ®: " + result);
</code></pre>

<h4><a href="https://docs.jboss.org/hibernate/entitymanager/3.5/reference/en/html/querycriteria.html">CriteriaQuery</a> <a href="https://github.com/treehouse/giflib-hibernate/commit/f97a2828a466e849d8ae84884b5dce60a66cf412">åºŸå¼ƒæ›´æ–°æ—¥å¿—</a></h4>

<p>æ³¨æ„æ–°çš„åˆ›å»ºæ–¹å¼å¼•ç”¨çš„åŒ…æ˜¯ <code>import javax.persistence.criteria.CriteriaQuery</code>,è€Œä¸æ˜¯<code>import org.hibernate.criterion.CriteriaQuery</code>!!!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//æ—§çš„å·²è¢«åºŸå¼ƒ
</span><span class='line'>session.createCriteria(User.class) çš„åˆ›å»ºæ–¹å¼å·²ç»è¢«åºŸå¼ƒ
</span><span class='line'>//æ”¹ä¸ºè¿™æ ·,å› ä¸º5.2.4çš„sessionå·²ç»ç»§æ‰¿äº†EntityManagerï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥getCriteriaBuilder()ã€‚
</span><span class='line'>CriteriaBuilder cb = session.getCriteriaBuilder();
</span><span class='line'>CriteriaQuery&lt;User&gt; query = cb.createQuery(User.class);
</span><span class='line'>Root&lt;User&gt; user = query.from(User.class);
</span><span class='line'>query.select(user).where(cb.equal(user.get("name"), "andy"));
</span><span class='line'>List&lt;User&gt; list = session.createQuery(query).getResultList();</span></code></pre></td></tr></table></div></figure>


<h4>åŸç”ŸSQL</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>String sql = "select * from user where id = :tmpId";
</span><span class='line'>NativeQuery&lt;User&gt; nativeQuery = session.createNativeQuery(sql,User.class);
</span><span class='line'>nativeQuery.setParameter("tmpId", 19);
</span><span class='line'>nativeQuery.setFirstResult(1);
</span><span class='line'>nativeQuery.setMaxResults(2);
</span><span class='line'>List&lt;User&gt; list = nativeQuery.getResultList();
</span><span class='line'>//nativeQuery.executeUpdate(); ä¿®æ”¹æˆ–è€…åˆ é™¤</span></code></pre></td></tr></table></div></figure>


<h4>one-to-many / many-to-one</h4>

<p>ä¸¾ä¸ªæ —å­ï¼š <code>User(å•æ–¹)----Book(å¤šæ–¹)</code>,ä¸€ä¸ªuseræœ‰å¤šä¸ªbook, ä¸€ä¸ªbookåªå±äºä¸€ä¸ªuserã€‚</p>

<pre><code>public class User {
    public int id;
    public String name;
    private Set&lt;Book&gt; books = new HashSet&lt;Book&gt;();
    //ä¸‹é¢ getter setter
}

public class Book {
    public int id;
    public String name;
    public User user;
    //ä¸‹é¢ getter setter
}
</code></pre>

<p>User mapper</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC 
 "-//Hibernate/Hibernate Mapping DTD//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;
&lt;hibernate-mapping package="com.sgm.bean"&gt;
    &lt;class name="User" table="user"&gt;
        &lt;id name="id" type="int" column="id"&gt;
            &lt;generator class="native" /&gt;
        &lt;/id&gt;
        &lt;property name="name" column="name" type="string" /&gt;

        &lt;set name="books" inverse="true" cascade="all"&gt;
            &lt;key column="userId"&gt;&lt;/key&gt;
            &lt;one-to-many class="com.sgm.bean.Book" /&gt;
        &lt;/set&gt;
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;
</code></pre>

<p>Book mapper</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC 
 "-//Hibernate/Hibernate Mapping DTD//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;
&lt;hibernate-mapping package="com.sgm.bean"&gt;
    &lt;class name="Book" table="book"&gt;
        &lt;id name="id" type="int" column="id"&gt;
            &lt;generator class="native" /&gt;
        &lt;/id&gt;
        &lt;property name="name" column="name" type="string" /&gt;

        &lt;many-to-one name="user" class="com.sgm.bean.User"&gt;
            &lt;column name="userId"&gt;&lt;/column&gt;
        &lt;/many-to-one&gt;
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;
</code></pre>

<p>æµ‹è¯•</p>

<pre><code>public class Main {
    private static SessionFactory factory;
    static {
        try {
            Configuration config = new Configuration().configure("com/sgm/config/hibernate.xml");
            factory = config.buildSessionFactory();
        } catch (Throwable ex) {
            throw new ExceptionInInitializerError(ex);
        }
    }

    @SuppressWarnings("unchecked")
    public static void main(String[] args) {
        Session session = factory.openSession();
        Transaction transaction = null;
        try {
            transaction = session.beginTransaction();
            // do some work
            User user = new User();
            user.setName("andy");

            Book book1 = new Book();
            book1.setName("å“ˆåˆ©æ³¢ç‰¹");
            book1.setUser(user);

            Book book2 = new Book();
            book2.setName("åŠŸå¤«ä¹‹ç‹");
            book2.setUser(user);

            user.getBooks().add(book1);
            user.getBooks().add(book2);

            session.save(user);

            transaction.commit();
        } catch (Exception e) {
            if (transaction != null)
                transaction.rollback();
            e.printStackTrace();
        } finally {
            session.close();
        }
    }
}
</code></pre>

<p><img src="http://andyfightting.github.io/myimg/java/hibernate_om.png" alt="" /></p>

<h4>ä¸­æ–‡ä¹±ç </h4>

<p>ç”¨Hibernate æ’å…¥ä¸­æ–‡åˆ°MySQLæ•°æ®åº“æ—¶ï¼Œå³ä½¿MySQLæ•°æ®åº“è®¾ç½®ç¼–ç  <code>Character set = utf-8</code> è¿˜æ˜¯ä¹±ç ã€‚è¦æ”¹Hibernate çš„é…ç½®ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;property name="connection.url"&gt;jdbc:mysql://localhost:8889/java_db&lt;/property&gt;
</span><span class='line'>//æ”¹ä¸º
</span><span class='line'>&lt;property name="connection.url"&gt;&lt;![CDATA[jdbc:mysql://localhost:8889/java_db?useUnicode=true&characterEncoding=utf8]]&gt;&lt;/property&gt;</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spring ä¾èµ–æ³¨å…¥]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/15/spring-ioc/"/>
    <updated>2016-11-15T09:17:48+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/15/spring-ioc</id>
    <content type="html"><![CDATA[<p><a href="https://spring.io/">Spring</a>æ˜¯ä¸€ä¸ªå¤§ä¸œè¥¿ï¼Œæ¡†æ¶é›†åˆã€‚Spring MVC, Spring AOP, Spring IoC&hellip;ç­‰ç­‰ã€‚å…ˆçœ‹çœ‹Spring IoC(Inversion of Control)æ§åˆ¶åè½¬ã€‚å°±æ˜¯æŠŠåŸå…ˆè¦æ‰‹åŠ¨ new ä¸€ä¸ªå¯¹è±¡ï¼Œç°åœ¨åªè¦åœ¨Srping çš„é…ç½®æ–‡ä»¶é‡Œé…ç½®å°±å¯ä»¥äº†ï¼Œä»ä¸»åŠ¨æ§åˆ¶å¯¹è±¡ï¼Œåˆ°è¢«åŠ¨æ¥æ”¶å¯¹è±¡ï¼Œè¿™å°±å«æ§åˆ¶åè½¬ï¼Œä¹Ÿå«ä¾èµ–æ³¨å…¥(dependency injection)ï¼ ä¾èµ–æ³¨å…¥æ˜¯Springçš„æ ¸å¿ƒæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»è½¬ä¸ºç”¨é…ç½®æ–‡ä»¶æ¥ç®¡ç†ï¼Œè¿™æœ‰èµ–äºå®ƒçš„æ ¸å¿ƒç»„ä»¶ Beans, Core, Context ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/java/spring_core.png" alt="" /></p>

<p>å¼€å§‹ä¹‹å‰è¦ä¸‹è½½Spring jaråŒ…ï¼Œä½†æ˜¯å®˜ç½‘ä¸Šåªçœ‹åˆ°äº†maven å’Œ gradle çš„æ·»åŠ æ–¹å¼ï¼Œè¦æ‰‹åŠ¨ä¸‹è½½jaråŒ…è¿˜ä¸å¥½æ‰¾å‘¢ï¼Œè—å¾—è·Ÿå®è—ä¼¼çš„ã€‚<a href="http://repo.spring.io/release/org/springframework/spring/">Spring jar åŒ…ä¸‹è½½</a>ï¼Œè¿˜éœ€è¦å®ƒçš„ä¾èµ–åŒ… <a href="http://commons.apache.org/proper/commons-logging/download_logging.cgi">Commons Logging</a>ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/java/spring_jar.png" alt="" /></p>

<p>æŠŠä¸Šé¢çš„åŒ…ä¸‹è½½ä¸‹æ¥æ·»åŠ åˆ°é¡¹ç›®é‡Œï¼Œç„¶å Add to build pathã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/java/spring_add.png" alt="" /></p>

<p>Spring å¯ä»¥ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥å’Œxmlæ–¹å¼æ³¨å…¥ã€‚</p>

<h5>1.æ³¨è§£çš„æ–¹å¼æ³¨å…¥ä¸€ä¸ªæ¥å£çš„å®ç°</h5>

<p>æ¥å£å®šä¹‰</p>

<pre><code>public interface MessageInterface {
   public String getMessage();
   public String getName();
}
</code></pre>

<p>æ“ä½œAction</p>

<pre><code>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Component //å¿…é¡»è¦
public class MessageAction {

final private MessageInterface service;

@Autowired //å¯ä¸è¦
public MessageAction(MessageInterface service) {
    this.service = service;
}

public void printMessage() {
    System.out.println(this.service.getMessage() + this.service.getName());
  }
}
</code></pre>

<p>æµ‹è¯•ç±»</p>

<pre><code>import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.*;

@Configuration //å¯ä¸è¦
@ComponentScan //å¿…é¡»è¦
public class Application {
    @Bean
    MessageInterface injectImp() {
        return new MessageInterface() {
            public String getMessage() {
              return "Hello World!";
            };

        public String getName(){
            return "sgm";
        }
    };
}

  public static void main(String[] args) {
      ApplicationContext context = new AnnotationConfigApplicationContext(Application.class);
      MessageAction printer = context.getBean(MessageAction.class);
      printer.printMessage();
  }
}
</code></pre>

<p>ç»“æœæ‰“å°å‡º</p>

<pre><code>Hello World!sgm
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Configuration ç”¨äºæ ‡æ³¨ä¸€ä¸ªç±»ï¼Œè¡¨ç¤ºbeanå®šä¹‰çš„æºæ–‡ä»¶
</span><span class='line'>@ComponentScan  ç”¨äºæ ‡æ³¨ä¸€ä¸ªç±»ï¼Œè¡¨ç¤ºæ‰«ææŒ‡å®šåŒ…ä¸­çš„@Componentæ ‡æ³¨çš„ç±»ã€‚é€šè¿‡è¯¥å®ä¾‹å¾—åˆ° ApplicationContext
</span><span class='line'>@Component  ç”¨äºæ ‡æ³¨ä¸€ä¸ªç±»ç»„ä»¶ï¼Œç„¶åé€šè¿‡ ApplicationContext å¯¹è±¡è·å–
</span><span class='line'>@Bean ç”¨äºæ³¨å…¥ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œç›¸å½“äºSpring &lt;bean&gt;XMLé‡Œçš„é…ç½®
</span><span class='line'>@Autowired  ç”¨äºæ ‡æ³¨setteræ–¹æ³•ï¼Œæ„é€ å™¨ï¼ŒåŒ…å«å¤šä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œé›†åˆç­‰ç­‰ï¼Œç”¨äºè‡ªåŠ¨æ³¨å…¥ç»‘å®šå®ä¾‹</span></code></pre></td></tr></table></div></figure>


<h5>2.ç”¨xmlçš„æ–¹å¼æ³¨å…¥ä¸€ä¸ªæ¥å£çš„å®ç°</h5>

<p>å¦‚ä¸‹ï¼ŒUserServiceæ˜¯æ¥å£ï¼Œé‡Œé¢å®šä¹‰ä¸€ä¸ªprint()æ–¹æ³•ã€‚UserServiceImpæ˜¯UserServiceçš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°print(&ldquo;hello wrold&rdquo;)ã€‚</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean id="userService" class="com.sgm.implement.UserServiceImp"/&gt;

&lt;/beans&gt;
</code></pre>

<p>userService.print()å°±ä¼šæ‰“å°å‡ºç»‘å®šå®ç°ç±»é‡Œçš„"hello wrold"ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ApplicationContext context =  new ClassPathXmlApplicationContext("com/sgm/spring/bean.xml");
</span><span class='line'> UserService userService = (UserService) context.getBean("userService");
</span><span class='line'> userService.print();</span></code></pre></td></tr></table></div></figure>


<p>ç”¨xmlçš„æ–¹å¼è¿˜å¯ä»¥é€šè¿‡ç±»çš„æ„é€ å‡½æ•°æ³¨å…¥ï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯é€šè¿‡å±æ€§çš„setæ–¹æ³•æ³¨å…¥çš„ã€‚</p>

<pre><code>&lt;bean id="serviceProvider" class="com.sgm.service.ServiceProvider"&gt;
    &lt;constructor-arg ref="userService"&gt;&lt;/constructor-arg&gt;  
&lt;/bean&gt; 

&lt;bean id="userService" class="com.sgm.implement.UserServiceImp"/&gt;
</code></pre>

<p>xmlé»˜è®¤éƒ½æ˜¯æ³¨å…¥ä¸€ä¸ªå•ä¾‹å¯¹è±¡çš„ï¼Œå³beançš„å±æ€§ scope = &ldquo;singleton&rdquo; ä¸ºé»˜è®¤å€¼ã€‚å¦‚æœè¦æ¯æ¬¡éƒ½æ³¨å…¥ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œåˆ™è®¾ç½®beançš„å±æ€§ scope = &ldquo;prototype"ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MyBatis çš„ä½¿ç”¨]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/14/mybatis/"/>
    <updated>2016-11-14T19:26:25+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/14/mybatis</id>
    <content type="html"><![CDATA[<p>Mybatisæ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥å¯¹é…ç½®å’ŒåŸç”ŸMapä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£ï¼Œå°†æ¥å£å’Œ Java çš„ POJOs(Plain Old Java Objects,æ™®é€šçš„ Javaå¯¹è±¡)æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p>

<p>éœ€è¦ä¸¤ä¸ªåŒ…ï¼š<a href="https://github.com/mybatis/mybatis-3/releases">MyBatisåŒ…</a>å’Œ<a href="https://www.mysql.com/products/connector/">JDBC Driver for MySQL</a></p>

<p>æ— è®ºæ˜¯ç”¨è¿‡çš„mybatiså’Œhibernateä»–ä»¬çš„å…±åŒç‚¹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1.ä»é…ç½®æ–‡ä»¶(é€šå¸¸æ˜¯XMLé…ç½®æ–‡ä»¶ä¸­)å¾—åˆ°sessionfactory
</span><span class='line'>2.ç”±sessionfactoryäº§ç”Ÿsession
</span><span class='line'>3.åœ¨sessionä¸­å®Œæˆå¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œäº‹åŠ¡æäº¤ç­‰
</span><span class='line'>4.åœ¨ç”¨å®Œä¹‹åå…³é—­session 
</span><span class='line'>5.åœ¨java å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æœ‰mappingçš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿé€šå¸¸æ˜¯xmlæ–‡ä»¶</span></code></pre></td></tr></table></div></figure>


<p>ä¸»è¦XMLé…ç½®æ–‡ä»¶ä¸­åŒ…å«äº†å¯¹ MyBatis ç³»ç»Ÿçš„æ ¸å¿ƒè®¾ç½®ï¼ŒåŒ…å«è·å–æ•°æ®åº“è¿æ¥å®ä¾‹çš„æ•°æ®æºå’Œå†³å®šäº‹åŠ¡èŒƒå›´å’Œæ§åˆ¶æ–¹å¼çš„äº‹åŠ¡ç®¡ç†å™¨ã€‚é€šè¿‡åŠ è½½è¯¥æ–‡ä»¶è·å–SqlSessionFactoryã€‚</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
    &lt;!--å¯¹è±¡åˆ«åå®šä¹‰ --&gt;
    &lt;typeAliases&gt;
        &lt;typeAlias alias="User" type="com.sgm.java.User" /&gt;
    &lt;/typeAliases&gt;

&lt;!--æ•°æ®åº“è¿æ¥ --&gt;
&lt;environments default="development"&gt;
    &lt;environment id="development"&gt;
        &lt;transactionManager type="JDBC" /&gt;
        &lt;dataSource type="POOLED"&gt;
            &lt;property name="driver" value="com.mysql.jdbc.Driver" /&gt;
            &lt;property name="url" value="jdbc:mysql://localhost:8889/java_db" /&gt;
            &lt;property name="username" value="root" /&gt;
            &lt;property name="password" value="root" /&gt;
        &lt;/dataSource&gt;
    &lt;/environment&gt;
&lt;/environments&gt;

&lt;!--æ•°æ®åº“æ“ä½œæ˜ å°„æ–‡ä»¶ --&gt;
&lt;mappers&gt;
    &lt;mapper resource="com/sgm/mybatis/User.xml" /&gt;
&lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>

<p>æ•°æ®åº“æ“ä½œæ˜ å°„æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;

&lt;!--namespaceå¾ˆé‡è¦ï¼Œç»‘å®šå¯¹åº”çš„æ¥å£æ–‡ä»¶ï¼--&gt;
&lt;mapper namespace="com.sgm.java.UserDao"&gt;

&lt;resultMap type="User" id="resultListUser"&gt;
    &lt;result column="name" property="name" /&gt;
    &lt;result column="age" property="age" /&gt;
&lt;/resultMap&gt;

&lt;!--idåå­—è¦å’ŒUserDaoé‡Œçš„æ–¹æ³•åä¸€æ ·  --&gt;
&lt;insert id="addUser" parameterType="User" useGeneratedKeys="true" keyProperty="id"&gt;
    insert into user(name, age) values(#{name}, #{age});
&lt;/insert&gt;

&lt;delete id="deleteUserById" parameterType="int"&gt;
    delete from user where id = #{id};
&lt;/delete&gt;

&lt;update id="updateUser" parameterType="User" &gt;
     update user set name = #{name}, age = #{age} where id = #{id};
&lt;/update&gt;

&lt;select id="getAllUsers" resultMap="resultListUser"&gt;
    select * from user ;
&lt;/select&gt;

&lt;select id="selectUserById" parameterType="int" resultType="User"&gt;
   select * from user where id = #{id};
&lt;/select&gt;
&lt;/mapper&gt;
</code></pre>

<p>å®šä¹‰æ•°æ®åº“æ“ä½œæ¥å£ï¼Œæ–¹æ³•è¦å’Œå¯¹åº”çš„æ˜ å°„æ–‡ä»¶é‡Œçš„idåç§°ä¸€æ ·ï¼</p>

<pre><code>public interface UserDao {
    //  æ–¹æ³•åè¦å’ŒUser.xmlé…ç½®æ–‡ä»¶é‡Œçš„idåç§°ä¸€æ ·
    public void addUser(User user);

    public void deleteUserById(int id);

    public void updateUser(User user);

    public List&lt;User&gt; getAllUsers();

    public User selectUserById(int id);
}
</code></pre>

<p>æ“ä½œçš„Javaå¯¹è±¡</p>

<pre><code>public class User {
        public int id;
        public String name;
        public int age;

    public int getId() {
        return id;
    }
    public void setId(int id) {
        this.id = id;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}
</code></pre>

<p>æµ‹è¯•</p>

<pre><code>public class Main {
    private static Reader reader;
    private static SqlSessionFactory sqlSessionFactory;

static {
    try {
        reader = Resources.getResourceAsReader("MyBatisConfig.xml");
        sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
    } catch (Exception e) {
        e.printStackTrace();
    }
}

public static void main(String[] args) {
    SqlSession session = sqlSessionFactory.openSession();
    UserDao userDao = session.getMapper(UserDao.class);

    try {
//          // å¢
//          User newUser = new User();
//          newUser.setName("andy");
//          newUser.setAge(20);
//          userDao.addUser(newUser);
//          session.commit();//å¿…é¡»æäº¤
//          System.out.println("reult------ï¼š æ–°å¢çš„userId " + newUser.getId());    
//          //åˆ 
//          userDao.deleteUserById(1);
//          session.commit();//å¿…é¡»æäº¤

//          //æ”¹
//          User updateUser = new User();
//          updateUser.setId(4);
//          updateUser.setName("andy");
//          updateUser.setAge(20);
//          userDao.updateUser(updateUser);
//          session.commit();//å¿…é¡»æäº¤

//          //åˆ—è¡¨
//          List&lt;User&gt; userList = userDao.getAllUsers();
//          for(User user : userList){
//              System.out.println("reult------ï¼š  " + user.getName());            
//          }
            //æŸ¥å•ä¸ª
//          User user = userDao.selectUserById(4);
//          System.out.println("reult------ï¼š  " + user.getName());
        } finally {
            session.close();//å¿…é¡»å…³é—­
        }
    }
}
</code></pre>

<h3>ä¼ å‚æ–¹å¼</h3>

<h5>1.ç”¨ä¸‹æ ‡è·å–</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//Daoå±‚æ¥å£å®šä¹‰
</span><span class='line'>public User selectUser(String name,String password);
</span><span class='line'>//å¯¹åº”çš„æ˜ å°„æ–¹æ³•,ç”¨ä¸‹æ ‡è·å–
</span><span class='line'>&lt;select id="selectUser" resultMap="userList"&gt;
</span><span class='line'>    select  *  from user where name = #{0} and password=#{1}
</span><span class='line'>&lt;/select&gt;
</span><span class='line'>//å®šä¹‰userList
</span><span class='line'>&lt;resultMap type="User" id="userList"&gt;
</span><span class='line'>  &lt;result column="id" property="id" /&gt;
</span><span class='line'>  &lt;result column="name" property="name" /&gt;
</span><span class='line'>  &lt;result column="password" property="password" /&gt;
</span><span class='line'>&lt;/resultMap&gt;</span></code></pre></td></tr></table></div></figure>


<h5>2.ä¼ è‡ªå®šä¹‰å¯¹è±¡</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public void updateUser(User user);
</span><span class='line'>&lt;update id="updateUser" parameterType="User"&gt;
</span><span class='line'>  update user set name = #{name}, password = #{password} where id = #{id};
</span><span class='line'>&lt;/update&gt;
</span><span class='line'>//å®šä¹‰Useråˆ«å
</span><span class='line'>&lt;typeAliases&gt;
</span><span class='line'>  &lt;typeAlias alias="User" type="com.sgm.bean.User" /&gt;
</span><span class='line'>&lt;/typeAliases&gt;</span></code></pre></td></tr></table></div></figure>


<h5>3.ç”¨æ³¨è§£çš„æ–¹å¼</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public User selectUser(@Param("name")String name,@Param("password")String password);
</span><span class='line'>&lt;select id="selectUser" resultType="User"&gt;
</span><span class='line'>  select * from user where name = #{name} and password = #{password};
</span><span class='line'>&lt;/select&gt;</span></code></pre></td></tr></table></div></figure>


<h4>åŠ¨æ€SQLè¯­å¥</h4>

<pre><code>&lt;select id="selectSameAddressUser" parameterType="User" resultType="userList"&gt;
    select * from user 
        &lt;if test="name != null"&gt;
            title = #{name}
        &lt;/if&gt;
        &lt;if test="address != null"&gt;
            and address = #{address}
        &lt;/if&gt;
&lt;/select&gt;
</code></pre>

<h3>æ³¨æ„!</h3>

<h5>SqlSessionFactoryBuilder</h5>

<p>è¿™ä¸ªç±»å¯ä»¥è¢«å®ä¾‹åŒ–ã€ä½¿ç”¨å’Œä¸¢å¼ƒï¼Œä¸€æ—¦åˆ›å»ºäº† SqlSessionFactoryï¼Œå°±ä¸å†éœ€è¦å®ƒäº†ã€‚å› æ­¤ SqlSessionFactoryBuilder å®ä¾‹çš„æœ€ä½³èŒƒå›´æ˜¯æ–¹æ³•èŒƒå›´,ä¹Ÿå°±æ˜¯å±€éƒ¨æ–¹æ³•å˜é‡ã€‚å¯ä»¥é‡ç”¨ SqlSessionFactoryBuilder æ¥åˆ›å»ºå¤šä¸ª SqlSessionFactory å®ä¾‹ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯ä¸è¦è®©å…¶ä¸€ç›´å­˜åœ¨ä»¥ä¿è¯æ‰€æœ‰çš„ XML è§£æèµ„æºå¼€æ”¾ç»™æ›´é‡è¦çš„äº‹æƒ…ã€‚</p>

<h5>SqlSessionFactory</h5>

<p>SqlSessionFactory ä¸€æ—¦è¢«åˆ›å»ºå°±åº”è¯¥åœ¨åº”ç”¨çš„è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œæ²¡æœ‰ä»»ä½•ç†ç”±å¯¹å®ƒè¿›è¡Œæ¸…é™¤æˆ–é‡å»ºã€‚ä½¿ç”¨ SqlSessionFactory çš„æœ€ä½³å®è·µæ˜¯åœ¨åº”ç”¨è¿è¡ŒæœŸé—´ä¸è¦é‡å¤åˆ›å»ºå¤šæ¬¡ã€‚å› æ­¤ SqlSessionFactory çš„æœ€ä½³èŒƒå›´æ˜¯åº”ç”¨èŒƒå›´ã€‚å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æˆ–è€…é™æ€å•ä¾‹æ¨¡å¼ã€‚</p>

<h5>SqlSession</h5>

<p>æ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰å®ƒè‡ªå·±çš„ SqlSession å®ä¾‹ã€‚SqlSession çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„æœ€ä½³çš„èŒƒå›´æ˜¯è¯·æ±‚æˆ–æ–¹æ³•èŒƒå›´ã€‚ä¸èƒ½å°† SqlSession å®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä¸€ä¸ªç±»çš„é™æ€åŸŸï¼Œç”šè‡³ä¸€ä¸ªç±»çš„å®ä¾‹å˜é‡ä¹Ÿä¸è¡Œã€‚æ¯æ¬¡æ“ä½œåº”è¯¥æ‰“å¼€ä¸€ä¸ª SqlSessionï¼Œå¤„ç†æ•°æ®ï¼Œå¤„ç†å®Œåå°±å…³é—­å®ƒã€‚å…³é—­æ“ä½œå¾ˆé‡è¦ï¼Œåº”è¯¥æŠŠè¿™ä¸ªå…³é—­æ“ä½œæ”¾åˆ° finally å—ä¸­ä»¥ç¡®ä¿æ¯æ¬¡éƒ½èƒ½æ‰§è¡Œå…³é—­ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SqlSession session = sqlSessionFactory.openSession();
</span><span class='line'>try {
</span><span class='line'>  // do work
</span><span class='line'>} finally {
</span><span class='line'>  session.close();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android ä¸€è¡Œä»£ç é€‰å–å›¾ç‰‡]]></title>
    <link href="http://andyfightting.github.io/blog/2016/11/11/android-select-photo/"/>
    <updated>2016-11-11T19:31:33+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/11/11/android-select-photo</id>
    <content type="html"><![CDATA[<p>ä¸€è¡Œä»£ç æ¨¡ä»¿iOSçš„é€‰å–å›¾ç‰‡æ•ˆæœã€‚æ€è·¯ä¸»è¦æ˜¯æŠŠç›¸æœºå’Œç›¸å†Œçš„å›è°ƒæ”¾åœ¨ä¸€ä¸ªé€æ˜çš„Activityé‡Œï¼Œç„¶ååœ¨è¿™ä¸ªé€æ˜çš„Activityä¸­å¼¹å‡ºè‡ªå®šä¹‰çš„ActionSheeté€‰æ‹©æ¡†ï¼Œé€‰å–è°ƒç›¸æœºè¿˜æ˜¯ç›¸å†Œã€‚ç›¸æœºæ¯”è¾ƒç®€å•ï¼Œç›´æ¥è°ƒç³»ç»Ÿçš„ã€‚ç›¸å†Œå°±ä¸ç”¨ç³»ç»Ÿçš„äº†ï¼Œä¸åŒæ‰‹æœºå·®åˆ«å¤ªå¤§ï¼Œæ•ˆæœä¹Ÿä¸å¥½ã€‚è‡ªå·±éå†æœ¬åœ°å›¾ç‰‡æ–‡ä»¶ç„¶åæ˜¾ç¤ºã€‚è¿™æ ·å³æ—¶åœ¨ä¸åŒæ‰‹æœºä¸Šä¹Ÿèƒ½å±•ç¤ºç›¸åŒçš„æ•ˆæœäº†ã€‚å°è£…åä½¿ç”¨å°±ç®€å•äº†ï¼Œä¸€è¡Œä»£ç è°ƒç”¨å°±å¯ä»¥ï¼Œä¸ä¼šå’Œä¸šåŠ¡Activityè€¦åˆäº†ï¼</p>

<h4>ä½¿ç”¨:</h4>

<p>1.é€‰å–ä¸€å¼ æ­£æ–¹å½¢å›¾ç‰‡</p>

<pre><code>   SelectPhotoSheet.showCropImageSheet(this, new AlbumResultListener() {
            @Override
            public void complete(View tapedView, List&lt;String&gt; pathList) {
                cache.displayBmp(headImageView, pathList.get(0), new Point(100, 100));
            }
        });
</code></pre>

<p>2.é€‰å–é™åˆ¶æ•°é‡çš„å…¨å°ºå¯¸å›¾ç‰‡</p>

<pre><code>SelectPhotoSheet.showFullImageSheet(this, 8, new AlbumResultListener() {
            @Override
            public void complete(View tapedView, List&lt;String&gt; pathList) {
                localPathList.clear();
                localPathList.addAll(pathList);
                adapter.notifyDataSetChanged();
            }
        });
</code></pre>

<p><img src="http://andyfightting.github.io/myimg/android/one_select.png" alt="" /></p>

<h4>å®ç°</h4>

<p>1.è‡ªå®šä¹‰ActionSheetï¼Œå¼„ä¸€ä¸ªSheetçš„å·¥å…·ç±» BaseSheetActivityã€‚</p>

<pre><code>//ç”¨ä½œå¼¹å‡º action sheet æ•ˆæœçš„ base activity
public class BaseSheetActivity extends Activity {
    protected int activityCloseEnterAnimation;
    protected int activityCloseExitAnimation;

public static ItemTapListener itemTapListener;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);

    TypedArray activityStyle = getTheme().obtainStyledAttributes(new int[] {android.R.attr.windowAnimationStyle});
    int windowAnimationStyleResId = activityStyle.getResourceId(0, 0);
    activityStyle.recycle();

    activityStyle = getTheme().obtainStyledAttributes(windowAnimationStyleResId, new int[] {android.R.attr.activityCloseEnterAnimation, android.R.attr.activityCloseExitAnimation});
    activityCloseEnterAnimation = activityStyle.getResourceId(0, 0);
    activityCloseExitAnimation = activityStyle.getResourceId(1, 0);
    activityStyle.recycle();
}

@Override
public boolean onTouchEvent(MotionEvent event) {
    dismiss();
    if (itemTapListener != null){
        itemTapListener.itemTap(new View(this),"");
    }
    return super.onTouchEvent(event);
}

@Override
public void finish() {
    dismiss();
}

public void dismiss(){
    super.finish();
    overridePendingTransition(activityCloseEnterAnimation, activityCloseExitAnimation);
}

public static void show(Context context, Class showedActivityClass, ItemTapListener itemTapListener){
    BaseSheetActivity.itemTapListener = itemTapListener;
    Intent intent = new Intent(context,showedActivityClass);
    context.startActivity(intent);
}
}
</code></pre>

<p>  è¦ä½¿ç”¨ActionSheetçš„æ•ˆæœè¯å°±æ˜¯ç»§æ‰¿å®ƒï¼Œç„¶åthemeé€‰æ‹©ActionSheetThemeã€‚ç„¶åæŠŠç•Œé¢çš„å¸ƒå±€ä»bottomå¼€å§‹å¸ƒå±€ã€‚</p>

<pre><code>  public class PhotoSheet extends BaseSheetActivity {

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.action_photo_sheet); //action_photo_sheetçš„å¸ƒå±€ä»bottomå¼€å§‹

}

public void itemTap(View view){
    dismiss();
    if (itemTapListener != null){
        itemTapListener.itemTap(view,"");
    }
}

@Override
public void onBackPressed() {
    dismiss();
    if (itemTapListener != null){
        itemTapListener.itemTap(new View(this),"");
    }
}
}

   //è®¾ç½®ä¸ºè‡ªå®šä¹‰çš„æ ·å¼
 &lt;activity
        android:name=".photo_lib.photo.PhotoSheet"
        android:theme="@style/ActionSheetTheme" /&gt;
</code></pre>

<p>2.è¯»å›¾ç‰‡æ–‡ä»¶è·¯å¾„ï¼Œä¸å•å•æ˜¯ç›¸å†Œé‡Œçš„å›¾ç‰‡</p>

<pre><code>public void getLocalImages() {
        new Thread(new Runnable() {
            @Override
            public void run() {
                Uri mImageUri = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;
                ContentResolver mContentResolver = AlbumDirActivity.this.getContentResolver();

            Cursor mCursor = mContentResolver.query(
                    mImageUri,
                    null,
                    MediaStore.Images.Media.MIME_TYPE + "=? or " + MediaStore.Images.Media.MIME_TYPE + "=? or " + MediaStore.Images.Media.MIME_TYPE + "=?",
                    new String[]{"image/jpeg", "image/png", "image/jpg"},
                    MediaStore.Images.Media.DATE_MODIFIED);

            while (mCursor.moveToNext()) {
                String path = mCursor.getString(mCursor.getColumnIndex(MediaStore.Images.Media.DATA));
                String parentName = new File(path).getParentFile().getName();

                if (!dirMap.containsKey(parentName)) {
                    List&lt;String&gt; chileList = new ArrayList&lt;&gt;();
                    chileList.add(path);
                    dirMap.put(parentName, chileList);
                } else {
                    dirMap.get(parentName).add(path);
                }
            }
            mCursor.close();
            mHandler.sendEmptyMessage(SCAN_OK);
        }
    }).start();
}
</code></pre>

<p>3.ç”¨LruCacheç¼“å­˜æ˜¾ç¤ºå‹ç¼©åçš„å›¾ç‰‡</p>

<pre><code>public class LocalImageCache {

private static LocalImageCache mInstance;

private Handler mHander = new Handler();
private LruCache&lt;String, Bitmap&gt; mMemoryCache;
private CacheImageCallBack mCallBack;
private ExecutorService mImageThreadPool = Executors.newFixedThreadPool(5);

private LocalImageCache() {
    final int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);
    final int cacheSize = maxMemory / 5;

    mMemoryCache = new LruCache&lt;String, Bitmap&gt;(cacheSize) {
        @Override
        protected int sizeOf(String key, Bitmap bitmap) {
            return bitmap.getByteCount()/1024;
        }
    };

    mCallBack = new CacheImageCallBack() {
        @Override
        public void onImageLoader(ImageView imageView, Bitmap bitmap) {
            if (bitmap != null &amp;&amp; imageView != null) {
                imageView.setImageBitmap(bitmap);
            }
        }
    };
}

public static LocalImageCache getInstance() {
    synchronized (LocalImageCache.class) {
        if (mInstance == null) {
            mInstance = new LocalImageCache();
        }
        return mInstance;
    }
}

public static void clearCache() {
    LocalImageCache cache = getInstance();
    cache.mMemoryCache.evictAll();
}

public void displayBmp(final ImageView imageView, final String path, final Point mPoint) {
    if (TextUtils.isEmpty(path) || imageView == null) {
        return;
    }

    Bitmap bitmap = getBitmapFromMemCache(path);
    if (bitmap == null) {
        imageView.setImageBitmap(null);

        mImageThreadPool.execute(new Runnable() {
            Bitmap mBitmap;

            @Override
            public void run() {
                mBitmap = decodeThumbBitmapForFile(path, mPoint == null ? 0 : mPoint.x, mPoint == null ? 0 : mPoint.y);
                mHander.post(new Runnable() {
                    @Override
                    public void run() {
                        mCallBack.onImageLoader(imageView, mBitmap);
                    }
                });
                addBitmapToMemoryCache(path, mBitmap);
            }
        });
    } else {
        imageView.setImageBitmap(bitmap);
    }
}

private void addBitmapToMemoryCache(String key, Bitmap bitmap) {
    if (getBitmapFromMemCache(key) == null &amp;&amp; bitmap != null) {
        mMemoryCache.put(key, bitmap);
    }
}

private Bitmap getBitmapFromMemCache(String key) {
    return mMemoryCache.get(key);
}

private Bitmap decodeThumbBitmapForFile(String path, int viewWidth, int viewHeight) {
    BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeFile(path, options);
    options.inSampleSize = computeScale(options, viewWidth, viewHeight);
    options.inJustDecodeBounds = false;

    return BitmapFactory.decodeFile(path, options);
}

private int computeScale(BitmapFactory.Options options, int viewWidth, int viewHeight) {
    int inSampleSize = 1;
    if (viewWidth == 0 || viewHeight == 0) {
        return inSampleSize;
    }
    int bitmapWidth = options.outWidth;
    int bitmapHeight = options.outHeight;

    if (bitmapWidth &gt; viewWidth || bitmapHeight &gt; viewHeight) {
        int widthScale = Math.round((float) bitmapWidth / (float) viewWidth);
        int heightScale = Math.round((float) bitmapHeight / (float) viewHeight);

        inSampleSize = (widthScale+heightScale)/2;
    }
    return inSampleSize;
}


private interface CacheImageCallBack {
    void onImageLoader(ImageView imageView, Bitmap bitmap);
}
}
</code></pre>

<p>4.ç”¨DrawerLayoutå°è£…äº†ä¸€ä¸ªæ‰‹åŠ¿è¿”å›çš„åŸºç¡€ç±»</p>

<pre><code>public class BaseSwipeActivity extends AppCompatActivity {

private LinearLayout containerLayout;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    initSwipeView();
}

@Override
protected void onDestroy() {
    super.onDestroy();
}

private void initSwipeView() {
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    setContentView(R.layout.activity_base_swipe);

    containerLayout = (LinearLayout) findViewById(R.id.container_layout);

    DrawerLayout drawer = (DrawerLayout) findViewById(R.id.base_drawer_layout);
    drawer.openDrawer(GravityCompat.END);
    ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(this, drawer, R.string.navigation_drawer_open, R.string.navigation_drawer_close) {
        @Override
        public void onDrawerClosed(View drawerView) {
            super.onDrawerClosed(drawerView);
            finish();
        }
    };
    drawer.addDrawerListener(toggle);
}

//å­ç±»è¦æ‰‹åŠ¿è¿”å›å°±ç”¨setMainView!!!!
public void setMainView(int viewId) {
    LayoutInflater inflater = LayoutInflater.from(this);
    View tmpView = inflater.inflate(viewId, null);

    if (tmpView instanceof LinearLayout) {
        LinearLayout.LayoutParams linearLayoutParams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(linearLayoutParams);
    } else if (tmpView instanceof RelativeLayout) {
        RelativeLayout.LayoutParams relativeLayoutParams = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(relativeLayoutParams);
    }
    containerLayout.removeAllViews();
    containerLayout.addView(tmpView);
}

public void backViewTap(View v) {

}

public void backImageTap(View v) {
    finish();
}
}
</code></pre>

<p>å…¶ä»–Activityéœ€è¦æ‰‹åŠ¿è¿”å›çš„è¯å°±ç»§æ‰¿å®ƒï¼Œç„¶åä½¿ç”¨setMainView()æ›¿ä»£setContentView()è®¾ç½®ç•Œé¢å¸ƒå±€ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡å•¦ï¼</p>

<h4>æ³¨æ„</h4>

<p>è¦åœ¨ä½¿ç”¨çš„Activityçš„onDestroy()æ–¹æ³•ä¸­è°ƒç”¨ FileUtil.deleteAllFile(); æ¸…é™¤é€‰å–çš„ä¸´æ—¶ç¼“å­˜å›¾ç‰‡ï¼ï¼ï¼</p>

<p><a href="https://github.com/AndyFightting/SelectPhoto_Android">ä¸‹è½½</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS Not Found for Architecture Arm64]]></title>
    <link href="http://andyfightting.github.io/blog/2016/09/12/link-bug/"/>
    <updated>2016-09-12T10:00:18+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/09/12/link-bug</id>
    <content type="html"><![CDATA[<p>æ¥æ‰‹ç»´æŠ¤ä¸€ä¸ªé¡¹ç›®ï¼Œæ›´æ–°ä¸€ä¸‹å‡ºç°äº†ä¸‹é¢è¿™é—®é¢˜ğŸ‘‡
<img src="http://andyfightting.github.io/myimg/ios/arm64.png" alt="image" /></p>

<p>å¥½åƒä¸å¸¸è§çš„é—®é¢˜ï¼Œè°·æ­Œä¸€ä¸‹</p>

<p><a href="http://stackoverflow.com/questions/19213782/undefined-symbols-for-architecture-arm64">Stack Overflow</a>
<img src="http://andyfightting.github.io/myimg/ios/stackoverflow.png" alt="image" /></p>

<p>è¯´æ˜¯Architecturesè®¾ç½®é—®é¢˜&hellip; è¯´æ˜¯Other Linker Flagsé—®é¢˜&hellip;è¯´æ˜¯Target Membershipé—®é¢˜&hellip; æ”¹äº†å¥½åƒéƒ½æ²¡ç”¨å•Šï¼Œé—®é¢˜è¿˜æ˜¯ä¸€åŠ¨ä¸åŠ¨çš„å‡ºç°åœ¨é‚£é‡Œ&hellip;
<img src="http://andyfightting.github.io/myimg/ios/targetMap.png" alt="image" /></p>

<p>ç»§ç»­æ‰¾æ‰¾æ‰¾&hellip;ç”¨å¯¹åº”çš„ç±»æ–‡ä»¶å…¨å±€æœä¸€ä¸‹&hellip;è¯¶~ å¥½åƒé‚£é‡Œä¸å¯¹å•Š&hellip;è·¯å¾„æ€ä¹ˆè¿™æ ·å­??æ€ä¹ˆå’Œåˆ«çš„ä¸ä¸€æ ·~~ å–œå‡ºæœ›å¤–ï¼Œå¥½åƒçŸ¥é“åŸå› äº†ï¼Œæœç„¶é¡¹ç›®æ–‡ä»¶å¤¹é‡Œçœ‹ä¸åˆ°è¯¥æ–‡ä»¶ï¼ŒAdd Files to &ldquo;XXX"æ·»åŠ æ–‡ä»¶!
<img src="http://andyfightting.github.io/myimg/ios/errorLoad.png" alt="image" /></p>

<p>è¿˜æ˜¯ä¸è¡Œ&hellip;æŠŠå¯¹åº”çš„.h .mæ–‡ä»¶æ‹–åˆ°æ¡Œé¢ä¸Šï¼Œå†é‡æ–°æ·»åŠ åˆ°é¡¹ç›®é‡Œï¼Œè§£å†³äº†ï¼ï¼ä¸ºä»€ä¹ˆä¸€å¼€å§‹ä¸æ€€ç–‘æ˜¯æ–‡ä»¶ç´¢å¼•é—®é¢˜å‘¢ï¼Ÿ å› ä¸ºé¡¹ç›®ç¼–è¯‘æ²¡æŠ¥ XXX.h not found &hellip;ä»¥ä¸ºæ–‡ä»¶éƒ½å¥½å¥½çš„å‘¢ï¼Œä»¥ä¸ºæ˜¯é¡¹ç›®çš„é…ç½®é—®é¢˜&hellip; æ‰€ä»¥ä¸€å¼€å§‹æ‰¾é—®é¢˜çš„æ–¹å‘å°±è·‘åäº†ï¼å…¶å®è¿™é—®é¢˜ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ï¼Œä¸€èˆ¬æ˜¯ç¬¬ä¸‰æ–¹çš„XXX.aæ–‡ä»¶å‡ºç°è¿™é—®é¢˜ï¼Œåªæ˜¯è¿™æ¬¡è„‘è¢‹æ²¡é•¿è®°æ€§&hellip;è¿™é—®é¢˜ä¸€èˆ¬æ˜¯å¤šäººå¼€å‘é¡¹ç›®ç”¨SVNæ›´æ¥æ›´å»å¯¼è‡´çš„<code>project.pbxproj</code>é‡Œå¯¹åº”çš„æ–‡ä»¶ç´¢å¼•æ²¡äº†ã€‚å¥½äº†ï¼Œå†é‡åˆ°è¿™é—®é¢˜å°±ä¸è¦è·‘åäº†ï¼ŒæŠŠå¯¹åº”çš„æ–‡ä»¶é‡æ–°æ·»åŠ å°±å¯ä»¥äº†ï¼ï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OkHttp and Retrofit]]></title>
    <link href="http://andyfightting.github.io/blog/2016/09/08/okhttp-retrofit/"/>
    <updated>2016-09-08T14:57:19+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/09/08/okhttp-retrofit</id>
    <content type="html"><![CDATA[<p><a href="http://square.github.io/okhttp/">OkHttp</a>å’Œ<a href="http://square.github.io/retrofit/">Retrofit</a>éƒ½æ˜¯<a href="http://square.github.io/">Square</a>å…¬å¸å¼€æºå‡ºæ¥çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚Retrofitæ˜¯å¯¹OkHttpçš„å°è£…ï¼Œä½¿å…¶å¯ä»¥ç”¨æ³¨è§£çš„æ–¹å¼è°ƒç”¨ã€‚</p>

<h4>OkHttp</h4>

<pre><code>//-----okhttp ç½‘ç»œè¯·æ±‚ å·¥å…·ç±»-----

//å¼‚æ­¥è¯·æ±‚ç»“æœæ”¾åœ¨ä¸»çº¿ç¨‹å›è°ƒã€‚
private static final Handler mainHandler = new Handler(Looper.getMainLooper()); 

private static final OkHttpClient client = new OkHttpClient.Builder()
        .connectTimeout(10, TimeUnit.SECONDS)
        .writeTimeout(10, TimeUnit.SECONDS)
        .readTimeout(10, TimeUnit.SECONDS)
        .build();

public static void getRequest(String url, final OkHttpListener listener) {
    Request request = new Request.Builder()
            .header("token", getUserToken())
            .header("client", "Android")
            .header("versionCode", getVersionCode())
            .header("versionName", getVersionName())
            .url(url)
            .build();
    beginRequest(request, listener);
}

//è¿™æ ·å°±ä¸ä¼šæœ‰ä¸­æ–‡ä¹±ç é—®é¢˜
public static void postRequest(String url, final Map&lt;String, String&gt; params, final OkHttpListener listener) {
    StringBuilder stringBuilder = new StringBuilder("");
    if (params != null) {
        Set&lt;String&gt; keys = params.keySet();
        for (String key : keys) {
            String value = params.get(key);
            stringBuilder.append(key + "=" + value + "&amp;");
        }
    }

    MediaType mediaType = MediaType.parse("application/x-www-form-urlencoded;charset=utf-8");
    RequestBody body = RequestBody.create(mediaType, stringBuilder.toString());

    Request request = new Request.Builder()
            .header("token", getUserToken())
            .header("client", "Android")
            .header("versionCode", getVersionCode())
            .header("versionName", getVersionName())
            .url(url)
            .post(body)
            .build();

    beginRequest(request, listener);
}

//å¯æ·»åŠ å›¾ç‰‡æ–‡ä»¶
public static void postMutibleRequest(String url, final Map&lt;String, Object&gt; params, final OkHttpListener listener) {
    MultipartBody.Builder multipleBuilder = new MultipartBody.Builder();
    multipleBuilder.setType(MultipartBody.FORM);

    if (params != null) {
        Set&lt;String&gt; keys = params.keySet();
        for (String key : keys) {
            Object obj = params.get(key);

            if (obj instanceof File) {
                File tmpFile = (File) obj;
                multipleBuilder.addFormDataPart(key, tmpFile.getName(), MultipartBody.create(MediaType.parse("image/jpg"), tmpFile));
            } else {
                multipleBuilder.addPart(Headers.of("Content-Disposition", "form-data; name=\"" + key + "\""), RequestBody.create(null, (String) obj));
            }
        }
    }

    RequestBody multipleBody = multipleBuilder.build();
    Request request = new Request.Builder()
            .header("token", getUserToken())
            .header("client", "Android")
            .header("versionCode", getVersionCode())
            .header("versionName", getVersionName())
            .url(url)
            .post(multipleBody)
            .build();

    beginRequest(request, listener);
}

//ä¿å­˜ç½‘ç»œå›¾ç‰‡åˆ°ç›¸å†Œ,è¿”å›æœ¬åœ°å­˜å‚¨è·¯å¾„
public static void downloadImageToSysPhoto(String imageUrl, final OkHttpListener listener) {
    Request request = new Request.Builder().url(imageUrl).build();
    Call call = client.newCall(request);
    call.enqueue(new Callback() {
        @Override
        public void onResponse(Call call, Response response) throws IOException {
            try {
                //ç³»ç»Ÿç›¸å†Œè·¯å¾„
                final String localPath = "/storage/emulated/0/DCIM/Camera/" + CommonUtil.getUniqueString(10) + ".jpg";

                InputStream is = response.body().byteStream();
                FileOutputStream fos = new FileOutputStream(localPath);
                byte[] buffer = new byte[1024];

                int len;
                while ((len = is.read(buffer)) != -1) {
                    fos.write(buffer, 0, len);
                }
                is.close();
                fos.close();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.success(localPath);
                        }
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.fail(0, "");
                        }
                    }
                });
            }
        }

        @Override
        public void onFailure(Call call, IOException e) {
            mainHandler.post(new Runnable() {
                @Override
                public void run() {
                    if (listener != null) {
                        listener.fail(0, "");
                    }
                }
            });
        }
    });
}

private static void beginRequest(Request request, final OkHttpListener listener) {
    Call call = client.newCall(request);

    call.enqueue(new Callback() {//enqueueæ˜¯å¼‚æ­¥è¯·æ±‚
        @Override
        public void onResponse(Call call, Response response) throws IOException {
            final String responseString = response.body().string();
            final int code = response.code();

            if (response.isSuccessful()) {
                CommonUtil.logJson(responseString);

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.success(responseString);
                        }
                    }
                });
            } else {
                //è¯·æ±‚å¤±è´¥ï¼š    400  ---------   {"code":100004,"msg":"æ‰‹æœºå·å·²æ³¨å†Œ"}
                CommonUtil.logString("è¯·æ±‚å¤±è´¥ï¼š" + code + "---------" + responseString);
                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.fail(code, responseString);
                        }
                    }
                });
            }
        }

        @Override
        public void onFailure(Call call, IOException e) {
            e.printStackTrace();
            CommonUtil.logString("è¯·æ±‚é”™è¯¯");
            mainHandler.post(new Runnable() {
                @Override
                public void run() {
                    if (listener != null) {
                        listener.fail(0, "è¯·æ±‚å¤±è´¥");
                    }
                }
            });
        }
    });
}

public static String getFailedMsg(String response) {
    try {
        JSONObject jsonObject = new JSONObject(response);
        return jsonObject.getString("msg");
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "è¯·æ±‚å¤±è´¥";
}

public static String getUserToken() {
    UserModel userModel = UserModel.getUser();
    if (userModel != null) {
        return userModel.getToken();
    }
    return "";
}

public static String getVersionCode() {
    try {
        PackageInfo pi = application.getPackageManager().getPackageInfo(application.getPackageName(), 0);
        return pi.versionCode + "";
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "";
}

public static String getVersionName() {
    try {
        PackageInfo pi = application.getPackageManager().getPackageInfo(application.getPackageName(), 0);
        return pi.versionName;
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "";
}

//ä¸‹è½½apkå®‰è£…åŒ…ï¼ŒHUDæ˜¯è‡ªå®šä¹‰çš„ç­‰å¾…è¿›åº¦æ¡
private static int apkProgress;
public static void downloadAPK(final Context context, String apkUrl) {
    HUD.show(context, "ä¸‹è½½ä¸­...");
    HUD.setCancelable(false);

    Request request = new Request.Builder().url(apkUrl).build();
    Call call = client.newCall(request);
    call.enqueue(new Callback() {
        @Override
        public void onResponse(Call call, Response response) throws IOException {
            try {
                FileUtil.createDir();//åˆ›å»º  ~/paiqi/ æ–‡ä»¶å¤¹
                final String apkLocalPath = FileUtil.DIR_PATH + "paiqi.apk";

                InputStream is = response.body().byteStream();
                FileOutputStream fos = new FileOutputStream(apkLocalPath);
                int readNum;
                byte[] buffer = new byte[1024];

                int progressCount = 0;
                long totalLength = response.body().contentLength();

                while ((readNum = is.read(buffer)) != -1) {
                    progressCount += readNum;
                    apkProgress = (int) (((float) progressCount / totalLength) * 100);

                    mainHandler.post(new Runnable() {
                        @Override
                        public void run() {
                            HUD.setMessage("ä¸‹è½½ä¸­ " + apkProgress + "%");
                        }
                    });

                    fos.write(buffer, 0, readNum);
                }
                is.close();
                fos.close();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        HUD.dismiss();
                        installAPK(context, apkLocalPath);
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        HUD.dismiss();
                        CommonUtil.showToast("ä¸‹è½½å¤±è´¥");
                    }
                });
            }
        }

        @Override
        public void onFailure(Call call, IOException e) {
            mainHandler.post(new Runnable() {
                @Override
                public void run() {
                    HUD.dismiss();
                    CommonUtil.showToast("ä¸‹è½½å¤±è´¥");
                }
            });
        }
    });
}

//å®‰è£…apk
private static void installAPK(Context context, String apkPath) {
    File apkFile = new File(apkPath);
    if (!apkFile.exists()) {
        CommonUtil.showToast("å®‰è£…å¤±è´¥");
        return;
    }
    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setDataAndType(Uri.parse("file://" + apkFile.toString()), "application/vnd.android.package-archive");
    context.startActivity(intent);
} 

//è¯·æ±‚å›è°ƒæ¥å£å®šä¹‰
public interface OkHttpListener {
   void success(String response);
   void fail(int code,String response);
}
</code></pre>

<p>è¦æ³¨æ„çš„æ˜¯enqueueæ–¹æ³•æ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œæ‰€ä»¥è¦æŠŠç»“æœå›è°ƒæ”¾åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œã€‚</p>

<pre><code> mainHandler.post(new Runnable() {
                        @Override
                        public void run() {
                            if (listener != null) {
                                listener.success(responseString);
                            }
                        }
                    });
</code></pre>

<p>ä¹‹å‰çœ‹è¿‡ä¸€ä¸ªåŒäº‹çš„ç½‘ç»œåº“å°è£…ï¼ŒæŠŠç½‘ç»œå›è°ƒæ¥å£æ”¾åœ¨BaseActivityé‡Œï¼Œç„¶ååœ¨å­Activityé‡Œé‡å†™å›è°ƒæ–¹æ³•ï¼è¿™æ ·å¯¼è‡´çš„ç»“æœå°±æ˜¯ï¼ŒFragmenté‡Œçš„è¯·æ±‚éƒ½è¦é€šè¿‡Activityæ¥é‡å†™æ–¹æ³•ï¼Œç„¶åå†è½¬å‘ç»™Fragment&hellip;ç®€ç›´æƒ³éª‚è¡—å•Šæœ‰æœ¨æœ‰ï¼ä¸‹é¢è¿™æ ·è°ƒç”¨æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢~!</p>

<pre><code>//getå¼‚æ­¥è¯·æ±‚,å›è°ƒéƒ½å·²æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­
 OkHttpHelper.getRequest(ulr, new OkHttpListener() {
        @Override
        public void success(String response) {

        }

        @Override
        public void fail() {

        }
    });

   //postå¼‚æ­¥è¯·æ±‚ï¼Œå›è°ƒéƒ½å·²æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨äºæäº¤File
    Map&lt;String, Object&gt; paramter = new HashMap&lt;&gt;();
    paramter.put("name", "é˜¿è´µ");
    paramter.put("file", new File("filePath"));//æäº¤å›¾ç‰‡æ–‡ä»¶

    OkHttpHelper.postRequest(url, paramter, new OkHttpListener() {
        @Override
        public void success(String response) {

        }

        @Override
        public void fail() {

        }
    });
</code></pre>

<p>è¿˜æœ‰å¾ˆå¤šäººå–œæ¬¢æŠŠç½‘ç»œè¯·æ±‚å’Œç»“æœè§£æå†™åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚é€šè¿‡è¯·æ±‚ç»“æœç›´æ¥å¾—åˆ°å¯¹åº”çš„Beanã€‚è¿™æ ·å¯¼è‡´çš„ç»“æœå°±æ˜¯ç½‘çƒè¯·æ±‚ç»“æœç±»å‹ä¸ç»Ÿä¸€ï¼Œè¿”å›å„ç§Beanã€‚ä¸ªäººä¸å¤ªå–œæ¬¢è¿™æ ·ï¼Œå¯ä»¥å¯¹ç»“æœè§£æè¿›è¡Œç®€å•å°è£…ä¸€ä¸‹ï¼Œè¿™æ ·ç½‘ç»œè¿”å›çš„ç»“æœä¹Ÿä¼šç»Ÿä¸€ï¼Œæ•°æ®è§£æä¹Ÿå°±ä¸€è¡Œä»£ç ã€‚</p>

<pre><code>//ä½¿ç”¨: getBean(json, User.class);
public static &lt;T&gt; T getBean(String json, Class&lt;T&gt; clazz) {
    T bean = null;
    try {
        Gson gson = new Gson();
        bean = gson.fromJson(json, clazz);
    } catch (Exception e) {
        e.printStackTrace();
    }
    return bean;
}

   //ä½¿ç”¨ï¼šgetBeanList(json, User[].class);
    public static &lt;T&gt; List&lt;T&gt; getBeanList(String json, Class&lt;T[]&gt; type) {
        try{
            T[] list = new Gson().fromJson(json, type);
            return Arrays.asList(list);
        }catch (Exception e){
            e.printStackTrace();
            return null;
        }
    }
</code></pre>

<h4>Retrofit</h4>

<p><a href="http://square.github.io/retrofit/">Retrofitå®˜ç½‘</a>ä¸Šçš„ä¾‹å­ä¸­è¿”å›ç»“æœæ˜¯Beanï¼Œä½†åˆæ²¡è¯´æ·»åŠ äº†GsonConverterFactoryï¼Œæ‰€ä»¥ä¼šæŠ¥ Could not locate ResponseBody converter for XXBean é”™è¯¯ï¼æ‰€ä»¥è¦å¼•å…¥GsonConverterFactoryè½¬åŒ–åº“<code>compile 'com.squareup.retrofit2:converter-gson:2.0.2'</code>, ç„¶ååœ¨Retrofitåˆå§‹åŒ–çš„æ—¶å€™æ·»åŠ è¯¥åº“ï¼å®˜ç½‘åé¢è¯´äº† By default, Retrofit can only deserialize HTTP bodies into OkHttp&rsquo;s ResponseBody type and it can only accept its RequestBody type for @Body. é»˜è®¤åªä¼šè¿”å›ResponseBodyï¼å¹¶ä¸”åªæœ‰ResponseBodyæ‰å¯ä»¥ä½¿ç”¨@Bodyæ³¨è§£ï¼æˆ‘ä¸ªäººè¿˜æ˜¯ä¸å–œæ¬¢ç›´æ¥åœ¨è¿™é‡Œå¾—åˆ°Bean, æˆ‘è¿˜æ˜¯å–œæ¬¢å…ˆé€šè¿‡å¾—åˆ°response.body().string()ï¼Œç„¶åå†è½¬åŒ–æˆBeanï¼Œå„å¸å…¶èŒã€‚æ³¨æ„æ˜¯<code>response.body().string()</code>ï¼Œä¸æ˜¯<code>response.body().toString()</code>!!</p>

<pre><code>    Retrofit retrofit = new Retrofit.Builder()
                .baseUrl("https://api.github.com/")
                .addConverterFactory(GsonConverterFactory.create()) //æ·»åŠ Beanè½¬åŒ–åº“
                .build();

    ServiceInterface service = retrofit.create(ServiceInterface.class);

    Call&lt;TestBean&gt; requestCall = service.getUserInfo();

    requestCall.enqueue(new Callback&lt;TestBean&gt;() {
        @Override
        public void onResponse(Call&lt;TestBean&gt; call, Response&lt;TestBean&gt; response) {

                TestBean b = response.body();
        }

        @Override
        public void onFailure(Call&lt;TestBean&gt; call, Throwable t) {

        }
    });

 public interface ServiceInterface {
    @GET("users/andyfightting")
    Call&lt;TestBean&gt; getUserInfo();

    //è¿™é‡Œç»§ç»­æ·»åŠ å…¶ä»–æ¥å£

}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Androidä¸­çš„AsyncTask]]></title>
    <link href="http://andyfightting.github.io/blog/2016/09/07/asynctask/"/>
    <updated>2016-09-07T10:15:12+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/09/07/asynctask</id>
    <content type="html"><![CDATA[<p>Androidå’ŒiOSä¸€æ ·ï¼Œå¯¹UIçš„æ“ä½œåªèƒ½æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œï¼Œå³UIçº¿ç¨‹ã€‚å¦‚æœåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ–¹æ³•ï¼Œå°±ä¼šé€ æˆç•Œé¢å¡é¡¿å‡æ­»æ— ååº”ï¼Œæ‰€ä»¥åº”è¯¥æŠŠè€—æ—¶æ“ä½œæ”¾åœ¨<code>éUIçº¿ç¨‹</code>ä¸­å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†åœ¨<code>UIçº¿ç¨‹</code>ä¸­æ›´æ–°ç•Œé¢ã€‚</p>

<p>åœ¨æ²¡æœ‰AsyncTaskç±»çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡åœ¨å­çº¿ç¨‹å¤„ç†ï¼Œç„¶åsendMessage(Message msg)ç»™ä¸»çº¿ç¨‹ä¸­åˆ›å»ºçš„Handler,ç„¶ååœ¨ä¸»çº¿ç¨‹ä¸­å®ç°handleMessage(Message msg)å¤„ç†ç›¸åº”ä¿¡æ¯ã€‚è€Œè¿™äº›å·¥ä½œAsyncTaskå¸®æˆ‘ä»¬åšäº†ï¼ŒAsyncTaskå°±æ˜¯å¯¹Threadå’ŒHandlerçš„å°è£…ã€‚</p>

<h4>AsyncTaskä½¿ç”¨</h4>

<p>AsyncTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥å¿…é¡»åˆ›å»ºä¸€ä¸ªå­ç±»å»ç»§æ‰¿å®ƒã€‚åœ¨ç»§æ‰¿æ—¶æˆ‘ä»¬å¯ä»¥ä¸ºAsyncTaskç±»æŒ‡å®šä¸‰ä¸ªå‚æ•°ç±»å‹,è¿™ä¸‰ä¸ªç±»å‹ä¼šå½±å“é‡å†™æ–¹æ³•å¯¹åº”çš„å‚æ•°ç±»å‹ã€‚</p>

<ol>
<li>Params: åœ¨execute()å¯åŠ¨ä»»åŠ¡æ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°</li>
<li>Progress: åå°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®æ—¶åé¦ˆå‡ºæ¥çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ‰§è¡Œè¿›åº¦ä»€ä¹ˆçš„</li>
<li>Result: åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœéœ€è¦å¯¹ç»“æœè¿›è¡Œè¿”å›ï¼Œåˆ™è¿”å›è¯¥ç±»å‹</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//onå¼€é€šçš„æ–¹æ³•éƒ½æ˜¯åœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œçš„
</span><span class='line'>class MyAsyncTask extends AsyncTask&lt;Void,Integer,Boolean&gt;{
</span><span class='line'>    @Override
</span><span class='line'>    protected void onPreExecute() {//åœ¨æ‰§è¡Œå®é™…çš„åå°çš„doInBackgroundæ–¹æ³•å‰
</span><span class='line'>        super.onPreExecute();
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    @Override
</span><span class='line'>    protected Boolean doInBackground(Void... params) {//åœ¨onPreExecute æ–¹æ³•æ‰§è¡Œåé©¬ä¸Šæ‰§è¡Œï¼Œè¯¥æ–¹æ³•è¿è¡Œåœ¨åå°çº¿ç¨‹ä¸­
</span><span class='line'>        for (int i = 0; i &lt;= 100; i++) {
</span><span class='line'>            publishProgress(i);//è°ƒç”¨onProgressUpdate
</span><span class='line'>            try {
</span><span class='line'>                Thread.sleep(1000);
</span><span class='line'>            } catch (InterruptedException e) {
</span><span class='line'>                e.printStackTrace();
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>        return true;//å¯ä»¥åˆ¤æ–­æ˜¯å¦é¡ºåˆ©æ‰§è¡Œå®Œäº†å•Š
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onProgressUpdate(Integer... values) {//è¿™ä¸ªå‡½æ•°åœ¨doInBackgroundè°ƒç”¨publishProgressæ—¶è¢«è°ƒç”¨å
</span><span class='line'>        super.onProgressUpdate(values);
</span><span class='line'>        //æ¯”å¦‚å®æ—¶æ›´æ–°è¿›åº¦æ¡
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onPostExecute(Boolean aBoolean) {
</span><span class='line'>        super.onPostExecute(aBoolean);
</span><span class='line'>        //åå°é¡ºåˆ©æ‰§è¡Œå®Œåè¦å¹²å•¥å‘¢
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCancelled() {
</span><span class='line'>        super.onCancelled();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p></p>

<ol>
<li>Taskçš„å®ä¾‹å¿…é¡»åœ¨UI çº¿ç¨‹ä¸­åˆ›å»º</li>
<li>executeæ–¹æ³•å¿…é¡»åœ¨UI çº¿ç¨‹ä¸­è°ƒç”¨</li>
<li>ä¸è¦æ‰‹åŠ¨çš„è°ƒç”¨onPreExecute(), onPostExecute(Result)ï¼ŒdoInBackground(Params&hellip;)ç­‰æ–¹æ³•</li>
<li>è¯¥taskåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™å¤šæ¬¡è°ƒç”¨æ—¶å°†ä¼šæŠ›å‡ºå¼‚å¸¸</li>
</ol>


<h4>AsyncTaskæºç </h4>

<p>AsyncTaskæœ‰ä¸ªhandlerå†…éƒ¨ç±»ï¼Œç”¨å®ƒæ¥å¤„ç†åœ¨ä¸»çº¿ç¨‹ä¸­å®æ—¶æ›´æ–°å’Œä»»åŠ¡å®Œæˆåçš„å›è°ƒ</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>private static InternalHandler sHandler;
</span><span class='line'>
</span><span class='line'>private static Handler getHandler() {
</span><span class='line'>    synchronized (AsyncTask.class) {
</span><span class='line'>        if (sHandler == null) {
</span><span class='line'>            sHandler = new InternalHandler();
</span><span class='line'>        }
</span><span class='line'>        return sHandler;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>private static class InternalHandler extends Handler {
</span><span class='line'>    public InternalHandler() {
</span><span class='line'>        super(Looper.getMainLooper());
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @SuppressWarnings({"unchecked", "RawUseOfParameterizedType"})
</span><span class='line'>    @Override
</span><span class='line'>    public void handleMessage(Message msg) {
</span><span class='line'>        AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;
</span><span class='line'>        switch (msg.what) {
</span><span class='line'>            case MESSAGE_POST_RESULT:
</span><span class='line'>                // There is only one result
</span><span class='line'>                result.mTask.finish(result.mData[0]);
</span><span class='line'>                break;
</span><span class='line'>            case MESSAGE_POST_PROGRESS:
</span><span class='line'>                result.mTask.onProgressUpdate(result.mData);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>å½“æˆ‘ä»¬è°ƒç”¨publishProgressæ–¹æ³•æ—¶ï¼Œå°±æ˜¯å¾—åˆ°handlerå•åˆ—ç„¶åå‘æ¶ˆæ¯</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   protected final void publishProgress(Progress... values) {
</span><span class='line'>        if (!isCancelled()) {
</span><span class='line'>            getHandler().obtainMessage(MESSAGE_POST_PROGRESS,
</span><span class='line'>                    new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>   private static class AsyncTaskResult&lt;Data&gt; {
</span><span class='line'>        final AsyncTask mTask;
</span><span class='line'>        final Data[] mData;
</span><span class='line'>
</span><span class='line'>     AsyncTaskResult(AsyncTask task, Data... data) {
</span><span class='line'>            mTask = task;
</span><span class='line'>            mData = data;
</span><span class='line'>        }
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>å½“æ‰§è¡Œexecute()æ–¹æ³•æ—¶ï¼Œä¼šåœ¨åå°ä»»åŠ¡doInBackground(mParams)å¼€å§‹æ‰§è¡Œå‰è°ƒç”¨onPreExecuteæ–¹æ³•ã€‚ä»ä¸‹é¢å¯ä»¥çœ‹å‡ºï¼Œå½“taskå·²ç»åœ¨è¿è¡Œæˆ–è€…å·²ç»ç»“æŸçš„æ—¶å€™ä¸å¯ä»¥å†è°ƒç”¨execute()æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) {
</span><span class='line'>        return executeOnExecutor(sDefaultExecutor, params);
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>  public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec,
</span><span class='line'>            Params... params) {
</span><span class='line'>        if (mStatus != Status.PENDING) {
</span><span class='line'>            switch (mStatus) {
</span><span class='line'>                case RUNNING:
</span><span class='line'>                    throw new IllegalStateException("Cannot execute task:"
</span><span class='line'>                            + " the task is already running.");
</span><span class='line'>                case FINISHED:
</span><span class='line'>                    throw new IllegalStateException("Cannot execute task:"
</span><span class='line'>                            + " the task has already been executed "
</span><span class='line'>                            + "(a task can be executed only once)");
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        mStatus = Status.RUNNING;
</span><span class='line'>
</span><span class='line'>        onPreExecute(); //åå°ä»»åŠ¡å¼€å§‹å‰æ‰§è¡Œ
</span><span class='line'>
</span><span class='line'>        mWorker.mParams = params;
</span><span class='line'>        exec.execute(mFuture);
</span><span class='line'>
</span><span class='line'>        return this;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>     mWorker = new WorkerRunnable&lt;Params, Result&gt;() {
</span><span class='line'>            public Result call() throws Exception {
</span><span class='line'>                mTaskInvoked.set(true);
</span><span class='line'>
</span><span class='line'>                Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
</span><span class='line'>                //noinspection unchecked
</span><span class='line'>                Result result = doInBackground(mParams);   //è¿™é‡Œå¼€å§‹æ‰§è¡Œåå°ä»»åŠ¡ï¼ï¼ï¼
</span><span class='line'>                Binder.flushPendingCommands();
</span><span class='line'>                return postResult(result);
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>
</span><span class='line'>        mFuture = new FutureTask&lt;Result&gt;(mWorker) {
</span><span class='line'>            @Override
</span><span class='line'>            protected void done() {
</span><span class='line'>                try {
</span><span class='line'>                    postResultIfNotInvoked(get());    //åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ï¼ï¼
</span><span class='line'>                } catch (InterruptedException e) {
</span><span class='line'>                    android.util.Log.w(LOG_TAG, e);
</span><span class='line'>                } catch (ExecutionException e) {
</span><span class='line'>                    throw new RuntimeException("An error occurred while executing doInBackground()",
</span><span class='line'>                            e.getCause());
</span><span class='line'>                } catch (CancellationException e) {
</span><span class='line'>                    postResultIfNotInvoked(null);
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>    
</span></code></pre></td></tr></table></div></figure>


<p>åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡handlerå‘æ¶ˆæ¯ï¼Œç„¶ååˆ¤æ–­æ˜¯ä¸æ˜¯å–æ¶ˆçŠ¶æ€æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> mFuture = new FutureTask&lt;Result&gt;(mWorker) {
</span><span class='line'>            @Override
</span><span class='line'>            protected void done() {
</span><span class='line'>                try {
</span><span class='line'>                    postResultIfNotInvoked(get());   //åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ï¼ï¼
</span><span class='line'>                } catch (InterruptedException e) {
</span><span class='line'>                    android.util.Log.w(LOG_TAG, e);
</span><span class='line'>                } catch (ExecutionException e) {
</span><span class='line'>                    throw new RuntimeException("An error occurred while executing doInBackground()",
</span><span class='line'>                            e.getCause());
</span><span class='line'>                } catch (CancellationException e) {
</span><span class='line'>                    postResultIfNotInvoked(null);
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>        
</span><span class='line'>   private void postResultIfNotInvoked(Result result) {
</span><span class='line'>        final boolean wasTaskInvoked = mTaskInvoked.get();
</span><span class='line'>        if (!wasTaskInvoked) {
</span><span class='line'>            postResult(result);
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>   private Result postResult(Result result) {
</span><span class='line'>        @SuppressWarnings("unchecked")
</span><span class='line'>        Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,
</span><span class='line'>                new AsyncTaskResult&lt;Result&gt;(this, result));
</span><span class='line'>        message.sendToTarget();
</span><span class='line'>        return result;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'> private void finish(Result result) {
</span><span class='line'>        if (isCancelled()) {
</span><span class='line'>            onCancelled(result);
</span><span class='line'>        } else {
</span><span class='line'>            onPostExecute(result);
</span><span class='line'>        }
</span><span class='line'>        mStatus = Status.FINISHED;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>ä»ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒThreadPoolExecutoræ˜¯ç±»å˜é‡ï¼Œæ‰€ä»¥ä¸ç®¡åˆ›å»ºå¤šå°‘ä¸ªAsyncTaskå­ç±»çš„å¯¹è±¡ï¼Œä»–ä»¬éƒ½å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ã€‚é»˜è®¤çº¿ç¨‹æ± å¯ç»´æŠ¤çš„çº¿ç¨‹æ•°å’Œæœ€å¤§æ•°é‡ï¼Œä¸å¯ç”¨çš„CUPå¤„ç†å™¨ä¸ªæ•°æœ‰å…³ã€‚çº¿ç¨‹æ± ä¸­è¶…è¿‡corePoolSizeæ•°ç›®çš„ç©ºé—²çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´1ï¼Œå•ä½SECONDSã€‚å¦‚æœçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡å°äºCORE_POOL_SIZEï¼Œè¿™ä¸ªæ—¶å€™æ–°æ·»åŠ ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡åˆ™ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼›å¦‚æœçº¿ç¨‹æ± çš„æ•°é‡å¤§äºç­‰äºCORE_POOL_SIZEï¼Œè¿™ä¸ªæ—¶å€™æ–°å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡è¿™ä¸ªä»»åŠ¡ä¼šè¢«æ”¾å…¥ç¼“å­˜é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚ç¼“å­˜é˜Ÿåˆ—å¤§å°ä¸º128ï¼Œå¹¶ä¸”SerialExecutoræ˜¯å¼‚æ­¥é¡ºåºæ‰§è¡Œä»»åŠ¡çš„ã€‚</p>

<pre><code>private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();
private static final int CORE_POOL_SIZE = CPU_COUNT + 1;
private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1;
private static final int KEEP_ALIVE = 1;

private static final BlockingQueue&lt;Runnable&gt; sPoolWorkQueue = new LinkedBlockingQueue&lt;Runnable&gt;(128);

public static final Executor THREAD_POOL_EXECUTOR
        = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE,
                TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory);


private static class SerialExecutor implements Executor {
    final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;();
    Runnable mActive;

    public synchronized void execute(final Runnable r) {
        mTasks.offer(new Runnable() {
            public void run() {
                try {
                    r.run();
                } finally {
                    scheduleNext();
                }
            }
        });
        if (mActive == null) {
            scheduleNext();
        }
    }

    protected synchronized void scheduleNext() {
        if ((mActive = mTasks.poll()) != null) {
            THREAD_POOL_EXECUTOR.execute(mActive);
        }
    }
}
</code></pre>

<h4>é—®é¢˜</h4>

<p>AsyncTaskå¤„ç†ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¹ æƒ¯åœ¨onPreExecuteæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œåœ¨æ•°æ®å¤„ç†å®Œæˆä¹‹åçš„onPostExecuteå…³é—­è¿›åº¦æ¡ã€‚ä½†æ˜¯å½“æ¨ªç«–å±åˆ‡æ¢æˆ–è€…å†…å­˜é‡å¯å¯¼è‡´Activityé‡æ–°å¯åŠ¨æ—¶ï¼Œå‡è®¾ä½ è¿˜åœ¨onPostExecuteå†™äº†ä¸€äº›å…¶ä»–é€»è¾‘ï¼Œè¿™ä¸ªæ—¶å€™çš„AsyncTaskå·²ç»ä¸ä¹‹å‰çš„Activityæ²¡æœ‰å…³è”äº†ï¼Œä¼šå¯¼è‡´onPostExecuteæ— æ•ˆé—®é¢˜ã€‚</p>

<p>è§£å†³åŠæ³•æ˜¯åœ¨onPostExecuteæ–¹æ³•é‡Œç”¨EventBus,Ottoç±»åº“æˆ–è€…è‡ªå·±å†™é€šçŸ¥ï¼ŒæŠŠç»“æœå‘é€ç»™Activityå»å¤„ç†ï¼ï¼</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>    protected void onPostExecute(String result) {
</span><span class='line'>        EventBus.getDefault().post(new AsyncTaskResultEvent(result));
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h4>ä¸ªäººçœ‹æ³•</h4>

<p>è§‰å¾—Androidå¾ˆå–œæ¬¢é€ è¿™ç§ä¸­å‹è½®å­å•Šï¼å¥½åƒæ²¡ä»€ä¹ˆå¿…è¦å†é€ ä¸ªAsyncTaskè¿™æ ·çš„è½®å­æ”¾åœ¨SDKé‡Œå•Š? åƒAsyncTaskè¿™ç§ä»»åŠ¡ä¸åº”è¯¥æ˜¯å¼€å‘è€…å»å®Œæˆçš„å—ï¼Ÿè¿˜æœ‰æ¯”å¦‚NavigationViewï¼ŒçœŸçš„æœ‰å¿…è¦å—ï¼Ÿè¿™ä¸æ˜¯åº”è¯¥è®©å¼€å‘è€…æ¥è‡ªå®šä¹‰çš„Viewå—ï¼Ÿåæ­£æˆ‘ä¸æ˜¯å¾ˆç†è§£ï¼Œè¿™å¯èƒ½ä¹Ÿæ˜¯Androidä¸ºä»€ä¹ˆå¦‚æ­¤ç¢ç‰‡åŒ–çš„åŸå› ä¹‹ä¸€å§ï¼&mdash;- å–œæ¬¢é€ ä¸­å‹è½®å­ï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åç¼–è¯‘Androidçš„APK]]></title>
    <link href="http://andyfightting.github.io/blog/2016/09/02/apk-decode/"/>
    <updated>2016-09-02T09:55:10+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/09/02/apk-decode</id>
    <content type="html"><![CDATA[<p>æœ¬äººç”¨çš„ç¯å¢ƒæ˜¯Mac 10.11.5, éœ€è¦ç”¨åˆ°çš„å·¥å…·æœ‰ï¼š<a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, <a href="https://sourceforge.net/projects/dex2jar/">dex2jar</a>, <a href="http://jd.benow.ca/">JD-GUI</a>ã€‚</p>

<p>ä¸‹é¢ç”¨æ·˜å®2.2.1ç‰ˆæœ¬å’Œå¾®ä¿¡2.3ç‰ˆæœ¬ä¸ºä¾‹å­æ¥åç¼–è¯‘ã€‚ä¸ºä»€ä¹ˆç”¨è¿™ä¹ˆè€çš„ç‰ˆæœ¬ï¼Ÿå› ä¸ºå¯èƒ½è€ç‰ˆæœ¬æ²¡æœ‰åšä»£ç æ··æ·†ï¼Œåç¼–è¯‘åä¼šæ›´å¥½çœ‹ä¸€ç‚¹ã€‚å¯ä»¥ç”¨<a href="http://www.anzhi.com/">å®‰æ™ºå¸‚åœº</a>æ¥ä¸‹è½½å†å²ç‰ˆæœ¬ï¼Œæ¨èç”¨å®‰æ™ºå¸‚åœºçš„æ‰‹æœºAPPæ¥ä¸‹è½½ï¼Œä¼šçœ‹åˆ°æ‰€æœ‰çš„å†å²ç‰ˆæœ¬ï¼Œè€Œç”µè„‘ç½‘ç«™åªèƒ½çœ‹åˆ°æœ€è¿‘çš„å‡ ä¸ªå†å²ç‰ˆæœ¬ã€‚
<img src="http://andyfightting.github.io/myimg/android/az_taobao.png" alt="image" /></p>

<h4>1.apktool</h4>

<p>éœ€è¦è‡³å°‘Java 7ç¯å¢ƒï¼Œé€šè¿‡<code>java -version</code>æŸ¥çœ‹
<img src="http://andyfightting.github.io/myimg/android/javaVersion.png" alt="image" /></p>

<p>é…ç½®apktool
<img src="http://andyfightting.github.io/myimg/android/apktool.png" alt="image" /></p>

<p>è¾“å…¥apktoolå¦‚ä¸‹æ‰€ç¤ºå°±æˆåŠŸäº†
<img src="http://andyfightting.github.io/myimg/android/apktool_result.png" alt="imag" /></p>

<p>ç”¨apktoolå·¥å…·å¤„ç†åå°±å¯ä»¥æŸ¥çœ‹xmlæ–‡ä»¶äº†ã€‚åœ¨æ¡Œé¢å»ºä¸€ä¸ªæ–‡ä»¶å¤¹test, æŠŠapkæ–‡ä»¶æ”¾è¿›å»ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œ<code>apktool d apkåç§°.apk</code>ã€‚å°±ä¼šåœ¨testæ–‡ä»¶å¤¹é‡Œå‡ºç°ä¸€ä¸ª<code>apkåç§°</code>çš„æ–‡ä»¶å¤¹ã€‚é‡Œé¢çš„èµ„æºæ–‡ä»¶å’Œxmlæ–‡ä»¶å°±å¯ä»¥æ‰“å¼€æŸ¥çœ‹äº†ã€‚
<img src="http://andyfightting.github.io/myimg/android/apktool1.png" alt="imag" />
<img src="http://andyfightting.github.io/myimg/android/apktool2.png" alt="imag" />
<img src="http://andyfightting.github.io/myimg/android/apktool3.png" alt="imag" /></p>

<h4>2.dex2jar</h4>

<p>dex2jarå·¥å…·å¯ä»¥å§dexæˆ–è€…apkæ–‡ä»¶è½¬æˆjaræ–‡ä»¶ã€‚dex2jarä¸‹è½½å¥½åè¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ<code>chmod a+x *.sh</code>å‘½ä»¤å¯ç”¨.shæ–‡ä»¶ã€‚</p>

<h6>æ–¹å¼ä¸€</h6>

<p>æŠŠapkæ–‡ä»¶çš„åç¼€åæ”¹ä¸ºzipï¼Œç„¶åè§£å‹å¾—åˆ°classes.dexæ–‡ä»¶ï¼ŒæŠŠclasses.dexæ–‡ä»¶æ”¾åˆ°dex2jaræ–‡ä»¶å¤¹ä¸­ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ<code>sh d2j-dex2jar.sh classes.dex</code>å‘½ä»¤ï¼Œå°±ä¼šå¾—åˆ°å¯¹åº”çš„jaræ–‡ä»¶ã€‚</p>

<h6>æ–¹å¼äºŒ</h6>

<p>ç›´æ¥æŠŠapkæ–‡ä»¶æ”¾å…¥dex2jaræ–‡ä»¶å¤¹ä¸­ï¼Œæ‰§è¡Œ<code>sh d2j-dex2jar.sh apkåç§°.apk</code>ä¹Ÿä¼šå¾—åˆ°å¯¹åº”çš„jaræ–‡ä»¶ã€‚</p>

<h4>3.JD-GUI</h4>

<p>æŠŠJD-GUIä¸‹è½½ä¸‹æ¥ï¼Œæ‰“å¼€ä¸Šé¢ç”Ÿæˆçš„jaræ–‡ä»¶å°±å¯æŸ¥çœ‹äº†ã€‚
<img src="http://andyfightting.github.io/myimg/android/taobao211.png" alt="image" /></p>

<p>ä¸‹é¢æ˜¯å¾®ä¿¡2.3å¤„ç†åçš„ç»“æœ
<img src="http://andyfightting.github.io/myimg/android/wx1.png" alt="image" />
<img src="http://andyfightting.github.io/myimg/android/wx2.png" alt="image" />
<img src="http://andyfightting.github.io/myimg/android/wx3.png" alt="image" />
å‰©ä¸‹çš„å°±çœ‹ç»†å¿ƒã€è€å¿ƒã€å’Œå¥½å¥‡å¿ƒäº†&hellip;ä¸‹é¢è¯´è¯´æˆ‘æ˜¯æ€ä¹ˆæŸ¥çœ‹QQ2.0çš„ã€‚</p>

<h3>æˆ‘çš„æŸ¥çœ‹æµç¨‹</h3>

<p>æ‰¾ä¸€ä¸ªé¡µé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ä¸‹é¢çš„"æˆ‘çš„ä¸ªäººèµ„æ–™"
<img src="http://andyfightting.github.io/myimg/android/find00.jpg" alt="image" /></p>

<p>ç„¶åFinderæœç´¢ï¼Œæ‰¾åˆ°strings.xmlæ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ‰¾åˆ°"æˆ‘çš„ä¸ªäººèµ„æ–™"å¯¹åº”çš„key &ndash; &ldquo;info_info"ã€‚
<img src="http://andyfightting.github.io/myimg/android/find0.png" alt="image" />
<img src="http://andyfightting.github.io/myimg/android/find1.png" alt="image" /></p>

<p>ç„¶åæœ"info_info"ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¸ƒå±€æ–‡ä»¶"info_self.xml"
<img src="http://andyfightting.github.io/myimg/android/find2.png" alt="image" /></p>

<p>ç„¶åé€šè¿‡"info_self"å¸ƒå±€æ–‡ä»¶åæœç´¢ï¼Œæ‰¾åˆ°å¯¹åº”çš„smaliæ–‡ä»¶
<img src="http://andyfightting.github.io/myimg/android/find3.png" alt="image" /></p>

<p>ç„¶åé€šè¿‡smaliæ–‡ä»¶å"InfoActivity"åœ¨JD-GUIçš„SearchåŠŸèƒ½æœç´¢ï¼Œä¸æ˜¯Find!æ‰¾åˆ°å¯¹åº”çš„Activityï¼Œè¿™æ ·æƒ³çœ‹çš„ä¸œè¥¿åº”è¯¥éƒ½èƒ½æ‰¾åˆ°äº†ã€‚
<img src="http://andyfightting.github.io/myimg/android/find4.png" alt="image" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Androidä¸­çš„Fragment]]></title>
    <link href="http://andyfightting.github.io/blog/2016/09/01/fragment/"/>
    <updated>2016-09-01T11:38:27+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/09/01/fragment</id>
    <content type="html"><![CDATA[<p>åœ¨ Android 3.0ï¼ˆAPI 11 çº§ï¼‰ä¸­å¼•å…¥äº†Fragmentï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»™å¤§å±å¹•ä¸Šæ›´åŠ åŠ¨æ€å’Œçµæ´»çš„ UI è®¾è®¡æä¾›æ”¯æŒã€‚ç”±äºå¹³æ¿ç”µè„‘çš„å±å¹•æ¯”æ‰‹æœºå±å¹•å¤§å¾—å¤šï¼Œå› æ­¤å¯ç”¨äºç»„åˆå’Œäº¤æ¢ UI ç»„ä»¶çš„ç©ºé—´æ›´å¤§ã€‚åˆ©ç”¨Fragmentå®ç°æ­¤ç±»è®¾è®¡æ—¶ï¼Œæ— éœ€ç®¡ç†å¯¹è§†å›¾å±‚æ¬¡ç»“æ„çš„å¤æ‚æ›´æ”¹ã€‚å®ƒå…·æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œèƒ½æ¥æ”¶è‡ªå·±çš„è¾“å…¥äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ Activity è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤Fragmentï¼Œæœ‰ç‚¹åƒå¯ä»¥åœ¨ä¸åŒ Activity ä¸­é‡å¤ä½¿ç”¨çš„"å­ Activity"ã€‚ é€šè¿‡å°† Activity å¸ƒå±€åˆ†æˆFragmentï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ Activity çš„å¤–è§‚ï¼Œå¹¶åœ¨ç”± Activity ç®¡ç†çš„è¿”å›æ ˆä¸­ä¿ç•™è¿™äº›æ›´æ”¹ã€‚Fragmentå¿…é¡»å§‹ç»ˆåµŒå…¥åœ¨ Activity ä¸­ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç›´æ¥å—å®¿ä¸» Activity ç”Ÿå‘½å‘¨æœŸçš„å½±å“ã€‚å½“ Activity æš‚åœæ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰Fragmentä¹Ÿä¼šæš‚åœï¼›å½“ Activity è¢«é”€æ¯æ—¶ï¼Œæ‰€æœ‰Fragmentä¹Ÿä¼šè¢«é”€æ¯ã€‚</p>

<p>ä¸‹é¢æ˜¯Androidå®˜ç½‘ä¸Šçš„<a href="https://developer.android.com/guide/components/activities.html">Activity</a>å’Œ<a href="https://developer.android.com/guide/components/fragments.html">Fragment</a>çš„ç”Ÿå‘½å‘¨æœŸå›¾ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/activity_lifecycle.png" alt="imga" /> <img src="http://andyfightting.github.io/myimg/android/fragment_lifecycle.png" alt="imga" /></p>

<p>ä¸‹é¢æ˜¯ç½‘å‹æ•´ç†çš„è¯¦ç»†çš„<a href="https://github.com/xxv/android-lifecycle">å‘¨æœŸå›¾æ¯”è¾ƒ</a>ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/fragment.png" alt="image" /></p>

<h4>ç”¨Fragmentå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜</h4>

<h5>getActivity()ç©ºæŒ‡é’ˆ</h5>

<p>å¯èƒ½é‡åˆ°è¿‡getActivity()è¿”å›nullï¼Œæˆ–è€…å¹³æ—¶è¿è¡Œå®Œå¥½çš„ä»£ç ï¼Œåœ¨â€œå†…å­˜é‡å¯â€ä¹‹åï¼Œè°ƒç”¨getActivity()çš„åœ°æ–¹å´è¿”å›nullï¼ŒæŠ¥äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹çš„åŸå› ï¼šåœ¨è°ƒç”¨äº†getActivity()æ—¶ï¼Œå½“å‰çš„Fragmentå·²ç»onDetach()äº†å®¿ä¸»Activityã€‚æ¯”å¦‚åœ¨popäº†Fragmentä¹‹åï¼Œè¯¥Fragmentçš„å¼‚æ­¥ä»»åŠ¡ä»ç„¶åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œå®Œæˆåè°ƒç”¨äº†getActivity()æ–¹æ³•ï¼Œè¿™æ ·å°±ä¼šç©ºæŒ‡é’ˆã€‚</p>

<p>å¯ä»¥åœ¨FragmentåŸºç±»é‡Œè®¾ç½®ä¸€ä¸ªActivity mActivityçš„å…¨å±€å˜é‡ï¼Œåœ¨onAttach(Activity activity)é‡Œèµ‹å€¼ï¼Œä½¿ç”¨mActivityä»£æ›¿getActivity()ï¼Œä¿è¯Fragmentå³ä½¿åœ¨onDetachåï¼Œä»æŒæœ‰Activityçš„å¼•ç”¨ã€‚</p>

<h5>Fragmenté‡å é—®é¢˜</h5>

<p>å¦‚æœadd()äº†å‡ ä¸ªFragmentï¼Œç„¶åä½¿ç”¨show()ã€hide()æ–¹æ³•æ§åˆ¶ï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQçš„åº•éƒ¨tabç­‰æƒ…æ™¯ã€‚å¦‚æœä½ ä»€ä¹ˆéƒ½ä¸åšçš„è¯ï¼Œåœ¨â€œå†…å­˜é‡å¯â€åå›ï¼ŒTabçš„è¿™å‡ ä¸ªFragmentç•Œé¢ä¼šé‡å ã€‚(æ‰‹æœºæ¨ªç«–å±åˆ‡æ¢å°±å¯ä»¥æ¨¡æ‹Ÿâ€œå†…å­˜é‡å¯â€)ã€‚åŸå› æ˜¯FragmentManagerå¸®æˆ‘ä»¬ç®¡ç†Fragmentï¼Œå½“å‘ç”Ÿâ€œå†…å­˜é‡å¯â€ï¼Œä»–ä¼šä»æ ˆåº•å‘æ ˆé¡¶çš„é¡ºåºæ¢å¤Fragmentï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰ä¿å­˜Fragmentçš„hiddenå±æ€§ï¼Œé»˜è®¤ä¸ºfalseï¼Œæ‰€ä»¥æ‰€æœ‰Fragmentéƒ½æ˜¯ä»¥showçš„å½¢å¼æ¢å¤ï¼Œç•Œé¢å°±é‡å äº†ã€‚</p>

<h5>è§£å†³æ–¹æ³•ä¸€</h5>

<p>ä¸ç”¨add()çš„æ–¹å¼å¤„ç†tabçš„Fragmentï¼Œç›´æ¥åœ¨Activityçš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ éœ€è¦çš„Fragment,ç„¶ååœ¨Activityä¸­é€šè¿‡getFragmentManager().findFragmentById()çš„æ–¹å¼å¾—åˆ°Fragmentï¼Œç„¶åå¤„ç†å¯¹åº”çš„hide,showã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;fragment
</span><span class='line'>    android:id="@+id/fragment0"
</span><span class='line'>    android:name="com.suguiming.myandroid.tab0.Fragment0"
</span><span class='line'>    android:layout_above="@+id/tab_line"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    tools:layout="@layout/fragment_container"/&gt;
</span><span class='line'>&lt;fragment
</span><span class='line'>    android:id="@+id/fragment1"
</span><span class='line'>    android:name="com.suguiming.myandroid.tab1.Fragment1"
</span><span class='line'>    android:layout_above="@+id/tab_line"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    tools:layout="@layout/fragment_container"/&gt;</span></code></pre></td></tr></table></div></figure>


<h5>è§£å†³æ–¹æ³•äºŒ</h5>

<p>åœ¨ç”¨add()æˆ–è€…replace()æ—¶ä¸ºFragmentç»‘å®šä¸€ä¸ªtagï¼Œä¸€èˆ¬ç”¨fragmentçš„ç±»åä½œä¸ºtagï¼Œç„¶ååœ¨å‘ç”Ÿâ€œå†…å­˜é‡å¯â€æ—¶ï¼Œå³savedInstanceState!=null æ—¶ï¼Œé€šè¿‡getFragmentManager().findFragmentByTag()æ‰¾åˆ°å¯¹åº”çš„Fragmentï¼Œç„¶åhideã€show å¯¹åº”çš„Fragmentã€‚</p>

<pre><code>protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity);

TargetFragment targetFragment;
HideFragment hideFragment;

if (savedInstanceState != null) {  // â€œå†…å­˜é‡å¯â€æ—¶è°ƒç”¨
    targetFragment = getSupportFragmentManager().findFragmentByTag(TargetFragment.class.getName);
    hideFragment = getSupportFragmentManager().findFragmentByTag(HideFragment.class.getName);
    // è§£å†³é‡å é—®é¢˜
    getFragmentManager().beginTransaction()
            .show(targetFragment)
            .hide(hideFragment)
            .commit();
}else{  // æ­£å¸¸æ—¶
    targetFragment = TargetFragment.newInstance();
    hideFragment = HideFragment.newInstance();

    getFragmentManager().beginTransaction()
            .add(R.id.container, targetFragment, targetFragment.getClass().getName())
            .add(R.id,container,hideFragment,hideFragment.getClass().getName())
            .hide(hideFragment)
            .commit();
}
}
</code></pre>

<h5>è§£å†³æ–¹æ³•ä¸‰</h5>

<p>ç”±äºé€ æˆé‡å çš„åŸå› æ˜¯å› ä¸ºFragmentä¸ä¼šä¿å­˜hideçš„çŠ¶æ€ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨BaseFragmentä¸­æ‰‹åŠ¨ä¿å­˜ç„¶åå¤„ç†å•Šï¼</p>

<pre><code>private static final String FRAGMENT_IS_HIDDEN = "FRAGMENT_IS_HIDDEN";

@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    //è§£å†³é‡å é—®é¢˜
    if (savedInstanceState != null) {
        boolean isHidden = savedInstanceState.getBoolean(FRAGMENT_IS_HIDDEN);
        FragmentTransaction ft = getFragmentManager().beginTransaction();
        if (isHidden) {
            ft.hide(this);
        } else {
            ft.show(this);
        }
        ft.commit();
    }
}

@Override
public void onSaveInstanceState(Bundle outState) {
    super.onSaveInstanceState(outState);
    outState.putBoolean(FRAGMENT_IS_HIDDEN, isHidden());//ä¿æŒfragmentæ˜¯å¦éšè—çš„çŠ¶æ€
}
</code></pre>

<p>åœ¨ä½¿ç”¨æ—¶è¿˜æ˜¯è¦æ³¨æ„åˆ¤æ–­savedInstanceStateæ˜¯å¦ä¸ºnullï¼Œåªæœ‰åœ¨ä¸ºç©ºæ—¶æ‰add()ã€‚åœ¨ä¸ä¸ºç©ºæ—¶å°±å¯ä»¥ä¸ç”¨å¤„ç†äº†ï¼Œäº¤ç”±BaseFragmentå¤„ç†äº†ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Androidæ‰‹åŠ¿æ»‘åŠ¨è¿”å›]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/31/android-swipe/"/>
    <updated>2016-08-31T15:16:10+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/31/android-swipe</id>
    <content type="html"><![CDATA[<p>å¶ç„¶é—´å‘ç°äº†ä¸€ä¸ªAndroidè‡ªå¸¦çš„æŠ½å±‰æ§ä»¶<a href="https://developer.android.com/training/implementing-navigation/nav-drawer.html">DrawerLayout</a>,å°±è§‰å¾—åº”è¯¥å¯ä»¥ç”¨ä»–æ¥å°è£…æˆæ‰‹åŠ¿è¿”å›çš„åŸºç¡€æ§ä»¶ã€‚æ€è·¯å°±æ˜¯å…ˆè®¾ç½®Activityçš„è·³è½¬åŠ¨ç”»æ˜¯ä»å³åˆ°å·¦ï¼Œå¹¶ä¸”å‰ä¸€ä¸ªActivityä¸èƒ½åŠ¨ã€‚ç„¶åè®¾ç½®DrawerLayoutçš„menuä»å³è¾¹å‡ºæ¥ï¼Œç„¶è®¾ç½®menuå…¨å±ï¼Œè¿™ä¸ªmenuå°±ç›¸å½“äºå­Activity Viewçš„å®¹å™¨ï¼Œé»˜è®¤æ‰“å¼€menu,ç„¶åè®¾ç½®DrawerLayoutå®¹å™¨é€æ˜ï¼Œå½“DrawerLayout closeçš„æ—¶å€™finishå®ƒæ‰€åœ¨çš„Activityï¼è¿˜è¦æŠŠçŠ¶æ€æ è®¾ç½®æˆé€æ˜ï¼Œä¸ç„¶DrawerLayout closed å† finish Activityçš„æ—¶å€™ä¼šæœ‰è§†è§‰å·®ï¼å¤æ‚çš„æ‰‹åŠ¿æ§åˆ¶å°±äº¤ç”±è‡ªå¸¦çš„DrawerLayoutå¤„ç†å•¦ï¼Œç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æœºæ™ºå¦‚æˆ‘ï¼ï¼ğŸ˜†</p>

<p>é‡åˆ°çš„é—®é¢˜ï¼šDrawerLayoutçš„menuå³æ—¶è®¾ç½®æˆmatch_parentä¹Ÿä¸èƒ½å…¨å±ï¼å› ä¸ºæºç é‡Œè®¾ç½®äº†margin64dp! é‚£æˆ‘ä»¬åªå¥½å†è®¾ç½®å›æ¥ï¼šandroid:layout_marginLeft=&ldquo;-64dp"ã€‚</p>

<pre><code> private static final int MIN_DRAWER_MARGIN = 64; // dp
</code></pre>

<p>BaseSwipeActivity</p>

<pre><code>package com.suguiming.myandroid.base;
import android.os.Bundle;
import android.support.v4.view.GravityCompat;
import android.support.v4.widget.DrawerLayout;
import android.support.v7.app.ActionBarDrawerToggle;
import android.support.v7.app.AppCompatActivity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.WindowManager;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;

import com.suguiming.myandroid.R;

public class BaseSwipeActivity extends AppCompatActivity {

private DrawerLayout drawer;
private LinearLayout containerLayout;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    setContentView(R.layout.activity_base_swipe);

    containerLayout = (LinearLayout) findViewById(R.id.container_layout);

    drawer = (DrawerLayout) findViewById(R.id.base_drawer_layout);
    drawer.openDrawer(GravityCompat.END);
    ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(this, drawer, R.string.navigation_drawer_open, R.string.navigation_drawer_close) {
        @Override
        public void onDrawerClosed(View drawerView) {
            super.onDrawerClosed(drawerView);
            finish();
        }
    };
    drawer.setDrawerListener(toggle);
}

//å­ç±»ä¸è¦ç”¨setContentView,ç”¨setMainView!!!!
public void setMainView(int viewId) {
    LayoutInflater inflater = LayoutInflater.from(this);
    View tmpView = inflater.inflate(viewId, null);

    if (tmpView instanceof LinearLayout) {
        LinearLayout.LayoutParams linearLayoutParams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(linearLayoutParams);
    } else if (tmpView instanceof RelativeLayout) {
        RelativeLayout.LayoutParams relativeLayoutParams = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(relativeLayoutParams);
    }
    containerLayout.removeAllViews();
    containerLayout.addView(tmpView);
}

}
</code></pre>

<p>å¯¹åº”çš„å¸ƒå±€æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="@android:color/transparent"
    tools:context="com.suguiming.myandroid.base.BaseSwipeActivity"&gt;

&lt;android.support.v4.widget.DrawerLayout
    android:id="@+id/base_drawer_layout"
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/transparent"
    tools:openDrawer="end"&gt;
    &lt;LinearLayout
        android:orientation="vertical"
        android:background="@color/clear"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;
    &lt;/LinearLayout&gt;

    &lt;!---64dpæ˜¯æºç menuçš„margin,è¿™é‡Œè®¾ç½®ä¸º65,ä¸ç„¶ä¼šæœ‰ä¸€æ¡é»‘çº¿--&gt;
    &lt;LinearLayout
        android:id="@+id/container_layout"
        android:orientation="vertical"
        android:layout_gravity="end"
        android:layout_marginLeft="-65dp"
        android:background="@color/light_gray"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;
    &lt;/LinearLayout&gt;
&lt;/android.support.v4.widget.DrawerLayout&gt;
&lt;/LinearLayout&gt;
</code></pre>

<p>push çš„åŠ¨ç”» style</p>

<pre><code>&lt;!--æ‰‹åŠ¿è¿”å›theme--&gt;
&lt;style name="BackSwipeTheme" parent="Theme.AppCompat.Light.NoActionBar"&gt;
    &lt;item name="android:windowIsTranslucent"&gt;true&lt;/item&gt;
    &lt;item name="android:windowBackground"&gt;@android:color/transparent&lt;/item&gt;
    &lt;item name="android:windowNoTitle"&gt;true&lt;/item&gt;
    &lt;item name="android:backgroundDimEnabled"&gt;false&lt;/item&gt;
    &lt;item name="android:windowAnimationStyle"&gt;@style/ActivitySwipeBackAnimation&lt;/item&gt;
&lt;/style&gt;
&lt;style name="ActivitySwipeBackAnimation" parent="@android:style/Animation.Activity"&gt;
    &lt;item name="android:activityOpenEnterAnimation"&gt;@anim/activity_swipe_in&lt;/item&gt;
    &lt;item name="android:activityOpenExitAnimation"&gt;@anim/activity_swipe_out&lt;/item&gt;
    &lt;item name="android:activityCloseEnterAnimation"&gt;@anim/activity_swipe_in&lt;/item&gt;
    &lt;item name="android:activityCloseExitAnimation"&gt;@anim/activity_swipe_out&lt;/item&gt;
&lt;/style&gt;
</code></pre>

<p>ä½¿ç”¨çš„è¯å°±æ˜¯è®©Activityç»§æ‰¿BaseSwipeActivityï¼Œç„¶åè®¾ç½®Activityçš„Themeä¸ºBackSwipeThemeã€‚</p>

<pre><code>public class ActivitySwipeBack extends BaseSwipeActivity {
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    //è¦ç”¨setMainViewï¼Œä¸è¦ç”¨setContentView
    setMainView(R.layout.activity_activity_swipe_back);
  }
}

&lt;activity android:name=".tab0.ActivitySwipeBack"
            android:theme="@style/BackSwipeTheme"/&gt;
</code></pre>

<p>å®Œæ•´Demoè¯·æŸ¥çœ‹<a href="https://github.com/AndyFightting/MyAndroid">MyAndroid</a>ä¸­çš„"æ‰‹åŠ¿æ»‘åŠ¨è¿”å›"ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/android_swipe.png" alt="imge" /></p>
]]></content>
  </entry>
  
</feed>
