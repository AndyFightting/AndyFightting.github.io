<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[é˜¿è´µ]]></title>
  <link href="http://andyfightting.github.io/atom.xml" rel="self"/>
  <link href="http://andyfightting.github.io/"/>
  <updated>2016-08-31T15:49:43+08:00</updated>
  <id>http://andyfightting.github.io/</id>
  <author>
    <name><![CDATA[guimingsu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Androidæ‰‹åŠ¿æ»‘åŠ¨è¿”å›]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/31/android-swipe/"/>
    <updated>2016-08-31T15:16:10+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/31/android-swipe</id>
    <content type="html"><![CDATA[<p>å¶ç„¶é—´å‘ç°äº†ä¸€ä¸ªAndroidè‡ªå¸¦çš„æŠ½å±‰æ§ä»¶DrawerLayout,å°±è§‰å¾—åº”è¯¥å¯ä»¥ç”¨ä»–æ¥å°è£…æˆæ‰‹åŠ¿è¿”å›çš„åŸºç¡€æ§ä»¶ã€‚æ€è·¯å°±æ˜¯å…ˆè®¾ç½®Activityçš„è·³è½¬åŠ¨ç”»æ˜¯ä»å³åˆ°å·¦ï¼Œå¹¶ä¸”å‰ä¸€ä¸ªActivityä¸èƒ½åŠ¨ã€‚ç„¶åè®¾ç½®DrawerLayoutçš„menuä»å³è¾¹å‡ºæ¥ï¼Œç„¶è®¾ç½®menuå…¨å±ï¼Œè¿™ä¸ªmenuå°±ç›¸å½“äºå­Activity Viewçš„å®¹å™¨ï¼Œé»˜è®¤æ‰“å¼€menu,ç„¶åè®¾ç½®DrawerLayoutå®¹å™¨é€æ˜ï¼Œå½“DrawerLayout closeçš„æ—¶å€™finishå®ƒæ‰€åœ¨çš„Activityå°±å¯ä»¥å•¦ï¼ï¼å¤æ‚çš„æ‰‹åŠ¿æ§åˆ¶å°±äº¤ç”±è‡ªå¸¦çš„DrawerLayoutå¤„ç†å•¦ï¼Œç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æœºæ™ºå¦‚æˆ‘ï¼ï¼ğŸ˜†</p>

<pre><code>package com.suguiming.myandroid.base;
import android.os.Bundle;
import android.support.v4.view.GravityCompat;
import android.support.v4.widget.DrawerLayout;
import android.support.v7.app.ActionBarDrawerToggle;
import android.support.v7.app.AppCompatActivity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.WindowManager;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;

import com.suguiming.myandroid.R;

public class BaseSwipeActivity extends AppCompatActivity {

private DrawerLayout drawer;
private LinearLayout containerLayout;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    setContentView(R.layout.activity_base_swipe);

    containerLayout = (LinearLayout) findViewById(R.id.container_layout);

    drawer = (DrawerLayout) findViewById(R.id.base_drawer_layout);
    drawer.openDrawer(GravityCompat.END);
    ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(this, drawer, R.string.navigation_drawer_open, R.string.navigation_drawer_close) {
        @Override
        public void onDrawerClosed(View drawerView) {
            super.onDrawerClosed(drawerView);
            finish();
        }
    };
    drawer.setDrawerListener(toggle);
}

//å­ç±»ä¸è¦ç”¨setContentView,ç”¨setMainView!!!!
public void setMainView(int viewId) {
    LayoutInflater inflater = LayoutInflater.from(this);
    View tmpView = inflater.inflate(viewId, null);

    if (tmpView instanceof LinearLayout) {
        LinearLayout.LayoutParams linearLayoutParams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(linearLayoutParams);
    } else if (tmpView instanceof RelativeLayout) {
        RelativeLayout.LayoutParams relativeLayoutParams = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(relativeLayoutParams);
    }
    containerLayout.removeAllViews();
    containerLayout.addView(tmpView);
}

}
</code></pre>

<p>å¯¹åº”çš„å¸ƒå±€æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="@android:color/transparent"
    tools:context="com.suguiming.myandroid.base.BaseSwipeActivity"&gt;

&lt;android.support.v4.widget.DrawerLayout
    android:id="@+id/base_drawer_layout"
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/transparent"
    tools:openDrawer="end"&gt;
    &lt;LinearLayout
        android:orientation="vertical"
        android:background="@color/clear"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;
    &lt;/LinearLayout&gt;

    &lt;!---64dpæ˜¯æºç menuçš„margin,è¿™é‡Œè®¾ç½®ä¸º65,ä¸ç„¶ä¼šæœ‰ä¸€æ¡é»‘çº¿--&gt;
    &lt;LinearLayout
        android:id="@+id/container_layout"
        android:orientation="vertical"
        android:layout_gravity="end"
        android:layout_marginLeft="-65dp"
        android:background="@color/light_gray"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;
    &lt;/LinearLayout&gt;
&lt;/android.support.v4.widget.DrawerLayout&gt;
&lt;/LinearLayout&gt;
</code></pre>

<p>push çš„åŠ¨ç”» style</p>

<pre><code>&lt;!--æ‰‹åŠ¿è¿”å›theme--&gt;
&lt;style name="BackSwipeTheme" parent="Theme.AppCompat.Light.NoActionBar"&gt;
    &lt;item name="android:windowIsTranslucent"&gt;true&lt;/item&gt;
    &lt;item name="android:windowBackground"&gt;@android:color/transparent&lt;/item&gt;
    &lt;item name="android:windowNoTitle"&gt;true&lt;/item&gt;
    &lt;item name="android:backgroundDimEnabled"&gt;false&lt;/item&gt;
    &lt;item name="android:windowAnimationStyle"&gt;@style/ActivitySwipeBackAnimation&lt;/item&gt;
&lt;/style&gt;
&lt;style name="ActivitySwipeBackAnimation" parent="@android:style/Animation.Activity"&gt;
    &lt;item name="android:activityOpenEnterAnimation"&gt;@anim/activity_swipe_in&lt;/item&gt;
    &lt;item name="android:activityOpenExitAnimation"&gt;@anim/activity_swipe_out&lt;/item&gt;
    &lt;item name="android:activityCloseEnterAnimation"&gt;@anim/activity_swipe_in&lt;/item&gt;
    &lt;item name="android:activityCloseExitAnimation"&gt;@anim/activity_swipe_out&lt;/item&gt;
&lt;/style&gt;
</code></pre>

<p>ä½¿ç”¨çš„è¯å°±æ˜¯è®©Activityç»§æ‰¿BaseSwipeActivityï¼Œç„¶åè®¾ç½®Activityçš„Themeä¸ºBackSwipeThemeã€‚</p>

<pre><code>public class ActivitySwipeBack extends BaseSwipeActivity {
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    //è¦ç”¨setMainViewï¼Œä¸è¦ç”¨setContentView
    setMainView(R.layout.activity_activity_swipe_back);
  }
}

&lt;activity android:name=".tab0.ActivitySwipeBack"
            android:theme="@style/BackSwipeTheme"/&gt;
</code></pre>

<p>å®Œæ•´Demoè¯·æŸ¥çœ‹<a href="https://github.com/AndyFightting/MyAndroid">MyAndroid</a>ä¸­çš„"æ‰‹åŠ¿æ»‘åŠ¨è¿”å›"ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/android_swipe.png" alt="imge" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swifté˜…è¯»ç¬”è®°]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/04/swift-read/"/>
    <updated>2016-08-04T16:23:05+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/04/swift-read</id>
    <content type="html"><![CDATA[<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>let å£°æ˜å¸¸é‡ï¼Œvar å£°æ˜å˜é‡ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹æ¨æ–­(å°æ•°æ¨æ–­ä¸ºDouble),ä¸€è¡Œæœ«å°¾å¯ä¸åŠ åˆ†å·(;)ã€‚
</span><span class='line'>å€¼æ°¸è¿œä¸ä¼šè¢«éšå¼è½¬æ¢ä¸ºå…¶ä»–ç±»å‹ï¼ŒåŠ¡å¿…æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢ã€‚
</span><span class='line'>ifè¯­å¥çš„æ¡ä»¶ä¸èƒ½é»˜è®¤é0ä¸ºçœŸã€‚ ç±»å‹ååŠ ?å·è¡¨ç¤ºå¯é€‰å€¼ï¼Œè¦ä¹ˆæœ‰å€¼ï¼Œè¦ä¹ˆæ˜¯nilã€‚
</span><span class='line'>ç”¨ if let(æˆ–è€…var) name = optionName æ¥è·å–å¯é€‰å€¼å¤„ç†ã€‚ 
</span><span class='line'>switchçš„caseä¸­è‡ªå¸¦breakï¼Œswitchè¦ä¿è¯å…¨éƒ¨éå†ï¼Œå¦åˆ™å¿…é¡»è¦æœ‰defaulté€‰é¡¹ã€‚
</span><span class='line'>0&lt; x &lt;4 ç­‰ä»· 0..&lt;4 , 0&lt; x &lt;=4 ç­‰ä»· 0...4 ã€‚ 
</span><span class='line'>ç”¨ func å£°æ˜å‡½æ•°ï¼Œç”¨-&gt;æŒ‡å®šè¿”å›ç±»å‹func greet(name: String, day: String) -&gt; String { ... }ã€‚ 
</span><span class='line'>å…ƒç»„æ¦‚å¿µï¼Œä¸€èˆ¬ç”¨åšå‡½æ•°è¿”å›å€¼ã€‚ 
</span><span class='line'>func sumOf(numbers: Int...) -&gt; Int {}ï¼Œ...è¡¨ç¤ºå¯å˜ä¸ªæ•°çš„å‚æ•°ã€‚ 
</span><span class='line'>å‡½æ•°æ˜¯ä¸€ç­‰ç±»å‹ï¼Œåƒint floatä¸€æ ·ï¼Œå¯ç”¨ä½œå‚æ•°æˆ–è€…è¿”å›å€¼ã€‚ 
</span><span class='line'>class å£°æ˜ç±»,å±æ€§éƒ½è¦èµ‹å€¼ï¼Œè¦ä¹ˆåœ¨å£°æ˜ç›´æ¥å†™æ­»ï¼Œè¦ä¹ˆåœ¨initæ–¹æ³•ä¸­èµ‹å€¼ã€‚ 
</span><span class='line'>é‡å†™çˆ¶ç±»æ–¹æ³•å¿…é¡»ç”¨ override æ ‡è®°ã€‚ å±æ€§å¯ä»¥æœ‰get set willGet didSet ç­‰æ–¹æ³•ã€‚ 
</span><span class='line'>mutatingå…³é”®å­—ç”¨æ¥æ ‡è®°ä¸€ä¸ªä¼šä¿®æ”¹ç»“æ„ä½“(å±æ€§)çš„æ–¹æ³•ã€‚ 
</span><span class='line'>extensionæ¥ä¸ºç°æœ‰çš„ç±»å‹æ·»åŠ åŠŸèƒ½ï¼Œæ¯”å¦‚æ–°çš„æ–¹æ³•å’Œè®¡ç®—å±æ€§ã€‚
</span><span class='line'>æ³›å‹(æŒ‡å®šç±»å‹)å°±æ˜¯javaä¸­çš„æ³›å‹ã€‚ Boolå€¼æ˜¯trueæˆ–falseã€‚ 
</span><span class='line'>typealies name = ç±»å‹ ç»™ç±»å‹èµ·ä¸ªåˆ«åã€‚ 
</span><span class='line'>OCä¸­çš„nilåªç”¨åœ¨å¯¹è±¡ä¸Š(intä¸è¡Œ)ï¼ŒSwiftä¸­nilå¯æŒ‡ä»»ä½•ä¸œè¥¿(å¯¹è±¡æˆ–int)ã€‚
</span><span class='line'>ä½¿ç”¨!æ¥è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å¯é€‰å€¼ä¼šå¯¼è‡´é”™è¯¯ã€‚éšå¼è§£æå¯é€‰ç±»å‹(ç±»å‹!)å°±æ˜¯å¯é€‰ç±»å‹ï¼Œä½†æ˜¯å¯ä»¥å½“åšéå¯é€‰ç±»å‹æ¥ä½¿ç”¨(ä¸ç”¨!è§£æ,æ²¡å€¼æ—¶ä¼šæŠ¥é”™)ã€‚ 
</span><span class='line'>throws do try catch çš„ä½¿ç”¨ã€‚Swiftçš„èµ‹å€¼æ“ä½œä¸è¿”å›ä»»ä½•å€¼ã€‚% æµ®ç‚¹æ•°ä¹Ÿå¯ä»¥å–ä½™è¿ç®—ã€‚ 
</span><span class='line'>ç©ºåˆè¿ç®—ç¬¦(a ?? b)å¯¹å¯é€‰ç±»å‹aè¿›è¡Œç©ºåˆ¤æ–­ï¼Œå¦‚æœaåŒ…å«ä¸€ä¸ªå€¼å°±è¿›è¡Œè§£å°ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªé»˜è®¤å€¼b(bå’Œaè¦ç±»å‹ç›¸åŒ)ã€‚é€»è¾‘ &&ï¼Œ|| éƒ½æ˜¯çŸ­è·¯è®¡ç®—çš„ã€‚
</span><span class='line'>æ¡ä»¶ä¸­çš„ä¸‹åˆ’çº¿ _ æ¥å¿½ç•¥å¯¹å€¼çš„è®¿é—®ï¼Œcase ä¸­çš„ä¸‹åˆ’çº¿ _ è¡¨ç¤ºæ‰€æœ‰å¯èƒ½çš„å€¼,caseä¸­å¯è¿›è¡Œå€¼ç»‘å®šï¼Œcaseæ¡ä»¶å¯ç”¨whereè¯­å¥ã€‚ 
</span><span class='line'>å­—å…¸çš„éå†é¡ºåºå’Œæ’å…¥é¡ºåºå¯èƒ½ä¸åŒ(å­—å…¸æ— åºçš„)ã€‚ 
</span><span class='line'>Swiftè¯­è¨€çš„repeat-whileå¾ªç¯åˆå…¶ä»–è¯­è¨€ä¸­çš„do-whileå¾ªç¯æ˜¯ç±»ä¼¼çš„ã€‚
</span><span class='line'>æ³¨æ„å¾ªç¯ä¸­switchä¸­çš„continue(å¼€å§‹ä¸‹æ¬¡)å’Œbreak(è·³åˆ°switch}åé¢ç»§ç»­æ‰§è¡Œ)çš„å·®åˆ«ï¼Œswitchä¸­çš„fallthrouthè¿›å…¥ä¸‹ä¸€ä¸ªcaseæ—¶ä¸ä¼šå†è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚
</span><span class='line'>guard(å®ˆå«)è¯­å¥æ€»æ˜¯æœ‰ä¸€ä¸ªelseåˆ†å¥ã€‚ 
</span><span class='line'>è°ƒç”¨å‡½æ•°æ—¶ç¬¬ä¸€ä¸ªå‚æ•°åä¸è¦ï¼Œä¹‹åçš„å‚æ•°åè¦ï¼Œç”¨é€—å·åˆ†å¼€(ç¬¬ä¸€ä¸ªå‚æ•°çœç•¥å…¶å¤–éƒ¨å‚æ•°åï¼Œç¬¬äºŒä¸ªä»¥åçš„å‚æ•°ä½¿ç”¨å…¶æœ¬åœ°å‚æ•°åä½œä¸ºè‡ªå·±çš„å¤–éƒ¨å‚æ•°åã€‚
</span><span class='line'>æ‰€æœ‰å‚æ•°éœ€è¦æœ‰ä¸åŒçš„æœ¬åœ°å‚æ•°åï¼Œä½†å¯ä»¥å…±äº«ç›¸åŒçš„å¤–éƒ¨å‚æ•°åã€‚å¦‚æœä½ æä¾›äº†å¤–éƒ¨å‚æ•°åï¼Œé‚£ä¹ˆå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å¤–éƒ¨å‚æ•°åã€‚å¦‚æœä½ ä¸æƒ³ä¸ºç¬¬äºŒä¸ªåŠåç»­çš„å‚æ•°è®¾ç½®å‚æ•°åï¼Œç”¨ä¸‹åˆ’çº¿_ä»£æ›¿)ã€‚
</span><span class='line'>ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å‚æ•°(...),å¦‚æœå‡½æ•°åŒæ—¶æœ‰é»˜è®¤å‚æ•°å’Œå¯å˜å‚æ•°è¦æŠŠå¯å˜å‚æ•°æ”¾æœ€åã€‚ 
</span><span class='line'>å‡½æ•°å‚æ•°é»˜è®¤æ˜¯å¸¸é‡ï¼Œä¿®æ”¹ä¼šæŠ¥é”™ï¼Œä½†å¯ä»¥ç”¨varå£°æ˜ä¸ºå˜é‡,ä¿®æ”¹åªåœ¨å‡½æ•°ä½“å†…æœ‰æ•ˆã€‚ 
</span><span class='line'>inoutå‚æ•°(åªèƒ½ä¼ å…¥å˜é‡)ä¼šæ›¿æ¢åŸæ¥çš„å€¼ï¼Œä½¿ç”¨æ—¶åœ¨å˜é‡åå‰åŠ &ç¬¦å·ã€‚ 
</span><span class='line'>åŸæ•°ç»„ä¸ä¼šè¢«sort()æ–¹æ³•ä¿®æ”¹ã€‚ é—­åŒ…å°±æ˜¯ç”¨{}åŒ…èµ·æ¥çš„å‡½æ•°ä»£ç å—ï¼Œç”¨inåˆ†å¼€è¿”å›å€¼å’Œå¤„ç†ä»£ç ï¼Œå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚å¦‚æœéœ€è¦å°†é—­åŒ…ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå¯å˜æˆå°¾éšé—­åŒ…ã€‚
</span><span class='line'>Arrayçš„mapæ–¹æ³•å¯è¿”å›ä¸åŒç±»å‹ã€‚ å‡½æ•°å’Œé—­åŒ…éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚
</span><span class='line'>ç»“æ„ä½“å’Œæšä¸¾æ˜¯å€¼ç±»å‹ï¼Œæ‰€æœ‰çš„åŸºæœ¬ç±»å‹éƒ½æ˜¯å€¼ç±»å‹ï¼Œå¹¶ä¸”éƒ½æ˜¯ä»¥ç»“æ„ä½“çš„å½¢å¼åœ¨åå°æ‰€å®ç°ã€‚
</span><span class='line'>ç±»æ˜¯å¼•ç”¨ç±»å‹ã€‚å¸¸é‡å®ä¾‹ä¾ç„¶å¯æ”¹å˜å…¶ä¸­çš„å˜é‡å±æ€§å€¼ã€‚
</span><span class='line'>swiftæŒ‡é’ˆå¹¶ä¸ç›´æ¥æŒ‡å‘å†…å­˜ä¸­çš„æŸä¸ªåœ°å€ï¼Œè€Œä¸”ä¹Ÿä¸è¦æ±‚ä½ ä½¿ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰æ¥è¡¨æ˜ä½ åœ¨åˆ›å»ºä¸€ä¸ªå¼•ç”¨ã€‚
</span><span class='line'>ç»“æ„ä½“å®ä¾‹æ€»æ˜¯é€šè¿‡å€¼ä¼ é€’ï¼Œç±»å®ä¾‹æ€»æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’ã€‚
</span><span class='line'>Swift ä¸­å­—ç¬¦ä¸²ï¼ˆStringï¼‰,æ•°ç»„ï¼ˆArrayï¼‰å’Œå­—å…¸ï¼ˆDictionaryï¼‰å‡ä»¥ç»“æ„ä½“çš„å½¢å¼å®ç°çš„å€¼ç±»å‹,è€Œåœ¨OCä¸­æ˜¯ä»¥ç±»çš„å½¢å¼å®ç°çš„å¼•ç”¨ç±»å‹ã€‚
</span><span class='line'>è®¡ç®—å±æ€§å¯ä»¥ç”¨äºç±»ã€ç»“æ„ä½“å’Œæšä¸¾ï¼Œå­˜å‚¨å±æ€§åªèƒ½ç”¨äºç±»å’Œç»“æ„ä½“ã€‚
</span><span class='line'>å¦‚æœåˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹å¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡ï¼Œåˆ™æ— æ³•ä¿®æ”¹è¯¥å®ä¾‹çš„ä»»ä½•å±æ€§ï¼Œå³ä½¿å®šä¹‰äº†å˜é‡å­˜å‚¨å±æ€§ï¼Œç”±äºç»“æ„ä½“ï¼ˆstructï¼‰å±äºå€¼ç±»å‹ï¼Œå½“å€¼ç±»å‹çš„å®ä¾‹è¢«å£°æ˜ä¸ºå¸¸é‡çš„æ—¶å€™ï¼Œå®ƒçš„æ‰€æœ‰å±æ€§ä¹Ÿå°±æˆäº†å¸¸é‡ã€‚
</span><span class='line'>å¿…é¡»å°†å»¶è¿Ÿå­˜å‚¨å±æ€§å£°æ˜æˆå˜é‡ï¼ˆä½¿ç”¨varå…³é”®å­—ï¼‰ï¼Œå› ä¸ºå±æ€§çš„åˆå§‹å€¼å¯èƒ½åœ¨å®ä¾‹æ„é€ å®Œæˆä¹‹åæ‰ä¼šå¾—åˆ°ã€‚
</span><span class='line'>è€Œå¸¸é‡å±æ€§åœ¨æ„é€ è¿‡ç¨‹å®Œæˆä¹‹å‰å¿…é¡»è¦æœ‰åˆå§‹å€¼ï¼Œå› æ­¤æ— æ³•å£°æ˜æˆå»¶è¿Ÿå±æ€§ã€‚
</span><span class='line'>è®¡ç®—å±æ€§ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ª getå’Œä¸€ä¸ªå¯é€‰çš„setï¼Œæ¥é—´æ¥è·å–å’Œè®¾ç½®å…¶ä»–å±æ€§æˆ–å˜é‡çš„å€¼ã€‚
</span><span class='line'>å¿…é¡»ä½¿ç”¨varå…³é”®å­—å®šä¹‰è®¡ç®—å±æ€§ï¼ŒåŒ…æ‹¬åªè¯»è®¡ç®—å±æ€§ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ä¸æ˜¯å›ºå®šçš„ã€‚
</span><span class='line'>çˆ¶ç±»çš„å±æ€§åœ¨å­ç±»çš„æ„é€ å™¨ä¸­è¢«èµ‹å€¼æ—¶ï¼Œå®ƒåœ¨çˆ¶ç±»ä¸­çš„willSetå’ŒdidSetè§‚å¯Ÿå™¨ä¼šè¢«è°ƒç”¨ã€‚
</span><span class='line'>å…¨å±€çš„å¸¸é‡æˆ–å˜é‡éƒ½æ˜¯å»¶è¿Ÿè®¡ç®—çš„ï¼Œè·Ÿå»¶è¿Ÿå­˜å‚¨å±æ€§ç›¸ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå…¨å±€çš„å¸¸é‡æˆ–å˜é‡ä¸éœ€è¦æ ‡è®°lazyç‰¹æ€§ã€‚å±€éƒ¨èŒƒå›´çš„å¸¸é‡æˆ–å˜é‡ä¸ä¼šå»¶è¿Ÿè®¡ç®—ã€‚
</span><span class='line'>å¿…é¡»ç»™å­˜å‚¨ç±»å‹çš„ç±»å±æ€§æŒ‡å®šé»˜è®¤å€¼ï¼Œå› ä¸ºç±»å‹æœ¬èº«æ— æ³•åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨æ„é€ å™¨ç»™ç±»å‹å±æ€§èµ‹å€¼ã€‚
</span><span class='line'>ç»“æ„ä½“å’Œæšä¸¾èƒ½å¤Ÿå®šä¹‰æ–¹æ³•æ˜¯ Swift ä¸ C/Objective-C çš„ä¸»è¦åŒºåˆ«ä¹‹ä¸€ã€‚</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„åŠ¨ç”»]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/04/animation/"/>
    <updated>2016-08-04T16:22:41+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/04/animation</id>
    <content type="html"><![CDATA[<p>åŠ¨ç”»æ˜¯ä½œç”¨çš„UIViewçš„CALayerä¸Šçš„ï¼ŒUIViewæ˜¯CALayerçš„ä»£ç†ï¼Œç»™CALayeræä¾›æ•°æ®å‚æ•°ï¼ŒCALayerè´Ÿè´£æ¸²æŸ“å’ŒåŠ¨ç”»ã€‚UIViewæ˜¯åœ¨UIKitæ¡†æ¶ä¸­ï¼Œè€ŒCALayeræ˜¯åœ¨QuartzCoreæ¡†æ¶ä¸­ã€‚UIViewå¯ä»¥å“åº”ç”¨æˆ·äº‹ä»¶ï¼Œè€ŒCALayerä¸å¯ä»¥å“åº”ç”¨æˆ·äº‹ä»¶ã€‚CALayerä¹Ÿå¯ä»¥åƒUIViewä¸€æ ·æ·»åŠ å­Layerã€‚
<img src="http://andyfightting.github.io/myimg/ios/calayer.png" alt="image" /></p>

<h4>CALayerå¸¸ç”¨å±æ€§</h4>

<pre><code>anchorPoint å’Œä¸­å¿ƒç‚¹positioné‡åˆçš„ä¸€ä¸ªç‚¹ï¼Œç§°ä¸ºâ€œé”šç‚¹â€ï¼Œé”šç‚¹çš„æè¿°æ˜¯ç›¸å¯¹äºxã€yä½ç½®æ¯”ä¾‹è€Œè¨€çš„é»˜è®¤åœ¨å›¾åƒä¸­å¿ƒç‚¹(0.5,0.5)çš„ä½ç½®
backgroundColor å›¾å±‚èƒŒæ™¯é¢œè‰²  
borderColor è¾¹æ¡†é¢œè‰²    
borderWidth è¾¹æ¡†å®½åº¦    
bounds  å›¾å±‚å¤§å°    
contents    å›¾å±‚æ˜¾ç¤ºå†…å®¹ï¼Œä¾‹å¦‚å¯ä»¥å°†å›¾ç‰‡ä½œä¸ºå›¾å±‚å†…å®¹æ˜¾ç¤º
contentsRect    å›¾å±‚æ˜¾ç¤ºå†…å®¹çš„å¤§å°å’Œä½ç½®    
cornerRadius    åœ†è§’åŠå¾„    
doubleSided å›¾å±‚èƒŒé¢æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤ä¸ºYES 
frame   å›¾å±‚å¤§å°å’Œä½ç½®ï¼Œä¸æ”¯æŒéšå¼åŠ¨ç”»ï¼Œæ‰€ä»¥CALayerä¸­å¾ˆå°‘ä½¿ç”¨frameï¼Œé€šå¸¸ä½¿ç”¨boundså’Œpositionä»£æ›¿
hidden  æ˜¯å¦éšè—    
mask    å›¾å±‚è’™ç‰ˆ    
maskToBounds    å­å›¾å±‚æ˜¯å¦å‰ªåˆ‡å›¾å±‚è¾¹ç•Œï¼Œé»˜è®¤ä¸ºNO 
opacity é€æ˜åº¦ ï¼Œç±»ä¼¼äºUIViewçš„alpha    
position    å›¾å±‚ä¸­å¿ƒç‚¹ä½ç½®ï¼Œç±»ä¼¼äºUIViewçš„center
shadowColor é˜´å½±é¢œè‰²    
shadowOffset    é˜´å½±åç§»é‡ 
shadowOpacity   é˜´å½±é€æ˜åº¦ï¼Œæ³¨æ„é»˜è®¤ä¸º0ï¼Œå¦‚æœè®¾ç½®é˜´å½±å¿…é¡»è®¾ç½®æ­¤å±æ€§
shadowPath  é˜´å½±çš„å½¢çŠ¶ 
shadowRadius    é˜´å½±æ¨¡ç³ŠåŠå¾„  
sublayers   å­å›¾å±‚   
sublayerTransform   å­å›¾å±‚å½¢å˜ 
transform   å›¾å±‚å½¢å˜
</code></pre>

<p>è¦æ³¨æ„positionå’ŒanchorPointçš„åŒºåˆ«ï¼š<strong>positionæ˜¯layerä¸­çš„anchorPointç‚¹åœ¨superLayerä¸­çš„ä½ç½®åæ ‡ï¼positionç‚¹æ˜¯ç›¸å¯¹suerLayerçš„ï¼ŒanchorPointç‚¹æ˜¯ç›¸å¯¹è‡ªèº«layerçš„ï¼</strong> æ‰€ä»¥è¯´positionä¸å˜ï¼Œä½†anchorPointæ”¹å˜çš„è¯ï¼Œä¹Ÿä¼šæ”¹å˜layeråœ¨superLayerä¸­çš„ä½ç½®ï¼</p>

<pre><code>layer=[[CALayer alloc]init];
layer.backgroundColor=[UIColor purpleColor].CGColor;
layer.bounds=CGRectMake(0, 0, 100,100);
layer.shadowColor=[UIColor redColor].CGColor;
layer.shadowOffset=CGSizeMake(5, 5);
layer.shadowOpacity=0.7;
layer.borderColor=[UIColor yellowColor].CGColor;
layer.borderWidth=3;
layer.position=CGPointMake(size.width/2, size.height/2);
[self.view.layer addSublayer:layer];

//layer.anchorPoint=CGPointMake(0, 0); //å›¾ä¸€
//layer.anchorPoint=CGPointMake(0, 1); //å›¾äºŒ
</code></pre>

<p>å›¾ä¸­positionä¸€æ ·ï¼Œä½†anchorPointä¸ä¸€æ ·ï¼Œæ‰€ä»¥å›¾ç‰‡ä½ç½®ä¹Ÿä¸ä¸€æ ·ã€‚  <br/>
<img src="http://andyfightting.github.io/myimg/ios/layer_position.png" alt="image" />
æ³¨æ„å¦‚æœè¦è®¾ç½®åœ†è§’ï¼Œå¯¹äºå›¾å±‚æœ¬èº«è€Œè¨€å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼Œä½†æ˜¯å¯¹äºå›¾å±‚ä¸­ç»˜åˆ¶çš„å›¾ç‰‡æ— æ³•æ­£ç¡®æ˜¾ç¤ºã€‚å¦‚æœæƒ³è¦å›¾ç‰‡æ­£ç¡®æ˜¾ç¤ºåˆ™å¿…é¡»è®¾ç½®masksToBounds=YESï¼Œå‰ªåˆ‡å­å›¾å±‚ã€‚ä½†è®¾ç½®layer.masksToBounds=YESåï¼Œå›¾å±‚çš„å½±æ•ˆæœæ— æ³•å’ŒmasksToBounds=YESåŒæ—¶ä½¿ç”¨ï¼Œå› ä¸ºmasksToBoundsçš„ç›®çš„å°±æ˜¯å‰ªåˆ‡å¤–è¾¹æ¡†ã€‚å¦‚æœåŒæ—¶è¦é˜´å½±åˆè¦åœ†è§’çš„è¯ï¼Œå°±ç”¨ä¸¤ä¸ªé‡å çš„å›¾å±‚,åº•éƒ¨è´Ÿè´£ç»˜åˆ¶é˜´å½±ï¼Œä¸Šå±‚è´Ÿè´£ç»˜åˆ¶åœ†è§’ã€‚</p>

<h4>Core Animation</h4>

<p>iOSçš„æ ¸å¿ƒåŠ¨ç”»Core AnimationåŒ…å«åœ¨Quartz Coreæ¡†æ¶ä¸­ã€‚æ ¸å¿ƒåŠ¨ç”»åˆ†ä¸ºå‡ ç±»ï¼šåŸºç¡€åŠ¨ç”»ã€å…³é”®å¸§åŠ¨ç”»ã€åŠ¨ç”»ç»„ã€è½¬åœºåŠ¨ç”»,å„ä¸ªç±»çš„å…³ç³»å¤§è‡´å¦‚ä¸‹ï¼š
<img src="http://andyfightting.github.io/myimg/ios/core_animation.png" alt="image" />
*CAAnimationï¼šæ ¸å¿ƒåŠ¨ç”»çš„åŸºç¡€ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè´Ÿè´£åŠ¨ç”»è¿è¡Œæ—¶é—´ã€é€Ÿåº¦çš„æ§åˆ¶ï¼Œæœ¬èº«å®ç°äº†CAMediaTimingåè®®ã€‚</p>

<p>*CAPropertyAnimationï¼šå±æ€§åŠ¨ç”»çš„åŸºç±»ï¼Œé€šè¿‡å±æ€§è¿›è¡ŒåŠ¨ç”»è®¾ç½®ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚</p>

<p>*CAAnimationGroupï¼šåŠ¨ç”»ç»„åˆæ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡åŠ¨ç”»ç»„æ¥è¿›è¡Œæ‰€æœ‰åŠ¨ç”»è¡Œä¸ºçš„ç»Ÿä¸€æ§åˆ¶ï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»æ•ˆæœå¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</p>

<p>*CATransitionï¼šè½¬åœºåŠ¨ç”»ï¼Œä¸»è¦é€šè¿‡æ»¤é•œè¿›è¡ŒåŠ¨ç”»æ•ˆæœè®¾ç½®ã€‚</p>

<p>*CABasicAnimationï¼šåŸºç¡€åŠ¨ç”»ï¼Œé€šè¿‡å±æ€§ä¿®æ”¹è¿›è¡ŒåŠ¨ç”»å‚æ•°æ§åˆ¶ï¼Œåªæœ‰åˆå§‹çŠ¶æ€å’Œç»“æŸçŠ¶æ€ã€‚</p>

<p>*CAKeyframeAnimationï¼šå…³é”®å¸§åŠ¨ç”»ï¼ŒåŒæ ·æ˜¯é€šè¿‡å±æ€§è¿›è¡ŒåŠ¨ç”»å‚æ•°æ§åˆ¶ï¼Œä½†æ˜¯åŒåŸºç¡€åŠ¨ç”»ä¸åŒçš„æ˜¯å®ƒå¯ä»¥æœ‰å¤šä¸ªçŠ¶æ€æ§åˆ¶ã€‚</p>

<p>åŸºç¡€åŠ¨ç”»ã€å…³é”®å¸§åŠ¨ç”»éƒ½å±äºå±æ€§åŠ¨ç”»ï¼Œå°±æ˜¯é€šè¿‡ä¿®æ”¹å±æ€§å€¼äº§ç”ŸåŠ¨ç”»æ•ˆæœï¼Œåªéœ€è¦è®¾ç½®åˆå§‹å€¼å’Œç»“æŸå€¼ï¼Œä¸­é—´çš„è¿‡ç¨‹åŠ¨ç”»ç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—äº§ç”Ÿã€‚å’ŒåŸºç¡€åŠ¨ç”»ä¸åŒçš„æ˜¯å…³é”®å¸§åŠ¨ç”»å¯ä»¥è®¾ç½®å¤šä¸ªå±æ€§å€¼ï¼Œæ¯ä¸¤ä¸ªå±æ€§ä¸­é—´çš„è¿‡æ¸¡åŠ¨ç”»ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„Core Data]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/04/core-data/"/>
    <updated>2016-08-04T16:22:22+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/04/core-data</id>
    <content type="html"><![CDATA[<p><a href="https://developer.apple.com/library/watchos/documentation/Cocoa/Conceptual/CoreData/index.html">Core Data</a>æ˜¯ä¸€ä¸ªå¯¹sqliteæ•°æ®åº“è¿›è¡Œå°è£…çš„ORM(Object Relation Mapping)æ¡†æ¶ã€‚å®ƒä¸»è¦ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š</p>

<h4><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObject_Class/">NSManagedObject</a></h4>

<p>NSManagedObject is a generic class that implements all the basic behavior required of a Core Data model object. It is not possible to use instances of direct subclasses of NSObject (or any other class not inheriting from NSManagedObject) with a managed object context. You may create custom subclasses of NSManagedObject, although this is not always required. If no custom logic is needed, a complete object graph can be formed with NSManagedObject instances.</p>

<h4><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObjectModel_Class/">NSManagedObjectModel</a></h4>

<p>An NSManagedObjectModel object describes a schema, a collection of entities (data models) that you use in your application.</p>

<h4><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObjectContext_Class/">NSManagedObjectContext</a></h4>

<p>An instance of NSManagedObjectContext represents a single â€œobject spaceâ€ or scratch pad in an application. Its primary responsibility is to manage a collection of managed objects. These objects form a group of related model objects that represent an internally consistent view of one or more persistent stores. A single managed object instance exists in one and only one context, but multiple copies of an object can exist in different contexts. Thus object uniquing is scoped to a particular context.</p>

<h4><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSPersistentStoreCoordinator_Class/">NSPersistentStoreCoordinator</a></h4>

<p>Instances of NSPersistentStoreCoordinator associate persistent stores (by type) with a model (or more accurately, a configuration of a model) and serve to mediate between the persistent store or stores and the managed object context or contexts. Instances of NSManagedObjectContext use a coordinator to save object graphs to persistent storage and to retrieve model information. A context without a coordinator is not fully functional as it cannot access a model except through a coordinator. The coordinator is designed to present a faÃ§ade to the managed object contexts such that a group of persistent stores appears as an aggregate store. A managed object context can then create an object graph based on the union of all the data stores the coordinator covers.</p>

<h4><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSFetchRequest_Class/index.html#//apple_ref/occ/cl/NSFetchRequest">NSFetchRequest</a></h4>

<p>An instance of NSFetchRequest describes search criteria used to retrieve data from a persistent store.</p>

<h4><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSPredicate_Class/">NSPredicate</a></h4>

<p>The NSPredicate class is used to define logical conditions used to constrain a search either for a fetch or for in-memory filtering.</p>

<p><img src="http://andyfightting.github.io/myimg/ios/cd_orm.png" alt="image" />
<img src="http://andyfightting.github.io/myimg/ios/cd_table.png" alt="image" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„NSURLSession]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/04/session/"/>
    <updated>2016-08-04T16:22:02+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/04/session</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„block]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/04/block/"/>
    <updated>2016-08-04T16:21:41+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/04/block</id>
    <content type="html"><![CDATA[<p>blockå°±æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œé—­åŒ…ï¼Œä¼šæ•è·ä¸Šä¸‹æ–‡çš„åŒ¿åå‡½æ•°ï¼Œå®ƒå¯ä»¥ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›å€¼è¿›è¡Œä¼ é€’ã€‚åœ¨objcä¸­ï¼Œæ ¹æ®å¯¹è±¡çš„å®šä¹‰ï¼Œå‡¡æ˜¯é¦–åœ°å€æ˜¯*isaçš„ç»“æ„ä½“æŒ‡é’ˆï¼Œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯å¯¹è±¡(id)ï¼Œæ‰€ä»¥blockå®é™…ä¸Šå°±ç®—æ˜¯å¯¹è±¡ï¼Œä½†å®ƒçš„å†…å­˜ç®¡ç†åˆå’ŒNSObjectæœ‰ç‚¹ä¸ä¸€æ ·ã€‚</p>

<h4>å£°æ˜:</h4>

<pre><code>*å˜é‡ï¼šreturnType (^blockName)(parameterTypes) = ^returnType(parameters) {...};

*å±æ€§ï¼š@property (nonatomic, copy) returnType (^blockName)(parameterTypes);

*æ–¹æ³•ï¼š-(void)someMethod:(returnType (^nullability)(parameterTypes))blockName;

*å›è°ƒï¼š[object  method:^returnType (parameters) {...}];

*å®šä¹‰ï¼štypedef returnType (^TypeName)(parameterTypes); --&gt; TypeName blockName = ^returnType(parameters) {...};
</code></pre>

<p>blockä¸­çš„isaæŒ‡å‘çš„æ˜¯è¯¥blockçš„Class,ä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼š</p>

<pre><code>_NSConcreteGlobalBlock å…¨å±€çš„é™æ€ blockï¼Œä¸ä¼šè®¿é—®ä»»ä½•å¤–éƒ¨å˜é‡ã€‚
_NSConcreteStackBlock ä¿å­˜åœ¨æ ˆä¸­çš„ blockï¼Œå½“å‡½æ•°è¿”å›æ—¶ä¼šè¢«é”€æ¯ã€‚
_NSConcreteMallocBlock ä¿å­˜åœ¨å †ä¸­çš„ blockï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ä¼šè¢«é”€æ¯ã€‚
</code></pre>

<p>å½“blockç¬¬ä¸€æ¬¡è¢«åˆ›å»ºæ—¶ï¼Œå®ƒæ˜¯å­˜åœ¨äºè¯¥å‡½æ•°çš„æ ˆä¸Šçš„ï¼Œå…¶Classæ˜¯å›ºå®šçš„NSConcreteStackBlockã€‚å…¶æ•è·çš„å˜é‡æ˜¯ä¼šèµ‹å€¼åˆ°ç»“æ„ä½“çš„æˆå‘˜ä¸Šï¼Œæ‰€ä»¥å½“blockåˆå§‹åŒ–å®Œæˆåï¼Œæ•è·åˆ°çš„å˜é‡ä¸èƒ½æ›´æ”¹ã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œå‡½æ•°çš„æ ˆè¢«é”€æ¯ï¼Œè¿™ä¸ªblockçš„å†…å­˜ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚æ‰€ä»¥åœ¨å‡½æ•°ç»“æŸåä»ç„¶éœ€è¦è¿™ä¸ªblockæ—¶ï¼Œå°±å¿…é¡»ç”¨Block_copy()æ–¹æ³•å°†å®ƒæ‹·è´åˆ°å †ä¸Šï¼Œç±»å‹å˜ä¸ºNSConcreteMallocBlockï¼Œå‘å®ƒå‘é€retainï¼Œå¢åŠ blockçš„å¼•ç”¨è®¡æ•°ã€‚</p>

<p>é»˜è®¤blockæ•è·åˆ°çš„å±€éƒ¨å˜é‡ï¼Œéƒ½æ˜¯èµ‹å€¼ç»™blockçš„ç»“æ„ä½“çš„ï¼Œç›¸å½“äºconstä¸å¯æ”¹ã€‚ä¸ºäº†è®©blockèƒ½è®¿é—®å¹¶ä¿®æ”¹å¤–é¢çš„å±€éƒ¨å˜é‡ï¼Œéœ€è¦åŠ ä¸Š__blockä¿®é¥°è¯ã€‚</p>

<pre><code>void test(){
 __block int i = 3;
  void(^myBlock)(void) = ^{
     i = 5;//å±€éƒ¨å˜é‡æ²¡æœ‰__blockä¿®é¥°çš„è¯ä¸å¯ä¿®æ”¹
  };
 myBlock();
}
</code></pre>

<h4>æ•è·è§„åˆ™ï¼š</h4>

<pre><code>1.é™æ€å­˜å‚¨åŒºçš„å˜é‡,ä¾‹å¦‚å…¨å±€å˜é‡ã€æ–¹æ³•ä¸­çš„staticå˜é‡:
  å¼•ç”¨ï¼Œå¯ä¿®æ”¹ã€‚

2.blockæ¥å—çš„å‚æ•°ä¼ å€¼:
  å¯ä¿®æ”¹ï¼Œå’Œä¸€èˆ¬å‡½æ•°çš„å‚æ•°ç›¸åŒã€‚

3.æ ˆå˜é‡(å±€éƒ¨å˜é‡):
  å¸¸é‡ï¼Œä¸å¯ä¿®æ”¹ï¼Œblockä¼šå¯¹idç±»å‹çš„å˜é‡äº§ç”Ÿå¼ºå¼•ç”¨ã€‚

4.æ ˆå˜é‡(æœ‰__blockå‰ç¼€çš„å±€éƒ¨å˜é‡):
  å¼•ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ã€‚å¦‚æœæ˜¯idç±»å‹åˆ™ä¸ä¼šè¢«block retainã€å¦‚æœè¯¥ç±»å‹æ˜¯Cç±»å‹å˜é‡ï¼Œè¯¥å€¼ä¼šè¢«æŒªåŠ¨åˆ°å †ä¸­ã€‚
</code></pre>

<p>åœ¨ARCä¸­ï¼Œblockè¢«èµ‹å€¼ä¼ é€’çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‹·è´åˆ°å †ä¸Šï¼Œå †ä¸Šçš„å¯¹è±¡å°±æœ‰å¯èƒ½è¢«é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥è¦ç”¨copyå¼ºå¼•ç”¨ç€,ä»¥å…é‡æŒ‡é’ˆcrashã€‚</p>

<h4>å¾ªç¯å¼•ç”¨:</h4>

<p>å½“blockè¢«copyåˆ°å †ä¹‹åï¼Œè¯¥blockå¯¹å®ƒæ•è·çš„å¯¹è±¡äº§ç”Ÿå¼ºå¼•ç”¨ï¼Œæ‰€ä»¥æœ‰æ—¶éœ€è¦é¿å…block copyåäº§ç”Ÿçš„å¾ªç¯å¼•ç”¨ã€‚</p>

<p>å¦‚selfå¼•ç”¨äº†blockï¼Œblockåˆæ•è·äº†selfï¼Œè¿™æ ·å°±ä¼šæœ‰å¾ªç¯å¼•ç”¨,å› æ­¤ï¼Œéœ€è¦ç”¨weakæ¥å£°æ˜selfã€‚</p>

<pre><code>- (void)test {
    ViewController * __weak weakSelf = self;
    self.block = ^{
        [weakSelf doSomething]; //ç”¨å¼±å¼•ç”¨,æ‰“ç ´å¾ªç¯å¼•ç”¨
    }
}
</code></pre>

<p>å¦‚æœæ•è·åˆ°çš„æ˜¯å¯¹è±¡çš„æˆå‘˜å˜é‡å¯¹è±¡ï¼Œä¹Ÿä¼šé—´æ¥é€ æˆå¯¹selfçš„å¾ªç¯å¼•ç”¨ï¼ŒåŒæ ·ä¹Ÿè¦é¿å…ã€‚</p>

<pre><code>- (void)test {
    id tempPropertyObj = _propertyObj; //ç”¨ä¸´æ—¶å˜é‡,é¿å…äº†å¾ªç¯å¼•ç”¨
    self.block = ^{
        [tempPropertyObj doSomething];
    }
}
</code></pre>

<h4>é—®é¢˜</h4>

<pre><code>[UIView animateWithDuration:0.5 animations:^{
        [self doSomething];
    }];
</code></pre>

<p>ä¸Šé¢ä¾‹å­å¹¶ä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œå› ä¸ºblockå¼ºå¼•ç”¨äº†self,è€Œselfå¹¶æ²¡æœ‰å¼ºå¼•ç”¨blockã€‚å¦‚æœåƒä¸‹é¢å°±ä¼šå¾ªç¯å¼•ç”¨ï¼šself &ndash;> _observer &ndash;> block &ndash;> self è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚</p>

<pre><code>//_observer æ˜¯selfçš„å®ä¾‹å˜é‡
    _observer = [[NSNotificationCenter defaultCenter] addObserverForName:@"test"
                                                                  object:nil
                                                                   queue:[NSOperationQueue mainQueue]
                                                              usingBlock:^(NSNotification * _Nonnull note) {
                                                                  [self doSomething];
                                                              }];
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„Runloopä¸Runtime]]></title>
    <link href="http://andyfightting.github.io/blog/2016/08/01/runtime/"/>
    <updated>2016-08-01T10:20:14+08:00</updated>
    <id>http://andyfightting.github.io/blog/2016/08/01/runtime</id>
    <content type="html"><![CDATA[<h3><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html">Runloop</a></h3>

<p>Runloopä¸çº¿ç¨‹æ¯æ¯ç›¸å…³ï¼Œå®ƒæ˜¯çº¿ç¨‹çš„åŸºç¡€æ¶æ„éƒ¨åˆ†ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„runloopå¯¹è±¡ï¼Œå¯ä»¥ç”¨[NSRunLoop currentRunLoop]æ¥å¾—åˆ°å®ƒã€‚ä¸»çº¿ç¨‹ä¸­çš„runloopæ˜¯å¯åŠ¨è¿è¡ŒçŠ¶æ€ï¼Œè€Œè‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ä¸­çš„runloopé»˜è®¤æ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œéœ€è¦çš„è¯è¦æ‰‹åŠ¨å»å¯åŠ¨ã€‚Runloopæ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å¾ªç¯ï¼Œç”¨æ¥ä¸åœçš„ç›‘å¬è¾“å…¥äº‹ä»¶æˆ–è€…å®šæ—¶äº‹ä»¶ï¼Œå¹¶å°†å…¶åˆ†é…åˆ°å¯¹åº”çš„ç›®æ ‡ä¸Šè¿›è¡Œå¤„ç†ã€‚å®ƒå¯ä»¥ä½¿çº¿ç¨‹åœ¨æœ‰å·¥ä½œçš„æ—¶å€™å·¥ä½œï¼Œæ²¡æœ‰å·¥ä½œçš„æ—¶å€™ä¼‘çœ ã€‚</p>

<p>RunloopåŒæ—¶ä¹Ÿè´Ÿè´£autorelease poolçš„åˆ›å»ºå’Œé‡Šæ”¾ï¼Œæ¯å½“ä¸€ä¸ªè¿è¡Œå¾ªç¯ç»“æŸçš„æ—¶å€™ï¼Œå®ƒéƒ½ä¼šé‡Šæ”¾autorelease poolï¼ŒåŒæ—¶poolä¸­çš„æ‰€æœ‰è‡ªåŠ¨é‡Šæ”¾ç±»å‹å˜é‡éƒ½ä¼šè¢«é‡Šæ”¾æ‰ã€‚NSRunloopä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒCFRunLoopRefæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚RunLoopè¦æŒ‡å®šåœ¨ç‰¹å®šModeä¸‹Runï¼š</p>

<p>*NSDefaultRunLoopModeï¼šå¤„ç†å¤§å¤šæ•°çš„æ“ä½œï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç”¨è¿™ä¸ªã€‚</p>

<p>*NSRunLoopCommonModesï¼šFor Cocoa applications, this set includes the default, modal, and event tracking modes by default. Core Foundation includes just the default mode initially.</p>

<p>è€Œä¸”é€šè¿‡scheduleInRunLoopçš„æ–¹å¼å¯åŠ¨çš„è¯·æ±‚ï¼Œè™½ç„¶æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ä½†ä¹Ÿä¼šæœ‰å¼‚æ­¥çš„æ•ˆæœï¼SDWebImageDownloader ä¸­çš„ NSURLConnection å°±æ˜¯è¿™æ ·å¯åŠ¨è¯·æ±‚çš„ï¼ï¼</p>

<pre><code>- (void)start{
    NSURLRequest *request = [[NSURLRequest alloc] initWithURL:url cachePolicy:NSURLRequestReloadIgnoringLocalCacheData timeoutInterval:15];
    self.connection = [[NSURLConnection alloc] initWithRequest:request delegate:self startImmediately:NO];
    [connection scheduleInRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes];
    [connection start];
    if (connection){
        self.imageData = [NSMutableData data];
    }else{
        if ([delegate respondsToSelector:@selector(imageDownloader:didFailWithError:)]){
            [delegate performSelector:@selector(imageDownloader:didFailWithError:) withObject:self withObject:nil];
        }
    }
}
</code></pre>

<p>NSURLConnectionåœ¨ä»£ç†æ–¹æ³•ä¸­æ‰“å°å‡ºçš„çº¿ç¨‹ï¼š
<img src="http://andyfightting.github.io/myimg/ios/sdrunloop.png" alt="iamge" /></p>

<p>runloopç›‘å¬ç”¨æˆ·è¾“å…¥äº‹ä»¶å’Œå®šæ—¶äº‹ä»¶
<img src="http://andyfightting.github.io/myimg/ios/runloop.png" alt="image" /><!--more--></p>

<h3><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Introduction/Introduction.html">Runtime</a></h3>

<p>Runtimeæ˜¯ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼ŒiOSä¹‹æ‰€ä»¥æ˜¯åŠ¨æ€è¯­è¨€å°±æ˜¯å› ä¸ºå®ƒã€‚å®ƒçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç”¨Cå’Œç¼–è¯‘è¯­è¨€å†™çš„Runtimeåº“ã€‚å®ƒæ˜¯Objective-Cé¢å‘å¯¹è±¡å’ŒåŠ¨æ€æœºåˆ¶çš„åŸºçŸ³ã€‚é™æ€è¯­è¨€æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç»‘å®šå¥½äº†æŸä¸ªæ–¹æ³•åä¼šæ‰§è¡Œå“ªæ®µå‡½æ•°åœ°å€ã€‚è€ŒåŠ¨æ€è¯­è¨€ä¸æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç»‘å®šå¥½äº†ï¼Œå®ƒæ˜¯åœ¨å…·ä½“è¦æ‰§è¡Œçš„æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰æ ¹æ®æ–¹æ³•åå»å¯»æ‰¾å…·ä½“æ‰§è¡Œçš„æ–¹æ³•åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™æ—¶å€™åŠ¨æ€çš„æ”¹å˜å®ƒçš„ç»‘å®šã€‚å¯ä»¥åœ¨<a href="https://opensource.apple.com/tarballs/objc4/">è¿™é‡Œ</a>ä¸‹è½½æºç æŸ¥çœ‹ã€‚</p>

<p>&ldquo;è®¡ç®—æœºç•Œï¼Œåªè¦å†åŠ ä¸€å±‚ä¸­é—´å±‚ï¼Œå°±æ²¡æœ‰è§£å†³ä¸äº†çš„é—®é¢˜ã€‚å¦‚æœæœ‰ï¼Œé‚£å†åŠ ä¸€å±‚ï¼Œç›´åˆ°å®ƒè§£å†³ã€‚"è¿™å¥è¯ä¸çŸ¥é“æ˜¯åœ¨å“ªé‡Œçœ‹åˆ°çš„äº†&hellip;ä¸è¿‡è¯´çš„æŒºæœ‰é“ç†çš„ã€‚è€ŒRuntimeåº“æ­£æ˜¯Objective-Cä¹‹æ‰€ä»¥ä¸ºåŠ¨æ€è¯­è¨€çš„ä¸­é—´å±‚ï¼</p>

<p>åœ¨Objective-Cä¸­ï¼Œç±»ã€å¯¹è±¡å’Œæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªCçš„ç»“æ„ä½“ï¼Œä»objc/objc.hå¤´æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä»–ä»¬çš„å®šä¹‰ï¼š</p>

<pre><code>//---NSObject-----
@interface NSObject &lt;NSObject&gt; {
     Class isa 
}

//---Class-----
typedef struct objc_class *Class;

//---objc_class-----
struct objc_class {
    Class isa 
    Class super_class                                        
    const char *name                                         
    long version                                             
    long info                                                
    long instance_size //å¯¹è±¡å¤§å°                                      
    struct objc_ivar_list *ivars //å±æ€§åˆ—è¡¨                             
    struct objc_method_list **methodLists //æ–¹æ³•åˆ—è¡¨                   
    struct objc_cache *cache  //æ–¹æ³•æ˜ å°„ç¼“å­˜                               
    struct objc_protocol_list *protocols   //ä»£ç†åˆ—è¡¨                   
};

//---objc_method----
struct objc_method {  
    SEL method_name //æ–¹æ³•å
    char *method_types //a string representing argument/return types
    IMP method_imp  //æ–¹æ³•åœ°å€
};
</code></pre>

<p>Objective-Cçš„å‡½æ•°è°ƒç”¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«ç¿»è¯‘ä¸º -objc_msgSend(æ‰§è¡Œçš„å¯¹è±¡ï¼Œæ–¹æ³•åï¼Œå‚æ•°&hellip;),å…ˆé€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°å®ƒçš„Class,ç„¶ååœ¨method listé‡Œæ‰¾æ–¹æ³•ï¼Œæ²¡æœ‰çš„è¯å°±ä¸ŠsuperClassä¸­æ‰¾ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å»æ‰§è¡Œï¼Œç„¶åæŠŠæ–¹æ³•åå’Œå¯¹åº”çš„æ–¹æ³•åœ°å€æ˜ å°„ä¿å­˜åœ¨objc_cacheä¸­ï¼Œä¸‹æ¬¡å°±ç›´æ¥ä»è¿™ç¼“å­˜ä¸­å–ã€‚å¦‚æœéƒ½æ²¡æ‰¾åˆ°ï¼Œä¼šåœ¨ç¨‹åºæŠ¥unrecognized selector sent to&hellip;é”™è¯¯ä¹‹å‰è¿˜æœ‰æœºä¼šè¡¥æ•‘ï¼Œå°±æ˜¯åŠ¨æ€çš„ç»™å®ƒæŒ‡å®šä¸€ä¸ªæ‰§è¡Œæ–¹æ³•ï¼</p>

<p>é¦–å…ˆï¼ŒObjective-Cè¿è¡Œæ—¶ä¼šè°ƒç”¨+resolveInstanceMethod:æˆ–è€…+resolveClassMethod:ï¼Œè®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°ã€‚å¦‚æœä½ æ·»åŠ äº†å‡½æ•°å¹¶è¿”å›YESï¼Œé‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ã€‚ä¸‹é¢ç”¨å½“æˆ‘è°ƒç”¨testæ–¹æ³•çš„æ—¶å€™ï¼Œæ²¡æœ‰testçš„å®ç°æ–¹æ³•ï¼Œä½†æŠŠå®ƒåŠ¨æ€ç»‘å®šç»™äº†newTestæ–¹æ³•å»æ‰§è¡Œï¼</p>

<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];
    [self performSelector:@selector(test) withObject:nil afterDelay:0];
}

void newTest(){
    NSLog(@"success !!");
}

+ (BOOL)resolveInstanceMethod:(SEL)aSEL{
    if(aSEL == @selector(test)){
        class_addMethod([self class], aSEL, (IMP)newTest, nil);
        return YES;
    }
    return [super resolveInstanceMethod:aSEL];
}
</code></pre>

<p>å¦‚æœresolveInstanceMethodï¼šæ–¹æ³•è¿”å›NOè¯ï¼Œå°±ä¼šè½¬åˆ°-forwardingTargetForSelector:æ–¹æ³•ä¸­å»æ‰§è¡Œ,è®©è¿™ä¸ªæ–¹æ³•åœ¨å…¶ä»–å¯¹è±¡ä¸­å»æ‰§è¡Œï¼å¦‚ä¸‹é¢æŠŠtestæ–¹æ³•ä¼ é€’ç»™ viewController2 å¯¹è±¡å»æ‰§è¡Œï¼Œåœ¨ viewController2 å¯¹è±¡ä¸­å®ç°çš„ test æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼ï¼</p>

<pre><code>+ (BOOL)resolveInstanceMethod:(SEL)aSEL{
    return NO;
}

- (id)forwardingTargetForSelector:(SEL)aSelector{
    if(aSelector == @selector(test)){
        return viewController2;//ä¼ é€’ç»™viewController2å¯¹è±¡å»æ‰§è¡Œ testæ–¹æ³•
    }
    return [super forwardingTargetForSelector:aSelector];
}
</code></pre>

<p>å¦‚æœforwardingTargetForSelectorï¼šæ–¹æ³•è¿”å›nilæˆ–è€…selfçš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector:æ–¹æ³•ä¸­å»æ‰§è¡Œï¼Œå¦‚æœè¿™æ–¹æ³•è¿”å›äº†ä¸€ä¸ªNSMethodSignatureå¯¹è±¡ï¼Œè¿™ä¼šè¿›å…¥-forwardInvocation:æ–¹æ³•ä¸­ï¼ŒæŠŠæ¶ˆæ¯ä¼ ç»™å¯¹åº”çš„å¯¹è±¡å»æ‰§è¡Œï¼å¦‚ä¸‹å°†ä¼šåœ¨viewController2ä¸­æ‰§è¡Œtestæ–¹æ³•ï¼ï¼</p>

<pre><code>+ (BOOL)resolveInstanceMethod:(SEL)aSEL{
    return NO;
}

- (id)forwardingTargetForSelector:(SEL)aSelector{
    return self;
}

- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector{
    NSMethodSignature* signature = [super methodSignatureForSelector:aSelector];
    if (signature==nil) {
        signature = [viewController2 methodSignatureForSelector:aSelector];
    }
    return signature;
}

- (void)forwardInvocation:(NSInvocation *)invocation{
    SEL sel = invocation.selector;
    if([viewController2 respondsToSelector:sel]) {
        [invocation invokeWithTarget:viewController2];
    }else {
        [self doesNotRecognizeSelector:sel];
    }
}
</code></pre>

<p>å¦‚æœè¿™ä¸‰ä¸ªè¿‡ç¨‹ä¸‹æ¥éƒ½æ²¡ç»‘å®šå…·ä½“çš„æ‰§è¡Œæ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥- (void)doesNotRecognizeSelector:(SEL)aSelectoræ–¹æ³•ï¼Œç„¶åç¨‹åºå¥”æºƒ!!</p>

<p><a href="http://nshipster.com/method-swizzling/">Method Swizzling</a>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨test1æ–¹æ³•çš„æ—¶å€™ï¼Œå…·ä½“æ‰§è¡Œæ˜¯è·‘åˆ°test2æ–¹æ³•ä¸­çš„ï¼ï¼</p>

<pre><code>@implementation ViewController
+ (void)load {
static dispatch_once_t onceToken;
dispatch_once(&amp;onceToken, ^{
    Class class = [self class];

    SEL originalSelector = @selector(test1);
    SEL swizzledSelector = @selector(test2);

    Method originalMethod = class_getInstanceMethod(class, originalSelector);
    Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);

    BOOL didAddMethod =
    class_addMethod(class,
                    originalSelector,
                    method_getImplementation(swizzledMethod),
                    method_getTypeEncoding(swizzledMethod));

    if (didAddMethod) {
        class_replaceMethod(class,
                            swizzledSelector,
                            method_getImplementation(originalMethod),
                            method_getTypeEncoding(originalMethod));
    } else {
        method_exchangeImplementations(originalMethod, swizzledMethod);
    }
});
}

- (void)viewDidLoad {
    [super viewDidLoad];
    [self test1];
}
-(void)test1{
    NSLog(@"å¼€å§‹1");
}
-(void)test2{
    NSLog(@"å¼€å§‹2");
}
</code></pre>

<p>Swizzlingåº”è¯¥æ€»æ˜¯åœ¨+loadä¸­æ‰§è¡Œ,åœ¨Objective-Cä¸­ï¼Œè¿è¡Œæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ¯ä¸ªç±»çš„ä¸¤ä¸ªæ–¹æ³•ã€‚+loadä¼šåœ¨ç±»åˆå§‹åŠ è½½æ—¶è°ƒç”¨ï¼Œ+initializeä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ç±»çš„ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨ã€‚</p>

<p>è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œä¸”åªæœ‰åœ¨å®ç°äº†å®ƒä»¬æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚ç”±äºmethod swizzlingä¼šå½±å“åˆ°ç±»çš„å…¨å±€çŠ¶æ€ï¼Œå› æ­¤è¦å°½é‡é¿å…åœ¨å¹¶å‘å¤„ç†ä¸­å‡ºç°ç«äº‰çš„æƒ…å†µã€‚+loadèƒ½ä¿è¯åœ¨ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­è¢«åŠ è½½ï¼Œå¹¶ä¿è¯è¿™ç§æ”¹å˜åº”ç”¨çº§åˆ«çš„è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ+initializeåœ¨å…¶æ‰§è¡Œæ—¶ä¸æä¾›è¿™ç§ä¿è¯â€”äº‹å®ä¸Šï¼Œå¦‚æœåœ¨åº”ç”¨ä¸­æ²¡ä¸ºç»™è¿™ä¸ªç±»å‘é€æ¶ˆæ¯ï¼Œåˆ™å®ƒå¯èƒ½æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚</p>

<p>Swizzlingåº”è¯¥æ€»æ˜¯åœ¨dispatch_onceä¸­æ‰§è¡Œ, å› ä¸ºswizzlingä¼šæ”¹å˜å…¨å±€çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ƒç¡®ä¿ä»£ç åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Œè€ŒGCDçš„dispatch_onceå¯ä»¥ç¡®ä¿è¿™ç§è¡Œä¸ºã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„CoreText]]></title>
    <link href="http://andyfightting.github.io/blog/2015/12/26/core-text/"/>
    <updated>2015-12-26T15:16:23+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/12/26/core-text</id>
    <content type="html"><![CDATA[<p>CoreTextè¿›è¡Œå›¾æ–‡æ··æ’çš„æ ¸å¿ƒæ€æƒ³æ˜¯æŠŠéœ€è¦æ‘†æ”¾å›¾ç‰‡çš„ä½ç½®ç”¨ç©ºå­—ç¬¦æ›¿æ¢åŸæ¥çš„å­—ç¬¦ï¼Œå¹¶ä¸”å®ç°CTRunDelegateï¼Œç”¨äºåŠ¨æ€è®¾ç½®ç©ºå­—ç¬¦çš„é«˜åº¦å’Œå®½åº¦ï¼ˆä»£è¡¨å›¾ç‰‡çš„å¤§å°ï¼‰ï¼Œå¹¶ä¸”å¯¹è¿™äº›ç©ºå­—ç¬¦è®¾ç½®ä¸€ä¸ªå±æ€§åæ¥åŒºåˆ«äºå…¶ä»–CTRunï¼Œä¹‹åè¿›è¡Œå›¾ç‰‡æ¸²æŸ“çš„æ—¶å€™å°±èƒ½é€šè¿‡è¯¥å±æ€§æ¥åŒºåˆ†å“ªäº›ç©ºå­—ç¬¦æ˜¯ä»£è¡¨å›¾ç‰‡çš„å ä½ç¬¦ï¼Œå“ªäº›æ˜¯æ™®é€šçš„ç©ºå­—ç¬¦ã€‚ä½¿ç”¨CoreTextå¤„ç†ç‚¹å‡»äº‹ä»¶çš„å…³é”®æ˜¯åˆ¤æ–­ç‚¹å‡»çš„ä½ç½®æ˜¯æœ¬æ–‡å†…å®¹ä¸­çš„ç¬¬å‡ ä¸ªå­—ç¬¦ï¼Œç„¶åé€šè¿‡åˆ¤æ–­è¯¥å­—ç¬¦æ˜¯å¦åœ¨éœ€è¦å¤„ç†ç‚¹å‡»äº‹ä»¶çš„å­—ç¬¦ä¸²èŒƒå›´å†…ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/ios/text2.png" alt="image" /><!--more-->
<img src="http://andyfightting.github.io/myimg/ios/coreText.png" alt="image" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>#import "CoreTextView.h"
</span><span class='line'>#import &lt;CoreText/CoreText.h&gt;
</span><span class='line'>
</span><span class='line'>@implementation CoreTextView{
</span><span class='line'>    CTFrameRef ctFrame;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>- (id)initWithFrame:(CGRect)frame
</span><span class='line'>{
</span><span class='line'>    self = [super initWithFrame:frame];
</span><span class='line'>    if (self) {
</span><span class='line'>        // Initialization code
</span><span class='line'>    }
</span><span class='line'>    return self;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>- (void)drawRect:(CGRect)rect
</span><span class='line'>{
</span><span class='line'>    //å¾—åˆ°å½“å‰ç”¨äºç»˜åˆ¶ç”»å¸ƒçš„ä¸Šä¸‹æ–‡ï¼Œç”¨äºåç»­å°†å†…å®¹ç»˜åˆ¶åœ¨ç”»å¸ƒä¸Š
</span><span class='line'>    CGContextRef context = UIGraphicsGetCurrentContext();
</span><span class='line'>    
</span><span class='line'>    //ç¿»è½¬å½“å‰çš„åæ ‡ç³», å› ä¸ºå¯¹äºåº•å±‚ç»˜åˆ¶å¼•æ“æ¥è¯´ï¼Œå±å¹•å·¦ä¸‹è§’ä¸ºï¼ˆ0ï¼Œ0)
</span><span class='line'>    CGContextSetTextMatrix(context, CGAffineTransformIdentity);
</span><span class='line'>    CGContextTranslateCTM(context, 0, self.bounds.size.height);
</span><span class='line'>    CGContextScaleCTM(context, 1.0, -1.0);
</span><span class='line'>    
</span><span class='line'>    //è¦ç»˜åˆ¶çš„æ–‡å­—
</span><span class='line'>    NSMutableAttributedString* attributedString = [[NSMutableAttributedString alloc] initWithString:@"å°‘å¹´ä¸è¯†æ„æ»‹å‘³ï¼Œçˆ±ä¸Šå±‚æ¥¼ã€‚çˆ±ä¸Šå±‚æ¥¼ã€‚ä¸ºèµ‹æ–°è¯å¼ºè¯´æ„ã€‚è€Œä»Šè¯†å°½æ„æ»‹å‘³ï¼Œæ¬²è¯´è¿˜ä¼‘ã€‚æ¬²è¯´è¿˜ä¼‘ã€‚å´é“å¤©å‡‰å¥½ä¸ªç§‹ã€‚"];
</span><span class='line'>    //ä¸ºæ‰€æœ‰æ–‡æœ¬è®¾ç½®å­—ä½“
</span><span class='line'>    [attributedString addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:10] range:NSMakeRange(0, [attributedString length])];
</span><span class='line'>    //è®¾ç½®æŸäº›å­—ä½“æ›´å¤§
</span><span class='line'>    [attributedString addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:30] range:NSMakeRange(10, 10)];
</span><span class='line'>    //index ä»0å¼€å§‹çš„2ä¸ªå­—ç¬¦ å­—ä½“é¢œè‰² è®¾ç½®ä¸ºè“è‰²
</span><span class='line'>    [attributedString addAttribute:NSForegroundColorAttributeName value:[UIColor blueColor] range:NSMakeRange(0, 2)];
</span><span class='line'>    //index ä»2å¼€å§‹çš„3ä¸ªå­—ç¬¦ å­—ä½“é¢œè‰² è®¾ç½®ä¸ºçº¢è‰²
</span><span class='line'>    [attributedString addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(2, 3)];
</span><span class='line'>    //è®¾ç½®è¡Œé—´è· 50
</span><span class='line'>    CGFloat lineSpacing = 50;
</span><span class='line'>    CTParagraphStyleSetting theSettings[3] = {
</span><span class='line'>        {kCTParagraphStyleSpecifierLineSpacingAdjustment, sizeof(CGFloat), &lineSpacing},
</span><span class='line'>        {kCTParagraphStyleSpecifierMaximumLineSpacing, sizeof(CGFloat), &lineSpacing},
</span><span class='line'>        {kCTParagraphStyleSpecifierMinimumLineSpacing, sizeof(CGFloat), &lineSpacing}
</span><span class='line'>    };
</span><span class='line'>    CTParagraphStyleRef theParagraphRef = CTParagraphStyleCreate(theSettings, 3);
</span><span class='line'>    [attributedString addAttribute:(id)kCTParagraphStyleAttributeName value:(__bridge id)theParagraphRef range:NSMakeRange(0, attributedString.length)];
</span><span class='line'>    CFRelease(theParagraphRef);
</span><span class='line'>    
</span><span class='line'>    //è¦æ’å…¥çš„å›¾ç‰‡
</span><span class='line'>    NSString *imageName = @"testImage.png";
</span><span class='line'>    
</span><span class='line'>    //ä¸ºå›¾ç‰‡è®¾ç½®CTRunDelegate è®¡ç®—ç•™ç»™å›¾ç‰‡çš„ç©ºé—´å¤§å°
</span><span class='line'>    CTRunDelegateCallbacks imageCallbacks;
</span><span class='line'>    imageCallbacks.version = kCTRunDelegateVersion1;
</span><span class='line'>    imageCallbacks.getAscent = GetAscentCallback;
</span><span class='line'>    imageCallbacks.getDescent = GetDescentCallback;
</span><span class='line'>    imageCallbacks.getWidth = GetWidthCallback;
</span><span class='line'>    
</span><span class='line'>    //è®¾ç½®å›¾ç‰‡ä½ç½®ï¼Œå¤§å°
</span><span class='line'>    CTRunDelegateRef runDelegate = CTRunDelegateCreate(&imageCallbacks, imageName);
</span><span class='line'>    NSMutableAttributedString *imageAttributedString = [[NSMutableAttributedString alloc] initWithString:@" "];//ç©ºæ ¼ç”¨äºç»™å›¾ç‰‡ç•™ä½ç½®
</span><span class='line'>    [imageAttributedString addAttribute:(NSString *)kCTRunDelegateAttributeName value:(id)runDelegate range:NSMakeRange(0, 1)];//ç”¨ä»£ç†è®¾ç½®å›¾ç‰‡
</span><span class='line'>    CFRelease(runDelegate);
</span><span class='line'>    
</span><span class='line'>    //æŠŠå›¾ç‰‡æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­
</span><span class='line'>    [imageAttributedString addAttribute:@"imageAttribute" value:imageName range:NSMakeRange(0, 1)];
</span><span class='line'>    [attributedString insertAttributedString:imageAttributedString atIndex:1];//å›¾ç‰‡æ’å…¥ä½ç½®ï¼Œä¸èƒ½è¶Šç•Œ
</span><span class='line'>    [attributedString insertAttributedString:imageAttributedString atIndex:3];//å›¾ç‰‡æ’å…¥ä½ç½®ï¼Œä¸èƒ½è¶Šç•Œ
</span><span class='line'>    [attributedString insertAttributedString:imageAttributedString atIndex:5];//å›¾ç‰‡æ’å…¥ä½ç½®ï¼Œä¸èƒ½è¶Šç•Œ
</span><span class='line'>    
</span><span class='line'>    //æ ¹æ®attributedStringç”ŸæˆCTFramesetterRef
</span><span class='line'>    CTFramesetterRef ctFramesetter = CTFramesetterCreateWithAttributedString((CFMutableAttributedStringRef)attributedString);
</span><span class='line'>    CGMutablePathRef path = CGPathCreateMutable();
</span><span class='line'>    CGRect bounds = CGRectMake(0.0, 0.0, self.bounds.size.width, self.bounds.size.height);
</span><span class='line'>    CGPathAddRect(path, NULL, bounds);
</span><span class='line'>    
</span><span class='line'>    //ç»˜åˆ¶æ–‡å­—
</span><span class='line'>    ctFrame = CTFramesetterCreateFrame(ctFramesetter,CFRangeMake(0, [attributedString length ]), path, NULL);
</span><span class='line'>    CTFrameDraw(ctFrame, context);
</span><span class='line'>    
</span><span class='line'>    //ä¸‹é¢éƒ½æ˜¯ä¸ºäº†ç»˜åˆ¶å›¾ç‰‡
</span><span class='line'>    CFArrayRef lines = CTFrameGetLines(ctFrame);
</span><span class='line'>    CGPoint lineOrigins[CFArrayGetCount(lines)];
</span><span class='line'>    CTFrameGetLineOrigins(ctFrame, CFRangeMake(0, 0), lineOrigins);
</span><span class='line'>    
</span><span class='line'>    //éå†æ¯ä¸ªCTLine
</span><span class='line'>    for (int i = 0; i &lt; CFArrayGetCount(lines); i++) {
</span><span class='line'>        CTLineRef line = CFArrayGetValueAtIndex(lines, i);
</span><span class='line'>        CGFloat lineAscent;
</span><span class='line'>        CGFloat lineDescent;
</span><span class='line'>        CGFloat lineLeading;
</span><span class='line'>        CTLineGetTypographicBounds(line, &lineAscent, &lineDescent, &lineLeading);
</span><span class='line'>        
</span><span class='line'>        CFArrayRef runs = CTLineGetGlyphRuns(line);
</span><span class='line'>        for (int j = 0; j &lt; CFArrayGetCount(runs); j++) {
</span><span class='line'>            CGFloat runAscent;
</span><span class='line'>            CGFloat runDescent;
</span><span class='line'>            CGPoint lineOrigin = lineOrigins[i];
</span><span class='line'>            CTRunRef run = CFArrayGetValueAtIndex(runs, j);
</span><span class='line'>            NSDictionary* attributes = (NSDictionary*)CTRunGetAttributes(run);
</span><span class='line'>            
</span><span class='line'>            CGRect runRect;
</span><span class='line'>            runRect.size.width = CTRunGetTypographicBounds(run, CFRangeMake(0,0), &runAscent, &runDescent, NULL);
</span><span class='line'>            runRect=CGRectMake(lineOrigin.x + CTLineGetOffsetForStringIndex(line, CTRunGetStringRange(run).location, NULL), lineOrigin.y - runDescent, runRect.size.width, runAscent + runDescent);
</span><span class='line'>            
</span><span class='line'>            NSString *isImage = [attributes objectForKey:@"imageAttribute"];
</span><span class='line'>            //å›¾ç‰‡æ¸²æŸ“é€»è¾‘
</span><span class='line'>            if (isImage) {
</span><span class='line'>                UIImage *image = [UIImage imageNamed:imageName];
</span><span class='line'>                if (image) {
</span><span class='line'>                    CGRect imageDrawRect;
</span><span class='line'>                    imageDrawRect.size = image.size;
</span><span class='line'>                    imageDrawRect.origin.x = runRect.origin.x + lineOrigin.x;
</span><span class='line'>                    imageDrawRect.origin.y = lineOrigin.y;
</span><span class='line'>                    CGContextDrawImage(context, imageDrawRect, image.CGImage);
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    //é‡Šæ”¾èµ„æº
</span><span class='line'>    //    CFRelease(ctFrame); //å› ä¸ºç‚¹å‡»è¦ç”¨ctFrameï¼Œæ‰€ä»¥æ”¾deallocé‡Œé‡Šæ”¾
</span><span class='line'>    CFRelease(path);
</span><span class='line'>    CFRelease(ctFramesetter);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>//æ¥å—è§¦æ‘¸äº‹ä»¶
</span><span class='line'>-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{
</span><span class='line'>    UITouch *touch = [touches anyObject];
</span><span class='line'>    CGPoint location = [touch locationInView:self];
</span><span class='line'>    
</span><span class='line'>    //è·å–æ¯ä¸€è¡Œ
</span><span class='line'>    CFArrayRef lines = CTFrameGetLines(ctFrame);
</span><span class='line'>    CGPoint origins[CFArrayGetCount(lines)];
</span><span class='line'>    //è·å–æ¯è¡Œçš„åŸç‚¹åæ ‡
</span><span class='line'>    CTFrameGetLineOrigins(ctFrame, CFRangeMake(0, 0), origins);
</span><span class='line'>    CTLineRef line = NULL;
</span><span class='line'>    CGPoint lineOrigin = CGPointZero;
</span><span class='line'>    for (int i= 0; i &lt; CFArrayGetCount(lines); i++){
</span><span class='line'>        CGPoint origin = origins[i];
</span><span class='line'>        CGPathRef path = CTFrameGetPath(ctFrame);
</span><span class='line'>        //è·å–æ•´ä¸ªCTFrameçš„å¤§å°
</span><span class='line'>        CGRect rect = CGPathGetBoundingBox(path);
</span><span class='line'>        //åæ ‡è½¬æ¢ï¼ŒæŠŠæ¯è¡Œçš„åŸç‚¹åæ ‡è½¬æ¢ä¸ºuiviewçš„åæ ‡ä½“ç³»
</span><span class='line'>        CGFloat y = rect.origin.y + rect.size.height - origin.y;
</span><span class='line'>        //åˆ¤æ–­ç‚¹å‡»çš„ä½ç½®å¤„äºé‚£ä¸€è¡ŒèŒƒå›´å†…
</span><span class='line'>        if ((location.y &lt;= y) && (location.x &gt;= origin.x)){
</span><span class='line'>            line = CFArrayGetValueAtIndex(lines, i);
</span><span class='line'>            lineOrigin = origin;
</span><span class='line'>            break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    location.x -= lineOrigin.x;
</span><span class='line'>    //è·å–ç‚¹å‡»ä½ç½®æ‰€å¤„çš„å­—ç¬¦ä½ç½®ï¼Œå°±æ˜¯ç›¸å½“äºç‚¹å‡»äº†ç¬¬å‡ ä¸ªå­—ç¬¦
</span><span class='line'>    CFIndex index = CTLineGetStringIndexForPosition(line, location)-1;//indexä»0å¼€å§‹
</span><span class='line'>    UIAlertView* alert = [[UIAlertView alloc]initWithTitle:@"æç¤º" message:[NSString stringWithFormat:@"ç‚¹å‡»äº†ç¬¬ %d ä¸ªå­—ç¬¦ï¼ï¼",(int)index] delegate:self cancelButtonTitle:@"ok" otherButtonTitles:nil, nil];
</span><span class='line'>    [alert show];
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>-(void)dealloc{
</span><span class='line'>    [super dealloc];
</span><span class='line'>    CFRelease(ctFrame);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>#pragma mark CTRunDelegate Callbacks
</span><span class='line'>CGFloat GetAscentCallback( void *refCon ){
</span><span class='line'>    NSString *imageName = (NSString *)refCon;
</span><span class='line'>    return [UIImage imageNamed:imageName].size.height;
</span><span class='line'>}
</span><span class='line'>CGFloat GetDescentCallback(void *refCon){
</span><span class='line'>    return 0;
</span><span class='line'>}
</span><span class='line'>CGFloat GetWidthCallback(void *refCon){
</span><span class='line'>    NSString *imageName = (NSString *)refCon;
</span><span class='line'>    return [UIImage imageNamed:imageName].size.width;
</span><span class='line'>}
</span><span class='line'>@end</span></code></pre></td></tr></table></div></figure>


<p>è¿è¡Œç»“æœ
<img src="http://andyfightting.github.io/myimg/ios/coreResult.png" alt="image" /></p>

<h3>*TextKit</h3>

<p>ç”±äºç”¨CoreTextæ˜¯ç”¨ç»˜å›¾æ–¹å¼å®ç°å›¾æ–‡æ··æ’ï¼Œå¤æ‚éš¾ç”¨ã€‚æ‰€ä»¥åœ¨iOS7æ–°æ¨å‡ºäº†æ–°çš„æ–‡å­—æ’ç‰ˆæŠ€æœ¯ &ndash; TextKitã€‚ä½¿ç”¨TextKitå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°å¯Œæ–‡æœ¬ã€è¡¨æƒ…æ··æ’å’Œå›¾æ–‡æ··æ’ç­‰æ•ˆæœã€‚å®ƒæ˜¯UIKit frameworkä¸­å®šä¹‰çš„ä¸€ç»„ç”¨äºæä¾›é«˜æ€§èƒ½çš„æ’ç‰ˆã€å¸ƒå±€å’Œå±•ç¤ºæ–‡å­—çš„ç±»å’Œåè®®ï¼Œæ¯”å¦‚å±•ç¤ºç‰¹åˆ«çš„å­—é—´è·ã€è¡Œé—´è·ã€æ–­è¡Œè§„åˆ™ã€‚ä»ä¸Šé¢å›¾2å¯çŸ¥ï¼Œå®ƒæ˜¯åŸºäºCoreTextçš„ï¼Œä¸”UILabel,UITextField,UITextViewåˆéƒ½æ˜¯åŸºäºTextKitçš„ã€‚</p>

<pre><code>UILabel* label = [[UILabel alloc]initWithFrame:self.view.bounds];
label.text = @"å°‘å¹´ä¸è¯†æ„æ»‹å‘³ï¼Œçˆ±ä¸Šå±‚æ¥¼ã€‚çˆ±ä¸Šå±‚æ¥¼ã€‚ä¸ºèµ‹æ–°è¯å¼ºè¯´æ„ã€‚è€Œä»Šè¯†å°½æ„æ»‹å‘³ï¼Œæ¬²è¯´è¿˜ä¼‘ã€‚æ¬²è¯´è¿˜ä¼‘ã€‚å´é“å¤©å‡‰å¥½ä¸ªç§‹ã€‚";
label.numberOfLines = 0;
label.userInteractionEnabled = YES;
[self.view addSubview:label];

NSMutableAttributedString * attributeString = [label.attributedText mutableCopy];
[attributeString addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(0, 10)];//è®¾ç½®é¢œè‰²
[attributeString addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:25] range:NSMakeRange(0, 5)];//è®¾ç½®å­—ä½“
[attributeString addAttribute:NSUnderlineStyleAttributeName value:@(NSUnderlineStyleSingle) range:NSMakeRange(0, 15)];//è®¾ç½®ä¸‹åˆ’çº¿
[attributeString addAttribute:NSStrokeWidthAttributeName value:@(2) range:NSMakeRange(0, 3)];//è®¾ç½®ç©ºå¿ƒå­—

//æ’å…¥å›¾ç‰‡1
UIImage * image1 = [UIImage imageNamed:@"fengye.png"];
NSTextAttachment * attachment1 = [[NSTextAttachment alloc] init];
attachment1.bounds = CGRectMake(0, 0, 60, 60);
attachment1.image = image1;
NSAttributedString * attachStr1 = [NSAttributedString attributedStringWithAttachment:attachment1];
[attributeString insertAttributedString:attachStr1 atIndex:1];

//æ’å…¥å›¾ç‰‡2
UIImage * image2 = [UIImage imageNamed:@"fengye.png"];
NSTextAttachment * attachment2 = [[NSTextAttachment alloc] init];
attachment2.bounds = CGRectMake(0, 0, 30, 30);
attachment2.image = image2;
NSAttributedString * attachStr2 = [NSAttributedString attributedStringWithAttachment:attachment2];
[attributeString insertAttributedString:attachStr2 atIndex:5];

label.attributedText = [attributeString copy];

//    TextView é€šè¿‡å¦‚ä¸‹å¯ä»¥è®¾ç½®ç¯ç»•å›¾ç‰‡çš„æ–‡å­—
//    UIBezierPath * path = [UIBezierPath bezierPathWithRect:rect];
//    textView.textContainer.exclusionPaths = @[path];
</code></pre>

<p><img src="http://andyfightting.github.io/myimg/ios/textkit1.png" alt="image" /></p>

<pre><code> NSAttributedStringå±æ€§keyçš„è¯´æ˜
 NSFontAttributeName                è®¾ç½®å­—ä½“å±æ€§ï¼Œé»˜è®¤å€¼ï¼šå­—ä½“ï¼šHelvetica(Neue) å­—å·ï¼š12
 NSForegroundColorAttributeName     è®¾ç½®å­—ä½“é¢œè‰²ï¼Œå–å€¼ä¸º UIColorå¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºé»‘è‰²
 NSBackgroundColorAttributeName     è®¾ç½®å­—ä½“æ‰€åœ¨åŒºåŸŸèƒŒæ™¯é¢œè‰²ï¼Œå–å€¼ä¸º UIColorå¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºnil, é€æ˜è‰²
 NSLigatureAttributeName            è®¾ç½®è¿ä½“å±æ€§ï¼Œå–å€¼ä¸ºNSNumber å¯¹è±¡(æ•´æ•°)ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰è¿ä½“å­—ç¬¦ï¼Œ1 è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„è¿ä½“å­—ç¬¦
 NSKernAttributeName                è®¾å®šå­—ç¬¦é—´è·ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰ï¼Œæ­£å€¼é—´è·åŠ å®½ï¼Œè´Ÿå€¼é—´è·å˜çª„
 NSStrikethroughStyleAttributeName  è®¾ç½®åˆ é™¤çº¿ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰
 NSStrikethroughColorAttributeName  è®¾ç½®åˆ é™¤çº¿é¢œè‰²ï¼Œå–å€¼ä¸º UIColor å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºé»‘è‰²
 NSUnderlineStyleAttributeName      è®¾ç½®ä¸‹åˆ’çº¿ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰ï¼Œæšä¸¾å¸¸é‡ NSUnderlineStyleä¸­çš„å€¼ï¼Œä¸åˆ é™¤çº¿ç±»ä¼¼
 NSUnderlineColorAttributeName      è®¾ç½®ä¸‹åˆ’çº¿é¢œè‰²ï¼Œå–å€¼ä¸º UIColor å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºé»‘è‰²
 NSStrokeWidthAttributeName         è®¾ç½®ç¬”ç”»å®½åº¦ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰ï¼Œè´Ÿå€¼å¡«å……æ•ˆæœï¼Œæ­£å€¼ä¸­ç©ºæ•ˆæœ
 NSStrokeColorAttributeName         å¡«å……éƒ¨åˆ†é¢œè‰²ï¼Œä¸æ˜¯å­—ä½“é¢œè‰²ï¼Œå–å€¼ä¸º UIColor å¯¹è±¡
 NSShadowAttributeName              è®¾ç½®é˜´å½±å±æ€§ï¼Œå–å€¼ä¸º NSShadow å¯¹è±¡
 NSTextEffectAttributeName          è®¾ç½®æ–‡æœ¬ç‰¹æ®Šæ•ˆæœï¼Œå–å€¼ä¸º NSString å¯¹è±¡ï¼Œç›®å‰åªæœ‰å›¾ç‰ˆå°åˆ·æ•ˆæœå¯ç”¨ï¼š
 NSBaselineOffsetAttributeName      è®¾ç½®åŸºçº¿åç§»å€¼ï¼Œå–å€¼ä¸º NSNumber ï¼ˆfloatï¼‰,æ­£å€¼ä¸Šåï¼Œè´Ÿå€¼ä¸‹å
 NSObliquenessAttributeName         è®¾ç½®å­—å½¢å€¾æ–œåº¦ï¼Œå–å€¼ä¸º NSNumber ï¼ˆfloatï¼‰,æ­£å€¼å³å€¾ï¼Œè´Ÿå€¼å·¦å€¾
 NSExpansionAttributeName           è®¾ç½®æ–‡æœ¬æ¨ªå‘æ‹‰ä¼¸å±æ€§ï¼Œå–å€¼ä¸º NSNumber ï¼ˆfloatï¼‰,æ­£å€¼æ¨ªå‘æ‹‰ä¼¸æ–‡æœ¬ï¼Œè´Ÿå€¼æ¨ªå‘å‹ç¼©æ–‡æœ¬
 NSWritingDirectionAttributeName    è®¾ç½®æ–‡å­—ä¹¦å†™æ–¹å‘ï¼Œä»å·¦å‘å³ä¹¦å†™æˆ–è€…ä»å³å‘å·¦ä¹¦å†™
 NSVerticalGlyphFormAttributeName   è®¾ç½®æ–‡å­—æ’ç‰ˆæ–¹å‘ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡(æ•´æ•°)ï¼Œ0 è¡¨ç¤ºæ¨ªæ’æ–‡æœ¬ï¼Œ1 è¡¨ç¤ºç«–æ’æ–‡æœ¬
 NSLinkAttributeName                è®¾ç½®é“¾æ¥å±æ€§ï¼Œç‚¹å‡»åè°ƒç”¨æµè§ˆå™¨æ‰“å¼€æŒ‡å®šURLåœ°å€
 NSAttachmentAttributeName          è®¾ç½®æ–‡æœ¬é™„ä»¶,å–å€¼ä¸ºNSTextAttachmentå¯¹è±¡,å¸¸ç”¨äºæ–‡å­—å›¾ç‰‡æ··æ’
 NSParagraphStyleAttributeName      è®¾ç½®æ–‡æœ¬æ®µè½æ’ç‰ˆæ ¼å¼ï¼Œå–å€¼ä¸º NSParagraphStyle å¯¹è±¡
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„SQLite]]></title>
    <link href="http://andyfightting.github.io/blog/2015/12/25/ios-sqlite/"/>
    <updated>2015-12-25T10:44:52+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/12/25/ios-sqlite</id>
    <content type="html"><![CDATA[<p><img src="http://andyfightting.github.io/myimg/ios/sqlite.png" alt="image" /></p>

<p><a href="http://www.sqlite.org/">SQLite</a>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å…³ç³»å‹æ•°æ®åº“ï¼Œåœ¨iOSå’ŒAndroidæ‰‹æœºä¸­éƒ½æœ‰ç”¨åˆ°ï¼ŒCè¯­è¨€çš„é¢å‘è¿‡ç¨‹çš„å‡½æ•°å¼ç¼–ç¨‹ã€‚<a href="https://github.com/woooooojianjie/SQLitePersistentObject">SQLitePersistentObject</a>å’Œ<a href="https://github.com/ccgus/fmdb">FMDB</a>æ¡†æ¶éƒ½æ˜¯åŸºäºSQLiteå¼€å‘çš„ã€‚SQLitePersistentObjectæ›´åƒæ˜¯ä¸ªORMæ¡†æ¶ï¼Œå®ƒæ˜¯ç”±Jeff LaMarcheåœ¨2008å¹´å¼€å‘çš„ï¼Œæ‰€ä»¥ä¸æ˜¯ARCçš„ï¼Œè¦ç”¨çš„è¯·åŠ ä¸Š<strong>-fno-objc-arc</strong>ï¼Œä¸”ä½œè€…å·²ç»æ²¡æœ‰ç»´æŠ¤äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¨èä½¿ç”¨æ›´åŠ å¹¿æ³›çš„FMDBã€‚<!--more--></p>

<h3>*SQLite</h3>

<p>æ·»åŠ ä¾èµ–åº“libsqlite3.tbdï¼Œç”¨SQLiteæ¥ä¸ªåŸç”Ÿçš„å¢åˆ æ”¹æŸ¥ã€‚ä¸‹é¢ä¸€æ¬¡æ€§å®Œæˆäº†åˆ›å»ºå¹¶æ‰“å¼€æ•°æ®åº“ï¼Œåˆ›å»ºè¡¨ï¼Œæ’å…¥ä¸€æ¡æ•°æ®ï¼ŒæŸ¥è¯¢æ•°æ®ï¼Œæœ€åå…³é—­æ•°æ®åº“ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSString* docsdir = [NSSearchPathForDirectoriesInDomains( NSDocumentDirectory, NSUserDomainMask, YES) lastObject];
</span><span class='line'>NSString* dbpath = [docsdir stringByAppendingPathComponent:@"user.sqlite"];
</span><span class='line'>sqlite3 *database;
</span><span class='line'>//åˆ›å»ºå¹¶æ‰“å¼€æ•°æ®åº“*****************
</span><span class='line'>if (sqlite3_open([dbpath UTF8String], &database) != SQLITE_OK) { //SQLITE_OK == 0
</span><span class='line'>   sqlite3_close(database);
</span><span class='line'>   NSAssert(0,@"æ•°æ®åº“æ‰“å¼€å¤±è´¥"); //è‹¥çŠ¶æ€ä¸æ˜¯0å°±æ‰“å¼€å¤±è´¥
</span><span class='line'>}
</span><span class='line'>//åˆ›å»ºè¡¨æ ¼*****************
</span><span class='line'>NSString *createSql = @"CREATE TABLE IF NOT EXISTS student (student_id INTEGER PRIMARY KEY ,student_name TEXT);";
</span><span class='line'>char *createError;
</span><span class='line'>//sqlite3_execè¿™ä¸ªæ–¹æ³•å¯ä»¥æ‰§è¡Œé‚£äº›æ²¡æœ‰è¿”å›ç»“æœçš„æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºã€æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ã€‚è¿™ä¸ªå‡½æ•°åŒ…å«äº†sqlite3_prepareè¿™ä¸ªå‡½æ•°çš„æ“ä½œï¼Œç›®çš„æ˜¯å°†UTF-8æ ¼å¼çš„SQLè¯­å¥è½¬æ¢ä¸ºç¼–è¯‘åçš„è¯­å¥
</span><span class='line'>if (sqlite3_exec(database, [createSql UTF8String], NULL, NULL, &createError) != SQLITE_OK) {
</span><span class='line'>    sqlite3_close(database);
</span><span class='line'>    NSAssert(0,@"åˆ›å»ºè¡¨é”™è¯¯ï¼š%s", createError);
</span><span class='line'>}
</span><span class='line'>//æ’å…¥æˆ–ä¿®æ”¹æ•°æ®*****************  
</span><span class='line'>char *update = "INSERT OR REPLACE INTO student VALUES (?,?)";  
</span><span class='line'>sqlite3_stmt *statement;  
</span><span class='line'>if (sqlite3_prepare_v2(database, update, -1, &statement, nil) == SQLITE_OK) {  
</span><span class='line'>    //å°†å€¼ä¿å­˜åˆ°æŒ‡å®šçš„åˆ—,åˆ—ä»1å¼€å§‹ï¼ï¼  
</span><span class='line'>    sqlite3_bind_int(statement, 1, 4);//1æ˜¯åˆ—ï¼Œ4æ˜¯student_id  
</span><span class='line'>    //ç¬¬å››ä¸ªå‚æ•°ä»£è¡¨ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­éœ€è¦ä¼ é€’çš„é•¿åº¦ã€‚å¯¹äºCå­—ç¬¦ä¸²æ¥è¯´ï¼Œ-1è¡¨ç¤ºä¼ é€’å…¨éƒ¨å­—ç¬¦ä¸²ã€‚ç¬¬äº”ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚æ‰§è¡Œååšå†…å­˜æ¸…é™¤å·¥ä½œã€‚  
</span><span class='line'>    sqlite3_bind_text(statement, 2, [@"studentName" UTF8String], -1, NULL);  
</span><span class='line'>}    
</span><span class='line'>if (sqlite3_step(statement) != SQLITE_DONE) {  
</span><span class='line'>    NSAssert(0,@"æ›´æ–°æ•°æ®å‡ºé”™");  
</span><span class='line'>}  
</span><span class='line'>sqlite3_finalize(statement);  
</span><span class='line'>//æŸ¥è¯¢æ•°æ®åº“***************** 
</span><span class='line'>NSString *querySql = @"SELECT * FROM student;";
</span><span class='line'>sqlite3_stmt *selectStmt;
</span><span class='line'>if (sqlite3_prepare_v2(database, [querySql UTF8String], -1, &selectStmt, nil) == SQLITE_OK) {
</span><span class='line'>    while (sqlite3_step(selectStmt) == SQLITE_ROW) {
</span><span class='line'>        int studentId = sqlite3_column_int(selectStmt, 0);//åé¢çš„æ•°å­—å¯¹åº”æ¯ä¸€åˆ—
</span><span class='line'>        char *cString = (char *)sqlite3_column_text(selectStmt, 1);
</span><span class='line'>        NSString* studentName = [[NSString alloc]initWithUTF8String:cString];
</span><span class='line'>        NSLog(@"student_id = %d   student_name = %@",studentId,studentName);
</span><span class='line'>    }
</span><span class='line'>    sqlite3_finalize(selectStmt);
</span><span class='line'>}
</span><span class='line'>sqlite3_close(database);//æœ€åå…³é—­æ•°æ®åº“</span></code></pre></td></tr></table></div></figure>


<p><img src="http://andyfightting.github.io/myimg/ios/select.png" alt="image" />
<img src="http://andyfightting.github.io/myimg/ios/table.png" alt="image" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„å¤šçº¿ç¨‹]]></title>
    <link href="http://andyfightting.github.io/blog/2015/12/22/thread/"/>
    <updated>2015-12-22T14:28:22+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/12/22/thread</id>
    <content type="html"><![CDATA[<p>1.ä»€ä¹ˆæ˜¯è¿›ç¨‹</p>

<p>è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…ã€‚
<img src="http://andyfightting.github.io/myimg/ios/jincheng.png" alt="image" /><!--more--></p>

<p>2.ä»€ä¹ˆæ˜¯çº¿ç¨‹</p>

<p>è¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡å¿…é¡»é€šè¿‡çº¿ç¨‹æ¥æ‰§è¡Œï¼Œ1ä¸ªè¿›ç¨‹è‡³å°‘ä¼šæœ‰1æ¡çº¿ç¨‹(ä¸»çº¿ç¨‹)ï¼Œè¿›ç¨‹çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œã€‚
<img src="http://andyfightting.github.io/myimg/ios/xiancheng.png" alt="image" /></p>

<p>çº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œåé¢çš„ä»»åŠ¡è¦ç­‰å‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œã€‚ä½†1ä¸ªè¿›ç¨‹é‡Œå¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹æ¥åŒæ—¶æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œå¯ä»¥æé«˜ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡ã€‚
<img src="http://andyfightting.github.io/myimg/ios/duox.png" alt="image" /></p>

<p>iOSä¸­æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹(UIçº¿ç¨‹)ï¼Œ<strong>åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI</strong>ã€‚å¦‚æœåœ¨è¿™ä¸ªä¸»çº¿ç¨‹é‡Œåšäº†è¿‡å¤šçš„è€—æ—¶æ“ä½œï¼Œå°±ä¼šé€ æˆUIå¡é¡¿ï¼Œæ‰€ä»¥ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†è€—æ—¶æ“ä½œã€‚å¸¸ç”¨çš„å¼€å¯å¤šçº¿ç¨‹æ–¹å¼æœ‰ä¸‰ç§ï¼šNSThread, NSOperation, GCDã€‚</p>

<h3>*NSThread</h3>

<p>NSThreadæ˜¯è½»é‡çº§çš„å¤šçº¿ç¨‹å¼€å‘ï¼Œç”¨èµ·æ¥ä¹Ÿä¸å¤æ‚ã€‚</p>

<p>åˆå§‹åŒ–æ–¹æ³•</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ (void)detachNewThreadSelector:(SEL)selector toTarget:(id)target withObject:(nullable id)argument;
</span><span class='line'>- (instancetype)initWithTarget:(id)target selector:(SEL)selector object:(nullable id)argument;</span></code></pre></td></tr></table></div></figure>


<p>å…¶ä»–æ–¹æ³•</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- (void)start;//å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶éç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå½“ç³»ç»Ÿè°ƒåº¦æ—¶æ‰çœŸæ­£æ‰§è¡Œ
</span><span class='line'>- (void)cancel;//å–æ¶ˆ
</span><span class='line'>+ (BOOL)isMainThread;//å½“å‰çº¿ç¨‹æ˜¯ä¸æ˜¯ä¸»çº¿ç¨‹
</span><span class='line'>+ (NSThread *)mainThread //è·å–ä¸»çº¿ç¨‹
</span><span class='line'>+ (NSThread *)currentThread;//è¿”å›å½“å‰çº¿ç¨‹
</span><span class='line'>+ (BOOL)isMultiThreaded;//æ˜¯ä¸æ˜¯å¤šçº¿ç¨‹
</span><span class='line'>+ (void)sleepUntilDate:(NSDate *)date;//ä¼‘çœ 
</span><span class='line'>+ (void)sleepForTimeInterval:(NSTimeInterval)ti;//ä¼‘çœ 
</span><span class='line'>+ (void)exit;//é€€å‡º
</span><span class='line'>+ (double)threadPriority;//ä¼˜å…ˆçº§
</span><span class='line'>+ (BOOL)setThreadPriority:(double)p;//è®¾ç½®ä¼˜å…ˆçº§ 0~1
</span><span class='line'>- (BOOL)isExecuting;//æ­£åœ¨æ‰§è¡Œ
</span><span class='line'>- (BOOL)isFinished;//æ‰§è¡Œå®Œæ¯•
</span><span class='line'>- (BOOL)isCancelled;//å·²ç»å–æ¶ˆ</span></code></pre></td></tr></table></div></figure>


<p>åœ¨å­çº¿ç¨‹é‡Œè¦è°ƒç”¨ä¸»çº¿ç¨‹æ¥æ›´æ–°UI,å¯ä»¥ç”¨NSObjectç±»åˆ«ä¸­çš„ OnMainThread æ–¹æ³•(å‰ä¸¤ä¸ª)ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@interface NSObject (NSThreadPerformAdditions)
</span><span class='line'>- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array;
</span><span class='line'>- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;
</span><span class='line'>- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array ;
</span><span class='line'>- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait ;
</span><span class='line'>- (void)performSelectorInBackground:(SEL)aSelector withObject:(nullable id)arg ;
</span><span class='line'>@end</span></code></pre></td></tr></table></div></figure>


<p>æŒ‰é¡ºåºå¯åŠ¨ï¼ˆstartï¼‰çš„çº¿ç¨‹ä¸ä¸€å®šæ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼Œç”±ç³»ç»Ÿè°ƒåº¦èµ„æºå†³å®šçš„ï¼ŒåŒæ ·çš„ä»£ç å¤šè¿è¡Œå‡ æ¬¡é¡ºåºå°±ä¸ä¸€æ ·äº†ã€‚
<img src="http://andyfightting.github.io/myimg/ios/shunxv.png" alt="image" />
<img src="http://andyfightting.github.io/myimg/ios/shunxv2.png" alt="image" /></p>

<h3>*NSOperation</h3>

<p>NSOperationæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä½¿ç”¨çš„è¯è¦<strong>ç»§æ‰¿å®ƒç„¶åå®ç°mainæ–¹æ³•</strong>ã€‚ä½†å®ƒæœ‰ä¸¤ä¸ªç°æˆå­ç±»ï¼šNSInvocationOperationå’ŒNSBlockOperationï¼Œåè€…ä½¿ç”¨Blockå½¢å¼è¿›è¡Œä»£ç ç»„ç»‡ï¼Œä½¿ç”¨ç›¸å¯¹æ–¹ä¾¿ã€‚</p>

<p>NSOperationè¦å’ŒNSOperationQueueä¸€èµ·ä½¿ç”¨ï¼Œåªè¦å°†ä¸€ä¸ªNSOperationå­ç±»å¯¹è±¡
æ”¾åˆ°NSOperationQueueé˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹å°±ä¼šä¾æ¬¡å¯åŠ¨ã€‚NSOperationQueueè´Ÿè´£ç®¡ç†ã€æ‰§è¡Œæ‰€æœ‰çš„NSOperationï¼Œå¯ä»¥æ›´åŠ å®¹æ˜“çš„ç®¡ç†çº¿ç¨‹æ€»æ•°å’Œæ§åˆ¶çº¿ç¨‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å¯ä»¥é€šè¿‡ç›‘å¬<strong>isFinished</strong>å±æ€§æ¥å¾—åˆ°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•é€šçŸ¥ã€‚</p>

<p>NSOperationç±»ä¸­çš„æ–¹æ³•</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- (void)start;
</span><span class='line'>- (void)cancel;
</span><span class='line'>- (void)main;//ç»§æ‰¿åè¦å®ç°å…·ä½“æ“ä½œ
</span><span class='line'>- (void)addDependency:(NSOperation *)op;//æ·»åŠ çº¿ç¨‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒAä¾èµ–Bï¼Œæ‰€ä»¥è¦Bå…ˆæ‰§è¡Œå®Œå†æ‰§è¡ŒA(åˆ‡è®°ä¸è¦å¾ªç¯ä¾èµ–...)
</span><span class='line'>- (void)removeDependency:(NSOperation *)op;//ç§»é™¤ä¾èµ–å…³ç³»
</span><span class='line'>- (void)waitUntilFinished;</span></code></pre></td></tr></table></div></figure>


<p>å‡ ä¸ªå±æ€§</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@property (readonly, getter=isCancelled) BOOL cancelled;
</span><span class='line'>@property (readonly, getter=isExecuting) BOOL executing;
</span><span class='line'>@property (readonly, getter=isFinished) BOOL finished;
</span><span class='line'>@property (readonly, getter=isConcurrent) BOOL concurrent;//å·²ç»å¼ƒç”¨ï¼Œç”¨ä¸‹é¢çš„'asynchronous'
</span><span class='line'>@property (readonly, getter=isAsynchronous) BOOL asynchronous;//æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ
</span><span class='line'>@property (readonly, getter=isReady) BOOL ready;</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºä»€ä¹ˆè¯´<strong>NSOperationè¦å’ŒNSOperationQueueä¸€èµ·ä½¿ç”¨</strong>å‘¢ï¼Ÿå› ä¸ºå¦‚æœNSOperationå­ç±»å¯¹è±¡ç›´æ¥startå¯åŠ¨çš„è¯ï¼Œå®ƒå…¶å®æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼
<img src="http://andyfightting.github.io/myimg/ios/error.png" alt="image" />
å¦‚æœæŠŠNSOperationå­ç±»å¯¹è±¡åŠ åˆ°NSOperationQueueä¸­,è¿™å°±ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œäº†ã€‚
<img src="http://andyfightting.github.io/myimg/ios/right.png" alt="image" /></p>

<p>NSInvocationOperationå°±ä¸¤ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œä¸¤ä¸ªå±æ€§&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- (nullable instancetype)initWithTarget:(id)target selector:(SEL)sel object:(nullable id)arg;
</span><span class='line'>- (instancetype)initWithInvocation:(NSInvocation *)inv;
</span><span class='line'>@property (readonly, retain) NSInvocation *invocation;
</span><span class='line'>@property (nullable, readonly, retain) id result;</span></code></pre></td></tr></table></div></figure>


<p>NSBlockOperationå°±ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå±æ€§&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+ (instancetype)blockOperationWithBlock:(void (^)(void))block;//åˆå§‹åŒ–
</span><span class='line'>- (void)addExecutionBlock:(void (^)(void))block;//åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡
</span><span class='line'>@property (readonly, copy) NSArray&lt;void (^)(void)&gt; *executionBlocks;//ä»»åŠ¡æ•°ç»„</span></code></pre></td></tr></table></div></figure>


<p><strong>addExecutionBlock</strong>ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œè€Œä¸æ˜¯åœ¨åŒä¸€ä¸ªå­çº¿ç¨‹ä¸­ã€‚
<img src="http://andyfightting.github.io/myimg/ios/blockThread.png" alt="image" /></p>

<p>NSOperationQueueä¸­çš„æ–¹æ³•åŠå±æ€§ï¼Œéƒ½å¾ˆå°‘&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- (void)cancelAllOperations;//å–æ¶ˆçº¿ç¨‹
</span><span class='line'>- (void)waitUntilAllOperationsAreFinished;
</span><span class='line'>+ (nullable NSOperationQueue *)currentQueue;
</span><span class='line'>+ (NSOperationQueue *)mainQueue;//è·å–ä¸»çº¿ç¨‹
</span><span class='line'>- (void)addOperation:(NSOperation *)op;//æ·»åŠ çº¿ç¨‹
</span><span class='line'>- (void)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)wait;//æ·»åŠ çº¿ç¨‹æ•°ç»„
</span><span class='line'>- (void)addOperationWithBlock:(void (^)(void))block;//æ·»åŠ çº¿ç¨‹block
</span><span class='line'>@property (readonly, copy) NSArray&lt;__kindof NSOperation *&gt; *operations;
</span><span class='line'>@property (readonly) NSUInteger operationCount;//æ± å­é‡Œå‡ ä¸ªçº¿ç¨‹
</span><span class='line'>@property NSInteger maxConcurrentOperationCount;//æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°
</span><span class='line'>@property (getter=isSuspended) BOOL suspended;//å»¶è¿Ÿ
</span><span class='line'>@property (nullable, copy) NSString *name;//çº¿ç¨‹åå­—
</span><span class='line'>@property NSQualityOfService qualityOfService;// ??
</span><span class='line'>@property (nullable, assign) dispatch_queue_t underlyingQueue;// ??</span></code></pre></td></tr></table></div></figure>


<h3>*GCD</h3>

<p>GCD(Grand Central Dispatch)æ˜¯åŸºäºCè¯­è¨€å¼€å‘çš„ä¸€å¥—å¤šçº¿ç¨‹å¼€å‘æœºåˆ¶ï¼Œä¹Ÿæ˜¯è‹¹æœå®˜æ–¹æ¨èçš„å¤šçº¿ç¨‹å¼€å‘æ–¹æ³•ã€‚æŠ½è±¡å±‚æ¬¡æœ€é«˜ï¼Œå½“ç„¶æ˜¯ç”¨èµ·æ¥ä¹Ÿæœ€ç®€å•ï¼Œåªæ˜¯å®ƒåŸºäºCè¯­è¨€å¼€å‘ï¼Œå¹¶ä¸åƒNSOperationæ˜¯é¢å‘å¯¹è±¡çš„å¼€å‘ï¼Œè€Œæ˜¯å®Œå…¨é¢å‘è¿‡ç¨‹çš„ï¼Œæœ€æ˜¾è‘—çš„ä¼˜ç‚¹å°±æ˜¯å®ƒå¯¹äºå¤šæ ¸è¿ç®—æ›´åŠ æœ‰æ•ˆã€‚</p>

<p>GCDä¸­çš„é˜Ÿåˆ—åˆ†ä¸º<strong>ä¸²è¡Œé˜Ÿåˆ—</strong>å’Œ<strong>å¹¶å‘é˜Ÿåˆ—</strong>ä¸¤ç±»ï¼Œéƒ½æ˜¯å¼‚æ­¥çš„ï¼š</p>

<p>ä¸²è¡Œé˜Ÿåˆ—ï¼šåªæœ‰ä¸€ä¸ªå­çº¿ç¨‹ï¼ŒåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œæŒ‰æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>

<p>å¹¶å‘é˜Ÿåˆ—ï¼šæœ‰å¤šä¸ªå­çº¿ç¨‹ï¼Œæ“ä½œè¿›æ¥ä¹‹åå®ƒä¼šå°†è¿™äº›é˜Ÿåˆ—å®‰æ’åœ¨å¯ç”¨çš„å¤„ç†å™¨ä¸Šï¼ŒåŒæ—¶ä¿è¯å…ˆè¿›æ¥çš„ä»»åŠ¡ä¼˜å…ˆå¤„ç†ã€‚</p>

<p><strong>1. ä¸²è¡Œé˜Ÿåˆ—, åœ¨åŒä¸€ä¸ªå­çº¿ç¨‹é‡Œ, é¡ºåºæ‰§è¡Œï¼</strong> å…³é”®å­— <em>DISPATCH_QUEUE_SERIAL</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_queue_t serialQueue = dispatch_queue_create("myThreadQueue", DISPATCH_QUEUE_SERIAL);
</span><span class='line'>    for (int i=0; i&lt;5; ++i) {
</span><span class='line'>        dispatch_async(serialQueue, ^{
</span><span class='line'>            [self doSomething:i];
</span><span class='line'>        });
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p><img src="http://andyfightting.github.io/myimg/ios/gcd1.png" alt="image" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//æ›´æ–°UIç•Œé¢,æ­¤å¤„è°ƒç”¨äº†GCDä¸»çº¿ç¨‹é˜Ÿåˆ—çš„æ–¹æ³•
</span><span class='line'>dispatch_queue_t mainQueue = dispatch_get_main_queue();
</span><span class='line'>  dispatch_sync(mainQueue, ^{
</span><span class='line'>    [self updateUI];
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p><strong>2. å¹¶å‘é˜Ÿåˆ—, åœ¨ä¸åŒçš„å­çº¿ç¨‹é‡Œ, å¹¶å‘æ‰§è¡Œ</strong> å…³é”®å­— <em>DISPATCH_QUEUE_CONCURRENT</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> //æ–¹å¼ä¸€ï¼šdispatch_queue_t serialQueue=dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
</span><span class='line'> dispatch_queue_t serialQueue=dispatch_queue_create("myThreadQueue", DISPATCH_QUEUE_CONCURRENT);
</span><span class='line'>    for (int i=0; i&lt;5; ++i) {
</span><span class='line'>        dispatch_async(serialQueue, ^{
</span><span class='line'>            [self doSomething:i];
</span><span class='line'>        });
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p><img src="http://andyfightting.github.io/myimg/ios/ybbf.png" alt="image" />
è‹¥æŠŠä¸Šé¢çš„<strong>dispatch_async</strong>æ”¹æˆ<strong>dispatch_sync</strong>,è¿™å°±æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œäº†ï¼å³ä½¿åœ¨å¼‚æ­¥å¹¶å‘é˜Ÿåˆ—ä¸­ï¼
<img src="http://andyfightting.github.io/myimg/ios/hah.png" alt="image" />
æ‰€ä»¥ï¼ŒGCDè‹¥è¦<strong>å¼‚æ­¥å¤šçº¿ç¨‹</strong>æ‰§è¡Œå¿…é¡»ï¼šä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—<strong>DISPATCH_QUEUE_CONCURRENT</strong> å¹¶ä¸” æ–¹æ³•æ˜¯å¼‚æ­¥æ–¹æ³•(dispatch_async)!! å¦åˆ™ï¼Œè¦ä¹ˆåœ¨<strong>å­çº¿ç¨‹</strong>é‡Œé¡ºåºæ‰§è¡Œ(ä¸²è¡Œé˜Ÿåˆ—ï¼Œå¼‚æ­¥æ–¹æ³•(dispatch_async))ï¼Œè¦ä¹ˆåœ¨<strong>ä¸»çº¿ç¨‹</strong>é‡Œé¡ºåºæ‰§è¡Œï¼ï¼(åŒæ­¥æ–¹æ³•(dispatch_sync)ï¼Œä¸ç®¡ä¸²è¡Œè¿˜æ˜¯å¹¶å‘é˜Ÿåˆ—)</p>

<p>è§£å†³å¼‚æ­¥æƒ…å†µä¸‹æŠ¢å èµ„æºé—®é¢˜ï¼Œå¯ä»¥åŠ é”<strong>NSLock</strong>ã€‚è·å–èµ„æºæ—¶lockä½ï¼Œè·å–å®Œèµ„æºåunlockã€‚æˆ–è€…ç”¨<strong>@synchronized</strong>åŒ…è£¹è·å–èµ„æºä»£ç ã€‚</p>

<p>å‡ ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œåå¾—åˆ°é€šçŸ¥</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dispatch_group_t group = dispatch_group_create();
</span><span class='line'>dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0), ^{
</span><span class='line'>    //å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ä¸€
</span><span class='line'>});
</span><span class='line'>dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0), ^{
</span><span class='line'>    //å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡äºŒ
</span><span class='line'>});
</span><span class='line'>dispatch_group_notify(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0), ^{
</span><span class='line'>    //æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†å¾—åˆ°é€šçŸ¥
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSOperationQueue *queue = [[NSOperationQueue alloc]init];
</span><span class='line'>NSBlockOperation *blockOperation=[NSBlockOperation blockOperationWithBlock:^{
</span><span class='line'>     //å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ä¸€
</span><span class='line'> }];
</span><span class='line'> [blockOperation addExecutionBlock:^{
</span><span class='line'>     //å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡äºŒ
</span><span class='line'> }];
</span><span class='line'> [blockOperation setCompletionBlock:^{
</span><span class='line'>     //æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†
</span><span class='line'> }];
</span><span class='line'> [queue addOperation:blockOperation];</span></code></pre></td></tr></table></div></figure>


<h3>*æ€»ç»“</h3>

<p>1.æ— è®ºä½¿ç”¨å“ªç§æ–¹æ³•è¿›è¡Œå¤šçº¿ç¨‹å¼€å‘ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åå¹¶ä¸ä¸€å®šç«‹å³æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå…·ä½“ä»€ä¹ˆæ—¶å€™ç”±ç³»ç»Ÿè°ƒåº¦ï¼ŒCPUç©ºé—²æ—¶å°±ä¼šæ‰§è¡Œã€‚</p>

<p>2.æ›´æ–°UIåº”è¯¥åœ¨ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰ä¸­è¿›è¡Œï¼Œå¸¸ç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>-(void)performSelectorOnMainThread:(SEL)aSelector withObject:(id)arg waitUntilDone:(BOOL)wait</p>

<p>-(void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(id)arg waitUntilDone:(BOOL) wait;//ä¼ é€’[NSThread mainThread]</p>

<p>[[NSOperationQueue mainQueue] addOperationWithBlock:^{ }];</p>

<p>dispatch_sync(dispatch_get_main_queue(), ^{ });</p>

<p>3.NSThreadé€‚åˆè½»é‡çº§å¤šçº¿ç¨‹å¼€å‘ï¼Œè¦æ‰‹åŠ¨æ§åˆ¶çº¿ç¨‹ï¼Œçº¿ç¨‹æ€»æ•°æ— æ³•æ§åˆ¶ï¼Œæ— æ³•çº¿ç¨‹ä¾èµ–ã€‚</p>

<p>4.å¯¹äºç®€å•çš„å¤šçº¿ç¨‹å¼€å‘å»ºè®®ä½¿ç”¨NSObjectçš„æ‰©å±•æ–¹æ³•å®Œæˆï¼Œè€Œä¸å¿…ä½¿ç”¨NSThreadã€‚</p>

<p>5.å¯ä»¥ä½¿ç”¨NSThreadçš„currentThreadæ–¹æ³•å–å¾—å½“å‰çº¿ç¨‹ï¼Œä½¿ç”¨ sleepForTimeInterval:æ–¹æ³•è®©å½“å‰çº¿ç¨‹ä¼‘çœ ã€‚</p>

<p>6.NSOperationè¿›è¡Œå¤šçº¿ç¨‹å¼€å‘å¯ä»¥æ§åˆ¶çº¿ç¨‹æ€»æ•°åŠçº¿ç¨‹ä¾èµ–å…³ç³»ã€‚</p>

<p>7.åˆ›å»ºä¸€ä¸ªNSOperationä¸åº”è¯¥ç›´æ¥è°ƒç”¨startæ–¹æ³•, å¦‚æœç›´æ¥startåˆ™ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨, è€Œæ˜¯åº”è¯¥æ”¾åˆ°NSOperationQueueä¸­å¯åŠ¨ã€‚</p>

<p>8.ç›¸æ¯”NSInvocationOperationæ¨èä½¿ç”¨NSBlockOperationï¼Œä»£ç ç®€å•ï¼ŒåŒæ—¶ç”±äºé—­åŒ…æ€§ä½¿å®ƒæ²¡æœ‰ä¼ å‚é—®é¢˜ã€‚</p>

<p>9.NSOperationæ˜¯å¯¹GCDé¢å‘å¯¹è±¡çš„å°è£…ï¼Œä½†æ˜¯GCDåŸºäºCè¯­è¨€å¼€å‘ï¼Œæ•ˆç‡å´æ›´é«˜. å»ºè®®å¦‚æœä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–å…³ç³»æˆ–è€…æƒ³è¦ç›‘å¬ä»»åŠ¡å®ŒæˆçŠ¶æ€çš„æƒ…å†µä¸‹ä¼˜å…ˆé€‰æ‹©NSOperationå¦åˆ™ä½¿ç”¨GCDã€‚</p>

<p>10.åœ¨GCDä¸­ä¸²è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¢«å®‰æ’åˆ°ä¸€ä¸ªå•ä¸€çš„å­çº¿ç¨‹ä¸­ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ§åˆ¶æ‰§è¡Œé¡ºåºï¼›å¹¶å‘é˜Ÿåˆ—åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆå‰ææ˜¯ä½¿ç”¨å¼‚æ­¥æ–¹æ³•ï¼‰ï¼Œé¡ºåºæ§åˆ¶ç›¸å¯¹å¤æ‚ï¼Œä½†æ˜¯æ›´é«˜æ•ˆã€‚</p>

<p>11.åœ¨GDCä¸­ä¸€ä¸ªæ“ä½œæ˜¯å¤šçº¿ç¨‹æ‰§è¡Œè¿˜æ˜¯å•çº¿ç¨‹æ‰§è¡Œå–å†³äºå½“å‰é˜Ÿåˆ—ç±»å‹å’Œæ‰§è¡Œæ–¹æ³•ï¼Œåªæœ‰é˜Ÿåˆ—ç±»å‹ä¸ºå¹¶å‘é˜Ÿåˆ—å¹¶ä¸”ä½¿ç”¨å¼‚æ­¥æ–¹æ³•æ‰§è¡Œæ—¶æ‰èƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¹¶å‘æ‰§è¡Œã€‚</p>

<p>12.ç›¸æ¯”ä½¿ç”¨NSLockï¼Œ@synchronizedæ›´åŠ ç®€å•ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®¾è®¡æ¨¡å¼]]></title>
    <link href="http://andyfightting.github.io/blog/2015/12/19/desigin-pattern/"/>
    <updated>2015-12-19T21:51:06+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/12/19/desigin-pattern</id>
    <content type="html"><![CDATA[<p>æˆ‘ç†è§£çš„è®¾è®¡æ¨¡å¼éƒ½æ˜¯ä¸ºäº†è®©ä»£ç æ¨¡å—åŒ–ï¼Œç»“æ„åŒ–ï¼Œå„å¸å…¶èŒï¼Œå†æŠŠå„ä¸ªæ¨¡å—é€šè¿‡"æ¥å£"ç»„åˆèµ·æ¥ã€‚å°è£…å˜åŒ–ï¼›å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ï¼›é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®ç°ç¼–ç¨‹ï¼›ä¸ºäº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›ï¼›å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>

<h3>1.MVCæ¨¡å¼</h3>

<p>çœ‹å›¾å°±å¯ä»¥äº†ï¼Œç®€æ´æ˜äº†~
<img src="http://andyfightting.github.io/myimg/other/mvc.png" alt="image" /><!--more--></p>

<h3>2.ç­–ç•¥æ¨¡å¼</h3>

<p>æ¯”å¦‚æœ‰ä¸ªçˆ¶ç±»æœ‰é£è¡ŒåŠŸèƒ½ï¼Œç„¶åæœ‰å¾ˆå¤šå­ç±»çš„é£è¡ŒåŠŸèƒ½å„ä¸ä¸€æ ·ï¼Œå¦‚æœå»ç»§æ‰¿çˆ¶ç±»ç„¶ååˆ†åˆ«å®ç°ä¸åŒçš„é£è¡Œè¡Œä¸ºï¼Œè¿™å°±å‘çˆ¹äº†&hellip;å…·ä½“åšæ³•åº”è¯¥æ˜¯ï¼šæŠŠé£è¡Œè¡Œä¸ºå®Œå…¨ç‹¬ç«‹å‡ºæ¥æˆä¸€ä¸ªInterfaceï¼Œç„¶åä¸åŒçš„é£è¡Œè¡Œä¸ºå†åœ¨å•ç‹¬çš„ç±»ä¸­å®ç°ï¼Œä¸åŒçš„å­ç±»è¦ä¸åŒçš„é£è¡Œè¡Œä¸ºçš„è¯å°±å–å¯¹åº”çš„è¡Œä¸ºå®ç°å¯¹è±¡ã€‚</p>

<p>çˆ¶ç±»ï¼š</p>

<pre><code>public class Duck {//çˆ¶ç±»

public FlyInterface flyInterface;//è¡Œä¸ºçš„æ¥å£æˆå‘˜å˜é‡

public void performFly(){//ç»Ÿä¸€è°ƒç”¨çš„é£è¡Œæ–¹æ³•
    flyInterface.fly();
}

public void setFlyInterface(FlyInterface fi){//åŠ¨æ€æ”¹å˜é£è¡Œè¡Œä¸º
    flyInterface = fi;
  }
}
</code></pre>

<p>è¡Œä¸ºæ¥å£ï¼š</p>

<pre><code>public interface FlyInterface { //è¡Œä¸ºæ¥å£
void fly();//è¦å®ç°çš„è¡Œä¸ºæ–¹æ³•
}
</code></pre>

<p>è¡Œä¸ºçš„ä¸€ç§å…·ä½“å®ç°ï¼š</p>

<pre><code>public class FlyPatternOne implements FlyInterface {//é£è¡Œè¡Œä¸ºçš„ä¸€ç§å®ç°ï¼Œå¯ä»¥æœ‰å¾ˆå¤šä¸ªä¸åŒçš„å®ç°
@Override
public void fly() {
    //è¿™é‡Œæ˜¯å…·ä½“é£è¡Œè¡Œä¸ºä»£ç 

  }
}
</code></pre>

<p>æŸä¸€ä¸ªå­ç±»ï¼š</p>

<pre><code>public class SubDuck extends Duck{
public SubDuck(){
    //é»˜è®¤çš„é£è¡Œè¡Œä¸ºï¼Œä¸åŒçš„å­ç±»æœ‰ä¸åŒçš„é£è¡Œè¡Œä¸ºï¼Œå¦‚ FlyPatternTwo FlyPatternThree...ç­‰
    flyInterface = new FlyPatternOne();
  }
}
</code></pre>

<p><img src="http://andyfightting.github.io/myimg/other/chelue.png" alt="image" /></p>

<p>1,æ‰¾å‡ºå¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å°è£…èµ·æ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åˆåœ¨ä¸€èµ·ã€‚</p>

<p>2.é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p>

<p>3.å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ã€‚</p>

<h3>3.è§‚å¯Ÿè€…æ¨¡å¼</h3>

<p>å¥½å¥½çœ‹å›¾å§ï¼ŒæŠŠå®ƒè½¬åŒ–ä¸ºå…·ä½“ä»£ç åŠ æ·±ç†è§£
<img src="http://andyfightting.github.io/myimg/other/guanCha0.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/guanCha1.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/guanCha2.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/guanCha3.jpg" alt="image" /></p>

<p>çœ‹å®Œä¸Šé¢ä¾‹å­ï¼Œä¸‹é¢çš„è®¾è®¡å›¾ä¹Ÿæ›´å¥½ç†è§£äº†ã€‚
<img src="http://andyfightting.github.io/myimg/other/guanCha4.jpg" alt="image" /></p>

<p>ä½¿ç”¨Javaå†…ç½®çš„è§‚å¯Ÿè€…æ¨¡å¼
<img src="http://andyfightting.github.io/myimg/other/guanCha5.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/guanCha6.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/guanCha7.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/guanCha8.jpg" alt="image" /></p>

<p>Swingä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼
<img src="http://andyfightting.github.io/myimg/other/guanCha9.jpg" alt="image" /></p>

<p>è¦ç‚¹
<img src="http://andyfightting.github.io/myimg/other/guanCha10.jpg" alt="image" /></p>

<h3>4.è£…é¥°æ¨¡å¼</h3>

<p>åŠ¨æ€çš„å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œç”¨å¯¹è±¡ç»„åˆçš„æ–¹å¼æ¥è§£å†³ç»§æ‰¿æ»¥ç”¨çš„é—®é¢˜ã€‚åˆ©ç”¨ç»§æ‰¿è®¾è®¡å­ç±»çš„è¡Œä¸ºæ˜¯åœ¨ç¼–è¯‘æ—¶é™æ€å†³å®šçš„ï¼Œè€Œä¸”æ‰€æœ‰çš„å­ç±»éƒ½ä¼šç»§æ‰¿åˆ°ç›¸åŒçš„è¡Œä¸ºã€‚å¦‚æœåˆ©ç”¨ç»„åˆçš„åšæ³•æ‰©å±•å¯¹è±¡çš„è¡Œä¸ºï¼Œå°±å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„è¿›è¡Œæ‰©å±•ã€‚ç±»åº”è¯¥å¤šæ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹å¯ä»¥æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</p>

<p>è£…é¥°ç€å’Œè¢«è£…é¥°ç€å¿…é¡»æ˜¯åŒä¸€ç±»å‹ï¼Œæ‰€ä»¥é€šè¿‡ç»§æ‰¿æ¥å®ç°ã€‚è¿™é‡Œçš„ç»§æ‰¿æ˜¯ç”¨æ¥è¾¾åˆ°â€œç±»å‹ä¸€è‡´â€çš„ï¼Œè€Œä¸æ˜¯ä¸ºäº†é€šè¿‡ç»§æ‰¿å¾—åˆ°â€œè¡Œä¸ºâ€ã€‚â€œè¡Œä¸ºâ€æ¥è‡ªè£…é¥°ç€å’ŒåŸºç¡€ç»„ä»¶ï¼Œå…¶ä»–ä¸è£…é¥°ç€ä¹‹é—´çš„ç»„åˆå…³ç³»ã€‚
<img src="http://andyfightting.github.io/myimg/other/zhuangShi.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi0.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi1.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi2.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi3.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi4.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi5.jpg" alt="image" />
<img src="http://andyfightting.github.io/myimg/other/zhuangShi6.jpg" alt="image" /></p>

<h3>5.å·¥å‚æ¨¡å¼</h3>

<p>å½“æ¯æ¬¡â€œnewâ€çš„æ—¶å€™éƒ½ä¼šå®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è¿™æ˜¯ç”¨çš„å®ç°ç¼–ç¨‹è€Œä¸æ˜¯æ¥å£ç¼–ç¨‹ã€‚â€œå·¥å‚â€å°±æ˜¯ä¸€ä¸ªä¸“é—¨è´Ÿè´£äº§ç”Ÿå¯¹è±¡çš„ä¸€ä¸ªç±»ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AndroidåŸºæœ¬å­˜å‚¨]]></title>
    <link href="http://andyfightting.github.io/blog/2015/11/23/androidsave/"/>
    <updated>2015-11-23T19:48:52+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/11/23/androidsave</id>
    <content type="html"><![CDATA[<p>Androidæ•°æ®ä¿å­˜æ–¹å¼æœ‰ï¼š æ–‡ä»¶å­˜å‚¨, SharedPreference, Sqlite, SDå¡å­˜å‚¨ã€‚</p>

<h3>* æ–‡ä»¶å­˜å‚¨</h3>

<p>ä¸å¯¹å­˜å‚¨æ•°æ®åšä»»ä½•æ ¼å¼åŒ–å¤„ç†ï¼ŒåŸå°ä¸åŠ¨çš„ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨äºä¿å­˜ç®€å•çš„æ–‡æœ¬æ•°æ®æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ã€‚</p>

<p>Contextæœ‰ä¸ª<code>openFileOutput()</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªï¼šæ–‡ä»¶åï¼Œ<strong>ä¸è¦åŒ…å«è·¯å¾„</strong>ï¼Œç¬¬äºŒä¸ªï¼šæ“ä½œæ–¹å¼ï¼Œæœ‰ä¸¤ç§ï¼Œ<code>MODE_PRIVATE</code>(è¦†ç›–åŸæ–‡ä»¶å†…å®¹),<code>MODE_APPEND</code>(åœ¨åŸæ–‡ä»¶å°¾éƒ¨è¿½åŠ å†…å®¹)ï¼Œé»˜è®¤ç¬¬ä¸€ç§ã€‚æ–‡ä»¶é»˜è®¤ä¿å­˜åœ¨ï¼š<code>/data/data/packageName/files/</code>è¿™ä¸ªç›®å½•é‡Œã€‚</p>

<pre><code> public static void saveText(Context context,String fileName,String text){
    FileOutputStream outputStream ;
    BufferedWriter bufferedWriter = null;
    try {
       outputStream = context.openFileOutput(fileName,Context.MODE_PRIVATE);
        bufferedWriter = new BufferedWriter(new OutputStreamWriter(outputStream));
        bufferedWriter.write(text);
    }catch (IOException e){
        e.printStackTrace();
    }finally {
        try {
            if (bufferedWriter != null){
                bufferedWriter.close();
            }
        }catch (IOException e){
            e.printStackTrace();
        }
    }
}
</code></pre>

<!--more-->


<p>åœ¨æˆ‘è°ƒç”¨ <code>MyTool.saveText(this,"myFile","Hello World!");</code>åå‡ºç°äº†å¦‚ä¸‹æ–‡ä»¶ï¼Œç‚¹ç”»åœˆåœˆçš„åœ°æ–¹å¯ä»¥å¯¼å‡ºåˆ°ç”µè„‘ä¸Šæ‰“å¼€æŸ¥çœ‹ã€‚
<img src="http://andyfightting.github.io/myimg/android/helloSave.png" alt="img" /></p>

<p>è¯»æ–‡ä»¶</p>

<pre><code>public static String getText(Context context,String fileName){
    FileInputStream inputStream;
    BufferedReader bufferReader = null;
    StringBuilder contentBuilder = new StringBuilder();
    try {
        inputStream = context.openFileInput(fileName);
        bufferReader = new BufferedReader(new InputStreamReader(inputStream));
        String lineText = "";
        while ((lineText = bufferReader.readLine()) != null){
            contentBuilder.append(lineText);
        }
    }catch (IOException e){
        e.printStackTrace();
    }finally {
       if (bufferReader != null){
           try {
               bufferReader.close();
           }catch (IOException e){
               e.printStackTrace();
           }
       }
    }
    return contentBuilder.toString();
}
</code></pre>

<p>åˆ é™¤æ–‡ä»¶</p>

<pre><code>public static void deleteFile(Context context, String fileName) {
    String filePath = context.getFilesDir()+"/"+fileName;
    File file = new File(filePath);
    if (file.exists()){
        file.delete();
    }
}
</code></pre>

<h3>* SharedPreference</h3>

<p>ç”¨key-valueé”®å€¼å¯¹çš„æ–¹å¼ä¿å­˜æ•°æ®ï¼Œé€‚ç”¨äºä¿å­˜åº”ç”¨é…ç½®ä¹‹ç±»çš„ç®€å•ä¿¡æ¯ã€‚æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼å¾—åˆ°<code>SharedPreferences</code>å¯¹è±¡ï¼Œå¾—åˆ°å®ä¾‹åè°ƒç”¨å®ä¾‹çš„<code>edit()</code>æ–¹æ³•å¾—åˆ°<code>SharedPreferences.Editor</code>å¯¹è±¡ï¼Œç”¨è¯¥<code>Editor</code>å¯¹è±¡<code>putBoolean("key",value)``putString("key",value)</code>ç­‰æ–¹æ³•æ·»åŠ æ•°æ®ï¼Œç„¶åè°ƒç”¨<code>apply()</code>å³å¯ã€‚è·å–æ•°æ®å°±è°ƒç”¨å¯¹åº”çš„<code>getBoolean("key")``getString("key")</code>ã€‚æ–‡ä»¶ä¿å­˜åœ¨<code>/data/data/packageName/shared_prefs/</code>ç›®å½•ä¸‹ã€‚</p>

<ol>
<li><p>Contextä¸­çš„<code>getSharedPreferences()</code>æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ–‡ä»¶å(ä¸è¦åŒ…å«è·¯å¾„)ï¼Œä¸€ä¸ªæ“ä½œæ¨¡å¼ï¼Œæœ‰<code>MODE_PRIVATE</code>(è¦†ç›–åŸæ–‡ä»¶),<code>MODE_MULTI_PROCESS</code>(å¤šä¸ªè¿›ç¨‹å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æƒ…å†µ)é»˜è®¤ç¬¬ä¸€ç§ã€‚</p></li>
<li><p>Activityä¸­ä¹Ÿæœ‰ä¸ªä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•<code>getSharedPreferences()</code>ï¼Œå®ƒåªæ¥æ”¶ä¸€ä¸ªæ“ä½œæ¨¡å¼ä½œä¸ºå‚æ•°ï¼Œ<strong>è‡ªåŠ¨å°†ç±»åä½œä¸ºæ–‡ä»¶å</strong>ã€‚</p></li>
<li><p>PreferenceManagerç±»ä¸­çš„<code>getDefaultSharedPreferences()</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°<code>Context</code>,è‡ªåŠ¨å°†åº”ç”¨ç¨‹åºçš„<code>packageName</code>ä¸ºå‰ç¼€çš„æ–‡ä»¶å,å¦‚æˆ‘çš„åŒ…åæ˜¯<code>com.suguiming.myandroid</code>,ç”Ÿæˆçš„æ–‡ä»¶åå°±æ˜¯<code>com.suguiming.myandroid_preferences.xml</code>ã€‚</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SharedPreferences sharedPreferences =    PreferenceManager.getDefaultSharedPreferences(context);
</span><span class='line'>  SharedPreferences.Editor editor = sharedPreferences.edit();
</span><span class='line'>    editor.putString("name","guimingsu");
</span><span class='line'>    editor.putInt("age", 18);
</span><span class='line'>    editor.apply();</span></code></pre></td></tr></table></div></figure>


<p><img src="http://andyfightting.github.io/myimg/android/shareP.png" alt="img" />
<img src="http://andyfightting.github.io/myimg/android/shareV.png" alt="img" /></p>

<p>ä¸€èˆ¬éƒ½æŠŠå®ƒåšæˆä¸€ä¸ªå·¥å…·ç±»</p>

<pre><code>public class SharedPreUtil {

public static final String FILE_NAME = "shared_preference";

public static void put(Context context, String key, Object value) {
    SharedPreferences sharedPreferences = context.getSharedPreferences(FILE_NAME, Context.MODE_PRIVATE);
    SharedPreferences.Editor editor = sharedPreferences.edit();

    if (value instanceof String) {
        editor.putString(key, (String) value);
    } else if (value instanceof Integer) {
        editor.putInt(key, (Integer) value);
    } else if (value instanceof Boolean) {
        editor.putBoolean(key, (Boolean) value);
    } else if (value instanceof Float) {
        editor.putFloat(key, (Float) value);
    } else if (value instanceof Long) {
        editor.putLong(key, (Long) value);
    } else {
        editor.putString(key, value.toString());
    }
    editor.apply();
}

public static Object get(Context context, String key, Object defaultValue) {
    SharedPreferences sharedPreferences = context.getSharedPreferences(FILE_NAME, Context.MODE_PRIVATE);

    if (defaultValue instanceof String) {
        return sharedPreferences.getString(key, (String) defaultValue);
    } else if (defaultValue instanceof Integer) {
        return sharedPreferences.getInt(key, (Integer) defaultValue);
    } else if (defaultValue instanceof Boolean) {
        return sharedPreferences.getBoolean(key, (Boolean) defaultValue);
    } else if (defaultValue instanceof Float) {
        return sharedPreferences.getFloat(key, (Float) defaultValue);
    } else if (defaultValue instanceof Long) {
        return sharedPreferences.getLong(key, (Long) defaultValue);
    }
    return null;
}

public static void remove(Context context, String key) {
    SharedPreferences sharedPreferences = context.getSharedPreferences(FILE_NAME, Context.MODE_PRIVATE);
    SharedPreferences.Editor editor = sharedPreferences.edit();
    editor.remove(key);
    editor.apply();
}

public static void removeAll(Context context) {
    SharedPreferences sharedPreferences = context.getSharedPreferences(FILE_NAME, Context.MODE_PRIVATE);
    SharedPreferences.Editor editor = sharedPreferences.edit();
    editor.clear();
    editor.apply();
}

}
</code></pre>

<h3>* SQLite</h3>

<p>å…³ç³»å‹çš„è½»é‡çº§æ•°æ®åº“ï¼Œä¿å­˜å¤æ‚æˆ–è€…å¤§æ•°æ®ç”¨è¿™ä¸ªï¼Œæ”¯æŒæ ‡å‡†çš„SQLè¯­æ³•ã€‚</p>

<p>åˆ›å»ºæ•°æ®åº“ï¼šAndroidæä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»<code>SQLiteOpenHelper</code>ï¼Œæˆ‘ä»¬ç»§æ‰¿å®ƒé‡å†™é‡Œé¢çš„ä¸¤ä¸ªæ–¹æ³•<code>onCreate()</code>,<code>onUpdate()</code>æ¥åˆ›å»ºå’Œæ›´æ–°æ•°æ®åº“è¡¨ç»“æ„ã€‚åˆ›å»ºçš„æ•°æ®åº“ä¼šä¿å­˜åœ¨ <code>/data/data/packageName/databases/</code>ç›®å½•ä¸‹ã€‚é€šè¿‡<code>getReadableDatabase</code>æˆ–è€…<code>getWritableDatabase</code>éƒ½å¯å¾—åˆ°å¯è¯»å†™çš„æ•°æ®åº“ï¼Œä½†å¦‚æœæ•°æ®åº“ä¸å¯å†™æ—¶(å¦‚ç£ç›˜å·²æ»¡)ï¼Œ<code>getWritableDatabase</code>ä¼šæŠ¥é”™ï¼Œ<code>getReadableDatabase</code>ä¸ä¼šã€‚</p>

<p>è°ƒç”¨<code>MySqliteHelper.getHelper(mainActivity).getReadableDatabase();</code>ä¸€ä¸‹æ•°æ®åº“å°±å»ºå¥½äº†ï¼Œä¸‹æ¬¡å†è°ƒç”¨å°±ä¸ä¼šå†åˆ›å»ºäº†ã€‚</p>

<pre><code>public class MyDatabaseHelper extends SQLiteOpenHelper {

private static MyDatabaseHelper helper;
private static final String DB_NAME = "myAndroid.db";

public MyDatabaseHelper(Context context){
    super(context, DB_NAME, null, 2);//2 æ•°æ®åº“version,ä¿®æ”¹æ•°æ®åº“ç”¨
}

@Override
public void onCreate(SQLiteDatabase db) {
    db.execSQL(create_dog);
    db.execSQL(create_cat);
}

@Override
public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
    //æ›´æ–°è¡¨æ‰ç”¨,è¿™é‡Œå‡è®¾åœ¨ ç‰ˆæœ¬2 ä¸­è¦æ·»åŠ  cat è¡¨,æ³¨æ„ï¼šswitch ä¸è¦ break !!
    switch (newVersion){
        case 2:
            db.execSQL(create_cat);
        default:
    }
}
//è·å– helper å•ä¾‹
public static synchronized MyDatabaseHelper getHelper(Context context) {
    context = context.getApplicationContext();
    if (helper == null) {
        synchronized (MyDatabaseHelper.class) {
            if (helper == null)
                helper = new MyDatabaseHelper(context);
        }
    }
    return helper;
}

//-------------sql----------------------------
    public static final String create_dog = "create table dog ("
            +"id integer primary key autoincrement,"
            +"name text,"
            +"age integer,"
            +"weight real)";

    public static final String create_cat = "create table cat ("
            +"id integer primary key autoincrement,"
            +"name text,"
            +"age integer,"
            +"weight real)";
}
</code></pre>

<p><img src="http://andyfightting.github.io/myimg/android/mydb.png" alt="img" />  <br/>
æŠŠæ•°æ®åº“å¯¼å‡ºåˆ°æ¡Œé¢ï¼Œç”¨<a href="http://www.sqlitemanager.org/">SQLiteManager</a>æ‰“å¼€æŸ¥çœ‹
<img src="http://andyfightting.github.io/myimg/android/mytable.png" alt="img" /></p>

<p>æ•°æ®å¢ï¼Œåˆ ï¼Œæ”¹ï¼ŒæŸ¥çš„æœ€ç®€å•çš„ä¾‹å­</p>

<pre><code>public class DogDao {
private static final String TABLE_NAME = "dog";

public static void add(Context context,Dog dog){
    SQLiteDatabase db =  MyDatabaseHelper.getHelper(context).getWritableDatabase();
    ContentValues values = new ContentValues();
    values.put("name",dog.getName());
    values.put("age",dog.getAge());
    values.put("weight",dog.getWeight());
    db.insert(TABLE_NAME, null, values);
}

public static void update(Context context,Dog dog){
    SQLiteDatabase db =  MyDatabaseHelper.getHelper(context).getWritableDatabase();
    ContentValues values = new ContentValues();
    values.put("name",dog.getName());
    values.put("age",dog.getAge());
    values.put("weight",dog.getWeight());
    db.update(TABLE_NAME, values, null, null);
}

public static void deleteAll(Context context){
    SQLiteDatabase db =  MyDatabaseHelper.getHelper(context).getWritableDatabase();
    db.delete(TABLE_NAME, null, null);
}

public static List&lt;Dog&gt; getAll(Context context){
    SQLiteDatabase db =  MyDatabaseHelper.getHelper(context).getWritableDatabase();
    Cursor cursor = db.query(TABLE_NAME, null, null, null, null, null, null);
    List&lt;Dog&gt; dogList = new ArrayList&lt;&gt;();
    if (cursor.moveToFirst()){
        do {
            Dog dog = new Dog();
            dog.setName(cursor.getString(cursor.getColumnIndex("name")));
            dog.setAge(cursor.getInt(cursor.getColumnIndex("age")));
            dog.setWeight(cursor.getFloat(cursor.getColumnIndex("weight")));
            dogList.add(dog);
        }while (cursor.moveToNext());
    }
    cursor.close();
    return dogList;
}

//äº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚
public static void transactionTest(Context context){
    SQLiteDatabase db =  MyDatabaseHelper.getHelper(context).getWritableDatabase();
    db.beginTransaction();
    try {
        //æ•°æ®å¤„ç†....

        db.setTransactionSuccessful();
    }catch (Exception e){
        e.printStackTrace();
    }finally {
        db.endTransaction();
    }
}
}
</code></pre>

<p>ä¹Ÿå¯ä»¥ç”¨ Android SDK <code>/platform-tools</code>æ–‡ä»¶å¤¹ä¸­è‡ªå¸¦çš„<code>adb</code>å·¥å…·æ¥æ“ä½œé“¾æ¥åœ¨ç”µè„‘çš„æ‰‹æœºæˆ–è€…æ¨¡æ‹Ÿå™¨é‡Œçš„æ•°æ®åº“ã€‚</p>

<p>ä½†è¦å…ˆé…ç½®ä¸€ä¸‹ï¼ŒMacçš„é…ç½®å¦‚ä¸‹ï¼Œåœ¨ç»ˆç«¯ä¾æ¬¡è¾“å…¥ <code>cd ~</code> <code>touch .bash_profile</code> <code>open -e .bash_profile</code>è¿™æ—¶ä¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ·»åŠ <code>export PATH=${PATH}:è¿™é‡Œæ˜¯platform-toolsæ–‡ä»¶çš„è·¯å¾„</code>ä¿å­˜å…³é—­ï¼Œ
ç„¶å<code>source .bash-profile</code>åˆ·æ–°ï¼Œç„¶åè¾“å…¥<code>adb shell</code>å°±å¯ä»¥å¼€å§‹ç”¨äº†ã€‚
<img src="http://andyfightting.github.io/myimg/android/pzadb.png" alt="img" />
<img src="http://andyfightting.github.io/myimg/android/pzadb2.png" alt="img" />
å¦‚æŸ¥çœ‹æ•°æ®åº“<code>cd /data/data/packageName/databases</code> <code>l</code>åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“
<img src="http://andyfightting.github.io/myimg/android/adbtable.png" alt="img" /></p>

<h3>* SDå¡å­˜å‚¨</h3>

<p>SDå¡å­˜å‚¨å’Œæ–‡ä»¶å­˜å‚¨å·®ä¸å¤šï¼Œåªä¸è¿‡æ˜¯æ‰‹æœºå¤–éƒ¨çš„å­˜å‚¨ç©ºé—´ï¼Œå®¹é‡æ›´å¤§ï¼Œä¸è¿‡åœ¨ä½¿ç”¨çš„æ—¶å€™è¦åˆ¤æ–­SDå¡å¯ä¸å¯ä»¥ç”¨ã€‚</p>

<pre><code>public class SDCardUtil {

// é»˜è®¤éƒ½ä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹
private static final String DEFAULT_DIR = "ProData/";

public static boolean isEnable() {
    return Environment.getExternalStorageState().equals(android.os.Environment.MEDIA_MOUNTED);
}

public static long getTotalMB() {
    if (!isEnable())
        return 0;
    File path = Environment.getExternalStorageDirectory();
    StatFs stat = new StatFs(path.getPath());
    long blockSize = stat.getBlockSizeLong();
    long availableBlocks = stat.getBlockCountLong();
    return (availableBlocks * blockSize) / 1024 / 1024;
}

public static long getAvailableMB() {
    if (!isEnable())
        return 0;
    File path = Environment.getExternalStorageDirectory();
    StatFs stat = new StatFs(path.getPath());
    long blockSize = stat.getBlockSizeLong();
    long availableBlocks = stat.getAvailableBlocksLong();
    return (availableBlocks * blockSize) / 1024 / 1024;
}

public static long getAvailableByte() {
    if (!isEnable())
        return 0;
    File path = Environment.getExternalStorageDirectory();
    StatFs stat = new StatFs(path.getPath());
    long blockSize = stat.getBlockSizeLong();
    long availableBlocks = stat.getAvailableBlocksLong();
    return availableBlocks * blockSize;
}

// è·¯å¾„ï¼š/storage/sdcard0/
public static String getSDCardPath() {
    if (!isEnable())
        return "";
    return Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator;
}


public static File createDir(String directoryName) {
    //å»ºé»˜è®¤æ–‡ä»¶å¤¹
    String defaultDir = getSDCardPath() + DEFAULT_DIR;
    File defaultFile = new File(defaultDir);
    if (!defaultFile.exists()) {
        defaultFile.mkdir();
    }

    String dirPath = getFilePath(directoryName);
    File dirFile = new File(dirPath);
    if (!dirFile.exists()) {
        dirFile.mkdir();
    }
    return dirFile;
}

public static File createFile(String fileName) {
    try {
        //å»ºé»˜è®¤æ–‡ä»¶å¤¹
        String dirPath = getSDCardPath() + DEFAULT_DIR;
        File directory = new File(dirPath);
        if (!directory.exists()) {
            directory.mkdir();
        }

        //å†åœ¨é»˜è®¤æ–‡ä»¶å¤¹é‡Œå»ºæ–‡ä»¶
        File file = new File(getFilePath(fileName));
        if (!file.exists()) {
            file.createNewFile();
        }
        return file;
    } catch (Exception e) {
        e.printStackTrace();
    }
    return null;
}

public static String getFilePath(String fileName) {
    return getSDCardPath() + DEFAULT_DIR + fileName;
}

public static boolean isFileExist(String fileName) {
    File file = new File(getFilePath(fileName));
    return file.exists();
}

public static boolean saveByte(String fileName, byte[] bytes) {
    if (bytes == null) {
        return false;
    }

    OutputStream output = null;
    try {
        if (bytes.length &lt; getAvailableByte()) {
            File file = createFile(fileName);//è¿™é‡Œé¢å·²ç»å»ºäº†é»˜è®¤æ–‡ä»¶å¤¹
            output = new BufferedOutputStream(new FileOutputStream(file));
            output.write(bytes);
            output.flush();
            return true;
        }
    } catch (IOException e1) {
        e1.printStackTrace();
    } finally {
        try {
            if (output != null) {
                output.close();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    return false;
}

public static byte[] getByte(String fileName) {
    File file = new File(getFilePath(fileName));
    if (!file.exists()) {
        return null;
    }
    InputStream inputStream = null;
    try {
        inputStream = new BufferedInputStream(new FileInputStream(file));
        byte[] data = new byte[inputStream.available()];
        inputStream.read(data);
        return data;
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        try {
            if (inputStream != null) {
                inputStream.close();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    return null;
}

public static boolean saveBitmap(Bitmap bitmap, String bitmapName) {
    if (bitmap == null) {
        return false;
    }
    //å»ºé»˜è®¤æ–‡ä»¶å¤¹
    String dirPath = getSDCardPath() + DEFAULT_DIR;
    File directory = new File(dirPath);
    if (!directory.exists()) {
        directory.mkdir();
    }

    File file = new File(getFilePath(bitmapName));
    BufferedOutputStream output = null;
    try {
        output = new BufferedOutputStream(new FileOutputStream(file));
        bitmap.compress(Bitmap.CompressFormat.JPEG, 80, output);
        output.flush();
        output.close();
        return true;
    } catch (IOException e1) {
        e1.printStackTrace();
    } finally {
        try {
            if (output != null) {
                output.close();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    return false;
}

public static Bitmap getBitmap(String bitmapName) {
    String myJpgPath = getFilePath(bitmapName);
    BitmapFactory.Options options = new BitmapFactory.Options();
    return BitmapFactory.decodeFile(myJpgPath, options);
}

public static void removeFile(String fileName) {
    String filePath = getFilePath(fileName);
    File file = new File(filePath);
    if (file.exists()) {
        file.delete();
    }
}

public static void removeFile(File file) {
    if (file.isFile()) {
        file.delete();
        return;
    }
    if (file.isDirectory()) {
        File[] childFiles = file.listFiles();
        if (childFiles == null || childFiles.length == 0) {
            file.delete();
            return;
        }

        for (int i = 0; i &lt; childFiles.length; i++) {
            removeFile(childFiles[i]);
        }
        file.delete();
    }
}

public static void removeAll() {
    String filePath = getSDCardPath() + DEFAULT_DIR;
    File file = new File(filePath);
    if (file.exists()) {
        removeFile(file);
    }

    //å†å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹
    File directory = new File(filePath);
    if (!directory.exists()) {
        directory.mkdir();
    }
  }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Studioæ’ä»¶]]></title>
    <link href="http://andyfightting.github.io/blog/2015/11/22/studioplugin/"/>
    <updated>2015-11-22T14:10:45+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/11/22/studioplugin</id>
    <content type="html"><![CDATA[<h3>* Logger</h3>

<p>æ¨èä¸€æ¬¾æ‰“å°å·¥å…·<a href="https://github.com/orhanobut/logger">Logger</a>,æ¯”è‡ªå¸¦çš„æ‰“å°æ•ˆæœæ›´å¥½ï¼Œä¸»è¦æ˜¯jsonæ‰“å°æ˜¯æ ¼å¼åŒ–çš„ï¼Githubä¸Šå†™çš„åœ°å€<code>compile 'com.github.orhanobut:logger:1.12'</code>æˆ‘ä¸‹è½½å¤±è´¥ï¼Œæˆ‘ç”¨çš„æ˜¯<code>compile 'com.orhanobut:logger:1.11'</code>ã€‚
<img src="http://andyfightting.github.io/myimg/android/logger.png" alt="img" />
æ‰“å°é¢œè‰²å¯ä»¥åœ¨preferenceé‡Œè®¾ç½®ï¼Œè¦å…ˆ<code>Save as</code>ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åæŠŠå³è¾¹çš„<code>Use inherited attributes</code>å–æ¶ˆï¼Œç„¶åå°±å¯ä»¥é€‰æ‹©é¢œè‰²äº†<!--more-->
<img src="http://andyfightting.github.io/myimg/android/logColor.png" alt="img" /></p>

<h3>* Sexy Editor</h3>

<p>è®¾ç½®ç¼–è¾‘åŒºåŸŸèƒŒæ™¯å›¾çš„, è¿™æ ·æ•²ä»£ç ä¹Ÿæ›´æœ‰åŠ›æ°”æ‹‰~~å“ˆå“ˆ</p>

<p><img src="http://andyfightting.github.io/myimg/android/screen.png" alt="img" /></p>

<p>æ€ä¹ˆæ·»åŠ æ’ä»¶ï¼Ÿæœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼<code>install JetBrains plugin</code>,<code>Browse repositories</code>,<code>install plugin from disk</code>ã€‚<code>Sexy Editor</code>æ˜¯ç”¨ç¬¬äºŒç§æ–¹å¼æ·»åŠ ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/add_plugin.png" alt="img" /></p>

<p>æˆ‘çš„<code>sexy editor</code>è®¾ç½®</p>

<p><img src="http://andyfightting.github.io/myimg/android/sexy_editor.png" alt="img" /></p>

<h3>* Macä¸‹çš„å¿«æ·é”®</h3>

<p>Macä¸­çš„æ ‡è¯†ï¼š<code>âŒ˜:command</code>, <code>âŒƒ:control</code>, <code>â‡§:shift</code>, <code>âŒ¥:alt/option</code></p>

<p><code>âŒ˜ + âŒ¥ + L</code>: ä»£ç å¯¹é½æ ¼å¼åŒ–</p>

<p><code>^ + âŒ¥ + O</code>: é™¤å»æ— æ•ˆçš„importå¼•ç”¨</p>

<p><code>F1</code>: æŸ¥çœ‹æ–‡æ¡£</p>

<p><code>F2</code>: å®šä½åˆ°æœªè¢«ä½¿ç”¨çš„æˆå‘˜</p>

<p><code>F3</code>: æ·»åŠ ä¹¦ç­¾</p>

<p><code>F4</code>: å®šä½åˆ°å£°æ˜å¤„</p>

<p><code>â‡§ + F6</code>: æ–‡ä»¶é‡å‘½å</p>

<p><code>âŒ˜ + F12</code>: æ˜¾ç¤ºå†…éƒ¨æˆå‘˜</p>

<p><code>âŒ˜ + â‡§ + F7</code>: ä»£ç é«˜äº®</p>

<p><code>âŒ¥ + â</code>: æ·»åŠ ç¼ºå°‘çš„import</p>

<p><code>âŒ˜ + delete</code>: åˆ é™¤æ•´è¡Œ</p>

<p><code>âŒ˜ + N</code>: ç”Ÿæˆä»£ç ï¼Œgetter setter ç­‰</p>

<p><code>âŒƒ + H</code>: æŸ¥çœ‹ç±»çš„å±‚çº§å…³ç³»</p>

<p><code>âŒ˜ + U</code>: æŸ¥çœ‹çˆ¶ç±»çš„åŒåæ–¹æ³•</p>

<p><code>âŒ˜ + J</code>: å¿«æ·æ’å…¥å¸¸ç”¨ä»£ç ç‰‡æ®µ</p>

<p><code>âŒ¥ + â‡§ + â†‘æˆ–â†“</code>: ä¸Šä¸‹ç§»åŠ¨å…‰æ ‡æ‰€åœ¨çš„è¡Œ</p>

<p><code>âŒ˜ + â‡§ + â†‘æˆ–â†“</code>: ä¸Šä¸‹ç§»åŠ¨æ•´ä¸ªæ–¹æ³•å—</p>

<p><code>âŒ˜ + âŒ¥ + â</code>: å½“å‰è¡Œä¸Šé¢æ’å…¥ä¸€è¡Œ</p>

<p><code>âŒ˜ + â‡§ + U</code>: å¤§å°å†™è½¬åŒ–</p>

<p><code>âŒ˜ + E</code>: æŸ¥çœ‹æ‰“å¼€è¿‡çš„æ–‡ä»¶</p>

<p><code>âŒƒ + T</code>: é‡æ„é¢æ¿</p>

<p><code>âŒƒ + O</code>: é€‰æ‹©è¦é‡å†™æˆ–è€…è¦å®ç°çš„æ–¹æ³•</p>

<p><code>âŒ˜ + O</code>: å¿«é€Ÿæœç´¢class</p>

<p><code>âŒ˜ + â‡§ + O</code>: å¿«é€Ÿæœç´¢file</p>

<p><code>âŒ˜ + â‡§ + F</code>: å…¨å±€æœç´¢</p>

<p><code>âŒ˜ + â‡§ + R</code>: å…¨å±€æ›¿æ¢</p>

<p><code>âŒ˜ + +æˆ–-</code>: å±•å¼€æˆ–è€…æ”¶èµ·ä»£ç å—</p>

<p><code>âŒ˜ + /</code>: æ³¨é‡Š //</p>

<p><code>âŒ˜ + âŒ¥ + /</code>: æ³¨é‡Š /**/</p>

<p><code>âŒ¥ + â</code>: æç¤ºé”™è¯¯è§£å†³æ–¹æ³•</p>

<p>å¯èƒ½ä¼šæœ‰äººè§‰å¾—ä¸ºå•¥é‡å‘½å<code>â‡§ + F6</code>æ²¡ååº”å‘¢ï¼Ÿè·Ÿ F1 ~ F12 æœ‰å…³çš„éƒ½æ²¡ååº”&hellip;</p>

<p>å› ä¸ºMacç³»ç»Ÿé»˜è®¤æ²¡æœ‰å¯ç”¨å®ƒä»¬&hellip;åœ¨ç³»ç»Ÿè®¾ç½®ï¼Œé”®ç›˜é€‰é¡¹é‡Œé€‰ä¸­å°±å¯ä»¥äº†ã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/keyf.png" alt="img" /></p>

<p>å½“ç„¶å¯ä»¥è®¾ç½®è‡ªå·±å–œæ¬¢çš„å¿«æ·é”®ï¼Œæˆ‘è‡ªå·±æŠŠè¿è¡Œå’Œè°ƒè¯•æ”¹æˆäº†<code>âŒ˜ + R</code>å’Œ<code>âŒ˜ + D</code></p>

<p><img src="http://andyfightting.github.io/myimg/android/keymap.png" alt="img" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android åŸºç¡€çŸ¥è¯†]]></title>
    <link href="http://andyfightting.github.io/blog/2015/11/21/androidBase0/"/>
    <updated>2015-11-21T09:26:15+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/11/21/androidBase0</id>
    <content type="html"><![CDATA[<h3>* Activityå¯åŠ¨æ¨¡å¼</h3>

<p>åœ¨AndroidMainfest.xmlé‡Œçš„activityé‡Œè®¾ç½®android:launchMode = â€œxxxâ€</p>

<p><strong>standard:</strong> é»˜è®¤æ¨¡å¼ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ”¾åœ¨æ ˆé¡¶ï¼Œå³ä½¿æ ˆé‡Œå·²ç»æœ‰äº†</p>

<p><strong>singleTop:</strong> å·²ç»åœ¨<strong>æ ˆé¡¶</strong>äº†å°±ä¸åˆ›å»ºï¼Œå¦åˆ™è¿˜æ˜¯ä¼šåˆ›å»ºï¼Œå³ä½¿æ ˆé‡Œå·²ç»æœ‰äº†</p>

<p><strong>singleTask:</strong> åœ¨æ´»åŠ¨æ ˆä¸­æœ‰äº†å°±ä¸åˆ›å»ºï¼Œç›´æ¥æ¨åˆ°æ ˆé¡¶ï¼Œ<strong>åœ¨å®ƒä¹‹å‰çš„å…¨éƒ¨ä¼šè¢«æŒ¤å‡ºæ ˆ</strong>ï¼Œè‹¥æ´»åŠ¨æ ˆä¸­æ²¡æœ‰å°±åˆ›å»º</p>

<p><strong>singleInstance:</strong> ä¼šåˆ›å»ºä¸€ä¸ª<strong>æ–°çš„æ´»åŠ¨æ ˆ</strong>æŠŠè‡ªå·±æ”¾è¿›å»</p>

<h3>* éšæ—¶éšåœ°é€€å‡ºç¨‹åº</h3>

<p>åœ¨ä»»ä½•é¡µé¢éƒ½å¯ä»¥è¢«è¸¢ä¸‹çº¿çš„å®ç°æŠ€å·§</p>

<p>åˆ›å»ºä¸€ä¸ªæ”¶é›†Activityçš„ç®¡ç†ç±»ï¼Œåœ¨BaseActivityçš„<code>onCreate()</code>æ–¹æ³•ä¸­æ·»åŠ <code>ActivityManager.addActivity(this)</code>,åœ¨<code>onDestroy</code>æ–¹æ³•ä¸­æ·»åŠ <code>ActivityManager.removeActivity(this)</code>ã€‚ç„¶ååœ¨ä»»ä½•è¦å¼ºé€€çš„åœ°æ–¹è°ƒç”¨<code>ActivityManager.finishAllActivity()</code>ã€‚<!--more--></p>

<pre><code>public class ActivityManager {

public static List&lt;Activity&gt; activityList = new ArrayList&lt;&gt;();

public static void addActivity(Activity activity){
    activityList.add(activity);
  }

public static void removeActivity(Activity activity){
    activityList.remove(activity);
  }

public static void finishAllActivity(){
    for (Activity activity : activityList){
        if (!activity.isFinishing()){
            activity.finish();
        }
    }
    activityList.clear();
  }
}
</code></pre>

<h3>* Activityè·³è½¬</h3>

<p>ä¸€èˆ¬æˆ‘ä»¬æ˜¯ç”¨å¦‚ä¸‹çš„æ–¹å¼è·³è½¬ï¼Œéœ€è¦çŸ¥é“ä¸‹ä¸€ä¸ªActivityè¦ç”¨å“ªäº›å‚æ•°ï¼Œå¤šäººå¼€å‘å¯èƒ½æœ‰äº›ä¸ä¾¿ã€‚</p>

<pre><code>Intent intent = new Intent(OneActivity.thi,TwoActivity.class);
intent.putExtra("key","value");
startActivity(intent);
</code></pre>

<p>å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªActivityä¸­æŠŠéœ€è¦çš„å‚æ•°æš´éœ²å‡ºæ¥ã€‚</p>

<pre><code>public static void actionStart(Activity activity,String param){
  Intent intent = new Intent(activity,TwoActivity.class);
  intent.putExtra("key","param");
  activity.startActivity(intent);
  activity.finish();
}
</code></pre>

<h3>* ListViewçš„æ­£ç¡®ä½¿ç”¨æ–¹å¼</h3>

<p>å®ç°äº†itemçš„å¤ç”¨ï¼Œè¿™æ ·æ•ˆç‡æœ€å¥½ï¼ŒArrayAdapteræºç ä¸­å°±æ˜¯è¿™æ ·å¼„çš„ã€‚ArrayAdapteræŠŠBaseAdapteråŒ…è£…äº†ä¸€éï¼Œå®ç°äº†<code>getCount</code>,<code>getItem</code>,<code>getItemId</code>ï¼Œæ‰€ä»¥è¿™äº›æˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨å†å†™äº†ï¼Œåªé‡å†™ä¸ª<code>getView</code>å°±å¯ä»¥ã€‚</p>

<pre><code>public class UserAdapter extends ArrayAdapter&lt;User&gt; {

private int layoutId;
public UserAdapter(Context context, int resourceId, List&lt;User&gt; objects){
      super(context,resourceId,objects);
      layoutId = resourceId;
}

@Override
public View getView(int position, View convertView, ViewGroup parent){

    User user = getItem(position);
    ViewHolder viewHolder;
    View layoutView;

    if (convertView == null){
        layoutView = LayoutInflater.from(getContext()).inflate(layoutId,null);
        viewHolder = new ViewHolder();
        viewHolder.headImage = (ImageView)layoutView.findViewById(R.id.head_img);
        viewHolder.nameTv = (TextView)layoutView.findViewById(R.id.name_tv);
        layoutView.setTag(viewHolder);
    }else {
       layoutView = convertView;
       viewHolder = (ViewHolder)layoutView.getTag();
    }
    //--------åœ¨ä¸‹é¢èµ‹å€¼ ----------------
    viewHolder.headImage.setImageResource(user.getHeadImgId());
    viewHolder.nameTv.setText(user.getName());

    return layoutView;
}

class ViewHolder{
    ImageView headImage;
    TextView nameTv;
  }
}
</code></pre>

<h3>* px,dpi,dp,density</h3>

<p>Androidè§„å®šï¼šå¦‚æœæ‰‹æœºä¸€è‹±å¯¸é•¿åº¦ä¸Šæœ‰160ä¸ªpxï¼Œé‚£ä¹ˆæ‰‹æœºçš„dpiå°±æ˜¯160,æ­¤æ—¶1dp==1pxï¼Œå³density=1ã€‚æ‰€ä»¥å¦‚æœä¸€è‹±å¯¸é•¿åº¦ä¸Šæœ‰320ä¸ªpxçš„è¯ï¼Œé‚£ä¹ˆæ‰‹æœºçš„dpiå°±æ˜¯320ï¼Œæ­¤æ—¶1dp==2px,å³density=2ã€‚</p>

<p>ç»“è®ºï¼šå³ç›¸åŒå¤§å°çš„æ‰‹æœºä¸Šçš„dpä¸ªæ•°æ˜¯ä¸å˜çš„ï¼Œå¦‚æœç›¸åŒå¤§å°çš„æ‰‹æœºåƒç´ ä¸åŒçš„è¯ï¼Œåªä¼šå½±å“dipå’Œdensityçš„å€¼,æ‰€ä»¥æˆ‘ä»¬é€‚é…æ‰‹æœºçš„æ—¶å€™ç”¨çš„é•¿åº¦å•ä½è¦ç”¨ &mdash;- <code>dp</code></p>

<pre><code>public static int getScreenWidthPx(Context context){
    return  context.getResources().getDisplayMetrics().widthPixels;
}

public static int getScreenHeightPx(Context context){
    return  context.getResources().getDisplayMetrics().heightPixels;
}

public static float getXdpi(Context context){
    return  context.getResources().getDisplayMetrics().xdpi;
}

public static float getYdpi(Context context){
    return  context.getResources().getDisplayMetrics().ydpi;
}

public static float getDensity(Context context){
   return context.getResources().getDisplayMetrics().density;
}
</code></pre>

<h3>* 9-patchå›¾ç‰‡</h3>

<p>1ï¼Œåœ¨<code>ä¸Š</code>è¾¹ç»˜åˆ¶çš„<code>å‚ç›´åŒºåŸŸ</code>ä¼šè¢«<code>æ°´å¹³æ‹‰ä¼¸</code>ï¼Œåœ¨<code>å·¦</code>è¾¹ç»˜åˆ¶çš„<code>æ¨ªå‘åŒºåŸŸ</code>ä¼šè¢«<code>å‚ç›´æ‹‰ä¼¸</code>ã€‚</p>

<p>2ï¼Œåœ¨<code>ä¸‹</code>è¾¹å’Œ<code>å³</code>è¾¹ç»˜åˆ¶çš„<code>äº¤å‰åŒºåŸŸ</code>æ˜¯å†…å®¹æ”¾ç½®çš„åŒºåŸŸã€‚</p>

<p><img src="http://andyfightting.github.io/myimg/android/9patch.jpg" alt="img" /></p>

<h3>* Fragment</h3>

<p>åœ¨fragmenté‡Œå¯ä»¥ç”¨<code>getActivity()</code>å¾—åˆ°ä¸ä¹‹å…³è”çš„Activityã€‚<code>FragmentTransaction</code>çš„å®ä¾‹å¯ä»¥è°ƒç”¨<code>addToBackStack(null)</code>æ–¹æ³•æŠŠè¿™ä¸ªäº‹åŠ¡æ·»åŠ åˆ°è¿”å›æ ˆä¸­ï¼Œè¿™æ ·ç‚¹å‡»è¿”å›å°±æ˜¯å›åˆ°äº‹åŠ¡å¤„ç†ä¹‹å‰çš„çŠ¶æ€,è€Œä¸æ˜¯é€€å‡ºActivityã€‚fragmentä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡ä¸ä¹‹å…±åŒå…³è”çš„Activityæ¥è½¬è¾¾ã€‚</p>

<p>fragmentçš„ç”Ÿå‘½å‘¨æœŸä¸Activityç±»ä¼¼ï¼Œåªä¸è¿‡æ¯”Activityå¤šäº†<code>onAttach()</code>,<code>onCreateView()</code>,<code>onActivityCreated()</code>,<code>onDestroyView()</code>,<code>onDetach()</code>ã€‚</p>

<p>ç”±ç”Ÿåˆ°æ­»ä¾æ¬¡æ˜¯ï¼š<code>onAttach()</code>, <code>onCreate()</code>,<code>onCreateView()</code>,<code>onActivityCreated()</code>,<code>onStart()</code>,<code>onResume()</code>,<code>onPause()</code>,<code>onStop()</code>,<code>onDestroyView()</code>,<code>onDestroy()</code>,<code>onDetach()</code>ã€‚</p>

<p>ä»è¿”å›æ ˆå›æ¥åæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯<code>onActivityCreated()</code>,è€ŒActivityçš„è½®å›åæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯<code>onRestart()</code>,ç„¶åå†<code>onStart()</code>,<code>onResume()</code>ã€‚</p>

<p>åŒä¸€ä¸ªActivityæ€æ ·è®©å®ƒåœ¨ä¸åŒå¤§å°çš„è®¾å¤‡è‡ªåŠ¨åŠ è½½ä¸åŒçš„å¸ƒå±€æ–‡ä»¶å‘¢ï¼Ÿç”¨<code>é™å®šç¬¦</code>,å³åœ¨<code>res</code>ä¸‹å»º<code>layout-large</code>æ–‡ä»¶å¤¹æˆ–è€…ä¸åŒé™å®šç¬¦çš„æ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢æ”¾<code>åŒå</code>çš„å¸ƒå±€æ–‡ä»¶ã€‚é™å®šç¬¦æœ‰ï¼š<code>small</code>,<code>normal</code>,<code>large</code>,<code>xlarge</code>ä»¥åŠåˆ†è¾¨ç‡é™å®šç¬¦ï¼š<code>ldpi</code>:120dpiä»¥ä¸‹ï¼Œ<code>mdpi</code>:120-160dpiï¼Œ<code>hdpi</code>:160-240dpi,<code>xhdpi</code>:240-320dpiï¼Œä»¥åŠæ–¹å‘é™å®šç¬¦ï¼š<code>land</code>:æ¨ªå±,<code>port</code>:ç«–å±ã€‚</p>

<p>è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œ<code>large</code>ï¼Œå¤§ï¼Œåˆ°åº•å¤šå¤§ç®—å¤§å‘¢ï¼Ÿå¯ä»¥è‡ªå·±å®šä¹‰è¿™ä¸ªè¾¹ç•Œå€¼ã€‚å¦‚<code>layout-sm600</code>,å°±æ˜¯<code>å®½åº¦</code>å¤§äº600<code>dp</code>çš„è®¾å¤‡å«å¤§ï¼Œå¦åˆ™å«å°ã€‚<code>sm</code>çš„æ„æ€æ˜¯ï¼š<code>smallest width</code>ã€‚</p>

<h3>* Broadcast å¹¿æ’­</h3>

<p>è§åçŸ¥æ„ï¼Œå³å‘ä¸€ä¸‹æ¶ˆæ¯ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½å¯ä»¥æ”¶åˆ°ã€‚å¹¿æ’­æœ‰ä¸¤ç§ï¼šå¼‚æ­¥æ‰§è¡Œçš„å¹¿æ’­ å’Œ æŒ‰é¡ºåºæ‰§è¡Œçš„åŒæ­¥å¹¿æ’­ã€‚å¼‚æ­¥å¹¿æ’­æ¥æ”¶æ²¡æœ‰å…ˆåä¹‹åˆ†ï¼Œå¯çœ‹åšåŒæ—¶æ”¶åˆ°ï¼Œè¿™ç§å¹¿æ’­å‘å‡ºä¹‹åä¸å¯è¢«æ‹¦æˆªã€‚åŒæ­¥å¹¿æ’­æ˜¯æŒ‰é¡ºåºä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œå¯ä»¥è®¾ç½®æ¥æ”¶çš„ä¼˜å…ˆçº§(è®¾ç½®<code>IntentFilter</code>çš„<code>priority</code>å€¼,è¶Šå¤§è¶Šä¼˜å…ˆ)ï¼Œè¿™ç§å¹¿æ’­å¯ä»¥è¢«æ‹¦æˆª(åœ¨<code>onReceive()</code>æ–¹æ³•é‡Œè°ƒç”¨<code>abortBroadcast()</code>åºŸæ‰è¿™æ¡å¹¿æ’­)ã€‚</p>

<p>æ³¨å†Œæ¥æ”¶å¹¿æ’­æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ç”¨ä»£ç æ³¨å†Œï¼Œä¹Ÿå«åŠ¨æ€æ³¨å†Œï¼ŒåŠ¨æ€æ³¨å†Œ(åœ¨<code>onCreate()</code>é‡Œè°ƒç”¨Activityçš„æ–¹æ³•<code>registerReceiver()</code>)çš„å¹¿æ’­æ¥æ”¶ä¸€å®šè¦åœ¨<code>onDestroy</code>ä¸­ç§»é™¤æ³¨å†Œ(è°ƒç”¨Activityçš„<code>unregisterReceiver()</code>)ã€‚å¦ä¸€ç§å«é™æ€æ³¨å†Œï¼Œæ˜¯åœ¨xmlä¸­é…ç½®çš„ï¼Œè¿™ç§æ³¨å†Œä¸ç”¨ç§»é™¤ã€‚</p>

<p>æ€ä¹ˆå†™å¹¿æ’­æ¥æ”¶å™¨ï¼Ÿå†™ä¸ªç±»ç»§æ‰¿<code>BroadcastReceiver</code>,å®ƒæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œç„¶åé‡å†™<code>onReceive()</code>å³å¯ï¼Œå¯ä»¥é€šè¿‡<code>intent.getAction()</code>æ¥åŒºåˆ†ä¸åŒå¹¿æ’­ï¼Œ<strong>åœ¨<code>onReceive()</code>æ–¹æ³•ä¸­ä¸èƒ½å¼€å¯çº¿ç¨‹</strong>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç›‘å¬ç½‘ç»œå˜åŒ–çš„å¹¿æ’­æ¥æ”¶å™¨ã€‚</p>

<pre><code>class NetWorkChangeReceiver extends BroadcastReceiver{
    @Override
    public void onReceive(Context context,Intent intent){
        ConnectivityManager connectivityManager = (ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);
        NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();
        if (networkInfo != null &amp;&amp; networkInfo.isAvailable()){
            Toast.makeText(context,"ç½‘ç»œå¯ç”¨",Toast.LENGTH_SHORT).show();
        }else {
            Toast.makeText(context,"ç½‘ç»œä¸å¯ç”¨",Toast.LENGTH_SHORT).show();
        }
    }
}
</code></pre>

<p>ç”¨Activityé‡Œçš„æ–¹æ³•å‘é€å¼‚æ­¥å¹¿æ’­<code>sendBroadcaset(intent)</code>,å’Œå‘é€åŒæ­¥å¹¿æ’­<code>sendOrderedBroadCaset(intent,null)</code>ã€‚è¿™æ ·å‘é€çš„å¹¿æ’­éƒ½æ˜¯<code>è·¨åº”ç”¨</code>çš„ï¼Œå³Aåº”ç”¨å‘å‡ºçš„å¹¿æ’­ï¼ŒBåº”ç”¨ä¹Ÿå¯ä»¥æ”¶åˆ°çš„ï¼åº”ä¸ºè¿™äº›éƒ½æ˜¯å…¨å±€å¹¿æ’­ã€‚</p>

<p>æœ¬åœ°å¹¿æ’­ï¼Œå³å‘å‡ºçš„å¹¿æ’­åªä¼šè¢«<code>æœ¬èº«åº”ç”¨</code>æ¥æ”¶åˆ°,æ‰‹æœºé‡Œçš„å…¶ä»–åº”ç”¨å°±æ”¶ä¸åˆ°äº†ã€‚æœ¬åœ°å¹¿æ’­è¦ç”¨<code>LocalBroadcastManager</code>è¿™ä¸ªç±»æ¥ç®¡ç†ï¼Œå³æ³¨å†Œå’Œç§»é™¤çš„æ—¶å€™ä¸èƒ½ç”¨<code>Activity</code>çš„<code>registerReceiver()</code>å’Œ<code>unregisterReceiver()</code>æ–¹æ³•ï¼Œè€Œåº”è¯¥ç”¨<code>LocalBroadcastManager</code>å®ä¾‹çš„<code>registerReceiver()</code>å’Œ<code>unregisterReceiver()</code>æ–¹æ³•ï¼Œç®€å•å§ï¼<strong>æœ¬åœ°å¹¿æ’­ä¸ä¼šè¢«é™æ€æ³¨å†Œçš„æ¥æ”¶å™¨æ”¶åˆ°ï¼</strong>è¦æ¥æ”¶æœ¬åœ°å¹¿æ’­ï¼Œæ¥æ”¶å™¨éƒ½å¾—ç”¨åŠ¨æ€æ³¨å†Œçš„æ–¹å¼ã€‚</p>

<h3>* ContentProvider / ContentResolver</h3>

<p>è¿™ä¸ªæ˜¯ç”¨äºåœ¨æ‰‹æœºä¸­<code>ä¸åŒåº”ç”¨ç¨‹åº</code>é—´çš„æ•°æ®ä¼ é€’ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©é‚£äº›æ•°æ®å¯æš´éœ²å‡ºæ¥ç»™å…¶ä»–åº”ç”¨è·å–ã€‚æœ‰äº›ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºå·²ç»æä¾›è¿™æ ·çš„æ¥å£äº†ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è¿™ç§æ–¹å¼è·å–æ•°æ®ï¼Œå¦‚ çŸ­ä¿¡åº”ç”¨ï¼Œé€šè®¯å½•åº”ç”¨ç­‰ï¼Œè€Œæˆ‘ä»¬è‡ªå·±å†™çš„åº”ç”¨ç¨‹åºåˆ™è¦è‡ªå·±å†™è¿™ä¸ªæ•°æ®æä¾›æ¥å£ã€‚</p>

<p>è·å–æ•°æ®é€šè¿‡<code>ContentResolver</code>ç±»ï¼Œå¯ä»¥é€šè¿‡Context çš„ <code>getContentResolver()</code>å¾—åˆ°å®ä¾‹ï¼Œç„¶åæ•°æ®å¤„ç†å°±æ˜¯ <code>insert()</code>,<code>update()</code>,<code>delete()</code>,<code>quert()</code>,å’Œ<code>SQLiteDatabase</code>å¾ˆåƒï¼Œä½†ä¸æ˜¯ä¼ <code>è¡¨å</code>è€Œæ˜¯ä¼ <code>Uri</code>ã€‚</p>

<p>æä¾›æ•°æ®ï¼Œè¦ç»§æ‰¿æŠ½è±¡ç±»<code>ContentProvider</code>ç„¶åé‡å†™é‡Œé¢çš„å…­ä¸ªæ–¹æ³•ï¼š<code>onCreate()</code>,<code>quert()</code>,<code>insert()</code>,<code>update()</code>,<code>delete()</code>,<code>getType()</code>ã€‚</p>

<h3>* NotificationManager</h3>

<p>Notification åœ¨æ‰‹æœºé¡¶éƒ¨æç¤ºç”¨æˆ·çš„é€šçŸ¥ï¼Œ</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopressæ­å»ºä¸ªäººåšå®¢]]></title>
    <link href="http://andyfightting.github.io/blog/2015/11/14/jiaocheng/"/>
    <updated>2015-11-14T11:21:39+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/11/14/jiaocheng</id>
    <content type="html"><![CDATA[<p>æœ¬äººçš„åšå®¢åˆšåˆšæ­å»ºå¥½ï¼Œå¹¶ç»‘å®šäº†ä¸ªäººåŸŸå(<a href="http://guimingsu.com">guimingsu.com</a>)ï¼Œç°å°†è¯¥è¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚</p>

<p><a href="https://pages.github.com/">Github Pages</a>æ˜¯Githubæä¾›çš„ä¸€ä¸ªå…è´¹ç©ºé—´ï¼Œç›¸å½“äºæˆ‘ä»¬åšå®¢çš„å…è´¹æ‰˜ç®¡æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å†™çš„åšå®¢å°±æ˜¯æ”¾è¿™ä¸Šé¢çš„ã€‚å®ƒå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„äºŒçº§åŸŸåå¦‚xxx.github.io(å¦‚æœæœ‰è‡ªå·±çš„ä¸ªäººåŸŸåï¼Œå¯ä»¥ç”¨è‡ªå·±çš„ä¸ªäººåŸŸåæŒ‡å‘å®ƒ)ï¼Œå…è®¸å¼€å‘è€…æäº¤é™æ€ç½‘é¡µæ–‡ä»¶ï¼Œç”¨äºä»‹ç»è‡ªå·±ï¼Œæˆ–è€…è‡ªå·±çš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸ªäººæˆ–é¡¹ç›®ä¸»é¡µã€‚</p>

<p><a href="http://octopress.org/">Octopress</a>â€œA blogging framework for hackersâ€ï¼Œå³åƒå†™ä»£ç ä¼¼çš„å†™åšå®¢ã€‚ä¸€ä¸ªåšå®¢ç½‘é¡µç”Ÿæˆæ¡†æ¶ï¼Œæˆ‘ä»¬æŒ‰ç…§å®ƒè¦æ±‚çš„æ ¼å¼å†™åšå®¢å†…å®¹ï¼Œç„¶åæ•²å‘½ä»¤<code>rake generate</code>,<code>rake deploy</code>,å°±å¯ä»¥æŠŠç½‘é¡µæ”¾åˆ°GithubæœåŠ¡å™¨ä¸Šï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°äº†å•Šï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå†™åšå®¢çš„å·¥å…·å¯ä»¥è¿™æ ·ç†è§£ã€‚</p>

<p>ä¸ªäººåŸŸåï¼Œè¿™ä¸ªè¦è‡ªå·±ä¹°äº†ï¼Œå¯ä»¥ä¸Š<a href="http://wanwang.aliyun.com/">é˜¿é‡Œäº‘</a>ä¸Šä¹°ï¼Œä¸€å¹´å‡ åå—ï¼Œé…ç½®åé¢å†è®²ã€‚åœ¨æ³¨å†Œé˜¿é‡Œäº‘çš„æ—¶å€™æˆ‘ç”¨çš„QQé‚®ç®±ï¼Œå°±æ˜¯æ”¶ä¸åˆ°é‚®ä»¶ï¼Œæ¢æˆGmailå°±æ”¶åˆ°äº†ã€‚ä¸çŸ¥é“æ˜¯æˆ‘ç½‘ç»œé—®é¢˜è¿˜æ˜¯å¤§å…¬å¸é—´çš„ä»»æ€§æ’•é€¼ï¼Œå¦‚æœä½ ä¹Ÿæ”¶ä¸åˆ°é‚®ä»¶å°±æ¢ä¸ªé‚®ç®±æ³¨å†Œå§ã€‚<!--more--></p>

<ul>
<li><p>åœ¨<a href="https://github.com">Github</a>ä¸ŠNew repository, åå­—ä¸º<code>yourNmae.github.io</code>ç¡®å®šæäº¤ï¼Œè¿™é‡ŒæŠ¥é”™æ˜¯å› ä¸ºæˆ‘å·²ç»å»ºå¥½äº†ã€‚
<img src="http://andyfightting.github.io/myimg/other/creat_rep.png" alt="creat_rep" />
ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªHTTPSè¿æ¥å¦‚ <a href="https://github.com/yourName/yourName.github.io.git">https://github.com/yourName/yourName.github.io.git</a> ,è¿™ä¸ªè¿æ¥åœ¨ä¹‹åçš„Octopressç»‘å®šé…ç½®ä¸­è¦ç”¨ã€‚</p></li>
<li><p><a href="http://octopress.org/docs/setup/">Octopress</a>è¿™ä¸ªæ­¥éª¤æ¯”è¾ƒå¤šä¸€ç‚¹, æˆ‘ç”¨çš„ç³»ç»Ÿæ˜¯ OS X10.10.5ã€‚Octopressè¦ç”¨åˆ°rubyç¯å¢ƒï¼Œä¸”rubyç‰ˆæœ¬è¦å¤§äºç­‰äº<code>1.9.3</code>ã€‚å¯ä»¥ç”¨<code>ruby -v</code>å‘½ä»¤çœ‹ä¸€ä¸‹rubyç‰ˆæœ¬ï¼Œæˆ‘çš„æ˜¯ç‰ˆæœ¬æ˜¯<code>2.0.0p643</code>, æ²¡æœ‰çš„è¯å¯ä»¥çœ‹<a href="https://ruby-china.org/wiki/install_ruby_guide">è¿™é‡Œ</a>å®‰è£…rubyç¯å¢ƒã€‚</p></li>
</ul>


<p>ç¯å¢ƒè£…å¥½åä»ç½‘ä¸Šä¸‹è½½Octopressæ¡†æ¶åˆ°æœ¬åœ°ç”µè„‘ä¸Šï¼Œè¿™é‡Œæˆ‘ä¿å­˜åˆ°octopressæ–‡ä»¶å¤¹ä¸”æ”¾åœ¨æ¡Œé¢ä¸Š</p>

<p>ä¸‹è½½ï¼š <code>git clone git://github.com/imathis/octopress.git /Users/suguiming/Desktop/octopress</code></p>

<p>ç„¶åè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼š<code>cd  /Users/suguiming/Desktop/octopress</code></p>

<p>ç„¶åï¼š  <code>gem install bundler</code></p>

<p>è¿™é‡Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œè¯´ç¼ºå°‘xxxä¾èµ–åŒ…ï¼Œå¯ä»¥ç”¨<code>gem dependency</code>æŸ¥çœ‹è¦ä¾èµ–çš„åŒ…ï¼Œç„¶åæŠŠåŒ…éƒ½è£…ä¸Šå†æ•²ä¸Šé¢çš„å‘½ä»¤</p>

<p>ç„¶åï¼š <code>bundle install</code></p>

<p>å†ç„¶åï¼š  <code>rake install</code></p>

<p>è¿™é‡ŒOctopresså°±ä¸‹è½½å®‰è£…å¥½äº†ï¼Œä¹‹åè¦è¿›è¡Œå…³è”é…ç½®,æŠŠOctopresså’ŒGithubå…³è”èµ·æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåšå®¢æ”¾åˆ°ä¹‹å‰å»ºçš„Githubé¡¹ç›®<code>yourNmae.github.io</code>é‡Œäº†ã€‚</p>

<p>ä½†å…³è”å‰è¿˜æœ‰ä¸€ä¸ªæ­¥éª¤å°±æ˜¯SSH keyå¤„ç†ã€‚æ–°å»ºä¸€ä¸ªå‘½ä»¤çª—å£<code>cd ~/.ssh</code>è¿›å…¥ç›®å½•ï¼Œ<code>ls -a</code>æŸ¥çœ‹å†…å®¹ï¼Œè¿™æ—¶å€™ä¸€èˆ¬æ²¡æœ‰<code>id_rsa</code>åŠ<code>id_rsa.pub</code>è¿™ä¸¤ä¸ªæ–‡ä»¶çš„ï¼Œæˆ‘ä»¬ç°åœ¨è¦åˆ›å»ºè¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚<code>ssh-keygen -t rsa -C "Githubç™»å½•è´¦å·é‚®ç®±@qq.com"</code>,ç„¶åæŒ‰å›è½¦å›è½¦å†å›è½¦å°±ç”Ÿæˆé‚£ä¸¤ä¸ªæ–‡ä»¶äº†ã€‚ç„¶åæŠŠ<code>id_rsa.pub</code>é‡Œçš„ä¸œè¥¿å…¨é€‰å¤åˆ¶ï¼Œåœ¨<a href="https://github.com/settings/ssh">è¿™é‡Œ</a>æ·»åŠ ä¸€ä¸ªSSH keyå³å¯ã€‚</p>

<p>å›åˆ°octopressçš„å‘½ä»¤çª—å£ï¼Œè¾“å…¥å‘½ä»¤<code>rake setup_github_pages</code> æ­¤æ—¶è¦æ±‚è¾“å…¥Githubé¡¹ç›®<code>yourNmae.github.io</code>çš„åœ°å€ï¼Œå³å‰é¢å¾—åˆ°çš„<code>https://github.com/yourName/yourName.github.io.git</code>,ä¹Ÿå¯åœ¨Githubä¸­é¡¹ç›®é‡Œçš„å³ä¸‹è§’çš„HTTPSé“¾æ¥å¤åˆ¶è¿‡æ¥ç„¶å</p>

<pre><code>rake generate
rake deploy
git add .
git commit -m 'say something'
git push origin source
</code></pre>

<ul>
<li>å†™åšå®¢ï¼Œ<code>rake new_post["file name"]</code>æ–°å»ºä¸€ä¸ªå†™åšå®¢çš„æ–‡ä»¶ï¼Œå®ƒä¼šåœ¨<code>/source/_posts</code>æ–‡ä»¶å¤¹é‡Œç”Ÿæˆ,æ‰“å¼€å®ƒåœ¨é‡Œé¢å†™åšå®¢å†…å®¹å°±å¯ä»¥äº†ã€‚å®ƒæ˜¯ç”¨markdownçš„æ–¹å¼å†™ï¼Œå¯ä»¥åœ¨<a href="http://wowubuntu.com/markdown/">è¿™é‡Œ</a>å’Œ<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">è¿™é‡Œ</a>æŸ¥çœ‹markdownçš„ä½¿ç”¨è§„åˆ™ï¼Œå¸¸ç”¨çš„å°±é‚£å‡ ä¸ªï¼Œç†Ÿæ‚‰å°±å¯ä»¥äº†,å¤§æ¦‚é•¿è¿™æ ·ã€‚æ¨èä½¿ç”¨<a href="http://mouapp.com/">Mou</a>æ¥ç¼–å†™markdownæ–‡ä»¶ï¼Œ<a href="https://maxiang.io/">é©¬å…‹é£è±¡</a>è¿™ä¸ªåœ¨çº¿ç¼–å†™å·¥å…·ä¹Ÿå¾ˆå¥½ã€‚
  <img src="http://andyfightting.github.io/myimg/other/write_blog.png" alt="write_blog" />
  å†™å¥½åä¿å­˜ï¼Œ<code>rake generate</code>ç”Ÿæˆåšå®¢ï¼Œ<code>rake preview</code>é¢„è§ˆåšå®¢ï¼Œåœ¨åœ°å€æ è¾“å…¥<code>http://localhost:4000/</code>æŸ¥çœ‹ï¼Œé€€å‡ºé¢„è§ˆ<code>control+C</code></li>
</ul>


<p>ç„¶åæäº¤ï¼Œä¹‹ååœ¨åœ°å€æ è¾“å…¥<code>yourName.github.io</code>å°±å¯ä»¥æŸ¥çœ‹äº†</p>

<pre><code>rake deploy
git add .
git commit -m 'say something'
git push origin source
</code></pre>

<ul>
<li><p>åŸŸåç»‘å®šï¼Œåœ¨<code>yourName.github.io</code>é¡¹ç›®é‡Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åå¿…é¡»æ˜¯å¤§å†™çš„<code>CNAME</code>,å†…å®¹æ˜¯ä½ è´­ä¹°çš„åŸŸåå¦‚æˆ‘çš„åŸŸå<code>guimingsu.com</code>,å‰é¢ä¸è¦åŠ wwwæˆ–http,å‚è€ƒ<a href="https://help.github.com/articles/adding-a-cname-file-to-your-repository/">è¿™é‡Œ</a>,ç„¶å<code>git pull</code>æŠŠåˆšæ‰å»ºçš„æ–‡ä»¶åŒæ­¥åˆ°æœ¬åœ°ã€‚
ç„¶ååœ¨åŸŸåè´­ä¹°çš„æœåŠ¡å•†é‚£é‡Œè®¾ç½®ï¼Œæˆ‘ç”¨çš„æ˜¯<a href="http://www.aliyun.com/">é˜¿é‡Œäº‘</a>ã€‚ç™»å½•è´¦å·ï¼Œåœ¨æ§åˆ¶ç®¡ç†ï¼ŒåŸŸåè§£æä¸­æ·»åŠ åŸŸåæŒ‡å‘,æŠŠå›¾ä¸­çš„<code>andyfightting.github.io</code>æ¢æˆä½ è‡ªå·±çš„ï¼Œå…¶ä»–çš„ä¸å˜,è¿™æ ·åŸŸåå°±é…ç½®å¥½äº†
<img src="http://andyfightting.github.io/myimg/other/yuming.png" alt="img" />
å‚è€ƒ<a href="https://help.github.com/articles/my-custom-domain-isn-t-working/">è¿™é‡Œ</a>
<img src="http://andyfightting.github.io/myimg/other/dns_error.png" alt="img" /></p></li>
<li><p>å…¶ä»–ä¸ªæ€§åŒ–é…ç½®ï¼Œå¦‚åœ¨æµè§ˆå™¨æ˜¾ç¤ºçš„iconæ›¿æ¢ï¼Œåœ¨sourceæ–‡ä»¶å¤¹é‡Œé¢æœ‰ä¸ªæ–‡ä»¶å«favicon.pngï¼Œåšä¸€ä¸ª16*16å›¾ç‰‡æ›¿æ¢è¿›å»æäº¤ï¼Œå¯èƒ½ä¸ä¼šç«‹å³æœ‰ååº”ã€‚è¿˜æœ‰åšå®¢çš„è¯„è®ºç³»ç»Ÿæ˜¯ç”¨çš„ç¬¬ä¸‰æ–¹<a href="https://disqus.com">disqus</a>ã€‚åœ¨è¯¥ç½‘ç«™ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åæŠŠè´¦å·åå¡«å†™åœ¨<code>/octopress/_config.yml</code>æ–‡ä»¶ä¸­å¯¹åº”çš„åœ°æ–¹ï¼ŒæŠŠfalseæ”¹æˆtrueã€‚</p></li>
</ul>


<p><img src="http://andyfightting.github.io/myimg/other/discus.png" alt="img" /></p>

<p>ç”±äºè®¿é—®å›½å¤–disqusæ¯”è¾ƒæ…¢ï¼Œæˆ‘åˆæŠŠè¯„è®ºéƒ¨åˆ†æ”¹ç”¨å›½å†…çš„<a href="http://duoshuo.com/">å¤šè¯´</a>äº†ï¼Œä½¿ç”¨æ–¹æ³•éƒ½ç±»ä¼¼çš„ï¼Œå…·ä½“é…ç½®è¯·çœ‹<a href="http://www.tuicool.com/articles/VbqYNjn">è¿™é‡Œ</a>,é‡Œé¢è¿˜è¯´äº†æ€§èƒ½ä¼˜åŒ–å¯ä»¥è·Ÿç€æ”¹æ”¹ï¼Œæé«˜ç½‘é¡µçš„å“åº”é€Ÿåº¦ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Octopress]]></title>
    <link href="http://andyfightting.github.io/blog/2015/11/13/my-octopress/"/>
    <updated>2015-11-13T21:03:44+08:00</updated>
    <id>http://andyfightting.github.io/blog/2015/11/13/my-octopress</id>
    <content type="html"><![CDATA[<p>Hello World !!
<img src="http://andyfightting.github.io/myimg/other/octopress.png" alt="img" /></p>
]]></content>
  </entry>
  
</feed>
