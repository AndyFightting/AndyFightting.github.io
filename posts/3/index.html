
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>é˜¿è´µ</title>
  <meta name="author" content="guimingsu">

  
  <meta name="description" content="MyBatis çš„ä½¿ç”¨ Nov 14th, 2016 7:26 pm Mybatisæ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥å¯¹é…ç½®å’ŒåŸç”ŸMapä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£ï¼Œ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://andyfightting.github.io/posts/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="é˜¿è´µ" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">  -->
<!--<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->

<script>
  function addBlankTargetForLinks () {
    $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
    });
  }
  $(document).bind('DOMNodeInserted', function(event) {
    addBlankTargetForLinks();
  });
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">é˜¿è´µ</a></h1>
  
    <h2>confidence comes from preparation</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="andyfightting.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li> 
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/14/mybatis/">MyBatis çš„ä½¿ç”¨</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-11-14T19:26:25+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mybatisæ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥å¯¹é…ç½®å’ŒåŸç”ŸMapä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£ï¼Œå°†æ¥å£å’Œ Java çš„ POJOs(Plain Old Java Objects,æ™®é€šçš„ Javaå¯¹è±¡)æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p>

<p>éœ€è¦ä¸¤ä¸ªåŒ…ï¼š<a href="https://github.com/mybatis/mybatis-3/releases">MyBatisåŒ…</a>å’Œ<a href="https://www.mysql.com/products/connector/">JDBC Driver for MySQL</a></p>

<p>æ— è®ºæ˜¯ç”¨è¿‡çš„mybatiså’Œhibernateä»–ä»¬çš„å…±åŒç‚¹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1.ä»é…ç½®æ–‡ä»¶(é€šå¸¸æ˜¯XMLé…ç½®æ–‡ä»¶ä¸­)å¾—åˆ°sessionfactory
</span><span class='line'>2.ç”±sessionfactoryäº§ç”Ÿsession
</span><span class='line'>3.åœ¨sessionä¸­å®Œæˆå¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œäº‹åŠ¡æäº¤ç­‰
</span><span class='line'>4.åœ¨ç”¨å®Œä¹‹åå…³é—­session 
</span><span class='line'>5.åœ¨java å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æœ‰mappingçš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿé€šå¸¸æ˜¯xmlæ–‡ä»¶</span></code></pre></td></tr></table></div></figure>


<p>ä¸»è¦XMLé…ç½®æ–‡ä»¶ä¸­åŒ…å«äº†å¯¹ MyBatis ç³»ç»Ÿçš„æ ¸å¿ƒè®¾ç½®ï¼ŒåŒ…å«è·å–æ•°æ®åº“è¿æ¥å®ä¾‹çš„æ•°æ®æºå’Œå†³å®šäº‹åŠ¡èŒƒå›´å’Œæ§åˆ¶æ–¹å¼çš„äº‹åŠ¡ç®¡ç†å™¨ã€‚é€šè¿‡åŠ è½½è¯¥æ–‡ä»¶è·å–SqlSessionFactoryã€‚</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
    &lt;!--å¯¹è±¡åˆ«åå®šä¹‰ --&gt;
    &lt;typeAliases&gt;
        &lt;typeAlias alias="User" type="com.sgm.java.User" /&gt;
    &lt;/typeAliases&gt;

&lt;!--æ•°æ®åº“è¿æ¥ --&gt;
&lt;environments default="development"&gt;
    &lt;environment id="development"&gt;
        &lt;transactionManager type="JDBC" /&gt;
        &lt;dataSource type="POOLED"&gt;
            &lt;property name="driver" value="com.mysql.jdbc.Driver" /&gt;
            &lt;property name="url" value="jdbc:mysql://localhost:8889/java_db" /&gt;
            &lt;property name="username" value="root" /&gt;
            &lt;property name="password" value="root" /&gt;
        &lt;/dataSource&gt;
    &lt;/environment&gt;
&lt;/environments&gt;

&lt;!--æ•°æ®åº“æ“ä½œæ˜ å°„æ–‡ä»¶ --&gt;
&lt;mappers&gt;
    &lt;mapper resource="com/sgm/mybatis/User.xml" /&gt;
&lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>

<p>æ•°æ®åº“æ“ä½œæ˜ å°„æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;

&lt;!--namespaceå¾ˆé‡è¦ï¼Œç»‘å®šå¯¹åº”çš„æ¥å£æ–‡ä»¶ï¼--&gt;
&lt;mapper namespace="com.sgm.java.UserDao"&gt;

&lt;resultMap type="User" id="resultListUser"&gt;
    &lt;result column="name" property="name" /&gt;
    &lt;result column="age" property="age" /&gt;
&lt;/resultMap&gt;

&lt;!--idåå­—è¦å’ŒUserDaoé‡Œçš„æ–¹æ³•åä¸€æ ·  --&gt;
&lt;insert id="addUser" parameterType="User" useGeneratedKeys="true" keyProperty="id"&gt;
    insert into user(name, age) values(#{name}, #{age});
&lt;/insert&gt;

&lt;delete id="deleteUserById" parameterType="int"&gt;
    delete from user where id = #{id};
&lt;/delete&gt;

&lt;update id="updateUser" parameterType="User" &gt;
     update user set name = #{name}, age = #{age} where id = #{id};
&lt;/update&gt;

&lt;select id="getAllUsers" resultMap="resultListUser"&gt;
    select * from user ;
&lt;/select&gt;

&lt;select id="selectUserById" parameterType="int" resultType="User"&gt;
   select * from user where id = #{id};
&lt;/select&gt;
&lt;/mapper&gt;
</code></pre>

<p>å®šä¹‰æ•°æ®åº“æ“ä½œæ¥å£ï¼Œæ–¹æ³•è¦å’Œå¯¹åº”çš„æ˜ å°„æ–‡ä»¶é‡Œçš„idåç§°ä¸€æ ·ï¼</p>

<pre><code>public interface UserDao {
    //  æ–¹æ³•åè¦å’ŒUser.xmlé…ç½®æ–‡ä»¶é‡Œçš„idåç§°ä¸€æ ·
    public void addUser(User user);

    public void deleteUserById(int id);

    public void updateUser(User user);

    public List&lt;User&gt; getAllUsers();

    public User selectUserById(int id);
}
</code></pre>

<p>æ“ä½œçš„Javaå¯¹è±¡</p>

<pre><code>public class User {
        public int id;
        public String name;
        public int age;

    public int getId() {
        return id;
    }
    public void setId(int id) {
        this.id = id;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}
</code></pre>

<p>æµ‹è¯•</p>

<pre><code>public class Main {
    private static Reader reader;
    private static SqlSessionFactory sqlSessionFactory;

static {
    try {
        reader = Resources.getResourceAsReader("MyBatisConfig.xml");
        sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
    } catch (Exception e) {
        e.printStackTrace();
    }
}

public static void main(String[] args) {
    SqlSession session = sqlSessionFactory.openSession();
    UserDao userDao = session.getMapper(UserDao.class);

    try {
//          // å¢
//          User newUser = new User();
//          newUser.setName("andy");
//          newUser.setAge(20);
//          userDao.addUser(newUser);
//          session.commit();//å¿…é¡»æäº¤
//          System.out.println("reult------ï¼š æ–°å¢çš„userId " + newUser.getId());    
//          //åˆ 
//          userDao.deleteUserById(1);
//          session.commit();//å¿…é¡»æäº¤

//          //æ”¹
//          User updateUser = new User();
//          updateUser.setId(4);
//          updateUser.setName("andy");
//          updateUser.setAge(20);
//          userDao.updateUser(updateUser);
//          session.commit();//å¿…é¡»æäº¤

//          //åˆ—è¡¨
//          List&lt;User&gt; userList = userDao.getAllUsers();
//          for(User user : userList){
//              System.out.println("reult------ï¼š  " + user.getName());            
//          }
            //æŸ¥å•ä¸ª
//          User user = userDao.selectUserById(4);
//          System.out.println("reult------ï¼š  " + user.getName());
        } finally {
            session.close();//å¿…é¡»å…³é—­
        }
    }
}
</code></pre>

<h3>ä¼ å‚æ–¹å¼</h3>

<h5>1.ç”¨ä¸‹æ ‡è·å–</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//Daoå±‚æ¥å£å®šä¹‰
</span><span class='line'>public User selectUser(String name,String password);
</span><span class='line'>//å¯¹åº”çš„æ˜ å°„æ–¹æ³•,ç”¨ä¸‹æ ‡è·å–
</span><span class='line'>&lt;select id="selectUser" resultMap="userList"&gt;
</span><span class='line'>    select  *  from user where name = #{0} and password=#{1}
</span><span class='line'>&lt;/select&gt;
</span><span class='line'>//å®šä¹‰userList
</span><span class='line'>&lt;resultMap type="User" id="userList"&gt;
</span><span class='line'>  &lt;result column="id" property="id" /&gt;
</span><span class='line'>  &lt;result column="name" property="name" /&gt;
</span><span class='line'>  &lt;result column="password" property="password" /&gt;
</span><span class='line'>&lt;/resultMap&gt;</span></code></pre></td></tr></table></div></figure>


<h5>2.ä¼ è‡ªå®šä¹‰å¯¹è±¡</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public void updateUser(User user);
</span><span class='line'>&lt;update id="updateUser" parameterType="User"&gt;
</span><span class='line'>  update user set name = #{name}, password = #{password} where id = #{id};
</span><span class='line'>&lt;/update&gt;
</span><span class='line'>//å®šä¹‰Useråˆ«å
</span><span class='line'>&lt;typeAliases&gt;
</span><span class='line'>  &lt;typeAlias alias="User" type="com.sgm.bean.User" /&gt;
</span><span class='line'>&lt;/typeAliases&gt;</span></code></pre></td></tr></table></div></figure>


<h5>3.ç”¨æ³¨è§£çš„æ–¹å¼</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public User selectUser(@Param("name")String name,@Param("password")String password);
</span><span class='line'>&lt;select id="selectUser" resultType="User"&gt;
</span><span class='line'>  select * from user where name = #{name} and password = #{password};
</span><span class='line'>&lt;/select&gt;</span></code></pre></td></tr></table></div></figure>


<h4>åŠ¨æ€SQLè¯­å¥</h4>

<pre><code>&lt;select id="selectSameAddressUser" parameterType="User" resultType="userList"&gt;
    select * from user 
        &lt;if test="name != null"&gt;
            title = #{name}
        &lt;/if&gt;
        &lt;if test="address != null"&gt;
            and address = #{address}
        &lt;/if&gt;
&lt;/select&gt;
</code></pre>

<h3>æ³¨æ„!</h3>

<h5>SqlSessionFactoryBuilder</h5>

<p>è¿™ä¸ªç±»å¯ä»¥è¢«å®ä¾‹åŒ–ã€ä½¿ç”¨å’Œä¸¢å¼ƒï¼Œä¸€æ—¦åˆ›å»ºäº† SqlSessionFactoryï¼Œå°±ä¸å†éœ€è¦å®ƒäº†ã€‚å› æ­¤ SqlSessionFactoryBuilder å®ä¾‹çš„æœ€ä½³èŒƒå›´æ˜¯æ–¹æ³•èŒƒå›´,ä¹Ÿå°±æ˜¯å±€éƒ¨æ–¹æ³•å˜é‡ã€‚å¯ä»¥é‡ç”¨ SqlSessionFactoryBuilder æ¥åˆ›å»ºå¤šä¸ª SqlSessionFactory å®ä¾‹ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯ä¸è¦è®©å…¶ä¸€ç›´å­˜åœ¨ä»¥ä¿è¯æ‰€æœ‰çš„ XML è§£æèµ„æºå¼€æ”¾ç»™æ›´é‡è¦çš„äº‹æƒ…ã€‚</p>

<h5>SqlSessionFactory</h5>

<p>SqlSessionFactory ä¸€æ—¦è¢«åˆ›å»ºå°±åº”è¯¥åœ¨åº”ç”¨çš„è¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œæ²¡æœ‰ä»»ä½•ç†ç”±å¯¹å®ƒè¿›è¡Œæ¸…é™¤æˆ–é‡å»ºã€‚ä½¿ç”¨ SqlSessionFactory çš„æœ€ä½³å®è·µæ˜¯åœ¨åº”ç”¨è¿è¡ŒæœŸé—´ä¸è¦é‡å¤åˆ›å»ºå¤šæ¬¡ã€‚å› æ­¤ SqlSessionFactory çš„æœ€ä½³èŒƒå›´æ˜¯åº”ç”¨èŒƒå›´ã€‚å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æˆ–è€…é™æ€å•ä¾‹æ¨¡å¼ã€‚</p>

<h5>SqlSession</h5>

<p>æ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰å®ƒè‡ªå·±çš„ SqlSession å®ä¾‹ã€‚SqlSession çš„å®ä¾‹ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æ˜¯ä¸èƒ½è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„æœ€ä½³çš„èŒƒå›´æ˜¯è¯·æ±‚æˆ–æ–¹æ³•èŒƒå›´ã€‚ä¸èƒ½å°† SqlSession å®ä¾‹çš„å¼•ç”¨æ”¾åœ¨ä¸€ä¸ªç±»çš„é™æ€åŸŸï¼Œç”šè‡³ä¸€ä¸ªç±»çš„å®ä¾‹å˜é‡ä¹Ÿä¸è¡Œã€‚æ¯æ¬¡æ“ä½œåº”è¯¥æ‰“å¼€ä¸€ä¸ª SqlSessionï¼Œå¤„ç†æ•°æ®ï¼Œå¤„ç†å®Œåå°±å…³é—­å®ƒã€‚å…³é—­æ“ä½œå¾ˆé‡è¦ï¼Œåº”è¯¥æŠŠè¿™ä¸ªå…³é—­æ“ä½œæ”¾åˆ° finally å—ä¸­ä»¥ç¡®ä¿æ¯æ¬¡éƒ½èƒ½æ‰§è¡Œå…³é—­ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SqlSession session = sqlSessionFactory.openSession();
</span><span class='line'>try {
</span><span class='line'>  // do work
</span><span class='line'>} finally {
</span><span class='line'>  session.close();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



</div>
  
  


      | <a href="/blog/2016/11/14/mybatis/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/11/android-select-photo/">Android ä¸€è¡Œä»£ç é€‰å–å›¾ç‰‡</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-11-11T19:31:33+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ä¸€è¡Œä»£ç æ¨¡ä»¿iOSçš„é€‰å–å›¾ç‰‡æ•ˆæœã€‚æ€è·¯ä¸»è¦æ˜¯æŠŠç›¸æœºå’Œç›¸å†Œçš„å›è°ƒæ”¾åœ¨ä¸€ä¸ªé€æ˜çš„Activityé‡Œï¼Œç„¶ååœ¨è¿™ä¸ªé€æ˜çš„Activityä¸­å¼¹å‡ºè‡ªå®šä¹‰çš„ActionSheeté€‰æ‹©æ¡†ï¼Œé€‰å–è°ƒç›¸æœºè¿˜æ˜¯ç›¸å†Œã€‚ç›¸æœºæ¯”è¾ƒç®€å•ï¼Œç›´æ¥è°ƒç³»ç»Ÿçš„ã€‚ç›¸å†Œå°±ä¸ç”¨ç³»ç»Ÿçš„äº†ï¼Œä¸åŒæ‰‹æœºå·®åˆ«å¤ªå¤§ï¼Œæ•ˆæœä¹Ÿä¸å¥½ã€‚è‡ªå·±éå†æœ¬åœ°å›¾ç‰‡æ–‡ä»¶ç„¶åæ˜¾ç¤ºã€‚è¿™æ ·å³æ—¶åœ¨ä¸åŒæ‰‹æœºä¸Šä¹Ÿèƒ½å±•ç¤ºç›¸åŒçš„æ•ˆæœäº†ã€‚å°è£…åä½¿ç”¨å°±ç®€å•äº†ï¼Œä¸€è¡Œä»£ç è°ƒç”¨å°±å¯ä»¥ï¼Œä¸ä¼šå’Œä¸šåŠ¡Activityè€¦åˆäº†ï¼</p>

<h4>ä½¿ç”¨:</h4>

<p>1.é€‰å–ä¸€å¼ æ­£æ–¹å½¢å›¾ç‰‡</p>

<pre><code>   SelectPhotoSheet.showCropImageSheet(this, new AlbumResultListener() {
            @Override
            public void complete(View tapedView, List&lt;String&gt; pathList) {
                cache.displayBmp(headImageView, pathList.get(0), new Point(100, 100));
            }
        });
</code></pre>

<p>2.é€‰å–é™åˆ¶æ•°é‡çš„å…¨å°ºå¯¸å›¾ç‰‡</p>

<pre><code>SelectPhotoSheet.showFullImageSheet(this, 8, new AlbumResultListener() {
            @Override
            public void complete(View tapedView, List&lt;String&gt; pathList) {
                localPathList.clear();
                localPathList.addAll(pathList);
                adapter.notifyDataSetChanged();
            }
        });
</code></pre>

<p><img src="/myimg/android/one_select.png" alt="" /></p>

<h4>å®ç°</h4>

<p>1.è‡ªå®šä¹‰ActionSheetï¼Œå¼„ä¸€ä¸ªSheetçš„å·¥å…·ç±» BaseSheetActivityã€‚</p>

<pre><code>//ç”¨ä½œå¼¹å‡º action sheet æ•ˆæœçš„ base activity
public class BaseSheetActivity extends Activity {
    protected int activityCloseEnterAnimation;
    protected int activityCloseExitAnimation;

public static ItemTapListener itemTapListener;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);

    TypedArray activityStyle = getTheme().obtainStyledAttributes(new int[] {android.R.attr.windowAnimationStyle});
    int windowAnimationStyleResId = activityStyle.getResourceId(0, 0);
    activityStyle.recycle();

    activityStyle = getTheme().obtainStyledAttributes(windowAnimationStyleResId, new int[] {android.R.attr.activityCloseEnterAnimation, android.R.attr.activityCloseExitAnimation});
    activityCloseEnterAnimation = activityStyle.getResourceId(0, 0);
    activityCloseExitAnimation = activityStyle.getResourceId(1, 0);
    activityStyle.recycle();
}

@Override
public boolean onTouchEvent(MotionEvent event) {
    dismiss();
    if (itemTapListener != null){
        itemTapListener.itemTap(new View(this),"");
    }
    return super.onTouchEvent(event);
}

@Override
public void finish() {
    dismiss();
}

public void dismiss(){
    super.finish();
    overridePendingTransition(activityCloseEnterAnimation, activityCloseExitAnimation);
}

public static void show(Context context, Class showedActivityClass, ItemTapListener itemTapListener){
    BaseSheetActivity.itemTapListener = itemTapListener;
    Intent intent = new Intent(context,showedActivityClass);
    context.startActivity(intent);
}
}
</code></pre>

<p>  è¦ä½¿ç”¨ActionSheetçš„æ•ˆæœè¯å°±æ˜¯ç»§æ‰¿å®ƒï¼Œç„¶åthemeé€‰æ‹©ActionSheetThemeã€‚ç„¶åæŠŠç•Œé¢çš„å¸ƒå±€ä»bottomå¼€å§‹å¸ƒå±€ã€‚</p>

<pre><code>  public class PhotoSheet extends BaseSheetActivity {

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.action_photo_sheet); //action_photo_sheetçš„å¸ƒå±€ä»bottomå¼€å§‹

}

public void itemTap(View view){
    dismiss();
    if (itemTapListener != null){
        itemTapListener.itemTap(view,"");
    }
}

@Override
public void onBackPressed() {
    dismiss();
    if (itemTapListener != null){
        itemTapListener.itemTap(new View(this),"");
    }
}
}

   //è®¾ç½®ä¸ºè‡ªå®šä¹‰çš„æ ·å¼
 &lt;activity
        android:name=".photo_lib.photo.PhotoSheet"
        android:theme="@style/ActionSheetTheme" /&gt;
</code></pre>

<p>2.è¯»å›¾ç‰‡æ–‡ä»¶è·¯å¾„ï¼Œä¸å•å•æ˜¯ç›¸å†Œé‡Œçš„å›¾ç‰‡</p>

<pre><code>public void getLocalImages() {
        new Thread(new Runnable() {
            @Override
            public void run() {
                Uri mImageUri = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;
                ContentResolver mContentResolver = AlbumDirActivity.this.getContentResolver();

            Cursor mCursor = mContentResolver.query(
                    mImageUri,
                    null,
                    MediaStore.Images.Media.MIME_TYPE + "=? or " + MediaStore.Images.Media.MIME_TYPE + "=? or " + MediaStore.Images.Media.MIME_TYPE + "=?",
                    new String[]{"image/jpeg", "image/png", "image/jpg"},
                    MediaStore.Images.Media.DATE_MODIFIED);

            while (mCursor.moveToNext()) {
                String path = mCursor.getString(mCursor.getColumnIndex(MediaStore.Images.Media.DATA));
                String parentName = new File(path).getParentFile().getName();

                if (!dirMap.containsKey(parentName)) {
                    List&lt;String&gt; chileList = new ArrayList&lt;&gt;();
                    chileList.add(path);
                    dirMap.put(parentName, chileList);
                } else {
                    dirMap.get(parentName).add(path);
                }
            }
            mCursor.close();
            mHandler.sendEmptyMessage(SCAN_OK);
        }
    }).start();
}
</code></pre>

<p>3.ç”¨LruCacheç¼“å­˜æ˜¾ç¤ºå‹ç¼©åçš„å›¾ç‰‡</p>

<pre><code>public class LocalImageCache {

private static LocalImageCache mInstance;

private Handler mHander = new Handler();
private LruCache&lt;String, Bitmap&gt; mMemoryCache;
private CacheImageCallBack mCallBack;
private ExecutorService mImageThreadPool = Executors.newFixedThreadPool(5);

private LocalImageCache() {
    final int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);
    final int cacheSize = maxMemory / 5;

    mMemoryCache = new LruCache&lt;String, Bitmap&gt;(cacheSize) {
        @Override
        protected int sizeOf(String key, Bitmap bitmap) {
            return bitmap.getByteCount()/1024;
        }
    };

    mCallBack = new CacheImageCallBack() {
        @Override
        public void onImageLoader(ImageView imageView, Bitmap bitmap) {
            if (bitmap != null &amp;&amp; imageView != null) {
                imageView.setImageBitmap(bitmap);
            }
        }
    };
}

public static LocalImageCache getInstance() {
    synchronized (LocalImageCache.class) {
        if (mInstance == null) {
            mInstance = new LocalImageCache();
        }
        return mInstance;
    }
}

public static void clearCache() {
    LocalImageCache cache = getInstance();
    cache.mMemoryCache.evictAll();
}

public void displayBmp(final ImageView imageView, final String path, final Point mPoint) {
    if (TextUtils.isEmpty(path) || imageView == null) {
        return;
    }

    Bitmap bitmap = getBitmapFromMemCache(path);
    if (bitmap == null) {
        imageView.setImageBitmap(null);

        mImageThreadPool.execute(new Runnable() {
            Bitmap mBitmap;

            @Override
            public void run() {
                mBitmap = decodeThumbBitmapForFile(path, mPoint == null ? 0 : mPoint.x, mPoint == null ? 0 : mPoint.y);
                mHander.post(new Runnable() {
                    @Override
                    public void run() {
                        mCallBack.onImageLoader(imageView, mBitmap);
                    }
                });
                addBitmapToMemoryCache(path, mBitmap);
            }
        });
    } else {
        imageView.setImageBitmap(bitmap);
    }
}

private void addBitmapToMemoryCache(String key, Bitmap bitmap) {
    if (getBitmapFromMemCache(key) == null &amp;&amp; bitmap != null) {
        mMemoryCache.put(key, bitmap);
    }
}

private Bitmap getBitmapFromMemCache(String key) {
    return mMemoryCache.get(key);
}

private Bitmap decodeThumbBitmapForFile(String path, int viewWidth, int viewHeight) {
    BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeFile(path, options);
    options.inSampleSize = computeScale(options, viewWidth, viewHeight);
    options.inJustDecodeBounds = false;

    return BitmapFactory.decodeFile(path, options);
}

private int computeScale(BitmapFactory.Options options, int viewWidth, int viewHeight) {
    int inSampleSize = 1;
    if (viewWidth == 0 || viewHeight == 0) {
        return inSampleSize;
    }
    int bitmapWidth = options.outWidth;
    int bitmapHeight = options.outHeight;

    if (bitmapWidth &gt; viewWidth || bitmapHeight &gt; viewHeight) {
        int widthScale = Math.round((float) bitmapWidth / (float) viewWidth);
        int heightScale = Math.round((float) bitmapHeight / (float) viewHeight);

        inSampleSize = (widthScale+heightScale)/2;
    }
    return inSampleSize;
}


private interface CacheImageCallBack {
    void onImageLoader(ImageView imageView, Bitmap bitmap);
}
}
</code></pre>

<p>4.ç”¨DrawerLayoutå°è£…äº†ä¸€ä¸ªæ‰‹åŠ¿è¿”å›çš„åŸºç¡€ç±»</p>

<pre><code>public class BaseSwipeActivity extends AppCompatActivity {

private LinearLayout containerLayout;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    initSwipeView();
}

@Override
protected void onDestroy() {
    super.onDestroy();
}

private void initSwipeView() {
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    setContentView(R.layout.activity_base_swipe);

    containerLayout = (LinearLayout) findViewById(R.id.container_layout);

    DrawerLayout drawer = (DrawerLayout) findViewById(R.id.base_drawer_layout);
    drawer.openDrawer(GravityCompat.END);
    ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(this, drawer, R.string.navigation_drawer_open, R.string.navigation_drawer_close) {
        @Override
        public void onDrawerClosed(View drawerView) {
            super.onDrawerClosed(drawerView);
            finish();
        }
    };
    drawer.addDrawerListener(toggle);
}

//å­ç±»è¦æ‰‹åŠ¿è¿”å›å°±ç”¨setMainView!!!!
public void setMainView(int viewId) {
    LayoutInflater inflater = LayoutInflater.from(this);
    View tmpView = inflater.inflate(viewId, null);

    if (tmpView instanceof LinearLayout) {
        LinearLayout.LayoutParams linearLayoutParams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(linearLayoutParams);
    } else if (tmpView instanceof RelativeLayout) {
        RelativeLayout.LayoutParams relativeLayoutParams = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(relativeLayoutParams);
    }
    containerLayout.removeAllViews();
    containerLayout.addView(tmpView);
}

public void backViewTap(View v) {

}

public void backImageTap(View v) {
    finish();
}
}
</code></pre>

<p>å…¶ä»–Activityéœ€è¦æ‰‹åŠ¿è¿”å›çš„è¯å°±ç»§æ‰¿å®ƒï¼Œç„¶åä½¿ç”¨setMainView()æ›¿ä»£setContentView()è®¾ç½®ç•Œé¢å¸ƒå±€ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡å•¦ï¼</p>

<h4>æ³¨æ„</h4>

<p>è¦åœ¨ä½¿ç”¨çš„Activityçš„onDestroy()æ–¹æ³•ä¸­è°ƒç”¨ FileUtil.deleteAllFile(); æ¸…é™¤é€‰å–çš„ä¸´æ—¶ç¼“å­˜å›¾ç‰‡ï¼ï¼ï¼</p>

<p><a href="https://github.com/AndyFightting/SelectPhoto_Android">ä¸‹è½½</a></p>
</div>
  
  


      | <a href="/blog/2016/11/11/android-select-photo/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/12/link-bug/">iOS Not Found for Architecture Arm64</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-12T10:00:18+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>æ¥æ‰‹ç»´æŠ¤ä¸€ä¸ªé¡¹ç›®ï¼Œæ›´æ–°ä¸€ä¸‹å‡ºç°äº†ä¸‹é¢è¿™é—®é¢˜ğŸ‘‡
<img src="/myimg/ios/arm64.png" alt="image" /></p>

<p>å¥½åƒä¸å¸¸è§çš„é—®é¢˜ï¼Œè°·æ­Œä¸€ä¸‹</p>

<p><a href="http://stackoverflow.com/questions/19213782/undefined-symbols-for-architecture-arm64">Stack Overflow</a>
<img src="/myimg/ios/stackoverflow.png" alt="image" /></p>

<p>è¯´æ˜¯Architecturesè®¾ç½®é—®é¢˜&hellip; è¯´æ˜¯Other Linker Flagsé—®é¢˜&hellip;è¯´æ˜¯Target Membershipé—®é¢˜&hellip; æ”¹äº†å¥½åƒéƒ½æ²¡ç”¨å•Šï¼Œé—®é¢˜è¿˜æ˜¯ä¸€åŠ¨ä¸åŠ¨çš„å‡ºç°åœ¨é‚£é‡Œ&hellip;
<img src="/myimg/ios/targetMap.png" alt="image" /></p>

<p>ç»§ç»­æ‰¾æ‰¾æ‰¾&hellip;ç”¨å¯¹åº”çš„ç±»æ–‡ä»¶å…¨å±€æœä¸€ä¸‹&hellip;è¯¶~ å¥½åƒé‚£é‡Œä¸å¯¹å•Š&hellip;è·¯å¾„æ€ä¹ˆè¿™æ ·å­??æ€ä¹ˆå’Œåˆ«çš„ä¸ä¸€æ ·~~ å–œå‡ºæœ›å¤–ï¼Œå¥½åƒçŸ¥é“åŸå› äº†ï¼Œæœç„¶é¡¹ç›®æ–‡ä»¶å¤¹é‡Œçœ‹ä¸åˆ°è¯¥æ–‡ä»¶ï¼ŒAdd Files to &ldquo;XXX"æ·»åŠ æ–‡ä»¶!
<img src="/myimg/ios/errorLoad.png" alt="image" /></p>

<p>è¿˜æ˜¯ä¸è¡Œ&hellip;æŠŠå¯¹åº”çš„.h .mæ–‡ä»¶æ‹–åˆ°æ¡Œé¢ä¸Šï¼Œå†é‡æ–°æ·»åŠ åˆ°é¡¹ç›®é‡Œï¼Œè§£å†³äº†ï¼ï¼ä¸ºä»€ä¹ˆä¸€å¼€å§‹ä¸æ€€ç–‘æ˜¯æ–‡ä»¶ç´¢å¼•é—®é¢˜å‘¢ï¼Ÿ å› ä¸ºé¡¹ç›®ç¼–è¯‘æ²¡æŠ¥ XXX.h not found &hellip;ä»¥ä¸ºæ–‡ä»¶éƒ½å¥½å¥½çš„å‘¢ï¼Œä»¥ä¸ºæ˜¯é¡¹ç›®çš„é…ç½®é—®é¢˜&hellip; æ‰€ä»¥ä¸€å¼€å§‹æ‰¾é—®é¢˜çš„æ–¹å‘å°±è·‘åäº†ï¼å…¶å®è¿™é—®é¢˜ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ï¼Œä¸€èˆ¬æ˜¯ç¬¬ä¸‰æ–¹çš„XXX.aæ–‡ä»¶å‡ºç°è¿™é—®é¢˜ï¼Œåªæ˜¯è¿™æ¬¡è„‘è¢‹æ²¡é•¿è®°æ€§&hellip;è¿™é—®é¢˜ä¸€èˆ¬æ˜¯å¤šäººå¼€å‘é¡¹ç›®ç”¨SVNæ›´æ¥æ›´å»å¯¼è‡´çš„<code>project.pbxproj</code>é‡Œå¯¹åº”çš„æ–‡ä»¶ç´¢å¼•æ²¡äº†ã€‚å¥½äº†ï¼Œå†é‡åˆ°è¿™é—®é¢˜å°±ä¸è¦è·‘åäº†ï¼ŒæŠŠå¯¹åº”çš„æ–‡ä»¶é‡æ–°æ·»åŠ å°±å¯ä»¥äº†ï¼ï¼</p>
</div>
  
  


      | <a href="/blog/2016/09/12/link-bug/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/08/okhttp-retrofit/">OkHttp and Retrofit</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-08T14:57:19+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:57 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://square.github.io/okhttp/">OkHttp</a>å’Œ<a href="http://square.github.io/retrofit/">Retrofit</a>éƒ½æ˜¯<a href="http://square.github.io/">Square</a>å…¬å¸å¼€æºå‡ºæ¥çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚Retrofitæ˜¯å¯¹OkHttpçš„å°è£…ï¼Œä½¿å…¶å¯ä»¥ç”¨æ³¨è§£çš„æ–¹å¼è°ƒç”¨ã€‚</p>

<h4>OkHttp</h4>

<pre><code>//-----okhttp ç½‘ç»œè¯·æ±‚ å·¥å…·ç±»-----

//å¼‚æ­¥è¯·æ±‚ç»“æœæ”¾åœ¨ä¸»çº¿ç¨‹å›è°ƒã€‚
private static final Handler mainHandler = new Handler(Looper.getMainLooper()); 

private static final OkHttpClient client = new OkHttpClient.Builder()
        .connectTimeout(10, TimeUnit.SECONDS)
        .writeTimeout(10, TimeUnit.SECONDS)
        .readTimeout(10, TimeUnit.SECONDS)
        .build();

public static void getRequest(String url, final OkHttpListener listener) {
    Request request = new Request.Builder()
            .header("token", getUserToken())
            .header("client", "Android")
            .header("versionCode", getVersionCode())
            .header("versionName", getVersionName())
            .url(url)
            .build();
    beginRequest(request, listener);
}

//è¿™æ ·å°±ä¸ä¼šæœ‰ä¸­æ–‡ä¹±ç é—®é¢˜
public static void postRequest(String url, final Map&lt;String, String&gt; params, final OkHttpListener listener) {
    StringBuilder stringBuilder = new StringBuilder("");
    if (params != null) {
        Set&lt;String&gt; keys = params.keySet();
        for (String key : keys) {
            String value = params.get(key);
            stringBuilder.append(key + "=" + value + "&amp;");
        }
    }

    MediaType mediaType = MediaType.parse("application/x-www-form-urlencoded;charset=utf-8");
    RequestBody body = RequestBody.create(mediaType, stringBuilder.toString());

    Request request = new Request.Builder()
            .header("token", getUserToken())
            .header("client", "Android")
            .header("versionCode", getVersionCode())
            .header("versionName", getVersionName())
            .url(url)
            .post(body)
            .build();

    beginRequest(request, listener);
}

//å¯æ·»åŠ å›¾ç‰‡æ–‡ä»¶
public static void postMutibleRequest(String url, final Map&lt;String, Object&gt; params, final OkHttpListener listener) {
    MultipartBody.Builder multipleBuilder = new MultipartBody.Builder();
    multipleBuilder.setType(MultipartBody.FORM);

    if (params != null) {
        Set&lt;String&gt; keys = params.keySet();
        for (String key : keys) {
            Object obj = params.get(key);

            if (obj instanceof File) {
                File tmpFile = (File) obj;
                multipleBuilder.addFormDataPart(key, tmpFile.getName(), MultipartBody.create(MediaType.parse("image/jpg"), tmpFile));
            } else {
                multipleBuilder.addPart(Headers.of("Content-Disposition", "form-data; name=\"" + key + "\""), RequestBody.create(null, (String) obj));
            }
        }
    }

    RequestBody multipleBody = multipleBuilder.build();
    Request request = new Request.Builder()
            .header("token", getUserToken())
            .header("client", "Android")
            .header("versionCode", getVersionCode())
            .header("versionName", getVersionName())
            .url(url)
            .post(multipleBody)
            .build();

    beginRequest(request, listener);
}

//ä¿å­˜ç½‘ç»œå›¾ç‰‡åˆ°ç›¸å†Œ,è¿”å›æœ¬åœ°å­˜å‚¨è·¯å¾„
public static void downloadImageToSysPhoto(String imageUrl, final OkHttpListener listener) {
    Request request = new Request.Builder().url(imageUrl).build();
    Call call = client.newCall(request);
    call.enqueue(new Callback() {
        @Override
        public void onResponse(Call call, Response response) throws IOException {
            try {
                //ç³»ç»Ÿç›¸å†Œè·¯å¾„
                final String localPath = "/storage/emulated/0/DCIM/Camera/" + CommonUtil.getUniqueString(10) + ".jpg";

                InputStream is = response.body().byteStream();
                FileOutputStream fos = new FileOutputStream(localPath);
                byte[] buffer = new byte[1024];

                int len;
                while ((len = is.read(buffer)) != -1) {
                    fos.write(buffer, 0, len);
                }
                is.close();
                fos.close();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.success(localPath);
                        }
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.fail(0, "");
                        }
                    }
                });
            }
        }

        @Override
        public void onFailure(Call call, IOException e) {
            mainHandler.post(new Runnable() {
                @Override
                public void run() {
                    if (listener != null) {
                        listener.fail(0, "");
                    }
                }
            });
        }
    });
}

private static void beginRequest(Request request, final OkHttpListener listener) {
    Call call = client.newCall(request);

    call.enqueue(new Callback() {//enqueueæ˜¯å¼‚æ­¥è¯·æ±‚
        @Override
        public void onResponse(Call call, Response response) throws IOException {
            final String responseString = response.body().string();
            final int code = response.code();

            if (response.isSuccessful()) {
                CommonUtil.logJson(responseString);

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.success(responseString);
                        }
                    }
                });
            } else {
                //è¯·æ±‚å¤±è´¥ï¼š    400  ---------   {"code":100004,"msg":"æ‰‹æœºå·å·²æ³¨å†Œ"}
                CommonUtil.logString("è¯·æ±‚å¤±è´¥ï¼š" + code + "---------" + responseString);
                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        if (listener != null) {
                            listener.fail(code, responseString);
                        }
                    }
                });
            }
        }

        @Override
        public void onFailure(Call call, IOException e) {
            e.printStackTrace();
            CommonUtil.logString("è¯·æ±‚é”™è¯¯");
            mainHandler.post(new Runnable() {
                @Override
                public void run() {
                    if (listener != null) {
                        listener.fail(0, "è¯·æ±‚å¤±è´¥");
                    }
                }
            });
        }
    });
}

public static String getFailedMsg(String response) {
    try {
        JSONObject jsonObject = new JSONObject(response);
        return jsonObject.getString("msg");
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "è¯·æ±‚å¤±è´¥";
}

public static String getUserToken() {
    UserModel userModel = UserModel.getUser();
    if (userModel != null) {
        return userModel.getToken();
    }
    return "";
}

public static String getVersionCode() {
    try {
        PackageInfo pi = application.getPackageManager().getPackageInfo(application.getPackageName(), 0);
        return pi.versionCode + "";
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "";
}

public static String getVersionName() {
    try {
        PackageInfo pi = application.getPackageManager().getPackageInfo(application.getPackageName(), 0);
        return pi.versionName;
    } catch (Exception e) {
        e.printStackTrace();
    }
    return "";
}

//ä¸‹è½½apkå®‰è£…åŒ…ï¼ŒHUDæ˜¯è‡ªå®šä¹‰çš„ç­‰å¾…è¿›åº¦æ¡
private static int apkProgress;
public static void downloadAPK(final Context context, String apkUrl) {
    HUD.show(context, "ä¸‹è½½ä¸­...");
    HUD.setCancelable(false);

    Request request = new Request.Builder().url(apkUrl).build();
    Call call = client.newCall(request);
    call.enqueue(new Callback() {
        @Override
        public void onResponse(Call call, Response response) throws IOException {
            try {
                FileUtil.createDir();//åˆ›å»º  ~/paiqi/ æ–‡ä»¶å¤¹
                final String apkLocalPath = FileUtil.DIR_PATH + "paiqi.apk";

                InputStream is = response.body().byteStream();
                FileOutputStream fos = new FileOutputStream(apkLocalPath);
                int readNum;
                byte[] buffer = new byte[1024];

                int progressCount = 0;
                long totalLength = response.body().contentLength();

                while ((readNum = is.read(buffer)) != -1) {
                    progressCount += readNum;
                    apkProgress = (int) (((float) progressCount / totalLength) * 100);

                    mainHandler.post(new Runnable() {
                        @Override
                        public void run() {
                            HUD.setMessage("ä¸‹è½½ä¸­ " + apkProgress + "%");
                        }
                    });

                    fos.write(buffer, 0, readNum);
                }
                is.close();
                fos.close();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        HUD.dismiss();
                        installAPK(context, apkLocalPath);
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();

                mainHandler.post(new Runnable() {
                    @Override
                    public void run() {
                        HUD.dismiss();
                        CommonUtil.showToast("ä¸‹è½½å¤±è´¥");
                    }
                });
            }
        }

        @Override
        public void onFailure(Call call, IOException e) {
            mainHandler.post(new Runnable() {
                @Override
                public void run() {
                    HUD.dismiss();
                    CommonUtil.showToast("ä¸‹è½½å¤±è´¥");
                }
            });
        }
    });
}

//å®‰è£…apk
private static void installAPK(Context context, String apkPath) {
    File apkFile = new File(apkPath);
    if (!apkFile.exists()) {
        CommonUtil.showToast("å®‰è£…å¤±è´¥");
        return;
    }
    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setDataAndType(Uri.parse("file://" + apkFile.toString()), "application/vnd.android.package-archive");
    context.startActivity(intent);
} 

//è¯·æ±‚å›è°ƒæ¥å£å®šä¹‰
public interface OkHttpListener {
   void success(String response);
   void fail(int code,String response);
}
</code></pre>

<p>è¦æ³¨æ„çš„æ˜¯enqueueæ–¹æ³•æ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œæ‰€ä»¥è¦æŠŠç»“æœå›è°ƒæ”¾åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œã€‚</p>

<pre><code> mainHandler.post(new Runnable() {
                        @Override
                        public void run() {
                            if (listener != null) {
                                listener.success(responseString);
                            }
                        }
                    });
</code></pre>

<p>ä¹‹å‰çœ‹è¿‡ä¸€ä¸ªåŒäº‹çš„ç½‘ç»œåº“å°è£…ï¼ŒæŠŠç½‘ç»œå›è°ƒæ¥å£æ”¾åœ¨BaseActivityé‡Œï¼Œç„¶ååœ¨å­Activityé‡Œé‡å†™å›è°ƒæ–¹æ³•ï¼è¿™æ ·å¯¼è‡´çš„ç»“æœå°±æ˜¯ï¼ŒFragmenté‡Œçš„è¯·æ±‚éƒ½è¦é€šè¿‡Activityæ¥é‡å†™æ–¹æ³•ï¼Œç„¶åå†è½¬å‘ç»™Fragment&hellip;ç®€ç›´æƒ³éª‚è¡—å•Šæœ‰æœ¨æœ‰ï¼ä¸‹é¢è¿™æ ·è°ƒç”¨æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢~!</p>

<pre><code>//getå¼‚æ­¥è¯·æ±‚,å›è°ƒéƒ½å·²æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­
 OkHttpHelper.getRequest(ulr, new OkHttpListener() {
        @Override
        public void success(String response) {

        }

        @Override
        public void fail() {

        }
    });

   //postå¼‚æ­¥è¯·æ±‚ï¼Œå›è°ƒéƒ½å·²æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨äºæäº¤File
    Map&lt;String, Object&gt; paramter = new HashMap&lt;&gt;();
    paramter.put("name", "é˜¿è´µ");
    paramter.put("file", new File("filePath"));//æäº¤å›¾ç‰‡æ–‡ä»¶

    OkHttpHelper.postRequest(url, paramter, new OkHttpListener() {
        @Override
        public void success(String response) {

        }

        @Override
        public void fail() {

        }
    });
</code></pre>

<p>è¿˜æœ‰å¾ˆå¤šäººå–œæ¬¢æŠŠç½‘ç»œè¯·æ±‚å’Œç»“æœè§£æå†™åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚é€šè¿‡è¯·æ±‚ç»“æœç›´æ¥å¾—åˆ°å¯¹åº”çš„Beanã€‚è¿™æ ·å¯¼è‡´çš„ç»“æœå°±æ˜¯ç½‘çƒè¯·æ±‚ç»“æœç±»å‹ä¸ç»Ÿä¸€ï¼Œè¿”å›å„ç§Beanã€‚ä¸ªäººä¸å¤ªå–œæ¬¢è¿™æ ·ï¼Œå¯ä»¥å¯¹ç»“æœè§£æè¿›è¡Œç®€å•å°è£…ä¸€ä¸‹ï¼Œè¿™æ ·ç½‘ç»œè¿”å›çš„ç»“æœä¹Ÿä¼šç»Ÿä¸€ï¼Œæ•°æ®è§£æä¹Ÿå°±ä¸€è¡Œä»£ç ã€‚</p>

<pre><code>//ä½¿ç”¨: getBean(json, User.class);
public static &lt;T&gt; T getBean(String json, Class&lt;T&gt; clazz) {
    T bean = null;
    try {
        Gson gson = new Gson();
        bean = gson.fromJson(json, clazz);
    } catch (Exception e) {
        e.printStackTrace();
    }
    return bean;
}

   //ä½¿ç”¨ï¼šgetBeanList(json, User[].class);
    public static &lt;T&gt; List&lt;T&gt; getBeanList(String json, Class&lt;T[]&gt; type) {
        try{
            T[] list = new Gson().fromJson(json, type);
            return Arrays.asList(list);
        }catch (Exception e){
            e.printStackTrace();
            return null;
        }
    }
</code></pre>

<h4>Retrofit</h4>

<p><a href="http://square.github.io/retrofit/">Retrofitå®˜ç½‘</a>ä¸Šçš„ä¾‹å­ä¸­è¿”å›ç»“æœæ˜¯Beanï¼Œä½†åˆæ²¡è¯´æ·»åŠ äº†GsonConverterFactoryï¼Œæ‰€ä»¥ä¼šæŠ¥ Could not locate ResponseBody converter for XXBean é”™è¯¯ï¼æ‰€ä»¥è¦å¼•å…¥GsonConverterFactoryè½¬åŒ–åº“<code>compile 'com.squareup.retrofit2:converter-gson:2.0.2'</code>, ç„¶ååœ¨Retrofitåˆå§‹åŒ–çš„æ—¶å€™æ·»åŠ è¯¥åº“ï¼å®˜ç½‘åé¢è¯´äº† By default, Retrofit can only deserialize HTTP bodies into OkHttp&rsquo;s ResponseBody type and it can only accept its RequestBody type for @Body. é»˜è®¤åªä¼šè¿”å›ResponseBodyï¼å¹¶ä¸”åªæœ‰ResponseBodyæ‰å¯ä»¥ä½¿ç”¨@Bodyæ³¨è§£ï¼æˆ‘ä¸ªäººè¿˜æ˜¯ä¸å–œæ¬¢ç›´æ¥åœ¨è¿™é‡Œå¾—åˆ°Bean, æˆ‘è¿˜æ˜¯å–œæ¬¢å…ˆé€šè¿‡å¾—åˆ°response.body().string()ï¼Œç„¶åå†è½¬åŒ–æˆBeanï¼Œå„å¸å…¶èŒã€‚æ³¨æ„æ˜¯<code>response.body().string()</code>ï¼Œä¸æ˜¯<code>response.body().toString()</code>!!</p>

<pre><code>    Retrofit retrofit = new Retrofit.Builder()
                .baseUrl("https://api.github.com/")
                .addConverterFactory(GsonConverterFactory.create()) //æ·»åŠ Beanè½¬åŒ–åº“
                .build();

    ServiceInterface service = retrofit.create(ServiceInterface.class);

    Call&lt;TestBean&gt; requestCall = service.getUserInfo();

    requestCall.enqueue(new Callback&lt;TestBean&gt;() {
        @Override
        public void onResponse(Call&lt;TestBean&gt; call, Response&lt;TestBean&gt; response) {

                TestBean b = response.body();
        }

        @Override
        public void onFailure(Call&lt;TestBean&gt; call, Throwable t) {

        }
    });

 public interface ServiceInterface {
    @GET("users/andyfightting")
    Call&lt;TestBean&gt; getUserInfo();

    //è¿™é‡Œç»§ç»­æ·»åŠ å…¶ä»–æ¥å£

}
</code></pre>
</div>
  
  


      | <a href="/blog/2016/09/08/okhttp-retrofit/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/07/asynctask/">Androidä¸­çš„AsyncTask</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-07T10:15:12+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:15 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Androidå’ŒiOSä¸€æ ·ï¼Œå¯¹UIçš„æ“ä½œåªèƒ½æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œï¼Œå³UIçº¿ç¨‹ã€‚å¦‚æœåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ–¹æ³•ï¼Œå°±ä¼šé€ æˆç•Œé¢å¡é¡¿å‡æ­»æ— ååº”ï¼Œæ‰€ä»¥åº”è¯¥æŠŠè€—æ—¶æ“ä½œæ”¾åœ¨<code>éUIçº¿ç¨‹</code>ä¸­å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†åœ¨<code>UIçº¿ç¨‹</code>ä¸­æ›´æ–°ç•Œé¢ã€‚</p>

<p>åœ¨æ²¡æœ‰AsyncTaskç±»çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡åœ¨å­çº¿ç¨‹å¤„ç†ï¼Œç„¶åsendMessage(Message msg)ç»™ä¸»çº¿ç¨‹ä¸­åˆ›å»ºçš„Handler,ç„¶ååœ¨ä¸»çº¿ç¨‹ä¸­å®ç°handleMessage(Message msg)å¤„ç†ç›¸åº”ä¿¡æ¯ã€‚è€Œè¿™äº›å·¥ä½œAsyncTaskå¸®æˆ‘ä»¬åšäº†ï¼ŒAsyncTaskå°±æ˜¯å¯¹Threadå’ŒHandlerçš„å°è£…ã€‚</p>

<h4>AsyncTaskä½¿ç”¨</h4>

<p>AsyncTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥å¿…é¡»åˆ›å»ºä¸€ä¸ªå­ç±»å»ç»§æ‰¿å®ƒã€‚åœ¨ç»§æ‰¿æ—¶æˆ‘ä»¬å¯ä»¥ä¸ºAsyncTaskç±»æŒ‡å®šä¸‰ä¸ªå‚æ•°ç±»å‹,è¿™ä¸‰ä¸ªç±»å‹ä¼šå½±å“é‡å†™æ–¹æ³•å¯¹åº”çš„å‚æ•°ç±»å‹ã€‚</p>

<ol>
<li>Params: åœ¨execute()å¯åŠ¨ä»»åŠ¡æ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°</li>
<li>Progress: åå°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®æ—¶åé¦ˆå‡ºæ¥çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ‰§è¡Œè¿›åº¦ä»€ä¹ˆçš„</li>
<li>Result: åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœéœ€è¦å¯¹ç»“æœè¿›è¡Œè¿”å›ï¼Œåˆ™è¿”å›è¯¥ç±»å‹</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//onå¼€é€šçš„æ–¹æ³•éƒ½æ˜¯åœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œçš„
</span><span class='line'>class MyAsyncTask extends AsyncTask&lt;Void,Integer,Boolean&gt;{
</span><span class='line'>    @Override
</span><span class='line'>    protected void onPreExecute() {//åœ¨æ‰§è¡Œå®é™…çš„åå°çš„doInBackgroundæ–¹æ³•å‰
</span><span class='line'>        super.onPreExecute();
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>    @Override
</span><span class='line'>    protected Boolean doInBackground(Void... params) {//åœ¨onPreExecute æ–¹æ³•æ‰§è¡Œåé©¬ä¸Šæ‰§è¡Œï¼Œè¯¥æ–¹æ³•è¿è¡Œåœ¨åå°çº¿ç¨‹ä¸­
</span><span class='line'>        for (int i = 0; i &lt;= 100; i++) {
</span><span class='line'>            publishProgress(i);//è°ƒç”¨onProgressUpdate
</span><span class='line'>            try {
</span><span class='line'>                Thread.sleep(1000);
</span><span class='line'>            } catch (InterruptedException e) {
</span><span class='line'>                e.printStackTrace();
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>        return true;//å¯ä»¥åˆ¤æ–­æ˜¯å¦é¡ºåˆ©æ‰§è¡Œå®Œäº†å•Š
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onProgressUpdate(Integer... values) {//è¿™ä¸ªå‡½æ•°åœ¨doInBackgroundè°ƒç”¨publishProgressæ—¶è¢«è°ƒç”¨å
</span><span class='line'>        super.onProgressUpdate(values);
</span><span class='line'>        //æ¯”å¦‚å®æ—¶æ›´æ–°è¿›åº¦æ¡
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onPostExecute(Boolean aBoolean) {
</span><span class='line'>        super.onPostExecute(aBoolean);
</span><span class='line'>        //åå°é¡ºåˆ©æ‰§è¡Œå®Œåè¦å¹²å•¥å‘¢
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCancelled() {
</span><span class='line'>        super.onCancelled();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p></p>

<ol>
<li>Taskçš„å®ä¾‹å¿…é¡»åœ¨UI çº¿ç¨‹ä¸­åˆ›å»º</li>
<li>executeæ–¹æ³•å¿…é¡»åœ¨UI çº¿ç¨‹ä¸­è°ƒç”¨</li>
<li>ä¸è¦æ‰‹åŠ¨çš„è°ƒç”¨onPreExecute(), onPostExecute(Result)ï¼ŒdoInBackground(Params&hellip;)ç­‰æ–¹æ³•</li>
<li>è¯¥taskåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™å¤šæ¬¡è°ƒç”¨æ—¶å°†ä¼šæŠ›å‡ºå¼‚å¸¸</li>
</ol>


<h4>AsyncTaskæºç </h4>

<p>AsyncTaskæœ‰ä¸ªhandlerå†…éƒ¨ç±»ï¼Œç”¨å®ƒæ¥å¤„ç†åœ¨ä¸»çº¿ç¨‹ä¸­å®æ—¶æ›´æ–°å’Œä»»åŠ¡å®Œæˆåçš„å›è°ƒ</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>private static InternalHandler sHandler;
</span><span class='line'>
</span><span class='line'>private static Handler getHandler() {
</span><span class='line'>    synchronized (AsyncTask.class) {
</span><span class='line'>        if (sHandler == null) {
</span><span class='line'>            sHandler = new InternalHandler();
</span><span class='line'>        }
</span><span class='line'>        return sHandler;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>private static class InternalHandler extends Handler {
</span><span class='line'>    public InternalHandler() {
</span><span class='line'>        super(Looper.getMainLooper());
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @SuppressWarnings({"unchecked", "RawUseOfParameterizedType"})
</span><span class='line'>    @Override
</span><span class='line'>    public void handleMessage(Message msg) {
</span><span class='line'>        AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;
</span><span class='line'>        switch (msg.what) {
</span><span class='line'>            case MESSAGE_POST_RESULT:
</span><span class='line'>                // There is only one result
</span><span class='line'>                result.mTask.finish(result.mData[0]);
</span><span class='line'>                break;
</span><span class='line'>            case MESSAGE_POST_PROGRESS:
</span><span class='line'>                result.mTask.onProgressUpdate(result.mData);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>å½“æˆ‘ä»¬è°ƒç”¨publishProgressæ–¹æ³•æ—¶ï¼Œå°±æ˜¯å¾—åˆ°handlerå•åˆ—ç„¶åå‘æ¶ˆæ¯</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   protected final void publishProgress(Progress... values) {
</span><span class='line'>        if (!isCancelled()) {
</span><span class='line'>            getHandler().obtainMessage(MESSAGE_POST_PROGRESS,
</span><span class='line'>                    new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>   private static class AsyncTaskResult&lt;Data&gt; {
</span><span class='line'>        final AsyncTask mTask;
</span><span class='line'>        final Data[] mData;
</span><span class='line'>
</span><span class='line'>     AsyncTaskResult(AsyncTask task, Data... data) {
</span><span class='line'>            mTask = task;
</span><span class='line'>            mData = data;
</span><span class='line'>        }
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>å½“æ‰§è¡Œexecute()æ–¹æ³•æ—¶ï¼Œä¼šåœ¨åå°ä»»åŠ¡doInBackground(mParams)å¼€å§‹æ‰§è¡Œå‰è°ƒç”¨onPreExecuteæ–¹æ³•ã€‚ä»ä¸‹é¢å¯ä»¥çœ‹å‡ºï¼Œå½“taskå·²ç»åœ¨è¿è¡Œæˆ–è€…å·²ç»ç»“æŸçš„æ—¶å€™ä¸å¯ä»¥å†è°ƒç”¨execute()æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) {
</span><span class='line'>        return executeOnExecutor(sDefaultExecutor, params);
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>  public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec,
</span><span class='line'>            Params... params) {
</span><span class='line'>        if (mStatus != Status.PENDING) {
</span><span class='line'>            switch (mStatus) {
</span><span class='line'>                case RUNNING:
</span><span class='line'>                    throw new IllegalStateException("Cannot execute task:"
</span><span class='line'>                            + " the task is already running.");
</span><span class='line'>                case FINISHED:
</span><span class='line'>                    throw new IllegalStateException("Cannot execute task:"
</span><span class='line'>                            + " the task has already been executed "
</span><span class='line'>                            + "(a task can be executed only once)");
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        mStatus = Status.RUNNING;
</span><span class='line'>
</span><span class='line'>        onPreExecute(); //åå°ä»»åŠ¡å¼€å§‹å‰æ‰§è¡Œ
</span><span class='line'>
</span><span class='line'>        mWorker.mParams = params;
</span><span class='line'>        exec.execute(mFuture);
</span><span class='line'>
</span><span class='line'>        return this;
</span><span class='line'>    }
</span><span class='line'>    
</span><span class='line'>     mWorker = new WorkerRunnable&lt;Params, Result&gt;() {
</span><span class='line'>            public Result call() throws Exception {
</span><span class='line'>                mTaskInvoked.set(true);
</span><span class='line'>
</span><span class='line'>                Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);
</span><span class='line'>                //noinspection unchecked
</span><span class='line'>                Result result = doInBackground(mParams);   //è¿™é‡Œå¼€å§‹æ‰§è¡Œåå°ä»»åŠ¡ï¼ï¼ï¼
</span><span class='line'>                Binder.flushPendingCommands();
</span><span class='line'>                return postResult(result);
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>
</span><span class='line'>        mFuture = new FutureTask&lt;Result&gt;(mWorker) {
</span><span class='line'>            @Override
</span><span class='line'>            protected void done() {
</span><span class='line'>                try {
</span><span class='line'>                    postResultIfNotInvoked(get());    //åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ï¼ï¼
</span><span class='line'>                } catch (InterruptedException e) {
</span><span class='line'>                    android.util.Log.w(LOG_TAG, e);
</span><span class='line'>                } catch (ExecutionException e) {
</span><span class='line'>                    throw new RuntimeException("An error occurred while executing doInBackground()",
</span><span class='line'>                            e.getCause());
</span><span class='line'>                } catch (CancellationException e) {
</span><span class='line'>                    postResultIfNotInvoked(null);
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>    
</span></code></pre></td></tr></table></div></figure>


<p>åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡handlerå‘æ¶ˆæ¯ï¼Œç„¶ååˆ¤æ–­æ˜¯ä¸æ˜¯å–æ¶ˆçŠ¶æ€æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> mFuture = new FutureTask&lt;Result&gt;(mWorker) {
</span><span class='line'>            @Override
</span><span class='line'>            protected void done() {
</span><span class='line'>                try {
</span><span class='line'>                    postResultIfNotInvoked(get());   //åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ï¼ï¼
</span><span class='line'>                } catch (InterruptedException e) {
</span><span class='line'>                    android.util.Log.w(LOG_TAG, e);
</span><span class='line'>                } catch (ExecutionException e) {
</span><span class='line'>                    throw new RuntimeException("An error occurred while executing doInBackground()",
</span><span class='line'>                            e.getCause());
</span><span class='line'>                } catch (CancellationException e) {
</span><span class='line'>                    postResultIfNotInvoked(null);
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>        
</span><span class='line'>   private void postResultIfNotInvoked(Result result) {
</span><span class='line'>        final boolean wasTaskInvoked = mTaskInvoked.get();
</span><span class='line'>        if (!wasTaskInvoked) {
</span><span class='line'>            postResult(result);
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>   private Result postResult(Result result) {
</span><span class='line'>        @SuppressWarnings("unchecked")
</span><span class='line'>        Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,
</span><span class='line'>                new AsyncTaskResult&lt;Result&gt;(this, result));
</span><span class='line'>        message.sendToTarget();
</span><span class='line'>        return result;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'> private void finish(Result result) {
</span><span class='line'>        if (isCancelled()) {
</span><span class='line'>            onCancelled(result);
</span><span class='line'>        } else {
</span><span class='line'>            onPostExecute(result);
</span><span class='line'>        }
</span><span class='line'>        mStatus = Status.FINISHED;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>ä»ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒThreadPoolExecutoræ˜¯ç±»å˜é‡ï¼Œæ‰€ä»¥ä¸ç®¡åˆ›å»ºå¤šå°‘ä¸ªAsyncTaskå­ç±»çš„å¯¹è±¡ï¼Œä»–ä»¬éƒ½å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ã€‚é»˜è®¤çº¿ç¨‹æ± å¯ç»´æŠ¤çš„çº¿ç¨‹æ•°å’Œæœ€å¤§æ•°é‡ï¼Œä¸å¯ç”¨çš„CUPå¤„ç†å™¨ä¸ªæ•°æœ‰å…³ã€‚çº¿ç¨‹æ± ä¸­è¶…è¿‡corePoolSizeæ•°ç›®çš„ç©ºé—²çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´1ï¼Œå•ä½SECONDSã€‚å¦‚æœçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡å°äºCORE_POOL_SIZEï¼Œè¿™ä¸ªæ—¶å€™æ–°æ·»åŠ ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡åˆ™ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼›å¦‚æœçº¿ç¨‹æ± çš„æ•°é‡å¤§äºç­‰äºCORE_POOL_SIZEï¼Œè¿™ä¸ªæ—¶å€™æ–°å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡è¿™ä¸ªä»»åŠ¡ä¼šè¢«æ”¾å…¥ç¼“å­˜é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚ç¼“å­˜é˜Ÿåˆ—å¤§å°ä¸º128ï¼Œå¹¶ä¸”SerialExecutoræ˜¯å¼‚æ­¥é¡ºåºæ‰§è¡Œä»»åŠ¡çš„ã€‚</p>

<pre><code>private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();
private static final int CORE_POOL_SIZE = CPU_COUNT + 1;
private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1;
private static final int KEEP_ALIVE = 1;

private static final BlockingQueue&lt;Runnable&gt; sPoolWorkQueue = new LinkedBlockingQueue&lt;Runnable&gt;(128);

public static final Executor THREAD_POOL_EXECUTOR
        = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE,
                TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory);


private static class SerialExecutor implements Executor {
    final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;();
    Runnable mActive;

    public synchronized void execute(final Runnable r) {
        mTasks.offer(new Runnable() {
            public void run() {
                try {
                    r.run();
                } finally {
                    scheduleNext();
                }
            }
        });
        if (mActive == null) {
            scheduleNext();
        }
    }

    protected synchronized void scheduleNext() {
        if ((mActive = mTasks.poll()) != null) {
            THREAD_POOL_EXECUTOR.execute(mActive);
        }
    }
}
</code></pre>

<h4>é—®é¢˜</h4>

<p>AsyncTaskå¤„ç†ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¹ æƒ¯åœ¨onPreExecuteæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œåœ¨æ•°æ®å¤„ç†å®Œæˆä¹‹åçš„onPostExecuteå…³é—­è¿›åº¦æ¡ã€‚ä½†æ˜¯å½“æ¨ªç«–å±åˆ‡æ¢æˆ–è€…å†…å­˜é‡å¯å¯¼è‡´Activityé‡æ–°å¯åŠ¨æ—¶ï¼Œå‡è®¾ä½ è¿˜åœ¨onPostExecuteå†™äº†ä¸€äº›å…¶ä»–é€»è¾‘ï¼Œè¿™ä¸ªæ—¶å€™çš„AsyncTaskå·²ç»ä¸ä¹‹å‰çš„Activityæ²¡æœ‰å…³è”äº†ï¼Œä¼šå¯¼è‡´onPostExecuteæ— æ•ˆé—®é¢˜ã€‚</p>

<p>è§£å†³åŠæ³•æ˜¯åœ¨onPostExecuteæ–¹æ³•é‡Œç”¨EventBus,Ottoç±»åº“æˆ–è€…è‡ªå·±å†™é€šçŸ¥ï¼ŒæŠŠç»“æœå‘é€ç»™Activityå»å¤„ç†ï¼ï¼</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>    protected void onPostExecute(String result) {
</span><span class='line'>        EventBus.getDefault().post(new AsyncTaskResultEvent(result));
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h4>ä¸ªäººçœ‹æ³•</h4>

<p>è§‰å¾—Androidå¾ˆå–œæ¬¢é€ è¿™ç§ä¸­å‹è½®å­å•Šï¼å¥½åƒæ²¡ä»€ä¹ˆå¿…è¦å†é€ ä¸ªAsyncTaskè¿™æ ·çš„è½®å­æ”¾åœ¨SDKé‡Œå•Š? åƒAsyncTaskè¿™ç§ä»»åŠ¡ä¸åº”è¯¥æ˜¯å¼€å‘è€…å»å®Œæˆçš„å—ï¼Ÿè¿˜æœ‰æ¯”å¦‚NavigationViewï¼ŒçœŸçš„æœ‰å¿…è¦å—ï¼Ÿè¿™ä¸æ˜¯åº”è¯¥è®©å¼€å‘è€…æ¥è‡ªå®šä¹‰çš„Viewå—ï¼Ÿåæ­£æˆ‘ä¸æ˜¯å¾ˆç†è§£ï¼Œè¿™å¯èƒ½ä¹Ÿæ˜¯Androidä¸ºä»€ä¹ˆå¦‚æ­¤ç¢ç‰‡åŒ–çš„åŸå› ä¹‹ä¸€å§ï¼&mdash;- å–œæ¬¢é€ ä¸­å‹è½®å­ï¼</p>
</div>
  
  


      | <a href="/blog/2016/09/07/asynctask/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/02/apk-decode/">åç¼–è¯‘Androidçš„APK</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-02T09:55:10+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>9:55 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>æœ¬äººç”¨çš„ç¯å¢ƒæ˜¯Mac 10.11.5, éœ€è¦ç”¨åˆ°çš„å·¥å…·æœ‰ï¼š<a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, <a href="https://sourceforge.net/projects/dex2jar/">dex2jar</a>, <a href="http://jd.benow.ca/">JD-GUI</a>ã€‚</p>

<p>ä¸‹é¢ç”¨æ·˜å®2.2.1ç‰ˆæœ¬å’Œå¾®ä¿¡2.3ç‰ˆæœ¬ä¸ºä¾‹å­æ¥åç¼–è¯‘ã€‚ä¸ºä»€ä¹ˆç”¨è¿™ä¹ˆè€çš„ç‰ˆæœ¬ï¼Ÿå› ä¸ºå¯èƒ½è€ç‰ˆæœ¬æ²¡æœ‰åšä»£ç æ··æ·†ï¼Œåç¼–è¯‘åä¼šæ›´å¥½çœ‹ä¸€ç‚¹ã€‚å¯ä»¥ç”¨<a href="http://www.anzhi.com/">å®‰æ™ºå¸‚åœº</a>æ¥ä¸‹è½½å†å²ç‰ˆæœ¬ï¼Œæ¨èç”¨å®‰æ™ºå¸‚åœºçš„æ‰‹æœºAPPæ¥ä¸‹è½½ï¼Œä¼šçœ‹åˆ°æ‰€æœ‰çš„å†å²ç‰ˆæœ¬ï¼Œè€Œç”µè„‘ç½‘ç«™åªèƒ½çœ‹åˆ°æœ€è¿‘çš„å‡ ä¸ªå†å²ç‰ˆæœ¬ã€‚
<img src="/myimg/android/az_taobao.png" alt="image" /></p>

<h4>1.apktool</h4>

<p>éœ€è¦è‡³å°‘Java 7ç¯å¢ƒï¼Œé€šè¿‡<code>java -version</code>æŸ¥çœ‹
<img src="/myimg/android/javaVersion.png" alt="image" /></p>

<p>é…ç½®apktool
<img src="/myimg/android/apktool.png" alt="image" /></p>

<p>è¾“å…¥apktoolå¦‚ä¸‹æ‰€ç¤ºå°±æˆåŠŸäº†
<img src="/myimg/android/apktool_result.png" alt="imag" /></p>

<p>ç”¨apktoolå·¥å…·å¤„ç†åå°±å¯ä»¥æŸ¥çœ‹xmlæ–‡ä»¶äº†ã€‚åœ¨æ¡Œé¢å»ºä¸€ä¸ªæ–‡ä»¶å¤¹test, æŠŠapkæ–‡ä»¶æ”¾è¿›å»ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œ<code>apktool d apkåç§°.apk</code>ã€‚å°±ä¼šåœ¨testæ–‡ä»¶å¤¹é‡Œå‡ºç°ä¸€ä¸ª<code>apkåç§°</code>çš„æ–‡ä»¶å¤¹ã€‚é‡Œé¢çš„èµ„æºæ–‡ä»¶å’Œxmlæ–‡ä»¶å°±å¯ä»¥æ‰“å¼€æŸ¥çœ‹äº†ã€‚
<img src="/myimg/android/apktool1.png" alt="imag" />
<img src="/myimg/android/apktool2.png" alt="imag" />
<img src="/myimg/android/apktool3.png" alt="imag" /></p>

<h4>2.dex2jar</h4>

<p>dex2jarå·¥å…·å¯ä»¥å§dexæˆ–è€…apkæ–‡ä»¶è½¬æˆjaræ–‡ä»¶ã€‚dex2jarä¸‹è½½å¥½åè¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ<code>chmod a+x *.sh</code>å‘½ä»¤å¯ç”¨.shæ–‡ä»¶ã€‚</p>

<h6>æ–¹å¼ä¸€</h6>

<p>æŠŠapkæ–‡ä»¶çš„åç¼€åæ”¹ä¸ºzipï¼Œç„¶åè§£å‹å¾—åˆ°classes.dexæ–‡ä»¶ï¼ŒæŠŠclasses.dexæ–‡ä»¶æ”¾åˆ°dex2jaræ–‡ä»¶å¤¹ä¸­ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ<code>sh d2j-dex2jar.sh classes.dex</code>å‘½ä»¤ï¼Œå°±ä¼šå¾—åˆ°å¯¹åº”çš„jaræ–‡ä»¶ã€‚</p>

<h6>æ–¹å¼äºŒ</h6>

<p>ç›´æ¥æŠŠapkæ–‡ä»¶æ”¾å…¥dex2jaræ–‡ä»¶å¤¹ä¸­ï¼Œæ‰§è¡Œ<code>sh d2j-dex2jar.sh apkåç§°.apk</code>ä¹Ÿä¼šå¾—åˆ°å¯¹åº”çš„jaræ–‡ä»¶ã€‚</p>

<h4>3.JD-GUI</h4>

<p>æŠŠJD-GUIä¸‹è½½ä¸‹æ¥ï¼Œæ‰“å¼€ä¸Šé¢ç”Ÿæˆçš„jaræ–‡ä»¶å°±å¯æŸ¥çœ‹äº†ã€‚
<img src="/myimg/android/taobao211.png" alt="image" /></p>

<p>ä¸‹é¢æ˜¯å¾®ä¿¡2.3å¤„ç†åçš„ç»“æœ
<img src="/myimg/android/wx1.png" alt="image" />
<img src="/myimg/android/wx2.png" alt="image" />
<img src="/myimg/android/wx3.png" alt="image" />
å‰©ä¸‹çš„å°±çœ‹ç»†å¿ƒã€è€å¿ƒã€å’Œå¥½å¥‡å¿ƒäº†&hellip;ä¸‹é¢è¯´è¯´æˆ‘æ˜¯æ€ä¹ˆæŸ¥çœ‹QQ2.0çš„ã€‚</p>

<h3>æˆ‘çš„æŸ¥çœ‹æµç¨‹</h3>

<p>æ‰¾ä¸€ä¸ªé¡µé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ä¸‹é¢çš„"æˆ‘çš„ä¸ªäººèµ„æ–™"
<img src="/myimg/android/find00.jpg" alt="image" /></p>

<p>ç„¶åFinderæœç´¢ï¼Œæ‰¾åˆ°strings.xmlæ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ‰¾åˆ°"æˆ‘çš„ä¸ªäººèµ„æ–™"å¯¹åº”çš„key &ndash; &ldquo;info_info"ã€‚
<img src="/myimg/android/find0.png" alt="image" />
<img src="/myimg/android/find1.png" alt="image" /></p>

<p>ç„¶åæœ"info_info"ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¸ƒå±€æ–‡ä»¶"info_self.xml"
<img src="/myimg/android/find2.png" alt="image" /></p>

<p>ç„¶åé€šè¿‡"info_self"å¸ƒå±€æ–‡ä»¶åæœç´¢ï¼Œæ‰¾åˆ°å¯¹åº”çš„smaliæ–‡ä»¶
<img src="/myimg/android/find3.png" alt="image" /></p>

<p>ç„¶åé€šè¿‡smaliæ–‡ä»¶å"InfoActivity"åœ¨JD-GUIçš„SearchåŠŸèƒ½æœç´¢ï¼Œä¸æ˜¯Find!æ‰¾åˆ°å¯¹åº”çš„Activityï¼Œè¿™æ ·æƒ³çœ‹çš„ä¸œè¥¿åº”è¯¥éƒ½èƒ½æ‰¾åˆ°äº†ã€‚
<img src="/myimg/android/find4.png" alt="image" /></p>
</div>
  
  


      | <a href="/blog/2016/09/02/apk-decode/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/01/fragment/">Androidä¸­çš„Fragment</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-01T11:38:27+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>11:38 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>åœ¨ Android 3.0ï¼ˆAPI 11 çº§ï¼‰ä¸­å¼•å…¥äº†Fragmentï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»™å¤§å±å¹•ä¸Šæ›´åŠ åŠ¨æ€å’Œçµæ´»çš„ UI è®¾è®¡æä¾›æ”¯æŒã€‚ç”±äºå¹³æ¿ç”µè„‘çš„å±å¹•æ¯”æ‰‹æœºå±å¹•å¤§å¾—å¤šï¼Œå› æ­¤å¯ç”¨äºç»„åˆå’Œäº¤æ¢ UI ç»„ä»¶çš„ç©ºé—´æ›´å¤§ã€‚åˆ©ç”¨Fragmentå®ç°æ­¤ç±»è®¾è®¡æ—¶ï¼Œæ— éœ€ç®¡ç†å¯¹è§†å›¾å±‚æ¬¡ç»“æ„çš„å¤æ‚æ›´æ”¹ã€‚å®ƒå…·æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œèƒ½æ¥æ”¶è‡ªå·±çš„è¾“å…¥äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ Activity è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤Fragmentï¼Œæœ‰ç‚¹åƒå¯ä»¥åœ¨ä¸åŒ Activity ä¸­é‡å¤ä½¿ç”¨çš„"å­ Activity"ã€‚ é€šè¿‡å°† Activity å¸ƒå±€åˆ†æˆFragmentï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ Activity çš„å¤–è§‚ï¼Œå¹¶åœ¨ç”± Activity ç®¡ç†çš„è¿”å›æ ˆä¸­ä¿ç•™è¿™äº›æ›´æ”¹ã€‚Fragmentå¿…é¡»å§‹ç»ˆåµŒå…¥åœ¨ Activity ä¸­ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç›´æ¥å—å®¿ä¸» Activity ç”Ÿå‘½å‘¨æœŸçš„å½±å“ã€‚å½“ Activity æš‚åœæ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰Fragmentä¹Ÿä¼šæš‚åœï¼›å½“ Activity è¢«é”€æ¯æ—¶ï¼Œæ‰€æœ‰Fragmentä¹Ÿä¼šè¢«é”€æ¯ã€‚</p>

<p>ä¸‹é¢æ˜¯Androidå®˜ç½‘ä¸Šçš„<a href="https://developer.android.com/guide/components/activities.html">Activity</a>å’Œ<a href="https://developer.android.com/guide/components/fragments.html">Fragment</a>çš„ç”Ÿå‘½å‘¨æœŸå›¾ã€‚</p>

<p><img src="/myimg/android/activity_lifecycle.png" alt="imga" /> <img src="/myimg/android/fragment_lifecycle.png" alt="imga" /></p>

<p>ä¸‹é¢æ˜¯ç½‘å‹æ•´ç†çš„è¯¦ç»†çš„<a href="https://github.com/xxv/android-lifecycle">å‘¨æœŸå›¾æ¯”è¾ƒ</a>ã€‚</p>

<p><img src="/myimg/android/fragment.png" alt="image" /></p>

<h4>ç”¨Fragmentå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜</h4>

<h5>getActivity()ç©ºæŒ‡é’ˆ</h5>

<p>å¯èƒ½é‡åˆ°è¿‡getActivity()è¿”å›nullï¼Œæˆ–è€…å¹³æ—¶è¿è¡Œå®Œå¥½çš„ä»£ç ï¼Œåœ¨â€œå†…å­˜é‡å¯â€ä¹‹åï¼Œè°ƒç”¨getActivity()çš„åœ°æ–¹å´è¿”å›nullï¼ŒæŠ¥äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹çš„åŸå› ï¼šåœ¨è°ƒç”¨äº†getActivity()æ—¶ï¼Œå½“å‰çš„Fragmentå·²ç»onDetach()äº†å®¿ä¸»Activityã€‚æ¯”å¦‚åœ¨popäº†Fragmentä¹‹åï¼Œè¯¥Fragmentçš„å¼‚æ­¥ä»»åŠ¡ä»ç„¶åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œå®Œæˆåè°ƒç”¨äº†getActivity()æ–¹æ³•ï¼Œè¿™æ ·å°±ä¼šç©ºæŒ‡é’ˆã€‚</p>

<p>å¯ä»¥åœ¨FragmentåŸºç±»é‡Œè®¾ç½®ä¸€ä¸ªActivity mActivityçš„å…¨å±€å˜é‡ï¼Œåœ¨onAttach(Activity activity)é‡Œèµ‹å€¼ï¼Œä½¿ç”¨mActivityä»£æ›¿getActivity()ï¼Œä¿è¯Fragmentå³ä½¿åœ¨onDetachåï¼Œä»æŒæœ‰Activityçš„å¼•ç”¨ã€‚</p>

<h5>Fragmenté‡å é—®é¢˜</h5>

<p>å¦‚æœadd()äº†å‡ ä¸ªFragmentï¼Œç„¶åä½¿ç”¨show()ã€hide()æ–¹æ³•æ§åˆ¶ï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQçš„åº•éƒ¨tabç­‰æƒ…æ™¯ã€‚å¦‚æœä½ ä»€ä¹ˆéƒ½ä¸åšçš„è¯ï¼Œåœ¨â€œå†…å­˜é‡å¯â€åå›ï¼ŒTabçš„è¿™å‡ ä¸ªFragmentç•Œé¢ä¼šé‡å ã€‚(æ‰‹æœºæ¨ªç«–å±åˆ‡æ¢å°±å¯ä»¥æ¨¡æ‹Ÿâ€œå†…å­˜é‡å¯â€)ã€‚åŸå› æ˜¯FragmentManagerå¸®æˆ‘ä»¬ç®¡ç†Fragmentï¼Œå½“å‘ç”Ÿâ€œå†…å­˜é‡å¯â€ï¼Œä»–ä¼šä»æ ˆåº•å‘æ ˆé¡¶çš„é¡ºåºæ¢å¤Fragmentï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰ä¿å­˜Fragmentçš„hiddenå±æ€§ï¼Œé»˜è®¤ä¸ºfalseï¼Œæ‰€ä»¥æ‰€æœ‰Fragmentéƒ½æ˜¯ä»¥showçš„å½¢å¼æ¢å¤ï¼Œç•Œé¢å°±é‡å äº†ã€‚</p>

<h5>è§£å†³æ–¹æ³•ä¸€</h5>

<p>ä¸ç”¨add()çš„æ–¹å¼å¤„ç†tabçš„Fragmentï¼Œç›´æ¥åœ¨Activityçš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ éœ€è¦çš„Fragment,ç„¶ååœ¨Activityä¸­é€šè¿‡getFragmentManager().findFragmentById()çš„æ–¹å¼å¾—åˆ°Fragmentï¼Œç„¶åå¤„ç†å¯¹åº”çš„hide,showã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;fragment
</span><span class='line'>    android:id="@+id/fragment0"
</span><span class='line'>    android:name="com.suguiming.myandroid.tab0.Fragment0"
</span><span class='line'>    android:layout_above="@+id/tab_line"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    tools:layout="@layout/fragment_container"/&gt;
</span><span class='line'>&lt;fragment
</span><span class='line'>    android:id="@+id/fragment1"
</span><span class='line'>    android:name="com.suguiming.myandroid.tab1.Fragment1"
</span><span class='line'>    android:layout_above="@+id/tab_line"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    tools:layout="@layout/fragment_container"/&gt;</span></code></pre></td></tr></table></div></figure>


<h5>è§£å†³æ–¹æ³•äºŒ</h5>

<p>åœ¨ç”¨add()æˆ–è€…replace()æ—¶ä¸ºFragmentç»‘å®šä¸€ä¸ªtagï¼Œä¸€èˆ¬ç”¨fragmentçš„ç±»åä½œä¸ºtagï¼Œç„¶ååœ¨å‘ç”Ÿâ€œå†…å­˜é‡å¯â€æ—¶ï¼Œå³savedInstanceState!=null æ—¶ï¼Œé€šè¿‡getFragmentManager().findFragmentByTag()æ‰¾åˆ°å¯¹åº”çš„Fragmentï¼Œç„¶åhideã€show å¯¹åº”çš„Fragmentã€‚</p>

<pre><code>protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity);

TargetFragment targetFragment;
HideFragment hideFragment;

if (savedInstanceState != null) {  // â€œå†…å­˜é‡å¯â€æ—¶è°ƒç”¨
    targetFragment = getSupportFragmentManager().findFragmentByTag(TargetFragment.class.getName);
    hideFragment = getSupportFragmentManager().findFragmentByTag(HideFragment.class.getName);
    // è§£å†³é‡å é—®é¢˜
    getFragmentManager().beginTransaction()
            .show(targetFragment)
            .hide(hideFragment)
            .commit();
}else{  // æ­£å¸¸æ—¶
    targetFragment = TargetFragment.newInstance();
    hideFragment = HideFragment.newInstance();

    getFragmentManager().beginTransaction()
            .add(R.id.container, targetFragment, targetFragment.getClass().getName())
            .add(R.id,container,hideFragment,hideFragment.getClass().getName())
            .hide(hideFragment)
            .commit();
}
}
</code></pre>

<h5>è§£å†³æ–¹æ³•ä¸‰</h5>

<p>ç”±äºé€ æˆé‡å çš„åŸå› æ˜¯å› ä¸ºFragmentä¸ä¼šä¿å­˜hideçš„çŠ¶æ€ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åœ¨BaseFragmentä¸­æ‰‹åŠ¨ä¿å­˜ç„¶åå¤„ç†å•Šï¼</p>

<pre><code>private static final String FRAGMENT_IS_HIDDEN = "FRAGMENT_IS_HIDDEN";

@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    //è§£å†³é‡å é—®é¢˜
    if (savedInstanceState != null) {
        boolean isHidden = savedInstanceState.getBoolean(FRAGMENT_IS_HIDDEN);
        FragmentTransaction ft = getFragmentManager().beginTransaction();
        if (isHidden) {
            ft.hide(this);
        } else {
            ft.show(this);
        }
        ft.commit();
    }
}

@Override
public void onSaveInstanceState(Bundle outState) {
    super.onSaveInstanceState(outState);
    outState.putBoolean(FRAGMENT_IS_HIDDEN, isHidden());//ä¿æŒfragmentæ˜¯å¦éšè—çš„çŠ¶æ€
}
</code></pre>

<p>åœ¨ä½¿ç”¨æ—¶è¿˜æ˜¯è¦æ³¨æ„åˆ¤æ–­savedInstanceStateæ˜¯å¦ä¸ºnullï¼Œåªæœ‰åœ¨ä¸ºç©ºæ—¶æ‰add()ã€‚åœ¨ä¸ä¸ºç©ºæ—¶å°±å¯ä»¥ä¸ç”¨å¤„ç†äº†ï¼Œäº¤ç”±BaseFragmentå¤„ç†äº†ã€‚</p>
</div>
  
  


      | <a href="/blog/2016/09/01/fragment/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/31/android-swipe/">Androidæ‰‹åŠ¿æ»‘åŠ¨è¿”å›</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-31T15:16:10+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>3:16 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>å¶ç„¶é—´å‘ç°äº†ä¸€ä¸ªAndroidè‡ªå¸¦çš„æŠ½å±‰æ§ä»¶<a href="https://developer.android.com/training/implementing-navigation/nav-drawer.html">DrawerLayout</a>,å°±è§‰å¾—åº”è¯¥å¯ä»¥ç”¨ä»–æ¥å°è£…æˆæ‰‹åŠ¿è¿”å›çš„åŸºç¡€æ§ä»¶ã€‚æ€è·¯å°±æ˜¯å…ˆè®¾ç½®Activityçš„è·³è½¬åŠ¨ç”»æ˜¯ä»å³åˆ°å·¦ï¼Œå¹¶ä¸”å‰ä¸€ä¸ªActivityä¸èƒ½åŠ¨ã€‚ç„¶åè®¾ç½®DrawerLayoutçš„menuä»å³è¾¹å‡ºæ¥ï¼Œç„¶è®¾ç½®menuå…¨å±ï¼Œè¿™ä¸ªmenuå°±ç›¸å½“äºå­Activity Viewçš„å®¹å™¨ï¼Œé»˜è®¤æ‰“å¼€menu,ç„¶åè®¾ç½®DrawerLayoutå®¹å™¨é€æ˜ï¼Œå½“DrawerLayout closeçš„æ—¶å€™finishå®ƒæ‰€åœ¨çš„Activityï¼è¿˜è¦æŠŠçŠ¶æ€æ è®¾ç½®æˆé€æ˜ï¼Œä¸ç„¶DrawerLayout closed å† finish Activityçš„æ—¶å€™ä¼šæœ‰è§†è§‰å·®ï¼å¤æ‚çš„æ‰‹åŠ¿æ§åˆ¶å°±äº¤ç”±è‡ªå¸¦çš„DrawerLayoutå¤„ç†å•¦ï¼Œç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æœºæ™ºå¦‚æˆ‘ï¼ï¼ğŸ˜†</p>

<p>é‡åˆ°çš„é—®é¢˜ï¼šDrawerLayoutçš„menuå³æ—¶è®¾ç½®æˆmatch_parentä¹Ÿä¸èƒ½å…¨å±ï¼å› ä¸ºæºç é‡Œè®¾ç½®äº†margin64dp! é‚£æˆ‘ä»¬åªå¥½å†è®¾ç½®å›æ¥ï¼šandroid:layout_marginLeft=&ldquo;-64dp"ã€‚</p>

<pre><code> private static final int MIN_DRAWER_MARGIN = 64; // dp
</code></pre>

<p>BaseSwipeActivity</p>

<pre><code>package com.suguiming.myandroid.base;
import android.os.Bundle;
import android.support.v4.view.GravityCompat;
import android.support.v4.widget.DrawerLayout;
import android.support.v7.app.ActionBarDrawerToggle;
import android.support.v7.app.AppCompatActivity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.WindowManager;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;

import com.suguiming.myandroid.R;

public class BaseSwipeActivity extends AppCompatActivity {

private DrawerLayout drawer;
private LinearLayout containerLayout;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
    setContentView(R.layout.activity_base_swipe);

    containerLayout = (LinearLayout) findViewById(R.id.container_layout);

    drawer = (DrawerLayout) findViewById(R.id.base_drawer_layout);
    drawer.openDrawer(GravityCompat.END);
    ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(this, drawer, R.string.navigation_drawer_open, R.string.navigation_drawer_close) {
        @Override
        public void onDrawerClosed(View drawerView) {
            super.onDrawerClosed(drawerView);
            finish();
        }
    };
    drawer.setDrawerListener(toggle);
}

//å­ç±»ä¸è¦ç”¨setContentView,ç”¨setMainView!!!!
public void setMainView(int viewId) {
    LayoutInflater inflater = LayoutInflater.from(this);
    View tmpView = inflater.inflate(viewId, null);

    if (tmpView instanceof LinearLayout) {
        LinearLayout.LayoutParams linearLayoutParams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(linearLayoutParams);
    } else if (tmpView instanceof RelativeLayout) {
        RelativeLayout.LayoutParams relativeLayoutParams = new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT);
        tmpView.setLayoutParams(relativeLayoutParams);
    }
    containerLayout.removeAllViews();
    containerLayout.addView(tmpView);
}

}
</code></pre>

<p>å¯¹åº”çš„å¸ƒå±€æ–‡ä»¶</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="@android:color/transparent"
    tools:context="com.suguiming.myandroid.base.BaseSwipeActivity"&gt;

&lt;android.support.v4.widget.DrawerLayout
    android:id="@+id/base_drawer_layout"
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/transparent"
    tools:openDrawer="end"&gt;
    &lt;LinearLayout
        android:orientation="vertical"
        android:background="@color/clear"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;
    &lt;/LinearLayout&gt;

    &lt;!---64dpæ˜¯æºç menuçš„margin,è¿™é‡Œè®¾ç½®ä¸º65,ä¸ç„¶ä¼šæœ‰ä¸€æ¡é»‘çº¿--&gt;
    &lt;LinearLayout
        android:id="@+id/container_layout"
        android:orientation="vertical"
        android:layout_gravity="end"
        android:layout_marginLeft="-65dp"
        android:background="@color/light_gray"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;
    &lt;/LinearLayout&gt;
&lt;/android.support.v4.widget.DrawerLayout&gt;
&lt;/LinearLayout&gt;
</code></pre>

<p>push çš„åŠ¨ç”» style</p>

<pre><code>&lt;!--æ‰‹åŠ¿è¿”å›theme--&gt;
&lt;style name="BackSwipeTheme" parent="Theme.AppCompat.Light.NoActionBar"&gt;
    &lt;item name="android:windowIsTranslucent"&gt;true&lt;/item&gt;
    &lt;item name="android:windowBackground"&gt;@android:color/transparent&lt;/item&gt;
    &lt;item name="android:windowNoTitle"&gt;true&lt;/item&gt;
    &lt;item name="android:backgroundDimEnabled"&gt;false&lt;/item&gt;
    &lt;item name="android:windowAnimationStyle"&gt;@style/ActivitySwipeBackAnimation&lt;/item&gt;
&lt;/style&gt;
&lt;style name="ActivitySwipeBackAnimation" parent="@android:style/Animation.Activity"&gt;
    &lt;item name="android:activityOpenEnterAnimation"&gt;@anim/activity_swipe_in&lt;/item&gt;
    &lt;item name="android:activityOpenExitAnimation"&gt;@anim/activity_swipe_out&lt;/item&gt;
    &lt;item name="android:activityCloseEnterAnimation"&gt;@anim/activity_swipe_in&lt;/item&gt;
    &lt;item name="android:activityCloseExitAnimation"&gt;@anim/activity_swipe_out&lt;/item&gt;
&lt;/style&gt;
</code></pre>

<p>ä½¿ç”¨çš„è¯å°±æ˜¯è®©Activityç»§æ‰¿BaseSwipeActivityï¼Œç„¶åè®¾ç½®Activityçš„Themeä¸ºBackSwipeThemeã€‚</p>

<pre><code>public class ActivitySwipeBack extends BaseSwipeActivity {
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    //è¦ç”¨setMainViewï¼Œä¸è¦ç”¨setContentView
    setMainView(R.layout.activity_activity_swipe_back);
  }
}

&lt;activity android:name=".tab0.ActivitySwipeBack"
            android:theme="@style/BackSwipeTheme"/&gt;
</code></pre>

<p>å®Œæ•´Demoè¯·æŸ¥çœ‹<a href="https://github.com/AndyFightting/MyAndroid">MyAndroid</a>ä¸­çš„"æ‰‹åŠ¿æ»‘åŠ¨è¿”å›"ã€‚</p>

<p><img src="/myimg/android/android_swipe.png" alt="imge" /></p>
</div>
  
  


      | <a href="/blog/2016/08/31/android-swipe/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/04/swift-read/">Swift</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-04T16:23:05+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>let å£°æ˜å¸¸é‡ï¼Œvar å£°æ˜å˜é‡ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹æ¨æ–­(å°æ•°æ¨æ–­ä¸ºDouble),ä¸€è¡Œæœ«å°¾å¯ä¸åŠ åˆ†å·(;)ã€‚
</span><span class='line'>å€¼æ°¸è¿œä¸ä¼šè¢«éšå¼è½¬æ¢ä¸ºå…¶ä»–ç±»å‹ï¼ŒåŠ¡å¿…æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢ã€‚
</span><span class='line'>ifè¯­å¥çš„æ¡ä»¶ä¸èƒ½é»˜è®¤é0ä¸ºçœŸã€‚ ç±»å‹ååŠ ?å·è¡¨ç¤ºå¯é€‰å€¼ï¼Œè¦ä¹ˆæœ‰å€¼ï¼Œè¦ä¹ˆæ˜¯nilã€‚
</span><span class='line'>ç”¨ if let(æˆ–è€…var) name = optionName æ¥è·å–å¯é€‰å€¼å¤„ç†ã€‚ 
</span><span class='line'>`??` æ“ä½œç¬¦æ¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚å¦‚æœ`å¯é€‰å€¼`ç¼ºå¤±çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼æ¥ä»£æ›¿ã€‚
</span><span class='line'>let nickName: String? = nil
</span><span class='line'>let fullName: String = "John Appleseed"
</span><span class='line'>let informalGreeting = "Hi \(nickName ?? fullName)"
</span><span class='line'>switchæ”¯æŒä»»æ„ç±»å‹çš„æ•°æ®ä»¥åŠå„ç§æ¯”è¾ƒæ“ä½œâ€”â€”ä¸ä»…ä»…æ˜¯æ•´æ•°ä»¥åŠæµ‹è¯•ç›¸ç­‰ã€‚
</span><span class='line'>switchçš„caseä¸­è‡ªå¸¦breakï¼Œswitchè¦ä¿è¯å…¨éƒ¨éå†ï¼Œå¦åˆ™å¿…é¡»è¦æœ‰defaulté€‰é¡¹ã€‚
</span><span class='line'>å­—å…¸æ˜¯ä¸€ä¸ªæ— åºçš„é›†åˆï¼Œæ‰€ä»¥ä»–ä»¬çš„é”®å’Œå€¼ä»¥ä»»æ„é¡ºåºè¿­ä»£ç»“æŸã€‚
</span><span class='line'>do while --&gt; repeat while.
</span><span class='line'>0&lt;= x &lt;4 ç­‰ä»· 0..&lt;4 , 0&lt;= x &lt;=4 ç­‰ä»· 0...4 ã€‚ 
</span><span class='line'>ç”¨ func å£°æ˜å‡½æ•°ï¼Œç”¨-&gt;æŒ‡å®šè¿”å›ç±»å‹func greet(name: String, day: String) -&gt; String { ... }ã€‚ 
</span><span class='line'>å‚æ•°åå‰ç”¨ _ è¡¨ç¤ºä¸é€‚ç”¨å‚æ•°æ ‡ç­¾ã€‚å‚æ•°å‰é¢æ·»åŠ å­—ç¬¦é‡æ–°å®šä¹‰é€‚ç”¨çš„å‚æ•°åã€‚
</span><span class='line'>å…ƒç»„æ¦‚å¿µï¼Œä¸€èˆ¬ç”¨åšå‡½æ•°è¿”å›å€¼ã€‚ -&gt; (min: Int, max: Int, sum: Int) ã€‚
</span><span class='line'>func sumOf(numbers: Int...) -&gt; Int {}ï¼Œ...è¡¨ç¤ºå¯å˜ä¸ªæ•°çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨å‡½æ•°å†…è¡¨ç°ä¸ºæ•°ç»„çš„å½¢å¼ã€‚
</span><span class='line'>å‡½æ•°å¯ä»¥åµŒå¥—ã€‚è¢«åµŒå¥—çš„å‡½æ•°å¯ä»¥è®¿é—®å¤–ä¾§å‡½æ•°çš„å˜é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨åµŒå¥—å‡½æ•°æ¥é‡æ„ä¸€ä¸ªå¤ªé•¿æˆ–è€…å¤ªå¤æ‚çš„å‡½æ•°ã€‚
</span><span class='line'>å‡½æ•°æ˜¯ä¸€ç­‰ç±»å‹ï¼Œåƒint floatä¸€æ ·ï¼Œå¯ç”¨ä½œå‚æ•°æˆ–è€…è¿”å›å€¼ã€‚ 
</span><span class='line'>å¯ä»¥ä½¿ç”¨{}æ¥åˆ›å»ºä¸€ä¸ªåŒ¿åé—­åŒ…ã€‚ä½¿ç”¨inå°†å‚æ•°å’Œè¿”å›å€¼ç±»å‹å£°æ˜ä¸é—­åŒ…å‡½æ•°ä½“è¿›è¡Œåˆ†ç¦»ã€‚
</span><span class='line'>numbers.map({
</span><span class='line'>    (number: Int) -&gt; Int in
</span><span class='line'>    let result = 3 * number
</span><span class='line'>    return result
</span><span class='line'>})
</span><span class='line'>åŒ¿åé—­åŒ…å¯ä»¥æœ‰å¾ˆå¤šç§ç¼©å†™ï¼š
</span><span class='line'>let mappedNumbers = numbers.map({ number in 3 * number })
</span><span class='line'>let sortedNumbers = numbers.sort { $0 &gt; $1 }
</span><span class='line'>é—­åŒ…ä¼˜åŒ–ï¼š
</span><span class='line'>åˆ©ç”¨ä¸Šä¸‹æ–‡æ¨æ–­å‚æ•°å’Œè¿”å›å€¼ç±»å‹
</span><span class='line'>éšå¼è¿”å›å•è¡¨è¾¾å¼é—­åŒ…ï¼Œå³å•è¡¨è¾¾å¼é—­åŒ…å¯ä»¥çœç•¥ return å…³é”®å­—
</span><span class='line'>å‚æ•°åç§°ç¼©å†™
</span><span class='line'>å°¾éšé—­åŒ…è¯­æ³•
</span><span class='line'>{ (parameters) -&gt; returnType in
</span><span class='line'>    statements
</span><span class='line'>}
</span><span class='line'>class å£°æ˜ç±»,å±æ€§éƒ½è¦èµ‹å€¼ï¼Œè¦ä¹ˆåœ¨å£°æ˜ç›´æ¥å†™æ­»ï¼Œè¦ä¹ˆåœ¨initæ–¹æ³•ä¸­èµ‹å€¼ã€‚ ä½¿ç”¨deinitåˆ›å»ºä¸€ä¸ªææ„å‡½æ•°ã€‚
</span><span class='line'>funcå…³é”®å­—ä¹‹å‰åŠ ä¸Šå…³é”®å­—staticï¼Œæ¥æŒ‡å®šç±»æ–¹æ³•ã€‚è¿˜å¯ä»¥ç”¨å…³é”®å­—classæ¥å…è®¸å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚(static = final + class)(ä¸å¯é‡å†™çš„ç±»æ–¹æ³•)
</span><span class='line'>é‡å†™çˆ¶ç±»æ–¹æ³•å¿…é¡»ç”¨ override æ ‡è®°ã€‚ å±æ€§å¯ä»¥æœ‰get set willGet didSet ç­‰æ–¹æ³•ã€‚ 
</span><span class='line'>mutatingå…³é”®å­—ç”¨æ¥æ ‡è®°ä¸€ä¸ªä¼šä¿®æ”¹ç»“æ„ä½“(å±æ€§)çš„æ–¹æ³•ã€‚ 
</span><span class='line'>extensionæ¥ä¸ºç°æœ‰çš„ç±»å‹æ·»åŠ åŠŸèƒ½ï¼Œæ¯”å¦‚æ–°çš„æ–¹æ³•å’Œè®¡ç®—å±æ€§ã€‚
</span><span class='line'>æ³›å‹(æŒ‡å®šç±»å‹)å°±æ˜¯javaä¸­çš„æ³›å‹ã€‚ Boolå€¼æ˜¯trueæˆ–falseã€‚ 
</span><span class='line'>typealies name = ç±»å‹ ç»™ç±»å‹èµ·ä¸ªåˆ«åã€‚ 
</span><span class='line'>OCä¸­çš„nilåªç”¨åœ¨å¯¹è±¡ä¸Š(intä¸è¡Œ)ï¼ŒSwiftä¸­nilå¯æŒ‡ä»»ä½•ä¸œè¥¿(å¯¹è±¡æˆ–int)ã€‚
</span><span class='line'>ä½¿ç”¨!æ¥è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å¯é€‰å€¼ä¼šå¯¼è‡´é”™è¯¯ã€‚éšå¼è§£æå¯é€‰ç±»å‹(ç±»å‹!)å°±æ˜¯å¯é€‰ç±»å‹ï¼Œä½†æ˜¯å¯ä»¥å½“åšéå¯é€‰ç±»å‹æ¥ä½¿ç”¨(ä¸ç”¨!è§£æ,æ²¡å€¼æ—¶ä¼šæŠ¥é”™)ã€‚ 
</span><span class='line'>throws do try catch çš„ä½¿ç”¨ã€‚Swiftçš„èµ‹å€¼æ“ä½œä¸è¿”å›ä»»ä½•å€¼ã€‚% æµ®ç‚¹æ•°ä¹Ÿå¯ä»¥å–ä½™è¿ç®—ã€‚ 
</span><span class='line'>ç©ºåˆè¿ç®—ç¬¦(a ?? b)å¯¹å¯é€‰ç±»å‹aè¿›è¡Œç©ºåˆ¤æ–­ï¼Œå¦‚æœaåŒ…å«ä¸€ä¸ªå€¼å°±è¿›è¡Œè§£å°ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªé»˜è®¤å€¼b(bå’Œaè¦ç±»å‹ç›¸åŒ)ã€‚é€»è¾‘ &&ï¼Œ|| éƒ½æ˜¯çŸ­è·¯è®¡ç®—çš„ã€‚
</span><span class='line'>æ¡ä»¶ä¸­çš„ä¸‹åˆ’çº¿ _ æ¥å¿½ç•¥å¯¹å€¼çš„è®¿é—®ï¼Œcase ä¸­çš„ä¸‹åˆ’çº¿ _ è¡¨ç¤ºæ‰€æœ‰å¯èƒ½çš„å€¼,caseä¸­å¯è¿›è¡Œå€¼ç»‘å®šï¼Œcaseæ¡ä»¶å¯ç”¨whereè¯­å¥ã€‚ 
</span><span class='line'>å­—å…¸çš„éå†é¡ºåºå’Œæ’å…¥é¡ºåºå¯èƒ½ä¸åŒ(å­—å…¸æ— åºçš„)ã€‚ 
</span><span class='line'>Swiftè¯­è¨€çš„repeat-whileå¾ªç¯åˆå…¶ä»–è¯­è¨€ä¸­çš„do-whileå¾ªç¯æ˜¯ç±»ä¼¼çš„ã€‚
</span><span class='line'>æ³¨æ„å¾ªç¯ä¸­switchä¸­çš„continue(å¼€å§‹ä¸‹æ¬¡)å’Œbreak(è·³åˆ°switch}åé¢ç»§ç»­æ‰§è¡Œ)çš„å·®åˆ«ï¼Œswitchä¸­çš„fallthrouthè¿›å…¥ä¸‹ä¸€ä¸ªcaseæ—¶ä¸ä¼šå†è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚
</span><span class='line'>guard(å®ˆå«)è¯­å¥æ€»æ˜¯æœ‰ä¸€ä¸ªelseåˆ†å¥ã€‚ 
</span><span class='line'>è°ƒç”¨å‡½æ•°æ—¶ç¬¬ä¸€ä¸ªå‚æ•°åä¸è¦ï¼Œä¹‹åçš„å‚æ•°åè¦ï¼Œç”¨é€—å·åˆ†å¼€(ç¬¬ä¸€ä¸ªå‚æ•°çœç•¥å…¶å¤–éƒ¨å‚æ•°åï¼Œç¬¬äºŒä¸ªä»¥åçš„å‚æ•°ä½¿ç”¨å…¶æœ¬åœ°å‚æ•°åä½œä¸ºè‡ªå·±çš„å¤–éƒ¨å‚æ•°åã€‚
</span><span class='line'>æ‰€æœ‰å‚æ•°éœ€è¦æœ‰ä¸åŒçš„æœ¬åœ°å‚æ•°åï¼Œä½†å¯ä»¥å…±äº«ç›¸åŒçš„å¤–éƒ¨å‚æ•°åã€‚å¦‚æœä½ æä¾›äº†å¤–éƒ¨å‚æ•°åï¼Œé‚£ä¹ˆå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å¤–éƒ¨å‚æ•°åã€‚å¦‚æœä½ ä¸æƒ³ä¸ºç¬¬äºŒä¸ªåŠåç»­çš„å‚æ•°è®¾ç½®å‚æ•°åï¼Œç”¨ä¸‹åˆ’çº¿_ä»£æ›¿)ã€‚
</span><span class='line'>ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å‚æ•°(...),å¦‚æœå‡½æ•°åŒæ—¶æœ‰é»˜è®¤å‚æ•°å’Œå¯å˜å‚æ•°è¦æŠŠå¯å˜å‚æ•°æ”¾æœ€åã€‚ 
</span><span class='line'>å‡½æ•°å‚æ•°é»˜è®¤æ˜¯å¸¸é‡ï¼Œä¿®æ”¹ä¼šæŠ¥é”™ï¼Œä½†å¯ä»¥ç”¨varå£°æ˜ä¸ºå˜é‡,ä¿®æ”¹åªåœ¨å‡½æ•°ä½“å†…æœ‰æ•ˆã€‚ 
</span><span class='line'>inoutå‚æ•°(åªèƒ½ä¼ å…¥å˜é‡)ä¼šæ›¿æ¢åŸæ¥çš„å€¼ï¼Œä½¿ç”¨æ—¶åœ¨å˜é‡åå‰åŠ &ç¬¦å·ã€‚ 
</span><span class='line'>åŸæ•°ç»„ä¸ä¼šè¢«sort()æ–¹æ³•ä¿®æ”¹ã€‚ é—­åŒ…å°±æ˜¯ç”¨{}åŒ…èµ·æ¥çš„å‡½æ•°ä»£ç å—ï¼Œç”¨inåˆ†å¼€è¿”å›å€¼å’Œå¤„ç†ä»£ç ï¼Œå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚å¦‚æœéœ€è¦å°†é—­åŒ…ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå¯å˜æˆå°¾éšé—­åŒ…ã€‚
</span><span class='line'>Arrayçš„mapæ–¹æ³•å¯è¿”å›ä¸åŒç±»å‹ã€‚ å‡½æ•°å’Œé—­åŒ…éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚
</span><span class='line'>ç»“æ„ä½“å’Œæšä¸¾æ˜¯å€¼ç±»å‹ï¼Œæ‰€æœ‰çš„åŸºæœ¬ç±»å‹éƒ½æ˜¯å€¼ç±»å‹ï¼Œå¹¶ä¸”éƒ½æ˜¯ä»¥ç»“æ„ä½“çš„å½¢å¼åœ¨åå°æ‰€å®ç°ã€‚
</span><span class='line'>é»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼ç±»å‹çš„å±æ€§ä¸èƒ½åœ¨å®ƒçš„å®ä¾‹æ–¹æ³•ä¸­è¢«ä¿®æ”¹ã€‚å¦‚æœä½ ç¡®å®éœ€è¦åœ¨æŸä¸ªç‰¹å®šçš„æ–¹æ³•ä¸­ä¿®æ”¹ç»“æ„ä½“æˆ–è€…æšä¸¾çš„å±æ€§ï¼Œä½ å¯ä»¥ä¸ºè¿™ä¸ªæ–¹æ³•é€‰æ‹©å¯å˜(mutating)è¡Œä¸ºï¼Œ
</span><span class='line'>ç„¶åå°±å¯ä»¥ä»å…¶æ–¹æ³•å†…éƒ¨æ”¹å˜å®ƒçš„å±æ€§.å¹¶ä¸”è¿™ä¸ªæ–¹æ³•åšçš„ä»»ä½•æ”¹å˜éƒ½ä¼šåœ¨æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶å†™å›åˆ°åŸå§‹ç»“æ„ä¸­ã€‚
</span><span class='line'>æ–¹æ³•è¿˜å¯ä»¥ç»™å®ƒéšå«çš„selfå±æ€§èµ‹äºˆä¸€ä¸ªå…¨æ–°çš„å®ä¾‹ï¼Œè¿™ä¸ªæ–°å®ä¾‹åœ¨æ–¹æ³•ç»“æŸæ—¶ä¼šæ›¿æ¢ç°å­˜å®ä¾‹ã€‚
</span><span class='line'>ä¸èƒ½åœ¨ç»“æ„ä½“ç±»å‹çš„å¸¸é‡ä¸Šè°ƒç”¨å¯å˜æ–¹æ³•ï¼Œå› ä¸ºå…¶å±æ€§ä¸èƒ½è¢«æ”¹å˜ï¼Œå³ä½¿å±æ€§æ˜¯å˜é‡å±æ€§.
</span><span class='line'>var somePoint = Point(x: 1.0, y: 1.0) //somePointæ˜¯varå°±å¯ä»¥
</span><span class='line'>somePoint.moveByX(2.0, y: 3.0)
</span><span class='line'>let fixedPoint = Point(x: 3.0, y: 3.0)
</span><span class='line'>fixedPoint.moveByX(2.0, y: 3.0)//å› ä¸ºfixedPointæ˜¯let è¿™é‡Œå°†ä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯
</span><span class='line'>ç±»æ˜¯å¼•ç”¨ç±»å‹ã€‚å¸¸é‡å®ä¾‹ä¾ç„¶å¯æ”¹å˜å…¶ä¸­çš„å˜é‡å±æ€§å€¼ã€‚
</span><span class='line'>å¿…é¡»å°†å»¶è¿Ÿå­˜å‚¨å±æ€§å£°æ˜æˆå˜é‡ï¼ˆä½¿ç”¨ var å…³é”®å­—ï¼‰ï¼Œå› ä¸ºå±æ€§çš„åˆå§‹å€¼å¯èƒ½åœ¨å®ä¾‹æ„é€ å®Œæˆä¹‹åæ‰ä¼šå¾—åˆ°ã€‚è€Œå¸¸é‡å±æ€§åœ¨æ„é€ è¿‡ç¨‹å®Œæˆä¹‹å‰å¿…é¡»è¦æœ‰åˆå§‹å€¼ï¼Œå› æ­¤æ— æ³•å£°æ˜æˆå»¶è¿Ÿå±æ€§ã€‚
</span><span class='line'>å¦‚æœä¸€ä¸ªè¢«æ ‡è®°ä¸º lazy çš„å±æ€§åœ¨æ²¡æœ‰åˆå§‹åŒ–æ—¶å°±åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œåˆ™æ— æ³•ä¿è¯è¯¥å±æ€§åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚
</span><span class='line'>è®¡ç®—å±æ€§ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ª get å’Œä¸€ä¸ªå¯é€‰çš„ setï¼Œæ¥é—´æ¥è·å–å’Œè®¾ç½®å…¶ä»–å±æ€§æˆ–å˜é‡çš„å€¼ã€‚
</span><span class='line'>swiftæŒ‡é’ˆå¹¶ä¸ç›´æ¥æŒ‡å‘å†…å­˜ä¸­çš„æŸä¸ªåœ°å€ï¼Œè€Œä¸”ä¹Ÿä¸è¦æ±‚ä½ ä½¿ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰æ¥è¡¨æ˜ä½ åœ¨åˆ›å»ºä¸€ä¸ªå¼•ç”¨ã€‚
</span><span class='line'>ç»“æ„ä½“å®ä¾‹æ€»æ˜¯é€šè¿‡å€¼ä¼ é€’ï¼Œç±»å®ä¾‹æ€»æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’ã€‚
</span><span class='line'>Swift ä¸­å­—ç¬¦ä¸²ï¼ˆStringï¼‰,æ•°ç»„ï¼ˆArrayï¼‰å’Œå­—å…¸ï¼ˆDictionaryï¼‰å‡ä»¥ç»“æ„ä½“çš„å½¢å¼å®ç°çš„å€¼ç±»å‹,è€Œåœ¨OCä¸­æ˜¯ä»¥ç±»çš„å½¢å¼å®ç°çš„å¼•ç”¨ç±»å‹ã€‚
</span><span class='line'>è®¡ç®—å±æ€§å¯ä»¥ç”¨äºç±»ã€ç»“æ„ä½“å’Œæšä¸¾ï¼Œå­˜å‚¨å±æ€§åªèƒ½ç”¨äºç±»å’Œç»“æ„ä½“ã€‚
</span><span class='line'>å¦‚æœåˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹å¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡ï¼Œåˆ™æ— æ³•ä¿®æ”¹è¯¥å®ä¾‹çš„ä»»ä½•å±æ€§ï¼Œå³ä½¿å®šä¹‰äº†å˜é‡å­˜å‚¨å±æ€§ï¼Œç”±äºç»“æ„ä½“ï¼ˆstructï¼‰å±äºå€¼ç±»å‹ï¼Œå½“å€¼ç±»å‹çš„å®ä¾‹è¢«å£°æ˜ä¸ºå¸¸é‡çš„æ—¶å€™ï¼Œå®ƒçš„æ‰€æœ‰å±æ€§ä¹Ÿå°±æˆäº†å¸¸é‡ã€‚
</span><span class='line'>å¦‚æœåˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹å¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡ï¼Œåˆ™æ— æ³•ä¿®æ”¹è¯¥å®ä¾‹çš„ä»»ä½•å±æ€§ï¼Œå³ä½¿æœ‰å±æ€§è¢«å£°æ˜ä¸ºå˜é‡ä¹Ÿä¸è¡Œ.
</span><span class='line'>è¿™ç§è¡Œä¸ºæ˜¯ç”±äºç»“æ„ä½“ï¼ˆstructï¼‰å±äºå€¼ç±»å‹ã€‚å½“å€¼ç±»å‹çš„å®ä¾‹è¢«å£°æ˜ä¸ºå¸¸é‡çš„æ—¶å€™ï¼Œå®ƒçš„æ‰€æœ‰å±æ€§ä¹Ÿå°±æˆäº†å¸¸é‡ã€‚
</span><span class='line'>å¼•ç”¨ç±»å‹çš„ç±»ï¼ˆclassï¼‰åˆ™ä¸ä¸€æ ·ã€‚æŠŠä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å®ä¾‹èµ‹ç»™ä¸€ä¸ªå¸¸é‡åï¼Œä»ç„¶å¯ä»¥ä¿®æ”¹è¯¥å®ä¾‹çš„å˜é‡å±æ€§ã€‚
</span><span class='line'>å¿…é¡»å°†å»¶è¿Ÿå­˜å‚¨å±æ€§å£°æ˜æˆå˜é‡ï¼ˆä½¿ç”¨varå…³é”®å­—ï¼‰ï¼Œå› ä¸ºå±æ€§çš„åˆå§‹å€¼å¯èƒ½åœ¨å®ä¾‹æ„é€ å®Œæˆä¹‹åæ‰ä¼šå¾—åˆ°ã€‚
</span><span class='line'>ç»“æ„ä½“æ€»æ˜¯é€šè¿‡è¢«å¤åˆ¶çš„æ–¹å¼åœ¨ä»£ç ä¸­ä¼ é€’ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚
</span><span class='line'>è€Œå¸¸é‡å±æ€§åœ¨æ„é€ è¿‡ç¨‹å®Œæˆä¹‹å‰å¿…é¡»è¦æœ‰åˆå§‹å€¼ï¼Œå› æ­¤æ— æ³•å£°æ˜æˆå»¶è¿Ÿå±æ€§ã€‚
</span><span class='line'>è®¡ç®—å±æ€§ä¸ç›´æ¥å­˜å‚¨å€¼ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ª getå’Œä¸€ä¸ªå¯é€‰çš„setï¼Œæ¥é—´æ¥è·å–å’Œè®¾ç½®å…¶ä»–å±æ€§æˆ–å˜é‡çš„å€¼ã€‚
</span><span class='line'>å¿…é¡»ä½¿ç”¨varå…³é”®å­—å®šä¹‰è®¡ç®—å±æ€§ï¼ŒåŒ…æ‹¬åªè¯»è®¡ç®—å±æ€§ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ä¸æ˜¯å›ºå®šçš„ã€‚
</span><span class='line'>çˆ¶ç±»çš„å±æ€§åœ¨å­ç±»çš„æ„é€ å™¨ä¸­è¢«èµ‹å€¼æ—¶ï¼Œå®ƒåœ¨çˆ¶ç±»ä¸­çš„willSetå’ŒdidSetè§‚å¯Ÿå™¨ä¼šè¢«è°ƒç”¨ã€‚
</span><span class='line'>å…¨å±€çš„å¸¸é‡æˆ–å˜é‡éƒ½æ˜¯å»¶è¿Ÿè®¡ç®—çš„ï¼Œè·Ÿå»¶è¿Ÿå­˜å‚¨å±æ€§ç›¸ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå…¨å±€çš„å¸¸é‡æˆ–å˜é‡ä¸éœ€è¦æ ‡è®°lazyç‰¹æ€§ã€‚å±€éƒ¨èŒƒå›´çš„å¸¸é‡æˆ–å˜é‡ä¸ä¼šå»¶è¿Ÿè®¡ç®—ã€‚
</span><span class='line'>å¿…é¡»ç»™å­˜å‚¨ç±»å‹çš„ç±»å±æ€§æŒ‡å®šé»˜è®¤å€¼ï¼Œå› ä¸ºç±»å‹æœ¬èº«æ— æ³•åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨æ„é€ å™¨ç»™ç±»å‹å±æ€§èµ‹å€¼ã€‚
</span><span class='line'>ç»“æ„ä½“å’Œæšä¸¾èƒ½å¤Ÿå®šä¹‰æ–¹æ³•æ˜¯ Swift ä¸ C/Objective-C çš„ä¸»è¦åŒºåˆ«ä¹‹ä¸€ã€‚
</span><span class='line'>é‡å†™ç±»åªèƒ½æ‰©å¤§èŒƒå›´è€Œä¸èƒ½ç¼©å°èŒƒå›´ï¼Œå¦‚æŠŠåªè¯»å±æ€§é‡å†™ä¸ºè¯»å†™å±æ€§ï¼Œè€Œä¸èƒ½åè¿‡æ¥ã€‚æœ‰setterçš„è¯å¿…é¡»ä¹Ÿæä¾›getterã€‚é‡å†™å±æ€§å¿…é¡»å†™ä¸Šç±»å‹ã€‚é€šè¿‡æ ‡è®°finalæ¥è¡¨ç¤ºä¸å¯è¢«ç»§æ‰¿æˆ–é‡å†™ã€‚
</span><span class='line'>ä¸‹æ ‡å¯ä»¥å®šä¹‰åœ¨ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ä¸­ï¼Œæ˜¯è®¿é—®é›†åˆï¼Œåˆ—è¡¨æˆ–åºåˆ—ä¸­å…ƒç´ çš„å¿«æ·æ–¹å¼ã€‚å¯ä»¥ä½¿ç”¨ä¸‹æ ‡çš„ç´¢å¼•ï¼Œè®¾ç½®å’Œè·å–å€¼ï¼Œè€Œä¸éœ€è¦å†è°ƒç”¨å¯¹åº”çš„å­˜å–æ–¹æ³•ã€‚
</span><span class='line'>ä¸‹æ ‡å…è®¸ä½ é€šè¿‡åœ¨å®ä¾‹åç§°åé¢çš„æ–¹æ‹¬å·ä¸­ä¼ å…¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•å€¼æ¥å¯¹å®ä¾‹è¿›è¡Œå­˜å–ã€‚è¯­æ³•ç±»ä¼¼äºå®ä¾‹æ–¹æ³•è¯­æ³•å’Œè®¡ç®—å‹å±æ€§è¯­æ³•çš„æ··åˆã€‚
</span><span class='line'>ä¸å®ä¾‹æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œä¸‹æ ‡å¯ä»¥è®¾å®šä¸ºè¯»å†™æˆ–åªè¯»ã€‚å¯ä»¥ä¸æŒ‡å®š setter çš„å‚æ•°ï¼ˆnewValueï¼‰ã€‚å¦‚æœä¸æŒ‡å®šå‚æ•°ï¼Œsetter ä¼šæä¾›ä¸€ä¸ªåä¸ºnewValueçš„é»˜è®¤å‚æ•°ã€‚
</span><span class='line'>æ‰€æœ‰ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜é€ä¸€æ„é€ å™¨ï¼Œç”¨äºåˆå§‹åŒ–æ–°ç»“æ„ä½“å®ä¾‹ä¸­æˆå‘˜çš„å±æ€§ã€‚ä¸ç»“æ„ä½“ä¸åŒï¼Œç±»å®ä¾‹æ²¡æœ‰é»˜è®¤çš„æˆå‘˜é€ä¸€æ„é€ å™¨ã€‚
</span><span class='line'>åœ¨ Swift ä¸­ï¼Œæ‰€æœ‰çš„åŸºæœ¬ç±»å‹ï¼šæ•´æ•°ï¼ˆIntegerï¼‰ã€æµ®ç‚¹æ•°ï¼ˆfloating-pointï¼‰ã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆstring)ã€æ•°ç»„ï¼ˆarrayï¼‰å’Œå­—å…¸ï¼ˆdictionaryï¼‰ï¼Œ
</span><span class='line'>éƒ½æ˜¯å€¼ç±»å‹ï¼Œå¹¶ä¸”åœ¨åº•å±‚éƒ½æ˜¯ä»¥ç»“æ„ä½“çš„å½¢å¼æ‰€å®ç°ã€‚å€¼ç±»å‹è¢«èµ‹äºˆç»™ä¸€ä¸ªå˜é‡ã€å¸¸é‡æˆ–è€…è¢«ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå…¶å€¼ä¼šè¢«æ‹·è´ã€‚
</span><span class='line'>ç±»çš„å®ä¾‹å³æ—¶æ˜¯letä¹Ÿå¯ä»¥æ”¹å˜ç±»é‡Œçš„varå±æ€§ã€‚
</span><span class='line'>===æ£€æµ‹ä¸¤ä¸ªç±»å¸¸é‡æˆ–è€…å˜é‡æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå®ä¾‹ã€‚(å€¼ç±»å‹ä¸å­˜åœ¨å¼•ç”¨ä¹‹è¯´ï¼Œéƒ½æ˜¯copy)
</span><span class='line'>ç»“æ„ä½“é€‚ç”¨æƒ…å†µï¼š
</span><span class='line'>è¯¥æ•°æ®ç»“æ„çš„ä¸»è¦ç›®çš„æ˜¯ç”¨æ¥å°è£…å°‘é‡ç›¸å…³ç®€å•æ•°æ®å€¼ã€‚
</span><span class='line'>æœ‰ç†ç”±é¢„è®¡è¯¥æ•°æ®ç»“æ„çš„å®ä¾‹åœ¨è¢«èµ‹å€¼æˆ–ä¼ é€’æ—¶ï¼Œå°è£…çš„æ•°æ®å°†ä¼šè¢«æ‹·è´è€Œä¸æ˜¯è¢«å¼•ç”¨ã€‚
</span><span class='line'>è¯¥æ•°æ®ç»“æ„ä¸­å‚¨å­˜çš„å€¼ç±»å‹å±æ€§ï¼Œä¹Ÿåº”è¯¥è¢«æ‹·è´ï¼Œè€Œä¸æ˜¯è¢«å¼•ç”¨ã€‚
</span><span class='line'>è¯¥æ•°æ®ç»“æ„ä¸éœ€è¦å»ç»§æ‰¿å¦ä¸€ä¸ªæ—¢æœ‰ç±»å‹çš„å±æ€§æˆ–è€…è¡Œä¸ºã€‚
</span><span class='line'>ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æ‹¥æœ‰ä¸€ä¸ªå¯å˜å‚æ•°ã€‚å‡½æ•°å‚æ•°é»˜è®¤æ˜¯å¸¸é‡ã€‚å¦‚æœä½ æƒ³è¦ä¸€ä¸ªå‡½æ•°å¯ä»¥ä¿®æ”¹å‚æ•°çš„å€¼ï¼Œå¹¶ä¸”æƒ³è¦åœ¨è¿™äº›ä¿®æ”¹åœ¨å‡½æ•°è°ƒç”¨ç»“æŸåä»ç„¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åº”è¯¥æŠŠè¿™ä¸ªå‚æ•°å®šä¹‰ä¸ºè¾“å…¥è¾“å‡ºå‚æ•°ï¼ˆIn-Out Parametersï¼‰ã€‚
</span><span class='line'>å½“ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ä¼ åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªé—­åŒ…åœ¨å‡½æ•°è¿”å›ä¹‹åæ‰è¢«æ‰§è¡Œï¼Œæˆ‘ä»¬ç§°è¯¥é—­åŒ…ä»å‡½æ•°ä¸­é€ƒé€¸ã€‚
</span><span class='line'>å‡½æ•°å’Œé—­åŒ…éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚
</span><span class='line'>Swift ä¸­ï¼Œè®¸å¤šåŸºæœ¬ç±»å‹ï¼Œè¯¸å¦‚Stringï¼ŒArrayå’ŒDictionaryç±»å‹å‡ä»¥ç»“æ„ä½“çš„å½¢å¼å®ç°ã€‚è¿™æ„å‘³ç€è¢«èµ‹å€¼ç»™æ–°çš„å¸¸é‡æˆ–å˜é‡ï¼Œæˆ–è€…è¢«ä¼ å…¥å‡½æ•°æˆ–æ–¹æ³•ä¸­æ—¶ï¼Œå®ƒä»¬çš„å€¼ä¼šè¢«æ‹·è´ã€‚
</span><span class='line'>Objective-C ä¸­NSStringï¼ŒNSArrayå’ŒNSDictionaryç±»å‹å‡ä»¥ç±»çš„å½¢å¼å®ç°ï¼Œè€Œå¹¶éç»“æ„ä½“ã€‚å®ƒä»¬åœ¨è¢«èµ‹å€¼æˆ–è€…è¢«ä¼ å…¥å‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä¸ä¼šå‘ç”Ÿå€¼æ‹·è´ï¼Œè€Œæ˜¯ä¼ é€’ç°æœ‰å®ä¾‹çš„å¼•ç”¨ã€‚
</span><span class='line'>ç±»å’Œç»“æ„ä½“åœ¨åˆ›å»ºå®ä¾‹æ—¶ï¼Œå¿…é¡»ä¸ºæ‰€æœ‰å­˜å‚¨å‹å±æ€§è®¾ç½®åˆé€‚çš„åˆå§‹å€¼ã€‚å­˜å‚¨å‹å±æ€§çš„å€¼ä¸èƒ½å¤„äºä¸€ä¸ªæœªçŸ¥çš„çŠ¶æ€ã€‚
</span><span class='line'>å½“ä¸ºå­˜å‚¨å‹å±æ€§è®¾ç½®é»˜è®¤å€¼æˆ–è€…åœ¨æ„é€ å™¨ä¸­ä¸ºå…¶èµ‹å€¼æ—¶ï¼Œå®ƒä»¬çš„å€¼æ˜¯è¢«ç›´æ¥è®¾ç½®çš„ï¼Œä¸ä¼šè§¦å‘ä»»ä½•å±æ€§è§‚å¯Ÿè€…ã€‚
</span><span class='line'>å¯ä»¥åœ¨æ„é€ è¿‡ç¨‹ä¸­ä¿®æ”¹å¸¸é‡å±æ€§.åªè¦åœ¨æ„é€ è¿‡ç¨‹ç»“æŸæ—¶æ˜¯ä¸€ä¸ªç¡®å®šçš„å€¼ã€‚å¯é€‰ç±»å‹çš„å±æ€§å°†è‡ªåŠ¨åˆå§‹åŒ–ä¸ºnil.
</span><span class='line'>ç»“æ„ä½“çš„é€ä¸€æˆå‘˜æ„é€ å™¨ï¼šå¦‚æœç»“æ„ä½“æ²¡æœ‰æä¾›è‡ªå®šä¹‰çš„æ„é€ å™¨ï¼Œå®ƒä»¬å°†è‡ªåŠ¨è·å¾—ä¸€ä¸ªé€ä¸€æˆå‘˜æ„é€ å™¨ï¼Œå³ä½¿ç»“æ„ä½“çš„å­˜å‚¨å‹å±æ€§æ²¡æœ‰é»˜è®¤å€¼ã€‚
</span><span class='line'>ç±»æ²¡æœ‰é»˜è®¤çš„é€ä¸€æˆå‘˜æ„é€ å™¨ã€‚
</span><span class='line'>å¦‚æœä½ ä¸ºæŸä¸ªå€¼ç±»å‹å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æ„é€ å™¨ï¼Œä½ å°†æ— æ³•è®¿é—®åˆ°é»˜è®¤æ„é€ å™¨ï¼ˆå¦‚æœæ˜¯ç»“æ„ä½“ï¼Œè¿˜å°†æ— æ³•è®¿é—®é€ä¸€æˆå‘˜æ„é€ å™¨ï¼‰ã€‚
</span><span class='line'>è¿™ç§é™åˆ¶å¯ä»¥é˜²æ­¢ä½ ä¸ºå€¼ç±»å‹å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„ä¸”ååˆ†å¤æ‚çš„æ„é€ å™¨ä¹‹å,ä»ç„¶æœ‰äººé”™è¯¯çš„ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„æ„é€ å™¨ã€‚
</span><span class='line'>å‡å¦‚ä½ å¸Œæœ›é»˜è®¤æ„é€ å™¨ã€é€ä¸€æˆå‘˜æ„é€ å™¨ä»¥åŠä½ è‡ªå·±çš„è‡ªå®šä¹‰æ„é€ å™¨éƒ½èƒ½ç”¨æ¥åˆ›å»ºå®ä¾‹ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„æ„é€ å™¨å†™åˆ°æ‰©å±•ï¼ˆextensionï¼‰ä¸­ï¼Œè€Œä¸æ˜¯å†™åœ¨å€¼ç±»å‹çš„åŸå§‹å®šä¹‰ä¸­ã€‚
</span><span class='line'>æ„é€ å™¨ä»£ç†çš„å®ç°è§„åˆ™å’Œå½¢å¼åœ¨å€¼ç±»å‹å’Œç±»ç±»å‹ä¸­æœ‰æ‰€ä¸åŒã€‚å€¼ç±»å‹ï¼ˆç»“æ„ä½“å’Œæšä¸¾ç±»å‹ï¼‰ä¸æ”¯æŒç»§æ‰¿ï¼Œæ‰€ä»¥æ„é€ å™¨ä»£ç†çš„è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬åªèƒ½ä»£ç†ç»™è‡ªå·±çš„å…¶å®ƒæ„é€ å™¨ã€‚ç±»åˆ™ä¸åŒï¼Œå®ƒå¯ä»¥ç»§æ‰¿è‡ªå…¶å®ƒç±»ï¼Œè¿™æ„å‘³ç€ç±»æœ‰è´£ä»»ä¿è¯å…¶æ‰€æœ‰ç»§æ‰¿çš„å­˜å‚¨å‹å±æ€§åœ¨æ„é€ æ—¶ä¹Ÿèƒ½æ­£ç¡®çš„åˆå§‹åŒ–ã€‚
</span><span class='line'>ç±»é‡Œé¢çš„æ‰€æœ‰å­˜å‚¨å‹å±æ€§â€”â€”åŒ…æ‹¬æ‰€æœ‰ç»§æ‰¿è‡ªçˆ¶ç±»çš„å±æ€§â€”â€”éƒ½å¿…é¡»åœ¨æ„é€ è¿‡ç¨‹ä¸­è®¾ç½®åˆå§‹å€¼ã€‚
</span><span class='line'>ç±»çš„æ„é€ å™¨ä»£ç†è§„åˆ™ï¼š
</span><span class='line'>æŒ‡å®šæ„é€ å™¨å¿…é¡»è°ƒç”¨å…¶ç›´æ¥çˆ¶ç±»çš„çš„æŒ‡å®šæ„é€ å™¨ã€‚
</span><span class='line'>ä¾¿åˆ©æ„é€ å™¨(convenience)å¿…é¡»è°ƒç”¨åŒç±»ä¸­å®šä¹‰çš„å…¶å®ƒæ„é€ å™¨ã€‚
</span><span class='line'>ä¾¿åˆ©æ„é€ å™¨å¿…é¡»æœ€ç»ˆå¯¼è‡´ä¸€ä¸ªæŒ‡å®šæ„é€ å™¨è¢«è°ƒç”¨ã€‚
</span><span class='line'>(æŒ‡å®šæ„é€ å™¨å¿…é¡»æ€»æ˜¯å‘ä¸Šä»£ç†ï¼Œä¾¿åˆ©æ„é€ å™¨å¿…é¡»æ€»æ˜¯æ¨ªå‘ä»£ç†ï¼‰
</span><span class='line'>ä¸¤æ®µå¼æ„é€ è¿‡ç¨‹:
</span><span class='line'>ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªå­˜å‚¨å‹å±æ€§è¢«å¼•å…¥å®ƒä»¬çš„ç±»æŒ‡å®šä¸€ä¸ªåˆå§‹å€¼ã€‚å½“æ¯ä¸ªå­˜å‚¨å‹å±æ€§çš„åˆå§‹å€¼è¢«ç¡®å®šåï¼Œç¬¬äºŒé˜¶æ®µå¼€å§‹ï¼Œå®ƒç»™æ¯ä¸ªç±»ä¸€æ¬¡æœºä¼šï¼Œåœ¨æ–°å®ä¾‹å‡†å¤‡ä½¿ç”¨ä¹‹å‰è¿›ä¸€æ­¥å®šåˆ¶å®ƒä»¬çš„å­˜å‚¨å‹å±æ€§ã€‚å­ç±»å¯ä»¥åœ¨åˆå§‹åŒ–æ—¶ä¿®æ”¹ç»§æ‰¿æ¥çš„å˜é‡å±æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹ç»§æ‰¿æ¥çš„å¸¸é‡å±æ€§ã€‚
</span><span class='line'>è·Ÿ Objective-C ä¸­çš„å­ç±»ä¸åŒï¼ŒSwift ä¸­çš„å­ç±»é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç»§æ‰¿çˆ¶ç±»çš„æ„é€ å™¨ã€‚Swift çš„è¿™ç§æœºåˆ¶å¯ä»¥é˜²æ­¢ä¸€ä¸ªçˆ¶ç±»çš„ç®€å•æ„é€ å™¨è¢«ä¸€ä¸ªæ›´ç²¾ç»†çš„å­ç±»ç»§æ‰¿ï¼Œå¹¶è¢«é”™è¯¯åœ°ç”¨æ¥åˆ›å»ºå­ç±»çš„å®ä¾‹ã€‚å­ç±»ä¸èƒ½è°ƒç”¨çˆ¶ç±»çš„ä¾¿åˆ©æ„é€ å™¨ã€‚æ‰€ä»¥åœ¨å­ç±»ä¸­â€œé‡å†™â€ä¸€ä¸ªçˆ¶ç±»ä¾¿åˆ©æ„é€ å™¨æ—¶ï¼Œä¸éœ€è¦åŠ overrideå‰ç¼€ã€‚
</span><span class='line'>å‡è®¾ä½ ä¸ºå­ç±»ä¸­å¼•å…¥çš„æ‰€æœ‰æ–°å±æ€§éƒ½æä¾›äº†é»˜è®¤å€¼,ä»¥ä¸‹ 2 ä¸ªè§„åˆ™é€‚ç”¨ï¼š
</span><span class='line'>1.å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰ä»»ä½•æŒ‡å®šæ„é€ å™¨ï¼Œå®ƒå°†è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çˆ¶ç±»çš„æŒ‡å®šæ„é€ å™¨ã€‚
</span><span class='line'>2.å¦‚æœå­ç±»æä¾›äº†æ‰€æœ‰çˆ¶ç±»æŒ‡å®šæ„é€ å™¨çš„å®ç°â€”â€”æ— è®ºæ˜¯é€šè¿‡è§„åˆ™ 1 ç»§æ‰¿è¿‡æ¥çš„ï¼Œè¿˜æ˜¯æä¾›äº†è‡ªå®šä¹‰å®ç°â€”â€”å®ƒå°†è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çˆ¶ç±»çš„ä¾¿åˆ©æ„é€ å™¨ã€‚
</span><span class='line'>å¯¹äºè§„åˆ™ 2ï¼Œå­ç±»å¯ä»¥å°†çˆ¶ç±»çš„æŒ‡å®šæ„é€ å™¨å®ç°ä¸ºä¾¿åˆ©æ„é€ å™¨ã€‚
</span><span class='line'>ææ„å™¨åªé€‚ç”¨äºç±»ï¼Œå½“ä¸€ä¸ªç±»çš„å®ä¾‹è¢«é‡Šæ”¾ä¹‹å‰ï¼Œææ„å™¨ä¼šè¢«ç«‹å³è°ƒç”¨ã€‚ææ„å™¨ç”¨å…³é”®å­—deinitæ¥æ ‡ç¤ºã€‚æ¯ä¸ªç±»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªææ„å™¨ï¼Œè€Œä¸”ææ„å™¨ä¸å¸¦ä»»ä½•å‚æ•°ã€‚ææ„å™¨æ˜¯åœ¨å®ä¾‹é‡Šæ”¾å‘ç”Ÿå‰è¢«è‡ªåŠ¨è°ƒç”¨ã€‚ä½ ä¸èƒ½ä¸»åŠ¨è°ƒç”¨ææ„å™¨ã€‚å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„ææ„å™¨ï¼Œå¹¶ä¸”åœ¨å­ç±»ææ„å™¨å®ç°çš„æœ€åï¼Œçˆ¶ç±»çš„ææ„å™¨ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚å³ä½¿å­ç±»æ²¡æœ‰æä¾›è‡ªå·±çš„ææ„å™¨ï¼Œçˆ¶ç±»çš„ææ„å™¨ä¹ŸåŒæ ·ä¼šè¢«è°ƒç”¨ã€‚
</span><span class='line'>ç”¨ç±»å‹æ£€æŸ¥æ“ä½œç¬¦ï¼ˆisï¼‰æ¥æ£€æŸ¥ä¸€ä¸ªå®ä¾‹æ˜¯å¦å±äºç‰¹å®šå­ç±»å‹ã€‚è‹¥å®ä¾‹å±äºé‚£ä¸ªå­ç±»å‹ï¼Œç±»å‹æ£€æŸ¥æ“ä½œç¬¦è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
</span><span class='line'>æŸç±»å‹çš„ä¸€ä¸ªå¸¸é‡æˆ–å˜é‡å¯èƒ½åœ¨å¹•åå®é™…ä¸Šå±äºä¸€ä¸ªå­ç±»ã€‚å½“ç¡®å®šæ˜¯è¿™ç§æƒ…å†µæ—¶ï¼Œä½ å¯ä»¥å°è¯•å‘ä¸‹è½¬åˆ°å®ƒçš„å­ç±»å‹ï¼Œç”¨ç±»å‹è½¬æ¢æ“ä½œç¬¦ï¼ˆas? æˆ– as!ï¼‰ã€‚
</span><span class='line'>Any å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬å‡½æ•°ç±»å‹ã€‚AnyObject å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»çš„å®ä¾‹ã€‚
</span><span class='line'>å¦‚æœä¸€æ¡catchå­å¥æ²¡æœ‰æŒ‡å®šåŒ¹é…æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™æ¡å­å¥å¯ä»¥åŒ¹é…ä»»ä½•é”™è¯¯ï¼Œå¹¶ä¸”æŠŠé”™è¯¯ç»‘å®šåˆ°ä¸€ä¸ªåå­—ä¸ºerrorçš„å±€éƒ¨å¸¸é‡ã€‚
</span><span class='line'>å¯ä»¥ä½¿ç”¨deferè¯­å¥åœ¨å³å°†ç¦»å¼€å½“å‰ä»£ç å—æ—¶æ‰§è¡Œä¸€ç³»åˆ—è¯­å¥ã€‚ä»¥ç”¨deferè¯­å¥æ¥ç¡®ä¿æ–‡ä»¶æè¿°ç¬¦å¾—ä»¥å…³é—­ï¼Œä»¥åŠæ‰‹åŠ¨åˆ†é…çš„å†…å­˜å¾—ä»¥é‡Šæ”¾ã€‚
</span><span class='line'>deferè¯­å¥å°†ä»£ç çš„æ‰§è¡Œå»¶è¿Ÿåˆ°å½“å‰çš„ä½œç”¨åŸŸé€€å‡ºä¹‹å‰ã€‚
</span><span class='line'>å¯é€‰é“¾å¼è°ƒç”¨æ˜¯ä¸€ç§å¯ä»¥åœ¨å½“å‰å€¼å¯èƒ½ä¸ºnilçš„å¯é€‰å€¼ä¸Šè¯·æ±‚å’Œè°ƒç”¨å±æ€§ã€æ–¹æ³•åŠä¸‹æ ‡çš„æ–¹æ³•ã€‚å¦‚æœå¯é€‰å€¼æœ‰å€¼ï¼Œé‚£ä¹ˆè°ƒç”¨å°±ä¼šæˆåŠŸï¼›å¦‚æœå¯é€‰å€¼æ˜¯nilï¼Œé‚£ä¹ˆè°ƒç”¨å°†è¿”å›nilã€‚å¤šä¸ªè°ƒç”¨å¯ä»¥è¿æ¥åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªè°ƒç”¨é“¾ï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸ºnilï¼Œæ•´ä¸ªè°ƒç”¨é“¾éƒ½ä¼šå¤±è´¥ï¼Œå³è¿”å›nilã€‚
</span><span class='line'>é€šè¿‡å¯é€‰é“¾å¼è°ƒç”¨è®¿é—®å¯é€‰å€¼çš„ä¸‹æ ‡æ—¶ï¼Œåº”è¯¥å°†é—®å·æ”¾åœ¨ä¸‹æ ‡æ–¹æ‹¬å·çš„å‰é¢è€Œä¸æ˜¯åé¢ã€‚å¯é€‰é“¾å¼è°ƒç”¨çš„é—®å·ä¸€èˆ¬ç›´æ¥è·Ÿåœ¨å¯é€‰è¡¨è¾¾å¼çš„åé¢ã€‚
</span><span class='line'>å¼•ç”¨è®¡æ•°ä»…ä»…åº”ç”¨äºç±»çš„å®ä¾‹ã€‚ç»“æ„ä½“å’Œæšä¸¾ç±»å‹æ˜¯å€¼ç±»å‹ï¼Œä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¹Ÿä¸æ˜¯é€šè¿‡å¼•ç”¨çš„æ–¹å¼å­˜å‚¨å’Œä¼ é€’ã€‚
</span><span class='line'>å¦‚æœä¸¤ä¸ªç±»å®ä¾‹äº’ç›¸æŒæœ‰å¯¹æ–¹çš„å¼ºå¼•ç”¨ï¼Œå› è€Œæ¯ä¸ªå®ä¾‹éƒ½è®©å¯¹æ–¹ä¸€ç›´å­˜åœ¨ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¾ªç¯å¼ºå¼•ç”¨ã€‚
</span><span class='line'>å¯ä»¥é€šè¿‡å®šä¹‰ç±»ä¹‹é—´çš„å…³ç³»ä¸ºå¼±å¼•ç”¨æˆ–æ— ä¸»å¼•ç”¨ï¼Œä»¥æ›¿ä»£å¼ºå¼•ç”¨ï¼Œä»è€Œè§£å†³å¾ªç¯å¼ºå¼•ç”¨çš„é—®é¢˜ã€‚
</span><span class='line'>å¼±å¼•ç”¨å’Œæ— ä¸»å¼•ç”¨å…è®¸å¾ªç¯å¼•ç”¨ä¸­çš„ä¸€ä¸ªå®ä¾‹å¼•ç”¨è€Œå¦å¤–ä¸€ä¸ªå®ä¾‹ä¸ä¿æŒå¼ºå¼•ç”¨ã€‚è¿™æ ·å®ä¾‹èƒ½å¤Ÿäº’ç›¸å¼•ç”¨è€Œä¸äº§ç”Ÿå¾ªç¯å¼ºå¼•ç”¨ã€‚
</span><span class='line'>ç”Ÿå‘½å‘¨æœŸæ›´é•¿çš„è¯ç”¨å¼±å¼•ç”¨(å¦‚å…¬å¯“å’Œç§Ÿå®¢ï¼Œåœ¨å…¬å¯“å¯¹è±¡é‡Œçš„ç§Ÿå®¢å±æ€§ç”¨å¼±å¼•ç”¨weak)ï¼Œæ›´çŸ­çš„è¯ç”¨æ— ä¸»å¼•ç”¨(å®¢æˆ·å’Œé“¶è¡Œå¡çš„å…³ç³»ï¼Œå®¢æˆ·ä¸ä¸€å®šæœ‰é“¶è¡Œå¡ï¼Œé“¶è¡Œå¡ä¸€å®šå±äºæŸä¸ªå®¢æˆ·ï¼Œæ‰€ä»¥åœ¨é“¶è¡Œå¡å¯¹è±¡é‡Œçš„éå¯é€‰å±æ€§å®¢æˆ·å‰ç”¨æ— ä¸»å¼•ç”¨unowned)ã€‚å½“ ARC è®¾ç½®å¼±å¼•ç”¨ä¸ºnilæ—¶ï¼Œå±æ€§è§‚å¯Ÿä¸ä¼šè¢«è§¦å‘ã€‚
</span><span class='line'>Personå’ŒApartmentçš„ä¾‹å­å±•ç¤ºäº†ä¸¤ä¸ªå±æ€§çš„å€¼éƒ½å…è®¸ä¸ºnilï¼Œå¹¶ä¼šæ½œåœ¨çš„äº§ç”Ÿå¾ªç¯å¼ºå¼•ç”¨ã€‚è¿™ç§åœºæ™¯æœ€é€‚åˆç”¨å¼±å¼•ç”¨æ¥è§£å†³ã€‚
</span><span class='line'>Customerå’ŒCreditCardçš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªå±æ€§çš„å€¼å…è®¸ä¸ºnilï¼Œè€Œå¦ä¸€ä¸ªå±æ€§çš„å€¼ä¸å…è®¸ä¸ºnilï¼Œè¿™ä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿå¾ªç¯å¼ºå¼•ç”¨ã€‚è¿™ç§åœºæ™¯æœ€é€‚åˆé€šè¿‡æ— ä¸»å¼•ç”¨æ¥è§£å†³ã€‚
</span><span class='line'>å­˜åœ¨ç€ç¬¬ä¸‰ç§åœºæ™¯ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œä¸¤ä¸ªå±æ€§éƒ½å¿…é¡»æœ‰å€¼ï¼Œå¹¶ä¸”åˆå§‹åŒ–å®Œæˆåæ°¸è¿œä¸ä¼šä¸ºnilã€‚åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œéœ€è¦ä¸€ä¸ªç±»ä½¿ç”¨æ— ä¸»å±æ€§ï¼Œè€Œå¦å¤–ä¸€ä¸ªç±»ä½¿ç”¨éšå¼è§£æå¯é€‰å±æ€§ã€‚</span></code></pre></td></tr></table></div></figure>


<p><img src="/myimg/ios/swift0.png" width="700" alt="" />
<img src="/myimg/ios/swift1.png" width="700" alt="" />
<img src="/myimg/ios/swift2.png" width="700" alt="" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>æ— ä¸»å¼•ç”¨é€šå¸¸éƒ½è¢«æœŸæœ›æ‹¥æœ‰å€¼ã€‚ä¸è¿‡ ARC æ— æ³•åœ¨å®ä¾‹è¢«é”€æ¯åå°†æ— ä¸»å¼•ç”¨è®¾ä¸ºnilï¼Œå› ä¸ºéå¯é€‰ç±»å‹çš„å˜é‡ä¸å…è®¸è¢«èµ‹å€¼ä¸ºnilã€‚
</span><span class='line'>ä½¿ç”¨æ— ä¸»å¼•ç”¨ï¼Œä½ å¿…é¡»ç¡®ä¿å¼•ç”¨å§‹ç»ˆæŒ‡å‘ä¸€ä¸ªæœªé”€æ¯çš„å®ä¾‹ã€‚
</span><span class='line'>å¦‚æœä½ è¯•å›¾åœ¨å®ä¾‹è¢«é”€æ¯åï¼Œè®¿é—®è¯¥å®ä¾‹çš„æ— ä¸»å¼•ç”¨ï¼Œä¼šè§¦å‘è¿è¡Œæ—¶é”™è¯¯ã€‚
</span><span class='line'>å¾ªç¯å¼ºå¼•ç”¨è¿˜ä¼šå‘ç”Ÿåœ¨å½“ä½ å°†ä¸€ä¸ªé—­åŒ…èµ‹å€¼ç»™ç±»å®ä¾‹çš„æŸä¸ªå±æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªé—­åŒ…ä½“ä¸­åˆä½¿ç”¨äº†è¿™ä¸ªç±»å®ä¾‹æ—¶ã€‚è¿™ä¸ªé—­åŒ…ä½“ä¸­å¯èƒ½è®¿é—®äº†å®ä¾‹çš„æŸä¸ªå±æ€§ï¼Œä¾‹å¦‚self.somePropertyï¼Œæˆ–è€…é—­åŒ…ä¸­è°ƒç”¨äº†å®ä¾‹çš„æŸä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚self.someMethod()ã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½å¯¼è‡´äº†é—­åŒ…â€œæ•è·â€selfï¼Œä»è€Œäº§ç”Ÿäº†å¾ªç¯å¼ºå¼•ç”¨ã€‚å¾ªç¯å¼ºå¼•ç”¨çš„äº§ç”Ÿï¼Œæ˜¯å› ä¸ºé—­åŒ…å’Œç±»ç›¸ä¼¼ï¼Œéƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚è™½ç„¶é—­åŒ…å¤šæ¬¡ä½¿ç”¨äº†selfï¼Œå®ƒåªæ•è·å®ä¾‹çš„ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚
</span><span class='line'>åœ¨å®šä¹‰é—­åŒ…æ—¶åŒæ—¶å®šä¹‰æ•è·åˆ—è¡¨ä½œä¸ºé—­åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥è§£å†³é—­åŒ…å’Œç±»å®ä¾‹ä¹‹é—´çš„å¾ªç¯å¼ºå¼•ç”¨ã€‚
</span><span class='line'>æ•è·åˆ—è¡¨å®šä¹‰äº†é—­åŒ…ä½“å†…æ•è·ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¼•ç”¨ç±»å‹çš„è§„åˆ™ã€‚è·Ÿè§£å†³ä¸¤ä¸ªç±»å®ä¾‹é—´çš„å¾ªç¯å¼ºå¼•ç”¨ä¸€æ ·ï¼Œå£°æ˜æ¯ä¸ªæ•è·çš„å¼•ç”¨ä¸ºå¼±å¼•ç”¨æˆ–æ— ä¸»å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¼ºå¼•ç”¨ã€‚åº”å½“æ ¹æ®ä»£ç å…³ç³»æ¥å†³å®šä½¿ç”¨å¼±å¼•ç”¨è¿˜æ˜¯æ— ä¸»å¼•ç”¨ã€‚
</span><span class='line'>Swift æœ‰å¦‚ä¸‹è¦æ±‚ï¼šåªè¦åœ¨é—­åŒ…å†…ä½¿ç”¨selfçš„æˆå‘˜ï¼Œå°±è¦ç”¨self.somePropertyæˆ–è€…self.someMethod()ï¼ˆè€Œä¸åªæ˜¯somePropertyæˆ–someMethod()ï¼‰ã€‚è¿™æé†’ä½ å¯èƒ½ä¼šä¸€ä¸å°å¿ƒå°±æ•è·äº†selfã€‚
</span><span class='line'>å¼±å¼•ç”¨æ€»æ˜¯å¯é€‰ç±»å‹ï¼Œå¹¶ä¸”å½“å¼•ç”¨çš„å®ä¾‹è¢«é”€æ¯åï¼Œå¼±å¼•ç”¨çš„å€¼ä¼šè‡ªåŠ¨ç½®ä¸ºnilã€‚å¦‚æœè¢«æ•è·çš„å¼•ç”¨ç»å¯¹ä¸ä¼šå˜ä¸ºnilï¼Œåº”è¯¥ç”¨æ— ä¸»å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¼±å¼•ç”¨ã€‚
</span><span class='line'>æ‰©å±•å¯ä»¥ä¸ºæ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸èƒ½é‡å†™å·²æœ‰çš„åŠŸèƒ½ã€‚å¯ä»¥æ·»åŠ è®¡ç®—å‹å±æ€§ï¼Œä¸èƒ½æ·»åŠ å­˜å‚¨å±æ€§ã€‚ä¹Ÿä¸å¯ä»¥ä¸ºå·²æœ‰å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ã€‚Swift çš„æ‰©å±•æ²¡æœ‰åå­—ã€‚
</span><span class='line'>å¦‚æœä½ é€šè¿‡æ‰©å±•ä¸ºä¸€ä¸ªå·²æœ‰ç±»å‹æ·»åŠ æ–°åŠŸèƒ½ï¼Œé‚£ä¹ˆæ–°åŠŸèƒ½å¯¹è¯¥ç±»å‹çš„æ‰€æœ‰å·²æœ‰å®ä¾‹éƒ½æ˜¯å¯ç”¨çš„ï¼Œå³ä½¿å®ƒä»¬æ˜¯åœ¨è¿™ä¸ªæ‰©å±•å®šä¹‰ä¹‹å‰åˆ›å»ºçš„ã€‚
</span><span class='line'>å¦‚æœä½ åœ¨åè®®ä¸­å®šä¹‰äº†ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ”¹å˜éµå¾ªè¯¥åè®®çš„ç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆåœ¨å®šä¹‰åè®®æ—¶éœ€è¦åœ¨æ–¹æ³•å‰åŠ  mutating å…³é”®å­—ã€‚
</span><span class='line'>å®ç°åè®®ä¸­çš„ mutating æ–¹æ³•æ—¶ï¼Œè‹¥æ˜¯ç±»ç±»å‹ï¼Œåˆ™ä¸ç”¨å†™ mutating å…³é”®å­—ã€‚è€Œå¯¹äºç»“æ„ä½“å’Œæšä¸¾ï¼Œåˆ™å¿…é¡»å†™ mutating å…³é”®å­—ã€‚
</span><span class='line'>mutatingï¼šè¡¨ç¤ºå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­ä¿®æ”¹å®ƒæ‰€å±çš„å®ä¾‹ä»¥åŠå®ä¾‹çš„ä»»æ„å±æ€§çš„å€¼ã€‚
</span><span class='line'>å§”æ‰˜æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ç±»æˆ–ç»“æ„ä½“å°†ä¸€äº›éœ€è¦å®ƒä»¬è´Ÿè´£çš„åŠŸèƒ½å§”æ‰˜ç»™å…¶ä»–ç±»å‹çš„å®ä¾‹ã€‚å§”æ‰˜æ¨¡å¼çš„å®ç°å¾ˆç®€å•ï¼šå®šä¹‰åè®®æ¥å°è£…é‚£äº›éœ€è¦è¢«å§”æ‰˜çš„åŠŸèƒ½ï¼Œè¿™æ ·å°±èƒ½ç¡®ä¿éµå¾ªåè®®çš„ç±»å‹èƒ½æä¾›è¿™äº›åŠŸèƒ½ã€‚å§”æ‰˜æ¨¡å¼å¯ä»¥ç”¨æ¥å“åº”ç‰¹å®šçš„åŠ¨ä½œï¼Œæˆ–è€…æ¥æ”¶å¤–éƒ¨æ•°æ®æºæä¾›çš„æ•°æ®ï¼Œè€Œæ— éœ€å…³å¿ƒå¤–éƒ¨æ•°æ®æºçš„ç±»å‹ã€‚
</span><span class='line'>æ ‡è®° @objc ç‰¹æ€§çš„åè®®åªèƒ½è¢«ç»§æ‰¿è‡ª Objective-C ç±»çš„ç±»æˆ–è€… @objc ç±»éµå¾ªï¼Œå…¶ä»–ç±»ä»¥åŠç»“æ„ä½“å’Œæšä¸¾å‡ä¸èƒ½éµå¾ªè¿™ç§åè®®ã€‚</span></code></pre></td></tr></table></div></figure>

</div>
  
  


      | <a href="/blog/2016/08/04/swift-read/#comments">Comments</a>


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/04/animation/">iOSä¸­çš„åŠ¨ç”»</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-04T16:22:41+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:22 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>åŠ¨ç”»æ˜¯ä½œç”¨çš„UIViewçš„CALayerä¸Šçš„ï¼ŒUIViewæ˜¯CALayerçš„ä»£ç†ï¼Œç»™CALayeræä¾›æ•°æ®å‚æ•°ï¼ŒCALayerè´Ÿè´£æ¸²æŸ“å’ŒåŠ¨ç”»ã€‚UIViewæ˜¯åœ¨UIKitæ¡†æ¶ä¸­ï¼Œè€ŒCALayeræ˜¯åœ¨QuartzCoreæ¡†æ¶ä¸­ã€‚UIViewå¯ä»¥å“åº”ç”¨æˆ·äº‹ä»¶ï¼Œè€ŒCALayerä¸å¯ä»¥å“åº”ç”¨æˆ·äº‹ä»¶ã€‚CALayerä¹Ÿå¯ä»¥åƒUIViewä¸€æ ·æ·»åŠ å­Layerã€‚
<img src="/myimg/ios/calayer.png" alt="image" /></p>

<h4>CALayerå¸¸ç”¨å±æ€§</h4>

<pre><code>anchorPoint å’Œä¸­å¿ƒç‚¹positioné‡åˆçš„ä¸€ä¸ªç‚¹ï¼Œç§°ä¸ºâ€œé”šç‚¹â€ï¼Œé”šç‚¹çš„æè¿°æ˜¯ç›¸å¯¹äºxã€yä½ç½®æ¯”ä¾‹è€Œè¨€çš„é»˜è®¤åœ¨å›¾åƒä¸­å¿ƒç‚¹(0.5,0.5)çš„ä½ç½®
backgroundColor å›¾å±‚èƒŒæ™¯é¢œè‰²  
borderColor è¾¹æ¡†é¢œè‰²    
borderWidth è¾¹æ¡†å®½åº¦    
bounds  å›¾å±‚å¤§å°    
contents    å›¾å±‚æ˜¾ç¤ºå†…å®¹ï¼Œä¾‹å¦‚å¯ä»¥å°†å›¾ç‰‡ä½œä¸ºå›¾å±‚å†…å®¹æ˜¾ç¤º
contentsRect    å›¾å±‚æ˜¾ç¤ºå†…å®¹çš„å¤§å°å’Œä½ç½®    
cornerRadius    åœ†è§’åŠå¾„    
doubleSided å›¾å±‚èƒŒé¢æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤ä¸ºYES 
frame   å›¾å±‚å¤§å°å’Œä½ç½®ï¼Œä¸æ”¯æŒéšå¼åŠ¨ç”»ï¼Œæ‰€ä»¥CALayerä¸­å¾ˆå°‘ä½¿ç”¨frameï¼Œé€šå¸¸ä½¿ç”¨boundså’Œpositionä»£æ›¿
hidden  æ˜¯å¦éšè—    
mask    å›¾å±‚è’™ç‰ˆ    
maskToBounds    å­å›¾å±‚æ˜¯å¦å‰ªåˆ‡å›¾å±‚è¾¹ç•Œï¼Œé»˜è®¤ä¸ºNO 
opacity é€æ˜åº¦ ï¼Œç±»ä¼¼äºUIViewçš„alpha    
position    å›¾å±‚ä¸­å¿ƒç‚¹ä½ç½®ï¼Œç±»ä¼¼äºUIViewçš„center
shadowColor é˜´å½±é¢œè‰²    
shadowOffset    é˜´å½±åç§»é‡ 
shadowOpacity   é˜´å½±é€æ˜åº¦ï¼Œæ³¨æ„é»˜è®¤ä¸º0ï¼Œå¦‚æœè®¾ç½®é˜´å½±å¿…é¡»è®¾ç½®æ­¤å±æ€§
shadowPath  é˜´å½±çš„å½¢çŠ¶ 
shadowRadius    é˜´å½±æ¨¡ç³ŠåŠå¾„  
sublayers   å­å›¾å±‚   
sublayerTransform   å­å›¾å±‚å½¢å˜ 
transform   å›¾å±‚å½¢å˜
</code></pre>

<p>è¦æ³¨æ„positionå’ŒanchorPointçš„åŒºåˆ«ï¼š<strong>positionæ˜¯layerä¸­çš„anchorPointç‚¹åœ¨superLayerä¸­çš„ä½ç½®åæ ‡ï¼positionç‚¹æ˜¯ç›¸å¯¹suerLayerçš„ï¼ŒanchorPointç‚¹æ˜¯ç›¸å¯¹è‡ªèº«layerçš„ï¼</strong> æ‰€ä»¥è¯´positionä¸å˜ï¼Œä½†anchorPointæ”¹å˜çš„è¯ï¼Œä¹Ÿä¼šæ”¹å˜layeråœ¨superLayerä¸­çš„ä½ç½®ï¼</p>

<pre><code>layer=[[CALayer alloc]init];
layer.backgroundColor=[UIColor purpleColor].CGColor;
layer.bounds=CGRectMake(0, 0, 100,100);
layer.shadowColor=[UIColor redColor].CGColor;
layer.shadowOffset=CGSizeMake(5, 5);
layer.shadowOpacity=0.7;
layer.borderColor=[UIColor yellowColor].CGColor;
layer.borderWidth=3;
layer.position=CGPointMake(size.width/2, size.height/2);
[self.view.layer addSublayer:layer];

//layer.anchorPoint=CGPointMake(0, 0); //å›¾ä¸€
//layer.anchorPoint=CGPointMake(0, 1); //å›¾äºŒ
</code></pre>

<p>å›¾ä¸­positionä¸€æ ·ï¼Œä½†anchorPointä¸ä¸€æ ·ï¼Œæ‰€ä»¥å›¾ç‰‡ä½ç½®ä¹Ÿä¸ä¸€æ ·ã€‚  <br/>
<img src="/myimg/ios/layer_position.png" alt="image" />
æ³¨æ„å¦‚æœè¦è®¾ç½®åœ†è§’ï¼Œå¯¹äºå›¾å±‚æœ¬èº«è€Œè¨€å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼Œä½†æ˜¯å¯¹äºå›¾å±‚ä¸­ç»˜åˆ¶çš„å›¾ç‰‡æ— æ³•æ­£ç¡®æ˜¾ç¤ºã€‚å¦‚æœæƒ³è¦å›¾ç‰‡æ­£ç¡®æ˜¾ç¤ºåˆ™å¿…é¡»è®¾ç½®masksToBounds=YESï¼Œå‰ªåˆ‡å­å›¾å±‚ã€‚ä½†è®¾ç½®layer.masksToBounds=YESåï¼Œå›¾å±‚çš„å½±æ•ˆæœæ— æ³•å’ŒmasksToBounds=YESåŒæ—¶ä½¿ç”¨ï¼Œå› ä¸ºmasksToBoundsçš„ç›®çš„å°±æ˜¯å‰ªåˆ‡å¤–è¾¹æ¡†ã€‚å¦‚æœåŒæ—¶è¦é˜´å½±åˆè¦åœ†è§’çš„è¯ï¼Œå°±ç”¨ä¸¤ä¸ªé‡å çš„å›¾å±‚,åº•éƒ¨è´Ÿè´£ç»˜åˆ¶é˜´å½±ï¼Œä¸Šå±‚è´Ÿè´£ç»˜åˆ¶åœ†è§’ã€‚</p>

<h4>Core Animation</h4>

<p>iOSçš„æ ¸å¿ƒåŠ¨ç”»Core AnimationåŒ…å«åœ¨Quartz Coreæ¡†æ¶ä¸­ã€‚æ ¸å¿ƒåŠ¨ç”»åˆ†ä¸ºå‡ ç±»ï¼šåŸºç¡€åŠ¨ç”»ã€å…³é”®å¸§åŠ¨ç”»ã€åŠ¨ç”»ç»„ã€è½¬åœºåŠ¨ç”»,å„ä¸ªç±»çš„å…³ç³»å¤§è‡´å¦‚ä¸‹ï¼š
<img src="/myimg/ios/core_animation.png" alt="image" />
*CAAnimationï¼šæ ¸å¿ƒåŠ¨ç”»çš„åŸºç¡€ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè´Ÿè´£åŠ¨ç”»è¿è¡Œæ—¶é—´ã€é€Ÿåº¦çš„æ§åˆ¶ï¼Œæœ¬èº«å®ç°äº†CAMediaTimingåè®®ã€‚</p>

<p>*CAPropertyAnimationï¼šå±æ€§åŠ¨ç”»çš„åŸºç±»ï¼Œé€šè¿‡å±æ€§è¿›è¡ŒåŠ¨ç”»è®¾ç½®ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚</p>

<p>*CAAnimationGroupï¼šåŠ¨ç”»ç»„åˆæ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡åŠ¨ç”»ç»„æ¥è¿›è¡Œæ‰€æœ‰åŠ¨ç”»è¡Œä¸ºçš„ç»Ÿä¸€æ§åˆ¶ï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»æ•ˆæœå¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</p>

<p>*CATransitionï¼šè½¬åœºåŠ¨ç”»ï¼Œä¸»è¦é€šè¿‡æ»¤é•œè¿›è¡ŒåŠ¨ç”»æ•ˆæœè®¾ç½®ã€‚</p>

<p>*CABasicAnimationï¼šåŸºç¡€åŠ¨ç”»ï¼Œé€šè¿‡å±æ€§ä¿®æ”¹è¿›è¡ŒåŠ¨ç”»å‚æ•°æ§åˆ¶ï¼Œåªæœ‰åˆå§‹çŠ¶æ€å’Œç»“æŸçŠ¶æ€ã€‚</p>

<p>*CAKeyframeAnimationï¼šå…³é”®å¸§åŠ¨ç”»ï¼ŒåŒæ ·æ˜¯é€šè¿‡å±æ€§è¿›è¡ŒåŠ¨ç”»å‚æ•°æ§åˆ¶ï¼Œä½†æ˜¯åŒåŸºç¡€åŠ¨ç”»ä¸åŒçš„æ˜¯å®ƒå¯ä»¥æœ‰å¤šä¸ªçŠ¶æ€æ§åˆ¶ã€‚</p>

<p>åŸºç¡€åŠ¨ç”»ã€å…³é”®å¸§åŠ¨ç”»éƒ½å±äºå±æ€§åŠ¨ç”»ï¼Œå°±æ˜¯é€šè¿‡ä¿®æ”¹å±æ€§å€¼äº§ç”ŸåŠ¨ç”»æ•ˆæœï¼Œåªéœ€è¦è®¾ç½®åˆå§‹å€¼å’Œç»“æŸå€¼ï¼Œä¸­é—´çš„è¿‡ç¨‹åŠ¨ç”»ç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—äº§ç”Ÿã€‚å’ŒåŸºç¡€åŠ¨ç”»ä¸åŒçš„æ˜¯å…³é”®å¸§åŠ¨ç”»å¯ä»¥è®¾ç½®å¤šä¸ªå±æ€§å€¼ï¼Œæ¯ä¸¤ä¸ªå±æ€§ä¸­é—´çš„è¿‡æ¸¡åŠ¨ç”»ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆã€‚</p>
</div>
  
  


      | <a href="/blog/2016/08/04/animation/#comments">Comments</a>


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/12/30/utf8/">Unicodeã€UTF-8ç¼–ç èµ·æº</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/28/google-protocol-buffer/">Google Protocol Buffer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/27/suan-fa/">æ’åºç®—æ³•</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/25/front-end/">å‰ç«¯åŸºç¡€çŸ¥è¯†</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/21/es6/">ECMAScript 6</a>
      </li>
    
  </ul>
</section>




<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/android/'>android (9)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (9)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (6)</a></li>
<li class='category'><a href='/blog/categories/javascript/'>javascript (5)</a></li>
<li class='category'><a href='/blog/categories/other/'>other (5)</a></li>
<li class='category'><a href='/blog/categories/react/'>react (8)</a></li>

  </ul>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - guimingsu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
